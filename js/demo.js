var THREE={REVISION:"71"};if(typeof module==="object"){module.exports=THREE}if(Math.sign===undefined){Math.sign=function(e){return e<0?-1:e>0?1:+e}}THREE.log=function(){console.log.apply(console,arguments)};THREE.warn=function(){console.warn.apply(console,arguments)};THREE.error=function(){console.error.apply(console,arguments)};THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.MinEquation=103;THREE.MaxEquation=104;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.UVMapping=300;THREE.CubeReflectionMapping=301;THREE.CubeRefractionMapping=302;THREE.EquirectangularReflectionMapping=303;THREE.EquirectangularRefractionMapping=304;THREE.SphericalReflectionMapping=305;THREE.RepeatWrapping=1e3;THREE.ClampToEdgeWrapping=1001;THREE.MirroredRepeatWrapping=1002;THREE.NearestFilter=1003;THREE.NearestMipMapNearestFilter=1004;THREE.NearestMipMapLinearFilter=1005;THREE.LinearFilter=1006;THREE.LinearMipMapNearestFilter=1007;THREE.LinearMipMapLinearFilter=1008;THREE.UnsignedByteType=1009;THREE.ByteType=1010;THREE.ShortType=1011;THREE.UnsignedShortType=1012;THREE.IntType=1013;THREE.UnsignedIntType=1014;THREE.FloatType=1015;THREE.HalfFloatType=1025;THREE.UnsignedShort4444Type=1016;THREE.UnsignedShort5551Type=1017;THREE.UnsignedShort565Type=1018;THREE.AlphaFormat=1019;THREE.RGBFormat=1020;THREE.RGBAFormat=1021;THREE.LuminanceFormat=1022;THREE.LuminanceAlphaFormat=1023;THREE.RGBEFormat=THREE.RGBAFormat;THREE.RGB_S3TC_DXT1_Format=2001;THREE.RGBA_S3TC_DXT1_Format=2002;THREE.RGBA_S3TC_DXT3_Format=2003;THREE.RGBA_S3TC_DXT5_Format=2004;THREE.RGB_PVRTC_4BPPV1_Format=2100;THREE.RGB_PVRTC_2BPPV1_Format=2101;THREE.RGBA_PVRTC_4BPPV1_Format=2102;THREE.RGBA_PVRTC_2BPPV1_Format=2103;THREE.Projector=function(){THREE.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(e,t){THREE.warn("THREE.Projector: .projectVector() is now vector.project().");e.project(t)};this.unprojectVector=function(e,t){THREE.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");e.unproject(t)};this.pickingRay=function(e,t){THREE.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};THREE.CanvasRenderer=function(){THREE.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElement("canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};THREE.Color=function(e){if(arguments.length===3){return this.setRGB(arguments[0],arguments[1],arguments[2])}return this.set(e)};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(e){if(e instanceof THREE.Color){this.copy(e)}else if(typeof e==="number"){this.setHex(e)}else if(typeof e==="string"){this.setStyle(e)}return this},setHex:function(e){e=Math.floor(e);this.r=(e>>16&255)/255;this.g=(e>>8&255)/255;this.b=(e&255)/255;return this},setRGB:function(e,t,i){this.r=e;this.g=t;this.b=i;return this},setHSL:function(e,t,i){if(t===0){this.r=this.g=this.b=i}else{var r=function(e,t,i){if(i<0)i+=1;if(i>1)i-=1;if(i<1/6)return e+(t-e)*6*i;if(i<1/2)return t;if(i<2/3)return e+(t-e)*6*(2/3-i);return e};var n=i<=.5?i*(1+t):i+t-i*t;var a=2*i-n;this.r=r(a,n,e+1/3);this.g=r(a,n,e);this.b=r(a,n,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);this.r=Math.min(255,parseInt(t[1],10))/255;this.g=Math.min(255,parseInt(t[2],10))/255;this.b=Math.min(255,parseInt(t[3],10))/255;return this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){var t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);this.r=Math.min(100,parseInt(t[1],10))/100;this.g=Math.min(100,parseInt(t[2],10))/100;this.b=Math.min(100,parseInt(t[3],10))/100;return this}if(/^\#([0-9a-f]{6})$/i.test(e)){var t=/^\#([0-9a-f]{6})$/i.exec(e);this.setHex(parseInt(t[1],16));return this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16));return this}if(/^(\w+)$/i.test(e)){this.setHex(THREE.ColorKeywords[e]);return this}},copy:function(e){this.r=e.r;this.g=e.g;this.b=e.b;return this},copyGammaToLinear:function(e,t){if(t===undefined)t=2;this.r=Math.pow(e.r,t);this.g=Math.pow(e.g,t);this.b=Math.pow(e.b,t);return this},copyLinearToGamma:function(e,t){if(t===undefined)t=2;var i=t>0?1/t:1;this.r=Math.pow(e.r,i);this.g=Math.pow(e.g,i);this.b=Math.pow(e.b,i);return this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;this.r=e*e;this.g=t*t;this.b=i*i;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t=e||{h:0,s:0,l:0};var i=this.r,r=this.g,n=this.b;var a=Math.max(i,r,n);var o=Math.min(i,r,n);var s,h;var l=(o+a)/2;if(o===a){s=0;h=0}else{var u=a-o;h=l<=.5?u/(a+o):u/(2-a-o);switch(a){case i:s=(r-n)/u+(r<n?6:0);break;case r:s=(n-i)/u+2;break;case n:s=(i-r)/u+4;break}s/=6}t.h=s;t.s=h;t.l=l;return t},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(e,t,i){var r=this.getHSL();r.h+=e;r.s+=t;r.l+=i;this.setHSL(r.h,r.s,r.l);return this},add:function(e){this.r+=e.r;this.g+=e.g;this.b+=e.b;return this},addColors:function(e,t){this.r=e.r+t.r;this.g=e.g+t.g;this.b=e.b+t.b;return this},addScalar:function(e){this.r+=e;this.g+=e;this.b+=e;return this},multiply:function(e){this.r*=e.r;this.g*=e.g;this.b*=e.b;return this},multiplyScalar:function(e){this.r*=e;this.g*=e;this.b*=e;return this},lerp:function(e,t){this.r+=(e.r-this.r)*t;this.g+=(e.g-this.g)*t;this.b+=(e.b-this.b)*t;return this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){this.r=e[0];this.g=e[1];this.b=e[2];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.r;e[t+1]=this.g;e[t+2]=this.b;return e},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(e,t,i,r){this._x=e||0;this._y=t||0;this._z=i||0;this._w=r!==undefined?r:1};THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(e){this._x=e;this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e;this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e;this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e;this.onChangeCallback()},set:function(e,t,i,r){this._x=e;this._y=t;this._z=i;this._w=r;this.onChangeCallback();return this},copy:function(e){this._x=e.x;this._y=e.y;this._z=e.z;this._w=e.w;this.onChangeCallback();return this},setFromEuler:function(e,t){if(e instanceof THREE.Euler===false){throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var i=Math.cos(e._x/2);var r=Math.cos(e._y/2);var n=Math.cos(e._z/2);var a=Math.sin(e._x/2);var o=Math.sin(e._y/2);var s=Math.sin(e._z/2);if(e.order==="XYZ"){this._x=a*r*n+i*o*s;this._y=i*o*n-a*r*s;this._z=i*r*s+a*o*n;this._w=i*r*n-a*o*s}else if(e.order==="YXZ"){this._x=a*r*n+i*o*s;this._y=i*o*n-a*r*s;this._z=i*r*s-a*o*n;this._w=i*r*n+a*o*s}else if(e.order==="ZXY"){this._x=a*r*n-i*o*s;this._y=i*o*n+a*r*s;this._z=i*r*s+a*o*n;this._w=i*r*n-a*o*s}else if(e.order==="ZYX"){this._x=a*r*n-i*o*s;this._y=i*o*n+a*r*s;this._z=i*r*s-a*o*n;this._w=i*r*n+a*o*s}else if(e.order==="YZX"){this._x=a*r*n+i*o*s;this._y=i*o*n+a*r*s;this._z=i*r*s-a*o*n;this._w=i*r*n-a*o*s}else if(e.order==="XZY"){this._x=a*r*n-i*o*s;this._y=i*o*n-a*r*s;this._z=i*r*s+a*o*n;this._w=i*r*n+a*o*s}if(t!==false)this.onChangeCallback();return this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);this._x=e.x*r;this._y=e.y*r;this._z=e.z*r;this._w=Math.cos(i);this.onChangeCallback();return this},setFromRotationMatrix:function(e){var t=e.elements,i=t[0],r=t[4],n=t[8],a=t[1],o=t[5],s=t[9],h=t[2],l=t[6],u=t[10],c=i+o+u,p;if(c>0){p=.5/Math.sqrt(c+1);this._w=.25/p;this._x=(l-s)*p;this._y=(n-h)*p;this._z=(a-r)*p}else if(i>o&&i>u){p=2*Math.sqrt(1+i-o-u);this._w=(l-s)/p;this._x=.25*p;this._y=(r+a)/p;this._z=(n+h)/p}else if(o>u){p=2*Math.sqrt(1+o-i-u);this._w=(n-h)/p;this._x=(r+a)/p;this._y=.25*p;this._z=(s+l)/p}else{p=2*Math.sqrt(1+u-i-o);this._w=(a-r)/p;this._x=(n+h)/p;this._y=(s+l)/p;this._z=.25*p}this.onChangeCallback();return this},setFromUnitVectors:function(){var e,t;var i=1e-6;return function(r,n){if(e===undefined)e=new THREE.Vector3;t=r.dot(n)+1;if(t<i){t=0;if(Math.abs(r.x)>Math.abs(r.z)){e.set(-r.y,r.x,0)}else{e.set(0,-r.z,r.y)}}else{e.crossVectors(r,n)}this._x=e.x;this._y=e.y;this._z=e.z;this._w=t;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();if(e===0){this._x=0;this._y=0;this._z=0;this._w=1}else{e=1/e;this._x=this._x*e;this._y=this._y*e;this._z=this._z*e;this._w=this._w*e}this.onChangeCallback();return this},multiply:function(e,t){if(t!==undefined){THREE.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.");return this.multiplyQuaternions(e,t)}return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e._x,r=e._y,n=e._z,a=e._w;var o=t._x,s=t._y,h=t._z,l=t._w;this._x=i*l+a*o+r*h-n*s;this._y=r*l+a*s+n*o-i*h;this._z=n*l+a*h+i*s-r*o;this._w=a*l-i*o-r*s-n*h;this.onChangeCallback();return this},multiplyVector3:function(e){THREE.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return e.applyQuaternion(this)},slerp:function(e,t){if(t===0)return this;if(t===1)return this.copy(e);var i=this._x,r=this._y,n=this._z,a=this._w;var o=a*e._w+i*e._x+r*e._y+n*e._z;if(o<0){this._w=-e._w;this._x=-e._x;this._y=-e._y;this._z=-e._z;o=-o}else{this.copy(e)}if(o>=1){this._w=a;this._x=i;this._y=r;this._z=n;return this}var s=Math.acos(o);var h=Math.sqrt(1-o*o);if(Math.abs(h)<.001){this._w=.5*(a+this._w);this._x=.5*(i+this._x);this._y=.5*(r+this._y);this._z=.5*(n+this._z);return this}var l=Math.sin((1-t)*s)/h,u=Math.sin(t*s)/h;this._w=a*l+this._w*u;this._x=i*l+this._x*u;this._y=r*l+this._y*u;this._z=n*l+this._z*u;this.onChangeCallback();return this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){if(t===undefined)t=0;this._x=e[t];this._y=e[t+1];this._z=e[t+2];this._w=e[t+3];this.onChangeCallback();return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._w;return e},onChange:function(e){this.onChangeCallback=e;return this},onChangeCallback:function(){},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}};THREE.Quaternion.slerp=function(e,t,i,r){return i.copy(e).slerp(t,r)};THREE.Vector2=function(e,t){this.x=e||0;this.y=t||0};THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){this.x=e;this.y=t;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){this.x=e.x;this.y=e.y;return this},add:function(e,t){if(t!==undefined){THREE.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;return this},addScalar:function(e){this.x+=e;this.y+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;return this},sub:function(e,t){if(t!==undefined){THREE.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;return this},subScalar:function(e){this.x-=e;this.y-=e;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;return this},multiply:function(e){this.x*=e.x;this.y*=e.y;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;return this},divide:function(e){this.x/=e.x;this.y/=e.y;return this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t;this.y*=t}else{this.x=0;this.y=0}return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}return this},clampScalar:function(){var e,t;return function(i,r){if(e===undefined){e=new THREE.Vector2;t=new THREE.Vector2}e.set(i,i);t.set(r,r);return this.clamp(e,t)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;return this},lerpVectors:function(e,t,i){this.subVectors(t,e).multiplyScalar(i).add(e);return this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;return e},fromAttribute:function(e,t,i){if(i===undefined)i=0;t=t*e.itemSize+i;this.x=e.array[t];this.y=e.array[t+1];return this},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(e,t,i){this.x=e||0;this.y=t||0;this.z=i||0};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,i){this.x=e;this.y=t;this.z=i;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;return this},add:function(e,t){if(t!==undefined){THREE.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;return this},addScalar:function(e){this.x+=e;this.y+=e;this.z+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;return this},sub:function(e,t){if(t!==undefined){THREE.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;return this},subScalar:function(e){this.x-=e;this.y-=e;this.z-=e;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;return this},multiply:function(e,t){if(t!==undefined){THREE.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.");return this.multiplyVectors(e,t)}this.x*=e.x;this.y*=e.y;this.z*=e.z;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;this.z*=e;return this},multiplyVectors:function(e,t){this.x=e.x*t.x;this.y=e.y*t.y;this.z=e.z*t.z;return this},applyEuler:function(){var e;return function(t){if(t instanceof THREE.Euler===false){THREE.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.")}if(e===undefined)e=new THREE.Quaternion;this.applyQuaternion(e.setFromEuler(t));return this}}(),applyAxisAngle:function(){var e;return function(t,i){if(e===undefined)e=new THREE.Quaternion;this.applyQuaternion(e.setFromAxisAngle(t,i));return this}}(),applyMatrix3:function(e){var t=this.x;var i=this.y;var r=this.z;var n=e.elements;this.x=n[0]*t+n[3]*i+n[6]*r;this.y=n[1]*t+n[4]*i+n[7]*r;this.z=n[2]*t+n[5]*i+n[8]*r;return this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z;var n=e.elements;this.x=n[0]*t+n[4]*i+n[8]*r+n[12];this.y=n[1]*t+n[5]*i+n[9]*r+n[13];this.z=n[2]*t+n[6]*i+n[10]*r+n[14];return this},applyProjection:function(e){var t=this.x,i=this.y,r=this.z;var n=e.elements;var a=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*a;this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*a;this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*a;return this},applyQuaternion:function(e){var t=this.x;var i=this.y;var r=this.z;var n=e.x;var a=e.y;var o=e.z;var s=e.w;var h=s*t+a*r-o*i;var l=s*i+o*t-n*r;var u=s*r+n*i-a*t;var c=-n*t-a*i-o*r;this.x=h*s+c*-n+l*-o-u*-a;this.y=l*s+c*-a+u*-n-h*-o;this.z=u*s+c*-o+h*-a-l*-n;return this},project:function(){var e;return function(t){if(e===undefined)e=new THREE.Matrix4;e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld));return this.applyProjection(e)}}(),unproject:function(){var e;return function(t){if(e===undefined)e=new THREE.Matrix4;e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix));return this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,i=this.y,r=this.z;var n=e.elements;this.x=n[0]*t+n[4]*i+n[8]*r;this.y=n[1]*t+n[5]*i+n[9]*r;this.z=n[2]*t+n[6]*i+n[10]*r;this.normalize();return this},divide:function(e){this.x/=e.x;this.y/=e.y;this.z/=e.z;return this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t;this.y*=t;this.z*=t}else{this.x=0;this.y=0;this.z=0}return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}if(this.z>e.z){this.z=e.z}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}if(this.z<e.z){this.z=e.z}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}if(this.z<e.z){this.z=e.z}else if(this.z>t.z){this.z=t.z}return this},clampScalar:function(){var e,t;return function(i,r){if(e===undefined){e=new THREE.Vector3;t=new THREE.Vector3}e.set(i,i,i);t.set(r,r,r);return this.clamp(e,t)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;return this},lerpVectors:function(e,t,i){this.subVectors(t,e).multiplyScalar(i).add(e);return this},cross:function(e,t){if(t!==undefined){THREE.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.");return this.crossVectors(e,t)}var i=this.x,r=this.y,n=this.z;this.x=r*e.z-n*e.y;this.y=n*e.x-i*e.z;this.z=i*e.y-r*e.x;return this},crossVectors:function(e,t){var i=e.x,r=e.y,n=e.z;var a=t.x,o=t.y,s=t.z;this.x=r*s-n*o;this.y=n*a-i*s;this.z=i*o-r*a;return this},projectOnVector:function(){var e,t;return function(i){if(e===undefined)e=new THREE.Vector3;e.copy(i).normalize();t=this.dot(e);return this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){if(e===undefined)e=new THREE.Vector3;e.copy(this).projectOnVector(t);return this.sub(e)}}(),reflect:function(){var e;return function(t){if(e===undefined)e=new THREE.Vector3;return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(THREE.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;var i=this.y-e.y;var r=this.z-e.z;return t*t+i*i+r*r},setEulerFromRotationMatrix:function(e,t){THREE.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){THREE.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){THREE.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){THREE.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){THREE.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){this.x=e.elements[12];this.y=e.elements[13];this.z=e.elements[14];return this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length();var i=this.set(e.elements[4],e.elements[5],e.elements[6]).length();var r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();this.x=t;this.y=i;this.z=r;return this},setFromMatrixColumn:function(e,t){var i=e*4;var r=t.elements;this.x=r[i];this.y=r[i+1];this.z=r[i+2];return this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;return e},fromAttribute:function(e,t,i){if(i===undefined)i=0;t=t*e.itemSize+i;this.x=e.array[t];this.y=e.array[t+1];this.z=e.array[t+2];return this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(e,t,i,r){this.x=e||0;this.y=t||0;this.z=i||0;this.w=r!==undefined?r:1};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,i,r){this.x=e;this.y=t;this.z=i;this.w=r;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setW:function(e){this.w=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w!==undefined?e.w:1;return this},add:function(e,t){if(t!==undefined){THREE.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;this.w+=e.w;return this},addScalar:function(e){this.x+=e;this.y+=e;this.z+=e;this.w+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;this.w=e.w+t.w;return this},sub:function(e,t){if(t!==undefined){THREE.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;this.w-=e.w;return this},subScalar:function(e){this.x-=e;this.y-=e;this.z-=e;this.w-=e;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;this.w=e.w-t.w;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;this.z*=e;this.w*=e;return this},applyMatrix4:function(e){var t=this.x;var i=this.y;var r=this.z;var n=this.w;var a=e.elements;this.x=a[0]*t+a[4]*i+a[8]*r+a[12]*n;this.y=a[1]*t+a[5]*i+a[9]*r+a[13]*n;this.z=a[2]*t+a[6]*i+a[10]*r+a[14]*n;this.w=a[3]*t+a[7]*i+a[11]*r+a[15]*n;return this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t;this.y*=t;this.z*=t;this.w*=t}else{this.x=0;this.y=0;this.z=0;this.w=1}return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);if(t<1e-4){this.x=1;this.y=0;this.z=0}else{this.x=e.x/t;this.y=e.y/t;this.z=e.z/t}return this},setAxisAngleFromRotationMatrix:function(e){var t,i,r,n,a=.01,o=.1,s=e.elements,h=s[0],l=s[4],u=s[8],c=s[1],p=s[5],f=s[9],d=s[2],m=s[6],g=s[10];if(Math.abs(l-c)<a&&Math.abs(u-d)<a&&Math.abs(f-m)<a){if(Math.abs(l+c)<o&&Math.abs(u+d)<o&&Math.abs(f+m)<o&&Math.abs(h+p+g-3)<o){this.set(1,0,0,0);return this}t=Math.PI;var v=(h+1)/2;var y=(p+1)/2;var E=(g+1)/2;var w=(l+c)/4;var b=(u+d)/4;var _=(f+m)/4;if(v>y&&v>E){if(v<a){i=0;r=.707106781;n=.707106781}else{i=Math.sqrt(v);r=w/i;n=b/i}}else if(y>E){if(y<a){i=.707106781;r=0;n=.707106781}else{r=Math.sqrt(y);i=w/r;n=_/r}}else{if(E<a){i=.707106781;r=.707106781;n=0}else{n=Math.sqrt(E);i=b/n;r=_/n}}this.set(i,r,n,t);return this}var x=Math.sqrt((m-f)*(m-f)+(u-d)*(u-d)+(c-l)*(c-l));if(Math.abs(x)<.001)x=1;this.x=(m-f)/x;this.y=(u-d)/x;this.z=(c-l)/x;this.w=Math.acos((h+p+g-1)/2);return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}if(this.z>e.z){this.z=e.z}if(this.w>e.w){this.w=e.w}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}if(this.z<e.z){this.z=e.z}if(this.w<e.w){this.w=e.w}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}if(this.z<e.z){this.z=e.z}else if(this.z>t.z){this.z=t.z}if(this.w<e.w){this.w=e.w}else if(this.w>t.w){this.w=t.w}return this},clampScalar:function(){var e,t;return function(i,r){if(e===undefined){e=new THREE.Vector4;t=new THREE.Vector4}e.set(i,i,i,i);t.set(r,r,r,r);return this.clamp(e,t)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;this.w+=(e.w-this.w)*t;return this},lerpVectors:function(e,t,i){this.subVectors(t,e).multiplyScalar(i).add(e);return this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){if(t===undefined)t=0;this.x=e[t];this.y=e[t+1];this.z=e[t+2];this.w=e[t+3];return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this.x;e[t+1]=this.y;e[t+2]=this.z;e[t+3]=this.w;return e},fromAttribute:function(e,t,i){if(i===undefined)i=0;t=t*e.itemSize+i;this.x=e.array[t];this.y=e.array[t+1];this.z=e.array[t+2];this.w=e.array[t+3];return this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Euler=function(e,t,i,r){this._x=e||0;this._y=t||0;this._z=i||0;this._order=r||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];THREE.Euler.DefaultOrder="XYZ";THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,get x(){return this._x},set x(e){this._x=e;this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e;this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e;this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e;this.onChangeCallback()},set:function(e,t,i,r){this._x=e;this._y=t;this._z=i;this._order=r||this._order;this.onChangeCallback();return this},copy:function(e){this._x=e._x;this._y=e._y;this._z=e._z;this._order=e._order;this.onChangeCallback();return this},setFromRotationMatrix:function(e,t,i){var r=THREE.Math.clamp;var n=e.elements;var a=n[0],o=n[4],s=n[8];var h=n[1],l=n[5],u=n[9];var c=n[2],p=n[6],f=n[10];t=t||this._order;if(t==="XYZ"){this._y=Math.asin(r(s,-1,1));if(Math.abs(s)<.99999){this._x=Math.atan2(-u,f);this._z=Math.atan2(-o,a)}else{this._x=Math.atan2(p,l);this._z=0}}else if(t==="YXZ"){this._x=Math.asin(-r(u,-1,1));if(Math.abs(u)<.99999){this._y=Math.atan2(s,f);this._z=Math.atan2(h,l)}else{this._y=Math.atan2(-c,a);this._z=0}}else if(t==="ZXY"){this._x=Math.asin(r(p,-1,1));if(Math.abs(p)<.99999){this._y=Math.atan2(-c,f);this._z=Math.atan2(-o,l)}else{this._y=0;this._z=Math.atan2(h,a)}}else if(t==="ZYX"){this._y=Math.asin(-r(c,-1,1));if(Math.abs(c)<.99999){this._x=Math.atan2(p,f);this._z=Math.atan2(h,a)}else{this._x=0;this._z=Math.atan2(-o,l)}}else if(t==="YZX"){this._z=Math.asin(r(h,-1,1));if(Math.abs(h)<.99999){this._x=Math.atan2(-u,l);this._y=Math.atan2(-c,a)}else{this._x=0;this._y=Math.atan2(s,f)}}else if(t==="XZY"){this._z=Math.asin(-r(o,-1,1));if(Math.abs(o)<.99999){this._x=Math.atan2(p,l);this._y=Math.atan2(s,a)}else{this._x=Math.atan2(-u,f);this._y=0}}else{THREE.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t)}this._order=t;if(i!==false)this.onChangeCallback();return this},setFromQuaternion:function(){var e;return function(t,i,r){if(e===undefined)e=new THREE.Matrix4;e.makeRotationFromQuaternion(t);this.setFromRotationMatrix(e,i,r);return this}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new THREE.Quaternion;return function(t){e.setFromEuler(this);this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){this._x=e[0];this._y=e[1];this._z=e[2];if(e[3]!==undefined)this._order=e[3];this.onChangeCallback();return this},toArray:function(e,t){if(e===undefined)e=[];if(t===undefined)t=0;e[t]=this._x;e[t+1]=this._y;e[t+2]=this._z;e[t+3]=this._order;return e},toVector3:function(e){if(e){return e.set(this._x,this._y,this._z)}else{return new THREE.Vector3(this._x,this._y,this._z)}},onChange:function(e){this.onChangeCallback=e;return this},onChangeCallback:function(){},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}};THREE.Line3=function(e,t){this.start=e!==undefined?e:new THREE.Vector3;this.end=t!==undefined?t:new THREE.Vector3};THREE.Line3.prototype={constructor:THREE.Line3,set:function(e,t){this.start.copy(e);this.end.copy(t);return this},copy:function(e){this.start.copy(e.start);this.end.copy(e.end);return this},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var i=t||new THREE.Vector3;return this.delta(i).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new THREE.Vector3;var t=new THREE.Vector3;return function(i,r){e.subVectors(i,this.start);t.subVectors(this.end,this.start);var n=t.dot(t);var a=t.dot(e);var o=a/n;if(r){o=THREE.Math.clamp(o,0,1)}return o}}(),closestPointToPoint:function(e,t,i){var r=this.closestPointToPointParameter(e,t);var n=i||new THREE.Vector3;return this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){this.start.applyMatrix4(e);this.end.applyMatrix4(e);return this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}};THREE.Box2=function(e,t){this.min=e!==undefined?e:new THREE.Vector2(Infinity,Infinity);this.max=t!==undefined?t:new THREE.Vector2(-Infinity,-Infinity)};THREE.Box2.prototype={constructor:THREE.Box2,set:function(e,t){this.min.copy(e);this.max.copy(t);return this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++){this.expandByPoint(e[t])}return this},setFromCenterAndSize:function(){var e=new THREE.Vector2;return function(t,i){var r=e.copy(i).multiplyScalar(.5);this.min.copy(t).sub(r);this.max.copy(t).add(r);return this}}(),copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new THREE.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},containsPoint:function(e){if(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y){return false}return true},containsBox:function(e){if(this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y){return true}return false},getParameter:function(e,t){var i=t||new THREE.Vector2;return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){if(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y){return false}return true},clampPoint:function(e,t){var i=t||new THREE.Vector2;return i.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector2;return function(t){var i=e.copy(t).clamp(this.min,this.max);return i.sub(t).length()}}(),intersect:function(e){this.min.max(e.min);this.max.min(e.max);return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}};THREE.Box3=function(e,t){this.min=e!==undefined?e:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=t!==undefined?t:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};THREE.Box3.prototype={constructor:THREE.Box3,set:function(e,t){this.min.copy(e);this.max.copy(t);return this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++){this.expandByPoint(e[t])}return this},setFromCenterAndSize:function(){var e=new THREE.Vector3;return function(t,i){var r=e.copy(i).multiplyScalar(.5);this.min.copy(t).sub(r);this.max.copy(t).add(r);return this}}(),setFromObject:function(){var e=new THREE.Vector3;return function(t){var i=this;t.updateMatrixWorld(true);this.makeEmpty();t.traverse(function(t){var r=t.geometry;if(r!==undefined){if(r instanceof THREE.Geometry){var n=r.vertices;for(var a=0,o=n.length;a<o;a++){e.copy(n[a]);e.applyMatrix4(t.matrixWorld);i.expandByPoint(e)}}else if(r instanceof THREE.BufferGeometry&&r.attributes["position"]!==undefined){var s=r.attributes["position"].array;for(var a=0,o=s.length;a<o;a+=3){e.set(s[a],s[a+1],s[a+2]);e.applyMatrix4(t.matrixWorld);i.expandByPoint(e)}}}});return this}}(),copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},containsPoint:function(e){if(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z){return false}return true},containsBox:function(e){if(this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z){return true}return false},getParameter:function(e,t){var i=t||new THREE.Vector3;return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){if(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z){return false}return true},clampPoint:function(e,t){var i=t||new THREE.Vector3;return i.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var i=e.copy(t).clamp(this.min,this.max);return i.sub(t).length()}}(),getBoundingSphere:function(){var e=new THREE.Vector3;return function(t){var i=t||new THREE.Sphere;i.center=this.center();i.radius=this.size(e).length()*.5;return i}}(),intersect:function(e){this.min.max(e.min);this.max.min(e.max);return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},applyMatrix4:function(){var e=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(t){e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t);e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t);e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t);e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t);e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t);e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t);e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t);e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t);this.makeEmpty();this.setFromPoints(e);return this}}(),translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}};THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);if(arguments.length>0){THREE.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}};THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(e,t,i,r,n,a,o,s,h){var l=this.elements;l[0]=e;l[3]=t;l[6]=i;l[1]=r;l[4]=n;l[7]=a;l[2]=o;l[5]=s;l[8]=h;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(e){var t=e.elements;this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]);return this},multiplyVector3:function(e){THREE.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return e.applyMatrix3(this)},multiplyVector3Array:function(e){THREE.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new THREE.Vector3;return function(t,i,r){if(i===undefined)i=0;if(r===undefined)r=t.length;for(var n=0,a=i;n<r;n+=3,a+=3){e.x=t[a];e.y=t[a+1];e.z=t[a+2];e.applyMatrix3(this);t[a]=e.x;t[a+1]=e.y;t[a+2]=e.z}return t}}(),multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[3]*=e;t[6]*=e;t[1]*=e;t[4]*=e;t[7]*=e;t[2]*=e;t[5]*=e;t[8]*=e;return this},determinant:function(){var e=this.elements;var t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],s=e[6],h=e[7],l=e[8];return t*a*l-t*o*h-i*n*l+i*o*s+r*n*h-r*a*s},getInverse:function(e,t){var i=e.elements;var r=this.elements;r[0]=i[10]*i[5]-i[6]*i[9];r[1]=-i[10]*i[1]+i[2]*i[9];r[2]=i[6]*i[1]-i[2]*i[5];r[3]=-i[10]*i[4]+i[6]*i[8];r[4]=i[10]*i[0]-i[2]*i[8];r[5]=-i[6]*i[0]+i[2]*i[4];r[6]=i[9]*i[4]-i[5]*i[8];r[7]=-i[9]*i[0]+i[1]*i[8];r[8]=i[5]*i[0]-i[1]*i[4];var n=i[0]*r[0]+i[1]*r[3]+i[2]*r[6];if(n===0){var a="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t||false){throw new Error(a)}else{THREE.warn(a)}this.identity();return this}this.multiplyScalar(1/n);return this},transpose:function(){var e,t=this.elements;e=t[1];t[1]=t[3];t[3]=e;e=t[2];t[2]=t[6];t[6]=e;e=t[5];t[5]=t[7];t[7]=e;return this},flattenToArrayOffset:function(e,t){var i=this.elements;e[t]=i[0];e[t+1]=i[1];e[t+2]=i[2];e[t+3]=i[3];e[t+4]=i[4];e[t+5]=i[5];e[t+6]=i[6];e[t+7]=i[7];e[t+8]=i[8];return e},getNormalMatrix:function(e){this.getInverse(e).transpose();return this},transposeIntoArray:function(e){var t=this.elements;e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8];return this},fromArray:function(e){this.elements.set(e);return this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){return(new THREE.Matrix3).fromArray(this.elements)}};THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(arguments.length>0){THREE.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,i,r,n,a,o,s,h,l,u,c,p,f,d,m){var g=this.elements;g[0]=e;g[4]=t;g[8]=i;g[12]=r;g[1]=n;g[5]=a;g[9]=o;g[13]=s;g[2]=h;g[6]=l;g[10]=u;g[14]=c;g[3]=p;g[7]=f;g[11]=d;g[15]=m;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(e){this.elements.set(e.elements);return this},extractPosition:function(e){THREE.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(e)},copyPosition:function(e){var t=this.elements;var i=e.elements;t[12]=i[12];t[13]=i[13];t[14]=i[14];return this},extractBasis:function(e,t,i){var r=this.elements;e.set(r[0],r[1],r[2]);t.set(r[4],r[5],r[6]);i.set(r[8],r[9],r[10]);return this},makeBasis:function(e,t,i){this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1);return this},extractRotation:function(){var e=new THREE.Vector3;return function(t){var i=this.elements;var r=t.elements;var n=1/e.set(r[0],r[1],r[2]).length();var a=1/e.set(r[4],r[5],r[6]).length();var o=1/e.set(r[8],r[9],r[10]).length();i[0]=r[0]*n;i[1]=r[1]*n;i[2]=r[2]*n;i[4]=r[4]*a;i[5]=r[5]*a;i[6]=r[6]*a;i[8]=r[8]*o;i[9]=r[9]*o;i[10]=r[10]*o;return this}}(),makeRotationFromEuler:function(e){if(e instanceof THREE.Euler===false){THREE.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var t=this.elements;var i=e.x,r=e.y,n=e.z;var a=Math.cos(i),o=Math.sin(i);var s=Math.cos(r),h=Math.sin(r);var l=Math.cos(n),u=Math.sin(n);if(e.order==="XYZ"){var c=a*l,p=a*u,f=o*l,d=o*u;t[0]=s*l;t[4]=-s*u;t[8]=h;t[1]=p+f*h;t[5]=c-d*h;t[9]=-o*s;t[2]=d-c*h;t[6]=f+p*h;t[10]=a*s}else if(e.order==="YXZ"){var m=s*l,g=s*u,v=h*l,y=h*u;t[0]=m+y*o;t[4]=v*o-g;t[8]=a*h;t[1]=a*u;t[5]=a*l;t[9]=-o;t[2]=g*o-v;t[6]=y+m*o;t[10]=a*s}else if(e.order==="ZXY"){var m=s*l,g=s*u,v=h*l,y=h*u;t[0]=m-y*o;t[4]=-a*u;t[8]=v+g*o;t[1]=g+v*o;t[5]=a*l;t[9]=y-m*o;t[2]=-a*h;t[6]=o;t[10]=a*s}else if(e.order==="ZYX"){var c=a*l,p=a*u,f=o*l,d=o*u;t[0]=s*l;t[4]=f*h-p;t[8]=c*h+d;t[1]=s*u;t[5]=d*h+c;t[9]=p*h-f;t[2]=-h;t[6]=o*s;t[10]=a*s}else if(e.order==="YZX"){var E=a*s,w=a*h,b=o*s,_=o*h;t[0]=s*l;t[4]=_-E*u;t[8]=b*u+w;t[1]=u;t[5]=a*l;t[9]=-o*l;t[2]=-h*l;t[6]=w*u+b;t[10]=E-_*u}else if(e.order==="XZY"){var E=a*s,w=a*h,b=o*s,_=o*h;t[0]=s*l;t[4]=-u;t[8]=h*l;t[1]=E*u+_;t[5]=a*l;t[9]=w*u-b;t[2]=b*u-w;t[6]=o*l;t[10]=_*u+E}t[3]=0;t[7]=0;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this},setRotationFromQuaternion:function(e){THREE.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements;var i=e.x,r=e.y,n=e.z,a=e.w;var o=i+i,s=r+r,h=n+n;var l=i*o,u=i*s,c=i*h;var p=r*s,f=r*h,d=n*h;var m=a*o,g=a*s,v=a*h;t[0]=1-(p+d);t[4]=u-v;t[8]=c+g;t[1]=u+v;t[5]=1-(l+d);t[9]=f-m;t[2]=c-g;t[6]=f+m;t[10]=1-(l+p);t[3]=0;t[7]=0;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this},lookAt:function(){var e=new THREE.Vector3;var t=new THREE.Vector3;var i=new THREE.Vector3;return function(r,n,a){var o=this.elements;i.subVectors(r,n).normalize();if(i.length()===0){i.z=1}e.crossVectors(a,i).normalize();if(e.length()===0){i.x+=1e-4;e.crossVectors(a,i).normalize()}t.crossVectors(i,e);o[0]=e.x;o[4]=t.x;o[8]=i.x;o[1]=e.y;o[5]=t.y;o[9]=i.y;o[2]=e.z;o[6]=t.z;o[10]=i.z;return this}}(),multiply:function(e,t){if(t!==undefined){THREE.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.");return this.multiplyMatrices(e,t)}return this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements;var r=t.elements;var n=this.elements;var a=i[0],o=i[4],s=i[8],h=i[12];var l=i[1],u=i[5],c=i[9],p=i[13];var f=i[2],d=i[6],m=i[10],g=i[14];var v=i[3],y=i[7],E=i[11],w=i[15];var b=r[0],_=r[4],x=r[8],T=r[12];var R=r[1],k=r[5],H=r[9],M=r[13];var S=r[2],A=r[6],C=r[10],z=r[14];var P=r[3],L=r[7],O=r[11],D=r[15];n[0]=a*b+o*R+s*S+h*P;n[4]=a*_+o*k+s*A+h*L;n[8]=a*x+o*H+s*C+h*O;n[12]=a*T+o*M+s*z+h*D;n[1]=l*b+u*R+c*S+p*P;n[5]=l*_+u*k+c*A+p*L;n[9]=l*x+u*H+c*C+p*O;n[13]=l*T+u*M+c*z+p*D;n[2]=f*b+d*R+m*S+g*P;n[6]=f*_+d*k+m*A+g*L;n[10]=f*x+d*H+m*C+g*O;n[14]=f*T+d*M+m*z+g*D;n[3]=v*b+y*R+E*S+w*P;n[7]=v*_+y*k+E*A+w*L;n[11]=v*x+y*H+E*C+w*O;n[15]=v*T+y*M+E*z+w*D;return this},multiplyToArray:function(e,t,i){var r=this.elements;this.multiplyMatrices(e,t);i[0]=r[0];i[1]=r[1];i[2]=r[2];i[3]=r[3];i[4]=r[4];i[5]=r[5];i[6]=r[6];i[7]=r[7];i[8]=r[8];i[9]=r[9];i[10]=r[10];i[11]=r[11];i[12]=r[12];i[13]=r[13];i[14]=r[14];i[15]=r[15];return this},multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[4]*=e;t[8]*=e;t[12]*=e;t[1]*=e;t[5]*=e;t[9]*=e;t[13]*=e;t[2]*=e;t[6]*=e;t[10]*=e;t[14]*=e;t[3]*=e;t[7]*=e;t[11]*=e;t[15]*=e;return this},multiplyVector3:function(e){THREE.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return e.applyProjection(this)},multiplyVector4:function(e){THREE.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},multiplyVector3Array:function(e){THREE.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new THREE.Vector3;return function(t,i,r){if(i===undefined)i=0;if(r===undefined)r=t.length;for(var n=0,a=i;n<r;n+=3,a+=3){e.x=t[a];e.y=t[a+1];e.z=t[a+2];e.applyMatrix4(this);t[a]=e.x;t[a+1]=e.y;t[a+2]=e.z}return t}}(),rotateAxis:function(e){THREE.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");e.transformDirection(this)},crossVector:function(e){THREE.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},determinant:function(){var e=this.elements;var t=e[0],i=e[4],r=e[8],n=e[12];var a=e[1],o=e[5],s=e[9],h=e[13];var l=e[2],u=e[6],c=e[10],p=e[14];var f=e[3],d=e[7],m=e[11],g=e[15];return f*(+n*s*u-r*h*u-n*o*c+i*h*c+r*o*p-i*s*p)+d*(+t*s*p-t*h*c+n*a*c-r*a*p+r*h*l-n*s*l)+m*(+t*h*u-t*o*p-n*a*u+i*a*p+n*o*l-i*h*l)+g*(-r*o*l-t*s*u+t*o*c+r*a*u-i*a*c+i*s*l)},transpose:function(){var e=this.elements;var t;t=e[1];e[1]=e[4];e[4]=t;t=e[2];e[2]=e[8];e[8]=t;t=e[6];e[6]=e[9];e[9]=t;t=e[3];e[3]=e[12];e[12]=t;t=e[7];e[7]=e[13];e[13]=t;t=e[11];e[11]=e[14];e[14]=t;return this},flattenToArrayOffset:function(e,t){var i=this.elements;e[t]=i[0];e[t+1]=i[1];e[t+2]=i[2];e[t+3]=i[3];e[t+4]=i[4];e[t+5]=i[5];e[t+6]=i[6];e[t+7]=i[7];e[t+8]=i[8];e[t+9]=i[9];e[t+10]=i[10];e[t+11]=i[11];e[t+12]=i[12];e[t+13]=i[13];e[t+14]=i[14];e[t+15]=i[15];return e},getPosition:function(){var e=new THREE.Vector3;return function(){THREE.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;t[12]=e.x;t[13]=e.y;t[14]=e.z;return this},getInverse:function(e,t){var i=this.elements;var r=e.elements;var n=r[0],a=r[4],o=r[8],s=r[12];var h=r[1],l=r[5],u=r[9],c=r[13];var p=r[2],f=r[6],d=r[10],m=r[14];var g=r[3],v=r[7],y=r[11],E=r[15];i[0]=u*m*v-c*d*v+c*f*y-l*m*y-u*f*E+l*d*E;i[4]=s*d*v-o*m*v-s*f*y+a*m*y+o*f*E-a*d*E;i[8]=o*c*v-s*u*v+s*l*y-a*c*y-o*l*E+a*u*E;i[12]=s*u*f-o*c*f-s*l*d+a*c*d+o*l*m-a*u*m;i[1]=c*d*g-u*m*g-c*p*y+h*m*y+u*p*E-h*d*E;i[5]=o*m*g-s*d*g+s*p*y-n*m*y-o*p*E+n*d*E;i[9]=s*u*g-o*c*g-s*h*y+n*c*y+o*h*E-n*u*E;i[13]=o*c*p-s*u*p+s*h*d-n*c*d-o*h*m+n*u*m;i[2]=l*m*g-c*f*g+c*p*v-h*m*v-l*p*E+h*f*E;i[6]=s*f*g-a*m*g-s*p*v+n*m*v+a*p*E-n*f*E;i[10]=a*c*g-s*l*g+s*h*v-n*c*v-a*h*E+n*l*E;i[14]=s*l*p-a*c*p-s*h*f+n*c*f+a*h*m-n*l*m;i[3]=u*f*g-l*d*g-u*p*v+h*d*v+l*p*y-h*f*y;i[7]=a*d*g-o*f*g+o*p*v-n*d*v-a*p*y+n*f*y;i[11]=o*l*g-a*u*g-o*h*v+n*u*v+a*h*y-n*l*y;i[15]=a*u*p-o*l*p+o*h*f-n*u*f-a*h*d+n*l*d;var w=n*i[0]+h*i[4]+p*i[8]+g*i[12];if(w==0){var b="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t||false){throw new Error(b)}else{THREE.warn(b)}this.identity();return this}this.multiplyScalar(1/w);return this},translate:function(e){THREE.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){THREE.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){THREE.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){THREE.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){THREE.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements;var i=e.x,r=e.y,n=e.z;t[0]*=i;t[4]*=r;t[8]*=n;t[1]*=i;t[5]*=r;t[9]*=n;t[2]*=i;t[6]*=r;t[10]*=n;t[3]*=i;t[7]*=r;t[11]*=n;return this},getMaxScaleOnAxis:function(){var e=this.elements;var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];var i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6];var r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(i,r)))},makeTranslation:function(e,t,i){this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1);return this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1);return this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1);return this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(e,t){var i=Math.cos(t);var r=Math.sin(t);var n=1-i;var a=e.x,o=e.y,s=e.z;var h=n*a,l=n*o;this.set(h*a+i,h*o-r*s,h*s+r*o,0,h*o+r*s,l*o+i,l*s-r*a,0,h*s-r*o,l*s+r*a,n*s*s+i,0,0,0,0,1);return this},makeScale:function(e,t,i){this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1);return this},compose:function(e,t,i){this.makeRotationFromQuaternion(t);this.scale(i);this.setPosition(e);return this},decompose:function(){var e=new THREE.Vector3;var t=new THREE.Matrix4;return function(i,r,n){var a=this.elements;var o=e.set(a[0],a[1],a[2]).length();var s=e.set(a[4],a[5],a[6]).length();var h=e.set(a[8],a[9],a[10]).length();var l=this.determinant();if(l<0){o=-o}i.x=a[12];i.y=a[13];i.z=a[14];t.elements.set(this.elements);var u=1/o;var c=1/s;var p=1/h;t.elements[0]*=u;t.elements[1]*=u;t.elements[2]*=u;t.elements[4]*=c;t.elements[5]*=c;t.elements[6]*=c;t.elements[8]*=p;t.elements[9]*=p;t.elements[10]*=p;r.setFromRotationMatrix(t);n.x=o;n.y=s;n.z=h;return this}}(),makeFrustum:function(e,t,i,r,n,a){var o=this.elements;var s=2*n/(t-e);var h=2*n/(r-i);var l=(t+e)/(t-e);var u=(r+i)/(r-i);var c=-(a+n)/(a-n);var p=-2*a*n/(a-n);o[0]=s;o[4]=0;o[8]=l;o[12]=0;o[1]=0;o[5]=h;o[9]=u;o[13]=0;o[2]=0;o[6]=0;o[10]=c;o[14]=p;o[3]=0;o[7]=0;o[11]=-1;o[15]=0;return this},makePerspective:function(e,t,i,r){var n=i*Math.tan(THREE.Math.degToRad(e*.5));var a=-n;var o=a*t;var s=n*t;return this.makeFrustum(o,s,a,n,i,r)},makeOrthographic:function(e,t,i,r,n,a){var o=this.elements;var s=t-e;var h=i-r;var l=a-n;var u=(t+e)/s;var c=(i+r)/h;var p=(a+n)/l;o[0]=2/s;o[4]=0;o[8]=0;o[12]=-u;o[1]=0;o[5]=2/h;o[9]=0;o[13]=-c;o[2]=0;o[6]=0;o[10]=-2/l;o[14]=-p;o[3]=0;o[7]=0;o[11]=0;o[15]=1;return this},fromArray:function(e){this.elements.set(e);return this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)}};THREE.Ray=function(e,t){this.origin=e!==undefined?e:new THREE.Vector3;this.direction=t!==undefined?t:new THREE.Vector3};THREE.Ray.prototype={constructor:THREE.Ray,set:function(e,t){this.origin.copy(e);this.direction.copy(t);return this},copy:function(e){this.origin.copy(e.origin);this.direction.copy(e.direction);return this},at:function(e,t){var i=t||new THREE.Vector3;return i.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new THREE.Vector3;return function(t){this.origin.copy(this.at(t,e));return this}}(),closestPointToPoint:function(e,t){var i=t||new THREE.Vector3;i.subVectors(e,this.origin);var r=i.dot(this.direction);if(r<0){return i.copy(this.origin)}return i.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var i=e.subVectors(t,this.origin).dot(this.direction);if(i<0){return this.origin.distanceTo(t)}e.copy(this.direction).multiplyScalar(i).add(this.origin);return e.distanceTo(t)}}(),distanceSqToSegment:function(){var e=new THREE.Vector3;var t=new THREE.Vector3;var i=new THREE.Vector3;return function(r,n,a,o){e.copy(r).add(n).multiplyScalar(.5);t.copy(n).sub(r).normalize();i.copy(this.origin).sub(e);var s=r.distanceTo(n)*.5;var h=-this.direction.dot(t);var l=i.dot(this.direction);var u=-i.dot(t);var c=i.lengthSq();var p=Math.abs(1-h*h);var f,d,m,g;if(p>0){f=h*u-l;d=h*l-u;g=s*p;if(f>=0){if(d>=-g){if(d<=g){var v=1/p;f*=v;d*=v;m=f*(f+h*d+2*l)+d*(h*f+d+2*u)+c}else{d=s;f=Math.max(0,-(h*d+l));m=-f*f+d*(d+2*u)+c}}else{d=-s;f=Math.max(0,-(h*d+l));m=-f*f+d*(d+2*u)+c}}else{if(d<=-g){f=Math.max(0,-(-h*s+l));d=f>0?-s:Math.min(Math.max(-s,-u),s);m=-f*f+d*(d+2*u)+c}else if(d<=g){f=0;d=Math.min(Math.max(-s,-u),s);m=d*(d+2*u)+c}else{f=Math.max(0,-(h*s+l));d=f>0?s:Math.min(Math.max(-s,-u),s);m=-f*f+d*(d+2*u)+c}}}else{d=h>0?-s:s;f=Math.max(0,-(h*d+l));m=-f*f+d*(d+2*u)+c}if(a){a.copy(this.direction).multiplyScalar(f).add(this.origin)}if(o){o.copy(t).multiplyScalar(d).add(e)}return m}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new THREE.Vector3;return function(t,i){e.subVectors(t.center,this.origin);var r=e.dot(this.direction);var n=e.dot(e)-r*r;var a=t.radius*t.radius;if(n>a)return null;var o=Math.sqrt(a-n);var s=r-o;var h=r+o;if(s<0&&h<0)return null;if(s<0)return this.at(h,i);return this.at(s,i)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);if(t===0){return true}var i=e.normal.dot(this.direction);if(i*t<0){return true}return false},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t==0){if(e.distanceToPoint(this.origin)==0){return 0}return null}var i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null},intersectPlane:function(e,t){var i=this.distanceToPlane(e);if(i===null){return null}return this.at(i,t)},isIntersectionBox:function(){var e=new THREE.Vector3;return function(t){return this.intersectBox(t,e)!==null}}(),intersectBox:function(e,t){var i,r,n,a,o,s;var h=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z;var c=this.origin;if(h>=0){i=(e.min.x-c.x)*h;r=(e.max.x-c.x)*h}else{i=(e.max.x-c.x)*h;r=(e.min.x-c.x)*h}if(l>=0){n=(e.min.y-c.y)*l;a=(e.max.y-c.y)*l}else{n=(e.max.y-c.y)*l;a=(e.min.y-c.y)*l}if(i>a||n>r)return null;if(n>i||i!==i)i=n;if(a<r||r!==r)r=a;if(u>=0){o=(e.min.z-c.z)*u;s=(e.max.z-c.z)*u}else{o=(e.max.z-c.z)*u;s=(e.min.z-c.z)*u}if(i>s||o>r)return null;if(o>i||i!==i)i=o;if(s<r||r!==r)r=s;if(r<0)return null;return this.at(i>=0?i:r,t)},intersectTriangle:function(){var e=new THREE.Vector3;var t=new THREE.Vector3;var i=new THREE.Vector3;var r=new THREE.Vector3;return function(n,a,o,s,h){t.subVectors(a,n);i.subVectors(o,n);r.crossVectors(t,i);var l=this.direction.dot(r);var u;if(l>0){if(s)return null;u=1}else if(l<0){u=-1;l=-l}else{return null}e.subVectors(this.origin,n);var c=u*this.direction.dot(i.crossVectors(e,i));if(c<0){return null}var p=u*this.direction.dot(t.cross(e));if(p<0){return null}if(c+p>l){return null}var f=-u*e.dot(r);if(f<0){return null}return this.at(f/l,h)}}(),applyMatrix4:function(e){this.direction.add(this.origin).applyMatrix4(e);this.origin.applyMatrix4(e);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}};THREE.Sphere=function(e,t){this.center=e!==undefined?e:new THREE.Vector3;this.radius=t!==undefined?t:0};THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(e,t){this.center.copy(e);this.radius=t;return this},setFromPoints:function(){var e=new THREE.Box3;return function(t,i){var r=this.center;if(i!==undefined){r.copy(i)}else{e.setFromPoints(t).center(r)}var n=0;for(var a=0,o=t.length;a<o;a++){n=Math.max(n,r.distanceToSquared(t[a]))}this.radius=Math.sqrt(n);return this}}(),copy:function(e){this.center.copy(e.center);this.radius=e.radius;return this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var i=this.center.distanceToSquared(e);var r=t||new THREE.Vector3;r.copy(e);if(i>this.radius*this.radius){r.sub(this.center).normalize();r.multiplyScalar(this.radius).add(this.center)}return r},getBoundingBox:function(e){var t=e||new THREE.Box3;t.set(this.center,this.center);t.expandByScalar(this.radius);return t},applyMatrix4:function(e){this.center.applyMatrix4(e);this.radius=this.radius*e.getMaxScaleOnAxis();return this},translate:function(e){this.center.add(e);return this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}};THREE.Frustum=function(e,t,i,r,n,a){this.planes=[e!==undefined?e:new THREE.Plane,t!==undefined?t:new THREE.Plane,i!==undefined?i:new THREE.Plane,r!==undefined?r:new THREE.Plane,n!==undefined?n:new THREE.Plane,a!==undefined?a:new THREE.Plane]};THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(e,t,i,r,n,a){var o=this.planes;o[0].copy(e);o[1].copy(t);o[2].copy(i);o[3].copy(r);o[4].copy(n);o[5].copy(a);return this},copy:function(e){var t=this.planes;for(var i=0;i<6;i++){t[i].copy(e.planes[i])}return this},setFromMatrix:function(e){var t=this.planes;var i=e.elements;var r=i[0],n=i[1],a=i[2],o=i[3];var s=i[4],h=i[5],l=i[6],u=i[7];var c=i[8],p=i[9],f=i[10],d=i[11];var m=i[12],g=i[13],v=i[14],y=i[15];t[0].setComponents(o-r,u-s,d-c,y-m).normalize();t[1].setComponents(o+r,u+s,d+c,y+m).normalize();t[2].setComponents(o+n,u+h,d+p,y+g).normalize();t[3].setComponents(o-n,u-h,d-p,y-g).normalize();t[4].setComponents(o-a,u-l,d-f,y-v).normalize();t[5].setComponents(o+a,u+l,d+f,y+v).normalize();return this},intersectsObject:function(){var e=new THREE.Sphere;return function(t){var i=t.geometry;if(i.boundingSphere===null)i.computeBoundingSphere();e.copy(i.boundingSphere);e.applyMatrix4(t.matrixWorld);return this.intersectsSphere(e)}}(),intersectsSphere:function(e){var t=this.planes;var i=e.center;var r=-e.radius;for(var n=0;n<6;n++){var a=t[n].distanceToPoint(i);if(a<r){return false}}return true},intersectsBox:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i){var r=this.planes;for(var n=0;n<6;n++){var a=r[n];e.x=a.normal.x>0?i.min.x:i.max.x;t.x=a.normal.x>0?i.max.x:i.min.x;e.y=a.normal.y>0?i.min.y:i.max.y;t.y=a.normal.y>0?i.max.y:i.min.y;e.z=a.normal.z>0?i.min.z:i.max.z;t.z=a.normal.z>0?i.max.z:i.min.z;var o=a.distanceToPoint(e);var s=a.distanceToPoint(t);if(o<0&&s<0){return false}}return true}}(),containsPoint:function(e){var t=this.planes;for(var i=0;i<6;i++){if(t[i].distanceToPoint(e)<0){return false}}return true},clone:function(){return(new THREE.Frustum).copy(this)}};THREE.Plane=function(e,t){this.normal=e!==undefined?e:new THREE.Vector3(1,0,0);this.constant=t!==undefined?t:0};THREE.Plane.prototype={constructor:THREE.Plane,set:function(e,t){this.normal.copy(e);this.constant=t;return this},setComponents:function(e,t,i,r){this.normal.set(e,t,i);this.constant=r;return this},setFromNormalAndCoplanarPoint:function(e,t){this.normal.copy(e);this.constant=-t.dot(this.normal);return this},setFromCoplanarPoints:function(){var e=new THREE.Vector3;var t=new THREE.Vector3;return function(i,r,n){var a=e.subVectors(n,r).cross(t.subVectors(i,r)).normalize();this.setFromNormalAndCoplanarPoint(a,i);return this}}(),copy:function(e){this.normal.copy(e.normal);this.constant=e.constant;return this},normalize:function(){var e=1/this.normal.length();this.normal.multiplyScalar(e);this.constant*=e;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var i=this.distanceToPoint(e);var r=t||new THREE.Vector3;return r.copy(this.normal).multiplyScalar(i)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start);var i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0},intersectLine:function(){var e=new THREE.Vector3;return function(t,i){var r=i||new THREE.Vector3;var n=t.delta(e);var a=this.normal.dot(n);if(a==0){if(this.distanceToPoint(t.start)==0){return r.copy(t.start)}return undefined}var o=-(t.start.dot(this.normal)+this.constant)/a;if(o<0||o>1){return undefined}return r.copy(n).multiplyScalar(o).add(t.start)}}(),coplanarPoint:function(e){var t=e||new THREE.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new THREE.Vector3;var t=new THREE.Vector3;var i=new THREE.Matrix3;return function(r,n){var a=n||i.getNormalMatrix(r);var o=e.copy(this.normal).applyMatrix3(a);var s=this.coplanarPoint(t);s.applyMatrix4(r);this.setFromNormalAndCoplanarPoint(o,s);return this}}(),translate:function(e){this.constant=this.constant-e.dot(this.normal);return this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}};THREE.Math={generateUUID:function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var t=new Array(36);var i=0,r;return function(){for(var n=0;n<36;n++){if(n==8||n==13||n==18||n==23){t[n]="-"}else if(n==14){t[n]="4"}else{if(i<=2)i=33554432+Math.random()*16777216|0;r=i&15;i=i>>4;t[n]=e[n==19?r&3|8:r]}}return t.join("")}}(),clamp:function(e,t,i){return e<t?t:e>i?i:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},smoothstep:function(e,t,i){if(e<=t)return 0;if(e>=i)return 1;e=(e-t)/(i-t);return e*e*(3-2*e)},smootherstep:function(e,t,i){if(e<=t)return 0;if(e>=i)return 1;e=(e-t)/(i-t);return e*e*e*(e*(e*6-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return Math.floor(this.randFloat(e,t))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return(e&e-1)===0&&e!==0},nextPowerOfTwo:function(e){e--;e|=e>>1;e|=e>>2;e|=e>>4;e|=e>>8;e|=e>>16;e++;return e}};THREE.Spline=function(e){this.points=e;var t=[],i={x:0,y:0,z:0},r,n,a,o,s,h,l,u,c;this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++){this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}}};this.getPoint=function(e){r=(this.points.length-1)*e;n=Math.floor(r);a=r-n;t[0]=n===0?n:n-1;t[1]=n;t[2]=n>this.points.length-2?this.points.length-1:n+1;t[3]=n>this.points.length-3?this.points.length-1:n+2;h=this.points[t[0]];l=this.points[t[1]];u=this.points[t[2]];c=this.points[t[3]];o=a*a;s=a*o;i.x=p(h.x,l.x,u.x,c.x,a,o,s);i.y=p(h.y,l.y,u.y,c.y,a,o,s);i.z=p(h.z,l.z,u.z,c.z,a,o,s);return i};this.getControlPointsArray=function(){var e,t,i=this.points.length,r=[];for(e=0;e<i;e++){t=this.points[e];r[e]=[t.x,t.y,t.z]}return r};this.getLength=function(e){var t,i,r,n,a=0,o=0,s=0,h=new THREE.Vector3,l=new THREE.Vector3,u=[],c=0;u[0]=0;if(!e)e=100;r=this.points.length*e;h.copy(this.points[0]);for(t=1;t<r;t++){i=t/r;n=this.getPoint(i);l.copy(n);c+=l.distanceTo(h);h.copy(n);a=(this.points.length-1)*i;o=Math.floor(a);if(o!=s){u[o]=c;s=o}}u[u.length]=c;return{chunks:u,total:c}};this.reparametrizeByArcLength=function(e){var t,i,r,n,a,o,s,h,l=[],u=new THREE.Vector3,c=this.getLength();l.push(u.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){o=c.chunks[t]-c.chunks[t-1];s=Math.ceil(e*o/c.total);n=(t-1)/(this.points.length-1);a=t/(this.points.length-1);for(i=1;i<s-1;i++){r=n+i*(1/s)*(a-n);h=this.getPoint(r);l.push(u.copy(h).clone())}l.push(u.copy(this.points[t]).clone())}this.points=l};function p(e,t,i,r,n,a,o){var s=(i-e)*.5,h=(r-t)*.5;return(2*(t-i)+s+h)*o+(-3*(t-i)-2*s-h)*a+s*n+t}};THREE.Triangle=function(e,t,i){this.a=e!==undefined?e:new THREE.Vector3;this.b=t!==undefined?t:new THREE.Vector3;this.c=i!==undefined?i:new THREE.Vector3};THREE.Triangle.normal=function(){var e=new THREE.Vector3;return function(t,i,r,n){var a=n||new THREE.Vector3;a.subVectors(r,i);e.subVectors(t,i);a.cross(e);var o=a.lengthSq();if(o>0){return a.multiplyScalar(1/Math.sqrt(o))}return a.set(0,0,0)}}();THREE.Triangle.barycoordFromPoint=function(){var e=new THREE.Vector3;var t=new THREE.Vector3;var i=new THREE.Vector3;return function(r,n,a,o,s){e.subVectors(o,n);t.subVectors(a,n);i.subVectors(r,n);var h=e.dot(e);var l=e.dot(t);var u=e.dot(i);var c=t.dot(t);var p=t.dot(i);var f=h*c-l*l;var d=s||new THREE.Vector3;if(f==0){return d.set(-2,-1,-1)}var m=1/f;var g=(c*u-l*p)*m;var v=(h*p-l*u)*m;return d.set(1-g-v,v,g)}}();THREE.Triangle.containsPoint=function(){var e=new THREE.Vector3;return function(t,i,r,n){var a=THREE.Triangle.barycoordFromPoint(t,i,r,n,e);return a.x>=0&&a.y>=0&&a.x+a.y<=1}}();THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(e,t,i){this.a.copy(e);this.b.copy(t);this.c.copy(i);return this},setFromPointsAndIndices:function(e,t,i,r){this.a.copy(e[t]);this.b.copy(e[i]);this.c.copy(e[r]);return this},copy:function(e){this.a.copy(e.a);this.b.copy(e.b);this.c.copy(e.c);return this},area:function(){var e=new THREE.Vector3;var t=new THREE.Vector3;return function(){e.subVectors(this.c,this.b);t.subVectors(this.a,this.b);return e.cross(t).length()*.5}}(),midpoint:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return THREE.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new THREE.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return THREE.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return THREE.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}};THREE.Clock=function(e){this.autoStart=e!==undefined?e:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false};THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.startTime=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now();this.oldTime=this.startTime;this.running=true},stop:function(){this.getElapsedTime();this.running=false},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running){this.start()}if(this.running){var t=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now();e=.001*(t-this.oldTime);this.oldTime=t;this.elapsedTime+=e}return e}};THREE.EventDispatcher=function(){};THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(e){e.addEventListener=THREE.EventDispatcher.prototype.addEventListener;e.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener;e.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener;e.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){if(this._listeners===undefined)this._listeners={};var i=this._listeners;if(i[e]===undefined){i[e]=[]}if(i[e].indexOf(t)===-1){i[e].push(t)}},hasEventListener:function(e,t){if(this._listeners===undefined)return false;var i=this._listeners;if(i[e]!==undefined&&i[e].indexOf(t)!==-1){return true}return false},removeEventListener:function(e,t){if(this._listeners===undefined)return;var i=this._listeners;var r=i[e];if(r!==undefined){var n=r.indexOf(t);if(n!==-1){r.splice(n,1)}}},dispatchEvent:function(e){if(this._listeners===undefined)return;var t=this._listeners;var i=t[e.type];if(i!==undefined){e.target=this;var r=[];var n=i.length;for(var a=0;a<n;a++){r[a]=i[a]}for(var a=0;a<n;a++){r[a].call(this,e)}}}};(function(e){e.Raycaster=function(t,i,r,n){this.ray=new e.Ray(t,i);this.near=r||0;this.far=n||Infinity;this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var t=function(e,t){return e.distance-t.distance};var i=function(e,t,r,n){e.raycast(t,r);if(n===true){var a=e.children;for(var o=0,s=a.length;o<s;o++){i(a[o],t,r,true)}}};e.Raycaster.prototype={constructor:e.Raycaster,precision:1e-4,linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(t,i){if(i instanceof e.PerspectiveCamera){this.ray.origin.copy(i.position);this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(i.position).normalize()}else if(i instanceof e.OrthographicCamera){this.ray.origin.set(t.x,t.y,-1).unproject(i);this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld)}else{e.error("THREE.Raycaster: Unsupported camera type.")}},intersectObject:function(e,r){var n=[];i(e,this,n,r);n.sort(t);return n},intersectObjects:function(r,n){var a=[];if(r instanceof Array===false){e.warn("THREE.Raycaster.intersectObjects: objects is not an Array.");return a}for(var o=0,s=r.length;o<s;o++){i(r[o],this,a,n)}a.sort(t);return a}}})(THREE);THREE.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Object3D";this.parent=undefined;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var e=new THREE.Vector3;var t=new THREE.Euler;var i=new THREE.Quaternion;var r=new THREE.Vector3(1,1,1);var n=function(){i.setFromEuler(t,false)};var a=function(){t.setFromQuaternion(i,undefined,false)};t.onChange(n);i.onChange(a);Object.defineProperties(this,{position:{enumerable:true,value:e},rotation:{enumerable:true,value:t},quaternion:{enumerable:true,value:i},scale:{enumerable:true,value:r}});this.rotationAutoUpdate=true;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=true;this.matrixWorldNeedsUpdate=false;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this.renderOrder=0;this.userData={}};THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0);THREE.Object3D.prototype={constructor:THREE.Object3D,get eulerOrder(){THREE.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");return this.rotation.order},set eulerOrder(e){THREE.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");this.rotation.order=e},get useQuaternion(){THREE.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){THREE.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,true)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new THREE.Quaternion;return function(t,i){e.setFromAxisAngle(t,i);this.quaternion.multiply(e);return this}}(),rotateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new THREE.Vector3;return function(t,i){e.copy(t).applyQuaternion(this.quaternion);this.position.add(e.multiplyScalar(i));return this}}(),translate:function(e,t){THREE.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(t,e)},translateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new THREE.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new THREE.Matrix4;return function(t){e.lookAt(t,this.position,this.up);this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++){this.add(arguments[t])}return this}if(e===this){THREE.error("THREE.Object3D.add: object can't be added as a child of itself.",e);return this}if(e instanceof THREE.Object3D){if(e.parent!==undefined){e.parent.remove(e)}e.parent=this;e.dispatchEvent({type:"added"});this.children.push(e)}else{THREE.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e)}return this},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++){this.remove(arguments[t])}}var i=this.children.indexOf(e);if(i!==-1){e.parent=undefined;e.dispatchEvent({type:"removed"});this.children.splice(i,1)}},getChildByName:function(e){THREE.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(e)},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i];var a=n.getObjectByProperty(e,t);if(a!==undefined){return a}}return undefined},getWorldPosition:function(e){var t=e||new THREE.Vector3;this.updateMatrixWorld(true);return t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new THREE.Vector3;var t=new THREE.Vector3;return function(i){var r=i||new THREE.Quaternion;this.updateMatrixWorld(true);this.matrixWorld.decompose(e,r,t);return r}}(),getWorldRotation:function(){var e=new THREE.Quaternion;return function(t){var i=t||new THREE.Euler;this.getWorldQuaternion(e);return i.setFromQuaternion(e,this.rotation.order,false)}}(),getWorldScale:function(){var e=new THREE.Vector3;var t=new THREE.Quaternion;return function(i){var r=i||new THREE.Vector3;this.updateMatrixWorld(true);this.matrixWorld.decompose(e,t,r);return r}}(),getWorldDirection:function(){var e=new THREE.Quaternion;return function(t){var i=t||new THREE.Vector3;this.getWorldQuaternion(e);return i.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=0,i=this.children.length;t<i;t++){this.children[t].traverse(e)}},traverseVisible:function(e){if(this.visible===false)return;e(this);for(var t=0,i=this.children.length;t<i;t++){this.children[t].traverseVisible(e)}},traverseAncestors:function(e){if(this.parent){e(this.parent);this.parent.traverseAncestors(e)}},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(e){if(this.matrixAutoUpdate===true)this.updateMatrix();if(this.matrixWorldNeedsUpdate===true||e===true){if(this.parent===undefined){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=false;e=true}for(var t=0,i=this.children.length;t<i;t++){this.children[t].updateMatrixWorld(e)}},toJSON:function(){var e={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}};var t={};var i=function(i){if(e.geometries===undefined){e.geometries=[]}if(t[i.uuid]===undefined){var r=i.toJSON();delete r.metadata;t[i.uuid]=r;e.geometries.push(r)}return i.uuid};var r={};var n=function(t){if(e.materials===undefined){e.materials=[]}if(r[t.uuid]===undefined){var i=t.toJSON();delete i.metadata;r[t.uuid]=i;e.materials.push(i)}return t.uuid};var a=function(e){var t={};t.uuid=e.uuid;t.type=e.type;if(e.name!=="")t.name=e.name;if(JSON.stringify(e.userData)!=="{}")t.userData=e.userData;if(e.visible!==true)t.visible=e.visible;if(e instanceof THREE.PerspectiveCamera){t.fov=e.fov;t.aspect=e.aspect;t.near=e.near;t.far=e.far}else if(e instanceof THREE.OrthographicCamera){t.left=e.left;t.right=e.right;t.top=e.top;t.bottom=e.bottom;t.near=e.near;t.far=e.far}else if(e instanceof THREE.AmbientLight){t.color=e.color.getHex()}else if(e instanceof THREE.DirectionalLight){t.color=e.color.getHex();t.intensity=e.intensity}else if(e instanceof THREE.PointLight){t.color=e.color.getHex();t.intensity=e.intensity;t.distance=e.distance;t.decay=e.decay}else if(e instanceof THREE.SpotLight){t.color=e.color.getHex();t.intensity=e.intensity;t.distance=e.distance;t.angle=e.angle;t.exponent=e.exponent;t.decay=e.decay}else if(e instanceof THREE.HemisphereLight){t.color=e.color.getHex();t.groundColor=e.groundColor.getHex()}else if(e instanceof THREE.Mesh||e instanceof THREE.Line||e instanceof THREE.PointCloud){t.geometry=i(e.geometry);t.material=n(e.material);if(e instanceof THREE.Line)t.mode=e.mode}else if(e instanceof THREE.Sprite){t.material=n(e.material)}t.matrix=e.matrix.toArray();if(e.children.length>0){t.children=[];for(var r=0;r<e.children.length;r++){t.children.push(a(e.children[r]))}}return t};e.object=a(this);return e},clone:function(e,t){if(e===undefined)e=new THREE.Object3D;if(t===undefined)t=true;e.name=this.name;e.up.copy(this.up);e.position.copy(this.position);e.quaternion.copy(this.quaternion);e.scale.copy(this.scale);e.rotationAutoUpdate=this.rotationAutoUpdate;e.matrix.copy(this.matrix);e.matrixWorld.copy(this.matrixWorld);e.matrixAutoUpdate=this.matrixAutoUpdate;e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;e.visible=this.visible;e.castShadow=this.castShadow;e.receiveShadow=this.receiveShadow;e.frustumCulled=this.frustumCulled;e.userData=JSON.parse(JSON.stringify(this.userData));if(t===true){for(var i=0;i<this.children.length;i++){var r=this.children[i];e.add(r.clone())}}return e}};THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);THREE.Object3DIdCount=0;THREE.Face3=function(e,t,i,r,n,a){this.a=e;this.b=t;this.c=i;this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3;this.vertexNormals=r instanceof Array?r:[];this.color=n instanceof THREE.Color?n:new THREE.Color;this.vertexColors=n instanceof Array?n:[];this.vertexTangents=[];this.materialIndex=a!==undefined?a:0};THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var e=new THREE.Face3(this.a,this.b,this.c);e.normal.copy(this.normal);e.color.copy(this.color);e.materialIndex=this.materialIndex;for(var t=0,i=this.vertexNormals.length;t<i;t++){e.vertexNormals[t]=this.vertexNormals[t].clone()}for(var t=0,i=this.vertexColors.length;t<i;t++){e.vertexColors[t]=this.vertexColors[t].clone()}for(var t=0,i=this.vertexTangents.length;t<i;t++){e.vertexTangents[t]=this.vertexTangents[t].clone()}return e}};THREE.Face4=function(e,t,i,r,n,a,o){THREE.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new THREE.Face3(e,t,i,n,a,o)};THREE.BufferAttribute=function(e,t){this.array=e;this.itemSize=t;this.needsUpdate=false};THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return this.array.length},copyAt:function(e,t,i){e*=this.itemSize;i*=t.itemSize;for(var r=0,n=this.itemSize;r<n;r++){this.array[e+r]=t.array[i+r]}return this},set:function(e,t){if(t===undefined)t=0;this.array.set(e,t);return this},setX:function(e,t){this.array[e*this.itemSize]=t;return this},setY:function(e,t){this.array[e*this.itemSize+1]=t;return this},setZ:function(e,t){this.array[e*this.itemSize+2]=t;return this},setXY:function(e,t,i){e*=this.itemSize;this.array[e]=t;this.array[e+1]=i;return this},setXYZ:function(e,t,i,r){e*=this.itemSize;this.array[e]=t;this.array[e+1]=i;this.array[e+2]=r;return this},setXYZW:function(e,t,i,r,n){e*=this.itemSize;this.array[e]=t;this.array[e+1]=i;this.array[e+2]=r;this.array[e+3]=n;return this},clone:function(){return new THREE.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}};THREE.Int8Attribute=function(e,t){THREE.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(e,t)};THREE.Uint8Attribute=function(e,t){THREE.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(e,t)};THREE.Uint8ClampedAttribute=function(e,t){THREE.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(e,t)};THREE.Int16Attribute=function(e,t){THREE.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(e,t)};THREE.Uint16Attribute=function(e,t){THREE.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(e,t)};THREE.Int32Attribute=function(e,t){THREE.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(e,t)};THREE.Uint32Attribute=function(e,t){THREE.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(e,t)};THREE.Float32Attribute=function(e,t){THREE.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(e,t)};THREE.Float64Attribute=function(e,t){THREE.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(e,t)};THREE.DynamicBufferAttribute=function(e,t){THREE.BufferAttribute.call(this,e,t);this.updateRange={offset:0,count:-1}};THREE.DynamicBufferAttribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.DynamicBufferAttribute.prototype.constructor=THREE.DynamicBufferAttribute;THREE.DynamicBufferAttribute.prototype.clone=function(){return new THREE.DynamicBufferAttribute(new this.array.constructor(this.array),this.itemSize)};THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="BufferGeometry";this.attributes={};this.attributesKeys=[];this.drawcalls=[];this.offsets=this.drawcalls;this.boundingBox=null;this.boundingSphere=null};THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(e,t){if(t instanceof THREE.BufferAttribute===false){THREE.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).");this.attributes[e]={array:arguments[1],itemSize:arguments[2]};return}this.attributes[e]=t;this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(e){return this.attributes[e]},addDrawCall:function(e,t,i){this.drawcalls.push({start:e,count:t,index:i!==undefined?i:0})},applyMatrix:function(e){var t=this.attributes.position;if(t!==undefined){e.applyToVector3Array(t.array);t.needsUpdate=true}var i=this.attributes.normal;if(i!==undefined){var r=(new THREE.Matrix3).getNormalMatrix(e);r.applyToVector3Array(i.array);i.needsUpdate=true}if(this.boundingBox!==null){this.computeBoundingBox()}if(this.boundingSphere!==null){this.computeBoundingSphere()}},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();this.applyMatrix((new THREE.Matrix4).setPosition(e));return e},fromGeometry:function(e,t){t=t||{vertexColors:THREE.NoColors};var i=e.vertices;var r=e.faces;var n=e.faceVertexUvs;var a=t.vertexColors;var o=n[0].length>0;var s=r[0].vertexNormals.length==3;var h=new Float32Array(r.length*3*3);this.addAttribute("position",new THREE.BufferAttribute(h,3));var l=new Float32Array(r.length*3*3);this.addAttribute("normal",new THREE.BufferAttribute(l,3));if(a!==THREE.NoColors){var u=new Float32Array(r.length*3*3);this.addAttribute("color",new THREE.BufferAttribute(u,3))}if(o===true){var c=new Float32Array(r.length*3*2);this.addAttribute("uv",new THREE.BufferAttribute(c,2))}for(var p=0,f=0,d=0;p<r.length;p++,f+=6,d+=9){var m=r[p];var g=i[m.a];var v=i[m.b];var y=i[m.c];h[d]=g.x;h[d+1]=g.y;h[d+2]=g.z;h[d+3]=v.x;h[d+4]=v.y;h[d+5]=v.z;h[d+6]=y.x;h[d+7]=y.y;h[d+8]=y.z;if(s===true){var E=m.vertexNormals[0];var w=m.vertexNormals[1];var b=m.vertexNormals[2];l[d]=E.x;l[d+1]=E.y;l[d+2]=E.z;l[d+3]=w.x;l[d+4]=w.y;l[d+5]=w.z;l[d+6]=b.x;l[d+7]=b.y;l[d+8]=b.z}else{var _=m.normal;l[d]=_.x;l[d+1]=_.y;l[d+2]=_.z;l[d+3]=_.x;l[d+4]=_.y;l[d+5]=_.z;l[d+6]=_.x;l[d+7]=_.y;l[d+8]=_.z}if(a===THREE.FaceColors){var x=m.color;u[d]=x.r;u[d+1]=x.g;u[d+2]=x.b;u[d+3]=x.r;u[d+4]=x.g;u[d+5]=x.b;u[d+6]=x.r;u[d+7]=x.g;u[d+8]=x.b}else if(a===THREE.VertexColors){var T=m.vertexColors[0];var R=m.vertexColors[1];var k=m.vertexColors[2];u[d]=T.r;u[d+1]=T.g;u[d+2]=T.b;u[d+3]=R.r;u[d+4]=R.g;u[d+5]=R.b;u[d+6]=k.r;u[d+7]=k.g;u[d+8]=k.b}if(o===true){var H=n[0][p][0];var M=n[0][p][1];var S=n[0][p][2];c[f]=H.x;c[f+1]=H.y;c[f+2]=M.x;c[f+3]=M.y;c[f+4]=S.x;c[f+5]=S.y}}this.computeBoundingSphere();return this},computeBoundingBox:function(){var e=new THREE.Vector3;return function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3}var t=this.attributes.position.array;if(t){var i=this.boundingBox;i.makeEmpty();for(var r=0,n=t.length;r<n;r+=3){e.set(t[r],t[r+1],t[r+2]);i.expandByPoint(e)}}if(t===undefined||t.length===0){this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}if(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)){THREE.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}}(),computeBoundingSphere:function(){var e=new THREE.Box3;var t=new THREE.Vector3;return function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere}var i=this.attributes.position.array;if(i){e.makeEmpty();var r=this.boundingSphere.center;for(var n=0,a=i.length;n<a;n+=3){t.set(i[n],i[n+1],i[n+2]);e.expandByPoint(t)}e.center(r);var o=0;for(var n=0,a=i.length;n<a;n+=3){t.set(i[n],i[n+1],i[n+2]);o=Math.max(o,r.distanceToSquared(t))}this.boundingSphere.radius=Math.sqrt(o);if(isNaN(this.boundingSphere.radius)){THREE.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.attributes;if(e.position){var t=e.position.array;if(e.normal===undefined){this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(t.length),3))}else{var i=e.normal.array;for(var r=0,n=i.length;r<n;r++){i[r]=0}}var i=e.normal.array;var a,o,s,h=new THREE.Vector3,l=new THREE.Vector3,u=new THREE.Vector3,c=new THREE.Vector3,p=new THREE.Vector3;if(e.index){var f=e.index.array;var d=this.offsets.length>0?this.offsets:[{start:0,count:f.length,index:0}];for(var m=0,g=d.length;m<g;++m){var v=d[m].start;var y=d[m].count;var E=d[m].index;for(var r=v,n=v+y;r<n;r+=3){a=(E+f[r])*3;o=(E+f[r+1])*3;s=(E+f[r+2])*3;h.fromArray(t,a);l.fromArray(t,o);u.fromArray(t,s);c.subVectors(u,l);p.subVectors(h,l);c.cross(p);i[a]+=c.x;i[a+1]+=c.y;i[a+2]+=c.z;i[o]+=c.x;i[o+1]+=c.y;i[o+2]+=c.z;i[s]+=c.x;i[s+1]+=c.y;i[s+2]+=c.z}}}else{for(var r=0,n=t.length;r<n;r+=9){h.fromArray(t,r);l.fromArray(t,r+3);u.fromArray(t,r+6);c.subVectors(u,l);p.subVectors(h,l);c.cross(p);i[r]=c.x;i[r+1]=c.y;i[r+2]=c.z;i[r+3]=c.x;i[r+4]=c.y;i[r+5]=c.z;i[r+6]=c.x;i[r+7]=c.y;i[r+8]=c.z}}this.normalizeNormals();e.normal.needsUpdate=true}},computeTangents:function(){if(this.attributes.index===undefined||this.attributes.position===undefined||this.attributes.normal===undefined||this.attributes.uv===undefined){THREE.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");return}var e=this.attributes.index.array;var t=this.attributes.position.array;var i=this.attributes.normal.array;var r=this.attributes.uv.array;var n=t.length/3;if(this.attributes.tangent===undefined){this.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*n),4))}var a=this.attributes.tangent.array;var o=[],s=[];for(var h=0;h<n;h++){o[h]=new THREE.Vector3;s[h]=new THREE.Vector3}var l=new THREE.Vector3,u=new THREE.Vector3,c=new THREE.Vector3,p=new THREE.Vector2,f=new THREE.Vector2,d=new THREE.Vector2,m,g,v,y,E,w,b,_,x,T,R;var k=new THREE.Vector3,H=new THREE.Vector3;function M(e,i,n){l.fromArray(t,e*3);u.fromArray(t,i*3);c.fromArray(t,n*3);p.fromArray(r,e*2);f.fromArray(r,i*2);d.fromArray(r,n*2);m=u.x-l.x;g=c.x-l.x;v=u.y-l.y;y=c.y-l.y;E=u.z-l.z;w=c.z-l.z;b=f.x-p.x;_=d.x-p.x;x=f.y-p.y;T=d.y-p.y;R=1/(b*T-_*x);k.set((T*m-x*g)*R,(T*v-x*y)*R,(T*E-x*w)*R);H.set((b*g-_*m)*R,(b*y-_*v)*R,(b*w-_*E)*R);o[e].add(k);o[i].add(k);o[n].add(k);s[e].add(H);s[i].add(H);s[n].add(H)}var S,A;var C,z;var P,L,O;if(this.drawcalls.length===0){this.addDrawCall(0,e.length,0)}var D=this.drawcalls;for(C=0,z=D.length;C<z;++C){var F=D[C].start;var B=D[C].count;var U=D[C].index;for(S=F,A=F+B;S<A;S+=3){P=U+e[S];L=U+e[S+1];O=U+e[S+2];M(P,L,O)}}var N=new THREE.Vector3,V=new THREE.Vector3;var I=new THREE.Vector3,j=new THREE.Vector3;var G,W,q;function X(e){I.fromArray(i,e*3);j.copy(I);W=o[e];N.copy(W);N.sub(I.multiplyScalar(I.dot(W))).normalize();V.crossVectors(j,W);q=V.dot(s[e]);G=q<0?-1:1;a[e*4]=N.x;a[e*4+1]=N.y;a[e*4+2]=N.z;a[e*4+3]=G}for(C=0,z=D.length;C<z;++C){var F=D[C].start;var B=D[C].count;var U=D[C].index;for(S=F,A=F+B;S<A;S+=3){P=U+e[S];L=U+e[S+1];O=U+e[S+2];X(P);X(L);X(O)}}},computeOffsets:function(e){if(e===undefined)e=65535;var t=this.attributes.index.array;var i=this.attributes.position.array;var r=t.length/3;var n=new Uint16Array(t.length);var a=0;var o=0;var s=[{start:0,count:0,index:0}];var h=s[0];var l=0;var u=0;var c=new Int32Array(6);var p=new Int32Array(i.length);var f=new Int32Array(i.length);for(var d=0;d<i.length;d++){p[d]=-1;f[d]=-1}for(var m=0;m<r;m++){u=0;for(var g=0;g<3;g++){var v=t[m*3+g];if(p[v]==-1){c[g*2]=v;c[g*2+1]=-1;u++}else if(p[v]<h.index){c[g*2]=v;c[g*2+1]=-1;l++}else{c[g*2]=v;c[g*2+1]=p[v]}}var y=o+u;if(y>h.index+e){var E={start:a,count:0,index:o};s.push(E);h=E;for(var w=0;w<6;w+=2){var b=c[w+1];if(b>-1&&b<h.index)c[w+1]=-1}}for(var w=0;w<6;w+=2){var v=c[w];var b=c[w+1];if(b===-1)b=o++;p[v]=b;f[b]=v;n[a++]=b-h.index;h.count++}}this.reorderBuffers(n,f,o);this.offsets=s;this.drawcalls=s;return s},merge:function(e,t){if(e instanceof THREE.BufferGeometry===false){THREE.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}if(t===undefined)t=0;var i=this.attributes;for(var r in i){if(e.attributes[r]===undefined)continue;var n=i[r];var a=n.array;var o=e.attributes[r];var s=o.array;var h=o.itemSize;for(var l=0,u=h*t;l<s.length;l++,u++){a[u]=s[l]}}return this},normalizeNormals:function(){var e=this.attributes.normal.array;var t,i,r,n;for(var a=0,o=e.length;a<o;a+=3){t=e[a];i=e[a+1];r=e[a+2];n=1/Math.sqrt(t*t+i*i+r*r);e[a]*=n;e[a+1]*=n;e[a+2]*=n}},reorderBuffers:function(e,t,i){var r={};for(var n in this.attributes){if(n=="index")continue;var a=this.attributes[n].array;r[n]=new a.constructor(this.attributes[n].itemSize*i)}for(var o=0;o<i;o++){var s=t[o];for(var n in this.attributes){if(n=="index")continue;var h=this.attributes[n].array;var l=this.attributes[n].itemSize;var u=r[n];for(var c=0;c<l;c++)u[o*l+c]=h[s*l+c]}}this.attributes["index"].array=e;for(var n in this.attributes){if(n=="index")continue;this.attributes[n].array=r[n];this.attributes[n].numItems=this.attributes[n].itemSize*i}},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}};var t=this.attributes;var i=this.offsets;var r=this.boundingSphere;for(var n in t){var a=t[n];var o=Array.prototype.slice.call(a.array);e.data.attributes[n]={itemSize:a.itemSize,type:a.array.constructor.name,array:o}}if(i.length>0){e.data.offsets=JSON.parse(JSON.stringify(i))}if(r!==null){e.data.boundingSphere={center:r.center.toArray(),radius:r.radius}}return e},clone:function(){var e=new THREE.BufferGeometry;for(var t in this.attributes){var i=this.attributes[t];e.addAttribute(t,i.clone())}for(var r=0,n=this.offsets.length;r<n;r++){var a=this.offsets[r];e.offsets.push({start:a.start,index:a.index,count:a.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);THREE.Geometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.dynamic=true;this.verticesNeedUpdate=false;this.elementsNeedUpdate=false;this.uvsNeedUpdate=false;this.normalsNeedUpdate=false;this.tangentsNeedUpdate=false;this.colorsNeedUpdate=false;this.lineDistancesNeedUpdate=false;this.groupsNeedUpdate=false};THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){var t=(new THREE.Matrix3).getNormalMatrix(e);for(var i=0,r=this.vertices.length;i<r;i++){var n=this.vertices[i];n.applyMatrix4(e)}for(var i=0,r=this.faces.length;i<r;i++){var a=this.faces[i];a.normal.applyMatrix3(t).normalize();for(var o=0,s=a.vertexNormals.length;o<s;o++){a.vertexNormals[o].applyMatrix3(t).normalize()}}if(this.boundingBox!==null){this.computeBoundingBox()}if(this.boundingSphere!==null){this.computeBoundingSphere()}this.verticesNeedUpdate=true;this.normalsNeedUpdate=true},fromBufferGeometry:function(e){var t=this;var i=e.attributes;var r=i.position.array;var n=i.index!==undefined?i.index.array:undefined;var a=i.normal!==undefined?i.normal.array:undefined;var o=i.color!==undefined?i.color.array:undefined;var s=i.uv!==undefined?i.uv.array:undefined;var h=[];var l=[];for(var u=0,c=0;u<r.length;u+=3,c+=2){t.vertices.push(new THREE.Vector3(r[u],r[u+1],r[u+2]));if(a!==undefined){h.push(new THREE.Vector3(a[u],a[u+1],a[u+2]))}if(o!==undefined){t.colors.push(new THREE.Color(o[u],o[u+1],o[u+2]))}if(s!==undefined){l.push(new THREE.Vector2(s[c],s[c+1]))}}var p=function(e,i,r){var n=a!==undefined?[h[e].clone(),h[i].clone(),h[r].clone()]:[];var u=o!==undefined?[t.colors[e].clone(),t.colors[i].clone(),t.colors[r].clone()]:[];t.faces.push(new THREE.Face3(e,i,r,n,u));if(s!==undefined){t.faceVertexUvs[0].push([l[e].clone(),l[i].clone(),l[r].clone()])}};if(n!==undefined){var f=e.drawcalls;if(f.length>0){for(var u=0;u<f.length;u++){var d=f[u];var m=d.start;var g=d.count;var v=d.index;for(var c=m,y=m+g;c<y;c+=3){p(v+n[c],v+n[c+1],v+n[c+2])}}}else{for(var u=0;u<n.length;u+=3){p(n[u],n[u+1],n[u+2])}}}else{for(var u=0;u<r.length/3;u+=3){p(u,u+1,u+2)}}this.computeFaceNormals();if(e.boundingBox!==null){this.boundingBox=e.boundingBox.clone()}if(e.boundingSphere!==null){this.boundingSphere=e.boundingSphere.clone()}return this},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();this.applyMatrix((new THREE.Matrix4).setPosition(e));return e},computeFaceNormals:function(){var e=new THREE.Vector3,t=new THREE.Vector3;for(var i=0,r=this.faces.length;i<r;i++){var n=this.faces[i];var a=this.vertices[n.a];var o=this.vertices[n.b];var s=this.vertices[n.c];e.subVectors(s,o);t.subVectors(a,o);e.cross(t);e.normalize();n.normal.copy(e)}},computeVertexNormals:function(e){var t,i,r,n,a,o;o=new Array(this.vertices.length);for(t=0,i=this.vertices.length;t<i;t++){o[t]=new THREE.Vector3}if(e){var s,h,l;var u=new THREE.Vector3,c=new THREE.Vector3;for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];s=this.vertices[a.a];h=this.vertices[a.b];l=this.vertices[a.c];u.subVectors(l,h);c.subVectors(s,h);u.cross(c);o[a.a].add(u);o[a.b].add(u);o[a.c].add(u)}}else{for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];o[a.a].add(a.normal);o[a.b].add(a.normal);o[a.c].add(a.normal)}}for(t=0,i=this.vertices.length;t<i;t++){o[t].normalize()}for(r=0,n=this.faces.length;r<n;r++){a=this.faces[r];a.vertexNormals[0]=o[a.a].clone();a.vertexNormals[1]=o[a.b].clone();a.vertexNormals[2]=o[a.c].clone()}},computeMorphNormals:function(){var e,t,i,r,n;for(i=0,r=this.faces.length;i<r;i++){n=this.faces[i];if(!n.__originalFaceNormal){n.__originalFaceNormal=n.normal.clone()}else{n.__originalFaceNormal.copy(n.normal)}if(!n.__originalVertexNormals)n.__originalVertexNormals=[];for(e=0,t=n.vertexNormals.length;e<t;e++){if(!n.__originalVertexNormals[e]){n.__originalVertexNormals[e]=n.vertexNormals[e].clone()}else{n.__originalVertexNormals[e].copy(n.vertexNormals[e])}}}var a=new THREE.Geometry;a.faces=this.faces;for(e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={};this.morphNormals[e].faceNormals=[];this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals;var s=this.morphNormals[e].vertexNormals;var h,l;for(i=0,r=this.faces.length;i<r;i++){h=new THREE.Vector3;l={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3};o.push(h);s.push(l)}}var u=this.morphNormals[e];a.vertices=this.morphTargets[e].vertices;a.computeFaceNormals();a.computeVertexNormals();var h,l;for(i=0,r=this.faces.length;i<r;i++){n=this.faces[i];h=u.faceNormals[i];l=u.vertexNormals[i];h.copy(n.normal);l.a.copy(n.vertexNormals[0]);l.b.copy(n.vertexNormals[1]);l.c.copy(n.vertexNormals[2])}}for(i=0,r=this.faces.length;i<r;i++){n=this.faces[i];n.normal=n.__originalFaceNormal;n.vertexNormals=n.__originalVertexNormals}},computeTangents:function(){var e,t,i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H=[],M=[],S=new THREE.Vector3,A=new THREE.Vector3,C=new THREE.Vector3,z=new THREE.Vector3,P=new THREE.Vector3,L;for(i=0,r=this.vertices.length;i<r;i++){H[i]=new THREE.Vector3;M[i]=new THREE.Vector3}function O(e,t,i,r,n,a,o){h=e.vertices[t];l=e.vertices[i];u=e.vertices[r];c=s[n];p=s[a];f=s[o];d=l.x-h.x;m=u.x-h.x;g=l.y-h.y;v=u.y-h.y;y=l.z-h.z;E=u.z-h.z;w=p.x-c.x;b=f.x-c.x;_=p.y-c.y;x=f.y-c.y;T=1/(w*x-b*_);S.set((x*d-_*m)*T,(x*g-_*v)*T,(x*y-_*E)*T);A.set((w*m-b*d)*T,(w*v-b*g)*T,(w*E-b*y)*T);H[t].add(S);H[i].add(S);H[r].add(S);M[t].add(A);M[i].add(A);M[r].add(A)}for(e=0,t=this.faces.length;e<t;e++){o=this.faces[e];s=this.faceVertexUvs[0][e];O(this,o.a,o.b,o.c,0,1,2)}var D=["a","b","c","d"];for(e=0,t=this.faces.length;e<t;e++){o=this.faces[e];for(n=0;n<Math.min(o.vertexNormals.length,3);n++){P.copy(o.vertexNormals[n]);a=o[D[n]];R=H[a];C.copy(R);C.sub(P.multiplyScalar(P.dot(R))).normalize();z.crossVectors(o.vertexNormals[n],R);k=z.dot(M[a]);L=k<0?-1:1;o.vertexTangents[n]=new THREE.Vector4(C.x,C.y,C.z,L)}}this.hasTangents=true},computeLineDistances:function(){var e=0;var t=this.vertices;for(var i=0,r=t.length;i<r;i++){if(i>0){e+=t[i].distanceTo(t[i-1])}this.lineDistances[i]=e}},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3}this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere}this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(e instanceof THREE.Geometry===false){THREE.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}var r,n=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,h=e.faces,l=this.faceVertexUvs[0],u=e.faceVertexUvs[0];if(i===undefined)i=0;if(t!==undefined){r=(new THREE.Matrix3).getNormalMatrix(t)}for(var c=0,p=o.length;c<p;c++){var f=o[c];var d=f.clone();if(t!==undefined)d.applyMatrix4(t);a.push(d)}for(c=0,p=h.length;c<p;c++){var m=h[c],g,v,y,E=m.vertexNormals,w=m.vertexColors;g=new THREE.Face3(m.a+n,m.b+n,m.c+n);g.normal.copy(m.normal);if(r!==undefined){g.normal.applyMatrix3(r).normalize()}for(var b=0,_=E.length;b<_;b++){v=E[b].clone();if(r!==undefined){v.applyMatrix3(r).normalize()}g.vertexNormals.push(v)}g.color.copy(m.color);for(var b=0,_=w.length;b<_;b++){y=w[b];g.vertexColors.push(y.clone())}g.materialIndex=m.materialIndex+i;s.push(g)}for(c=0,p=u.length;c<p;c++){var x=u[c],T=[];if(x===undefined){continue}for(var b=0,_=x.length;b<_;b++){T.push(x[b].clone())}l.push(T)}},mergeMesh:function(e){if(e instanceof THREE.Mesh===false){THREE.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix();this.merge(e.geometry,e.matrix)},mergeVertices:function(){var e={};var t=[],i=[];var r,n;var a=4;var o=Math.pow(10,a);var s,h,l;var u,c,p;for(s=0,h=this.vertices.length;s<h;s++){r=this.vertices[s];n=Math.round(r.x*o)+"_"+Math.round(r.y*o)+"_"+Math.round(r.z*o);if(e[n]===undefined){e[n]=s;t.push(this.vertices[s]);i[s]=t.length-1}else{i[s]=i[e[n]]}}var f=[];for(s=0,h=this.faces.length;s<h;s++){l=this.faces[s];l.a=i[l.a];l.b=i[l.b];l.c=i[l.c];u=[l.a,l.b,l.c];var d=-1;for(var m=0;m<3;m++){if(u[m]==u[(m+1)%3]){d=m;f.push(s);break}}}for(s=f.length-1;s>=0;s--){var g=f[s];this.faces.splice(g,1);for(c=0,p=this.faceVertexUvs.length;c<p;c++){this.faceVertexUvs[c].splice(g,1)}}var v=this.vertices.length-t.length;this.vertices=t;return v},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};if(this.name!=="")e.name=this.name;if(this.parameters!==undefined){var t=this.parameters;for(var i in t){if(t[i]!==undefined)e[i]=t[i]}return e}var r=[];for(var n=0;n<this.vertices.length;n++){var a=this.vertices[n];r.push(a.x,a.y,a.z)}var o=[];var s=[];var h={};var l=[];var u={};var c=[];var p={};for(var n=0;n<this.faces.length;n++){var f=this.faces[n];var d=false;var m=false;var g=this.faceVertexUvs[0][n]!==undefined;var v=f.normal.length()>0;var y=f.vertexNormals.length>0;var E=f.color.r!==1||f.color.g!==1||f.color.b!==1;var w=f.vertexColors.length>0;var b=0;b=R(b,0,0);b=R(b,1,d);b=R(b,2,m);b=R(b,3,g);b=R(b,4,v);b=R(b,5,y);b=R(b,6,E);b=R(b,7,w);o.push(b);o.push(f.a,f.b,f.c);if(g){var _=this.faceVertexUvs[0][n];o.push(M(_[0]),M(_[1]),M(_[2]))}if(v){o.push(k(f.normal))}if(y){var x=f.vertexNormals;o.push(k(x[0]),k(x[1]),k(x[2]))}if(E){o.push(H(f.color))}if(w){var T=f.vertexColors;o.push(H(T[0]),H(T[1]),H(T[2]))}}function R(e,t,i){return i?e|1<<t:e&~(1<<t)}function k(e){var t=e.x.toString()+e.y.toString()+e.z.toString();if(h[t]!==undefined){return h[t]}h[t]=s.length/3;s.push(e.x,e.y,e.z);return h[t]}function H(e){var t=e.r.toString()+e.g.toString()+e.b.toString();if(u[t]!==undefined){return u[t]}u[t]=l.length;l.push(e.getHex());return u[t]}function M(e){var t=e.x.toString()+e.y.toString();if(p[t]!==undefined){return p[t]}p[t]=c.length/2;c.push(e.x,e.y);return p[t]}e.data={};e.data.vertices=r;e.data.normals=s;if(l.length>0)e.data.colors=l;if(c.length>0)e.data.uvs=[c];e.data.faces=o;return e},clone:function(){var e=new THREE.Geometry;var t=this.vertices;for(var i=0,r=t.length;i<r;i++){e.vertices.push(t[i].clone())}var n=this.faces;for(var i=0,r=n.length;i<r;i++){e.faces.push(n[i].clone())}for(var i=0,r=this.faceVertexUvs.length;i<r;i++){var a=this.faceVertexUvs[i];if(e.faceVertexUvs[i]===undefined){e.faceVertexUvs[i]=[]}for(var o=0,s=a.length;o<s;o++){var h=a[o],l=[];for(var u=0,c=h.length;u<c;u++){var p=h[u];l.push(p.clone())}e.faceVertexUvs[i].push(l)}}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype);THREE.GeometryIdCount=0;THREE.Camera=function(){THREE.Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.getWorldDirection=function(){var e=new THREE.Quaternion;return function(t){var i=t||new THREE.Vector3;this.getWorldQuaternion(e);return i.set(0,0,-1).applyQuaternion(e)}}();THREE.Camera.prototype.lookAt=function(){var e=new THREE.Matrix4;return function(t){e.lookAt(this.position,t,this.up);this.quaternion.setFromRotationMatrix(e)}}();THREE.Camera.prototype.clone=function(e){if(e===undefined)e=new THREE.Camera;THREE.Object3D.prototype.clone.call(this,e);e.matrixWorldInverse.copy(this.matrixWorldInverse);e.projectionMatrix.copy(this.projectionMatrix);return e};THREE.CubeCamera=function(e,t,i){THREE.Object3D.call(this);this.type="CubeCamera";var r=90,n=1;var a=new THREE.PerspectiveCamera(r,n,e,t);a.up.set(0,-1,0);a.lookAt(new THREE.Vector3(1,0,0));this.add(a);var o=new THREE.PerspectiveCamera(r,n,e,t);o.up.set(0,-1,0);o.lookAt(new THREE.Vector3(-1,0,0));this.add(o);var s=new THREE.PerspectiveCamera(r,n,e,t);s.up.set(0,0,1);s.lookAt(new THREE.Vector3(0,1,0));this.add(s);var h=new THREE.PerspectiveCamera(r,n,e,t);h.up.set(0,0,-1);h.lookAt(new THREE.Vector3(0,-1,0));this.add(h);var l=new THREE.PerspectiveCamera(r,n,e,t);l.up.set(0,-1,0);l.lookAt(new THREE.Vector3(0,0,1));this.add(l);var u=new THREE.PerspectiveCamera(r,n,e,t);u.up.set(0,-1,0);u.lookAt(new THREE.Vector3(0,0,-1));this.add(u);this.renderTarget=new THREE.WebGLRenderTargetCube(i,i,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(e,t){var i=this.renderTarget;var r=i.generateMipmaps;i.generateMipmaps=false;i.activeCubeFace=0;e.render(t,a,i);i.activeCubeFace=1;e.render(t,o,i);i.activeCubeFace=2;e.render(t,s,i);i.activeCubeFace=3;e.render(t,h,i);i.activeCubeFace=4;e.render(t,l,i);i.generateMipmaps=r;i.activeCubeFace=5;e.render(t,u,i)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CubeCamera.prototype.constructor=THREE.CubeCamera;THREE.OrthographicCamera=function(e,t,i,r,n,a){THREE.Camera.call(this);this.type="OrthographicCamera";this.zoom=1;this.left=e;this.right=t;this.top=i;this.bottom=r;this.near=n!==undefined?n:.1;this.far=a!==undefined?a:2e3;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera;THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom);var t=(this.top-this.bottom)/(2*this.zoom);var i=(this.right+this.left)/2;var r=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(i-e,i+e,r+t,r-t,this.near,this.far)};THREE.OrthographicCamera.prototype.clone=function(){var e=new THREE.OrthographicCamera;THREE.Camera.prototype.clone.call(this,e);e.zoom=this.zoom;e.left=this.left;e.right=this.right;e.top=this.top;e.bottom=this.bottom;e.near=this.near;e.far=this.far;e.projectionMatrix.copy(this.projectionMatrix);return e};THREE.PerspectiveCamera=function(e,t,i,r){THREE.Camera.call(this);this.type="PerspectiveCamera";this.zoom=1;this.fov=e!==undefined?e:50;this.aspect=t!==undefined?t:1;this.near=i!==undefined?i:.1;this.far=r!==undefined?r:2e3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera;THREE.PerspectiveCamera.prototype.setLens=function(e,t){if(t===undefined)t=24;this.fov=2*THREE.Math.radToDeg(Math.atan(t/(e*2)));this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,i,r,n,a){this.fullWidth=e;this.fullHeight=t;this.x=i;this.y=r;this.width=n;this.height=a;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=THREE.Math.radToDeg(2*Math.atan(Math.tan(THREE.Math.degToRad(this.fov)*.5)/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight;var i=Math.tan(THREE.Math.degToRad(e*.5))*this.near;var r=-i;var n=t*r;var a=t*i;var o=Math.abs(a-n);var s=Math.abs(i-r);this.projectionMatrix.makeFrustum(n+this.x*o/this.fullWidth,n+(this.x+this.width)*o/this.fullWidth,i-(this.y+this.height)*s/this.fullHeight,i-this.y*s/this.fullHeight,this.near,this.far)}else{this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)}};THREE.PerspectiveCamera.prototype.clone=function(){var e=new THREE.PerspectiveCamera;THREE.Camera.prototype.clone.call(this,e);e.zoom=this.zoom;e.fov=this.fov;e.aspect=this.aspect;e.near=this.near;e.far=this.far;e.projectionMatrix.copy(this.projectionMatrix);return e};THREE.Light=function(e){THREE.Object3D.call(this);this.type="Light";this.color=new THREE.Color(e)};THREE.Light.prototype=Object.create(THREE.Object3D.prototype);THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.clone=function(e){if(e===undefined)e=new THREE.Light;THREE.Object3D.prototype.clone.call(this,e);e.color.copy(this.color);return e};THREE.AmbientLight=function(e){THREE.Light.call(this,e);this.type="AmbientLight"};THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype);THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.AmbientLight.prototype.clone=function(){var e=new THREE.AmbientLight;THREE.Light.prototype.clone.call(this,e);return e};THREE.AreaLight=function(e,t){THREE.Light.call(this,e);this.type="AreaLight";this.normal=new THREE.Vector3(0,-1,0);this.right=new THREE.Vector3(1,0,0);this.intensity=t!==undefined?t:1;this.width=1;this.height=1;this.constantAttenuation=1.5;this.linearAttenuation=.5;this.quadraticAttenuation=.1};THREE.AreaLight.prototype=Object.create(THREE.Light.prototype);THREE.AreaLight.prototype.constructor=THREE.AreaLight;THREE.DirectionalLight=function(e,t){THREE.Light.call(this,e);this.type="DirectionalLight";this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=t!==undefined?t:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraLeft=-500;this.shadowCameraRight=500;this.shadowCameraTop=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowCascade=false;this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,.99,.998];this.shadowCascadeFarZ=[.99,.998,1];this.shadowCascadeArray=[];this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.DirectionalLight.prototype.clone=function(){var e=new THREE.DirectionalLight;THREE.Light.prototype.clone.call(this,e);e.target=this.target.clone();e.intensity=this.intensity;e.castShadow=this.castShadow;e.onlyShadow=this.onlyShadow;e.shadowCameraNear=this.shadowCameraNear;e.shadowCameraFar=this.shadowCameraFar;e.shadowCameraLeft=this.shadowCameraLeft;e.shadowCameraRight=this.shadowCameraRight;e.shadowCameraTop=this.shadowCameraTop;e.shadowCameraBottom=this.shadowCameraBottom;e.shadowCameraVisible=this.shadowCameraVisible;e.shadowBias=this.shadowBias;e.shadowDarkness=this.shadowDarkness;e.shadowMapWidth=this.shadowMapWidth;e.shadowMapHeight=this.shadowMapHeight;e.shadowCascade=this.shadowCascade;e.shadowCascadeOffset.copy(this.shadowCascadeOffset);e.shadowCascadeCount=this.shadowCascadeCount;e.shadowCascadeBias=this.shadowCascadeBias.slice(0);e.shadowCascadeWidth=this.shadowCascadeWidth.slice(0);e.shadowCascadeHeight=this.shadowCascadeHeight.slice(0);e.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0);e.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0);return e};THREE.HemisphereLight=function(e,t,i){THREE.Light.call(this,e);this.type="HemisphereLight";this.position.set(0,100,0);this.groundColor=new THREE.Color(t);this.intensity=i!==undefined?i:1};THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype);THREE.HemisphereLight.prototype.constructor=THREE.HemisphereLight;THREE.HemisphereLight.prototype.clone=function(){var e=new THREE.HemisphereLight;THREE.Light.prototype.clone.call(this,e);e.groundColor.copy(this.groundColor);e.intensity=this.intensity;return e};THREE.PointLight=function(e,t,i,r){THREE.Light.call(this,e);this.type="PointLight";this.intensity=t!==undefined?t:1;this.distance=i!==undefined?i:0;this.decay=r!==undefined?r:1};THREE.PointLight.prototype=Object.create(THREE.Light.prototype);THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.PointLight.prototype.clone=function(){var e=new THREE.PointLight;THREE.Light.prototype.clone.call(this,e);e.intensity=this.intensity;e.distance=this.distance;e.decay=this.decay;return e};THREE.SpotLight=function(e,t,i,r,n,a){THREE.Light.call(this,e);this.type="SpotLight";this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=t!==undefined?t:1;this.distance=i!==undefined?i:0;this.angle=r!==undefined?r:Math.PI/3;this.exponent=n!==undefined?n:10;this.decay=a!==undefined?a:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraFov=50;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.SpotLight.prototype=Object.create(THREE.Light.prototype);THREE.SpotLight.prototype.constructor=THREE.SpotLight;THREE.SpotLight.prototype.clone=function(){var e=new THREE.SpotLight;THREE.Light.prototype.clone.call(this,e);e.target=this.target.clone();e.intensity=this.intensity;e.distance=this.distance;e.angle=this.angle;e.exponent=this.exponent;e.decay=this.decay;e.castShadow=this.castShadow;e.onlyShadow=this.onlyShadow;e.shadowCameraNear=this.shadowCameraNear;e.shadowCameraFar=this.shadowCameraFar;e.shadowCameraFov=this.shadowCameraFov;e.shadowCameraVisible=this.shadowCameraVisible;e.shadowBias=this.shadowBias;e.shadowDarkness=this.shadowDarkness;e.shadowMapWidth=this.shadowMapWidth;e.shadowMapHeight=this.shadowMapHeight;return e};THREE.Cache={files:{},add:function(e,t){this.files[e]=t},get:function(e){return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};THREE.Loader=function(e){this.showStatus=e;this.statusDomElement=e?THREE.Loader.prototype.addStatusElement():null;this.imageLoader=new THREE.ImageLoader;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:undefined,addStatusElement:function(){var e=document.createElement("div");e.style.position="absolute";e.style.right="0px";e.style.top="0px";e.style.fontSize="0.8em";e.style.textAlign="left";e.style.background="rgba(0,0,0,0.25)";e.style.color="#fff";e.style.width="120px";e.style.padding="0.5em 0.5em 0.5em 0.5em";e.style.zIndex=1e3;e.innerHTML="Loading ...";return e},updateProgress:function(e){var t="Loaded ";if(e.total){t+=(100*e.loaded/e.total).toFixed(0)+"%"}else{t+=(e.loaded/1024).toFixed(2)+" KB"}this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");if(t.length===1)return"./";t.pop();return t.join("/")+"/"},initMaterials:function(e,t){var i=[];for(var r=0;r<e.length;++r){i[r]=this.createMaterial(e[r],t)}return i},needsTangents:function(e){for(var t=0,i=e.length;t<i;t++){var r=e[t];if(r instanceof THREE.ShaderMaterial)return true}return false},createMaterial:function(e,t){var i=this;function r(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function n(e,n,a,o,s,h,l){var u=t+a;var c;var p=THREE.Loader.Handlers.get(u);if(p!==null){c=p.load(u)}else{c=new THREE.Texture;p=i.imageLoader;p.crossOrigin=i.crossOrigin;p.load(u,function(e){if(THREE.Math.isPowerOfTwo(e.width)===false||THREE.Math.isPowerOfTwo(e.height)===false){var t=r(e.width);var i=r(e.height);var n=document.createElement("canvas");n.width=t;n.height=i;var a=n.getContext("2d");a.drawImage(e,0,0,t,i);c.image=n}else{c.image=e}c.needsUpdate=true})}c.sourceFile=a;if(o){c.repeat.set(o[0],o[1]);if(o[0]!==1)c.wrapS=THREE.RepeatWrapping;if(o[1]!==1)c.wrapT=THREE.RepeatWrapping}if(s){c.offset.set(s[0],s[1])}if(h){var f={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(f[h[0]]!==undefined)c.wrapS=f[h[0]];if(f[h[1]]!==undefined)c.wrapT=f[h[1]]}if(l){c.anisotropy=l}e[n]=c}function a(e){return(e[0]*255<<16)+(e[1]*255<<8)+e[2]*255}var o="MeshLambertMaterial";var s={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:false};if(e.shading){var h=e.shading.toLowerCase();if(h==="phong")o="MeshPhongMaterial";else if(h==="basic")o="MeshBasicMaterial"}if(e.blending!==undefined&&THREE[e.blending]!==undefined){s.blending=THREE[e.blending]}if(e.transparent!==undefined){s.transparent=e.transparent}if(e.opacity!==undefined&&e.opacity<1){s.transparent=true}if(e.depthTest!==undefined){s.depthTest=e.depthTest}if(e.depthWrite!==undefined){s.depthWrite=e.depthWrite}if(e.visible!==undefined){s.visible=e.visible}if(e.flipSided!==undefined){s.side=THREE.BackSide}if(e.doubleSided!==undefined){s.side=THREE.DoubleSide}if(e.wireframe!==undefined){s.wireframe=e.wireframe}if(e.vertexColors!==undefined){if(e.vertexColors==="face"){s.vertexColors=THREE.FaceColors}else if(e.vertexColors){s.vertexColors=THREE.VertexColors}}if(e.colorDiffuse){s.color=a(e.colorDiffuse)}else if(e.DbgColor){s.color=e.DbgColor}if(e.colorSpecular){s.specular=a(e.colorSpecular)}if(e.colorEmissive){s.emissive=a(e.colorEmissive)}if(e.transparency!==undefined){console.warn("THREE.Loader: transparency has been renamed to opacity");e.opacity=e.transparency}if(e.opacity!==undefined){s.opacity=e.opacity}if(e.specularCoef){s.shininess=e.specularCoef}if(e.mapDiffuse&&t){n(s,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy)}if(e.mapLight&&t){n(s,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy)}if(e.mapBump&&t){n(s,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy)}if(e.mapNormal&&t){n(s,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy)}if(e.mapSpecular&&t){n(s,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy)}if(e.mapAlpha&&t){n(s,"alphaMap",e.mapAlpha,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy)}if(e.mapBumpScale){s.bumpScale=e.mapBumpScale}if(e.mapNormalFactor){s.normalScale=new THREE.Vector2(e.mapNormalFactor,e.mapNormalFactor)}var l=new THREE[o](s);if(e.DbgName!==undefined)l.name=e.DbgName;return l}};THREE.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=0,i=this.handlers.length;t<i;t+=2){var r=this.handlers[t];var n=this.handlers[t+1];if(r.test(e)){return n}}return null}};THREE.XHRLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager};THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(e,t,i,r){var n=this;var a=THREE.Cache.get(e);if(a!==undefined){if(t)t(a);return}var o=new XMLHttpRequest;o.open("GET",e,true);o.addEventListener("load",function(i){THREE.Cache.add(e,this.response);if(t)t(this.response);n.manager.itemEnd(e)},false);if(i!==undefined){o.addEventListener("progress",function(e){i(e)},false)}if(r!==undefined){o.addEventListener("error",function(e){r(e)},false)}if(this.crossOrigin!==undefined)o.crossOrigin=this.crossOrigin;if(this.responseType!==undefined)o.responseType=this.responseType;o.send(null);n.manager.itemStart(e)},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e}};THREE.ImageLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager};THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(e,t,i,r){var n=this;var a=THREE.Cache.get(e);if(a!==undefined){t(a);return}var o=document.createElement("img");o.addEventListener("load",function(i){THREE.Cache.add(e,this);if(t)t(this);n.manager.itemEnd(e)},false);if(i!==undefined){o.addEventListener("progress",function(e){i(e)},false)}if(r!==undefined){o.addEventListener("error",function(e){r(e)},false)}if(this.crossOrigin!==undefined)o.crossOrigin=this.crossOrigin;o.src=e;n.manager.itemStart(e);return o},setCrossOrigin:function(e){this.crossOrigin=e}};THREE.JSONLoader=function(e){THREE.Loader.call(this,e);this.withCredentials=false};THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype);THREE.JSONLoader.prototype.constructor=THREE.JSONLoader;THREE.JSONLoader.prototype.load=function(e,t,i){i=i&&typeof i==="string"?i:this.extractUrlBase(e);this.onLoadStart();this.loadAjaxJSON(this,e,t,i)};THREE.JSONLoader.prototype.loadAjaxJSON=function(e,t,i,r,n){var a=new XMLHttpRequest;var o=0;a.onreadystatechange=function(){if(a.readyState===a.DONE){if(a.status===200||a.status===0){if(a.responseText){var s=JSON.parse(a.responseText);var h=s.metadata;if(h!==undefined){if(h.type==="object"){THREE.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.");return}if(h.type==="scene"){THREE.error("THREE.JSONLoader: "+t+" seems to be a Scene. Use THREE.SceneLoader instead.");return}}var l=e.parse(s,r);i(l.geometry,l.materials)}else{THREE.error("THREE.JSONLoader: "+t+" seems to be unreachable or the file is empty.")}e.onLoadComplete()}else{THREE.error("THREE.JSONLoader: Couldn't load "+t+" ("+a.status+")")}}else if(a.readyState===a.LOADING){if(n){if(o===0){o=a.getResponseHeader("Content-Length")}n({total:o,loaded:a.responseText.length})}}else if(a.readyState===a.HEADERS_RECEIVED){if(n!==undefined){o=a.getResponseHeader("Content-Length")}}};a.open("GET",t,true);a.withCredentials=this.withCredentials;a.send(null)};THREE.JSONLoader.prototype.parse=function(e,t){var i=new THREE.Geometry,r=e.scale!==undefined?1/e.scale:1;n(r);a();o(r);i.computeFaceNormals();i.computeBoundingSphere();function n(t){function r(e,t){return e&1<<t}var n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M,S,A,C=e.faces,z=e.vertices,P=e.normals,L=e.colors,O=0;if(e.uvs!==undefined){for(n=0;n<e.uvs.length;n++){if(e.uvs[n].length)O++}for(n=0;n<O;n++){i.faceVertexUvs[n]=[]}}s=0;h=z.length;while(s<h){b=new THREE.Vector3;b.x=z[s++]*t;b.y=z[s++]*t;b.z=z[s++]*t;i.vertices.push(b)}s=0;h=C.length;while(s<h){f=C[s++];d=r(f,0);m=r(f,1);g=r(f,3);v=r(f,4);y=r(f,5);E=r(f,6);w=r(f,7);if(d){x=new THREE.Face3;x.a=C[s];x.b=C[s+1];x.c=C[s+3];T=new THREE.Face3;T.a=C[s+1];T.b=C[s+2];T.c=C[s+3];s+=4;if(m){p=C[s++];x.materialIndex=p;T.materialIndex=p}o=i.faces.length;if(g){for(n=0;n<O;n++){H=e.uvs[n];i.faceVertexUvs[n][o]=[];i.faceVertexUvs[n][o+1]=[];for(a=0;a<4;a++){c=C[s++];S=H[c*2];A=H[c*2+1];M=new THREE.Vector2(S,A);if(a!==2)i.faceVertexUvs[n][o].push(M);if(a!==0)i.faceVertexUvs[n][o+1].push(M)}}}if(v){u=C[s++]*3;x.normal.set(P[u++],P[u++],P[u]);T.normal.copy(x.normal)}if(y){for(n=0;n<4;n++){u=C[s++]*3;k=new THREE.Vector3(P[u++],P[u++],P[u]);if(n!==2)x.vertexNormals.push(k);if(n!==0)T.vertexNormals.push(k)}}if(E){l=C[s++];R=L[l];x.color.setHex(R);T.color.setHex(R)}if(w){for(n=0;n<4;n++){l=C[s++];R=L[l];if(n!==2)x.vertexColors.push(new THREE.Color(R));if(n!==0)T.vertexColors.push(new THREE.Color(R))}}i.faces.push(x);i.faces.push(T)}else{_=new THREE.Face3;_.a=C[s++];_.b=C[s++];_.c=C[s++];if(m){p=C[s++];_.materialIndex=p}o=i.faces.length;if(g){for(n=0;n<O;n++){H=e.uvs[n];i.faceVertexUvs[n][o]=[];for(a=0;a<3;a++){c=C[s++];S=H[c*2];A=H[c*2+1];M=new THREE.Vector2(S,A);i.faceVertexUvs[n][o].push(M)}}}if(v){u=C[s++]*3;_.normal.set(P[u++],P[u++],P[u])}if(y){for(n=0;n<3;n++){u=C[s++]*3;k=new THREE.Vector3(P[u++],P[u++],P[u]);_.vertexNormals.push(k)}}if(E){l=C[s++];_.color.setHex(L[l])}if(w){for(n=0;n<3;n++){l=C[s++];_.vertexColors.push(new THREE.Color(L[l]))}}i.faces.push(_)}}}function a(){var t=e.influencesPerVertex!==undefined?e.influencesPerVertex:2;if(e.skinWeights){for(var r=0,n=e.skinWeights.length;r<n;r+=t){var a=e.skinWeights[r];var o=t>1?e.skinWeights[r+1]:0;var s=t>2?e.skinWeights[r+2]:0;var h=t>3?e.skinWeights[r+3]:0;i.skinWeights.push(new THREE.Vector4(a,o,s,h))}}if(e.skinIndices){for(var r=0,n=e.skinIndices.length;r<n;r+=t){var l=e.skinIndices[r];var u=t>1?e.skinIndices[r+1]:0;var c=t>2?e.skinIndices[r+2]:0;var p=t>3?e.skinIndices[r+3]:0;i.skinIndices.push(new THREE.Vector4(l,u,c,p))}}i.bones=e.bones;if(i.bones&&i.bones.length>0&&(i.skinWeights.length!==i.skinIndices.length||i.skinIndices.length!==i.vertices.length)){THREE.warn("THREE.JSONLoader: When skinning, number of vertices ("+i.vertices.length+"), skinIndices ("+i.skinIndices.length+"), and skinWeights ("+i.skinWeights.length+") should match.")}i.animation=e.animation;i.animations=e.animations}function o(t){if(e.morphTargets!==undefined){var r,n,a,o,s,h;for(r=0,n=e.morphTargets.length;r<n;r++){i.morphTargets[r]={};i.morphTargets[r].name=e.morphTargets[r].name;i.morphTargets[r].vertices=[];s=i.morphTargets[r].vertices;h=e.morphTargets[r].vertices;for(a=0,o=h.length;a<o;a+=3){var l=new THREE.Vector3;l.x=h[a]*t;l.y=h[a+1]*t;l.z=h[a+2]*t;s.push(l)}}}if(e.morphColors!==undefined){var r,n,u,c,p,f,d;for(r=0,n=e.morphColors.length;r<n;r++){i.morphColors[r]={};i.morphColors[r].name=e.morphColors[r].name;i.morphColors[r].colors=[];p=i.morphColors[r].colors;f=e.morphColors[r].colors;for(u=0,c=f.length;u<c;u+=3){d=new THREE.Color(16755200);d.setRGB(f[u],f[u+1],f[u+2]);p.push(d)}}}}if(e.materials===undefined||e.materials.length===0){return{geometry:i}}else{var s=this.initMaterials(e.materials,t);if(this.needsTangents(s)){i.computeTangents()}return{geometry:i,materials:s}}};THREE.LoadingManager=function(e,t,i){var r=this;var n=0,a=0;this.onLoad=e;this.onProgress=t;this.onError=i;this.itemStart=function(e){a++};this.itemEnd=function(e){n++;if(r.onProgress!==undefined){r.onProgress(e,n,a)}if(n===a&&r.onLoad!==undefined){r.onLoad()}}};THREE.DefaultLoadingManager=new THREE.LoadingManager;THREE.BufferGeometryLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager};THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(e,t,i,r){var n=this;var a=new THREE.XHRLoader(n.manager);a.setCrossOrigin(this.crossOrigin);a.load(e,function(e){t(n.parse(JSON.parse(e)))},i,r)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new THREE.BufferGeometry;var i=e.data.attributes;for(var r in i){var n=i[r];var a=new self[n.type](n.array);t.addAttribute(r,new THREE.BufferAttribute(a,n.itemSize))}var o=e.data.offsets;if(o!==undefined){t.offsets=JSON.parse(JSON.stringify(o))}var s=e.data.boundingSphere;if(s!==undefined){var h=new THREE.Vector3;if(s.center!==undefined){h.fromArray(s.center)}t.boundingSphere=new THREE.Sphere(h,s.radius)}return t}};THREE.MaterialLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager};THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(e,t,i,r){var n=this;var a=new THREE.XHRLoader(n.manager);a.setCrossOrigin(this.crossOrigin);a.load(e,function(e){t(n.parse(JSON.parse(e)))},i,r)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new THREE[e.type];if(e.color!==undefined)t.color.setHex(e.color);if(e.emissive!==undefined)t.emissive.setHex(e.emissive);if(e.specular!==undefined)t.specular.setHex(e.specular);if(e.shininess!==undefined)t.shininess=e.shininess;if(e.uniforms!==undefined)t.uniforms=e.uniforms;if(e.vertexShader!==undefined)t.vertexShader=e.vertexShader;if(e.fragmentShader!==undefined)t.fragmentShader=e.fragmentShader;if(e.vertexColors!==undefined)t.vertexColors=e.vertexColors;if(e.shading!==undefined)t.shading=e.shading;if(e.blending!==undefined)t.blending=e.blending;if(e.side!==undefined)t.side=e.side;if(e.opacity!==undefined)t.opacity=e.opacity;if(e.transparent!==undefined)t.transparent=e.transparent;if(e.wireframe!==undefined)t.wireframe=e.wireframe;if(e.size!==undefined)t.size=e.size;if(e.sizeAttenuation!==undefined)t.sizeAttenuation=e.sizeAttenuation;if(e.materials!==undefined){for(var i=0,r=e.materials.length;i<r;i++){t.materials.push(this.parse(e.materials[i]))}}return t}};THREE.ObjectLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager;this.texturePath=""};THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(e,t,i,r){if(this.texturePath===""){this.texturePath=e.substring(0,e.lastIndexOf("/")+1)}var n=this;var a=new THREE.XHRLoader(n.manager);a.setCrossOrigin(this.crossOrigin);a.load(e,function(e){n.parse(JSON.parse(e),t)},i,r)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var i=this.parseGeometries(e.geometries);var r=this.parseImages(e.images,function(){if(t!==undefined)t(o)});var n=this.parseTextures(e.textures,r);var a=this.parseMaterials(e.materials,n);var o=this.parseObject(e.object,i,a);if(e.images===undefined||e.images.length===0){if(t!==undefined)t(o)}return o},parseGeometries:function(e){var t={};if(e!==undefined){var i=new THREE.JSONLoader;var r=new THREE.BufferGeometryLoader;for(var n=0,a=e.length;n<a;n++){var o;var s=e[n];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new THREE[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"CubeGeometry":o=new THREE.BoxGeometry(s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":o=new THREE.CircleGeometry(s.radius,s.segments);break;case"CylinderGeometry":o=new THREE.CylinderGeometry(s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded);break;case"SphereGeometry":o=new THREE.SphereGeometry(s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"IcosahedronGeometry":o=new THREE.IcosahedronGeometry(s.radius,s.detail);break;case"TorusGeometry":o=new THREE.TorusGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":o=new THREE.TorusKnotGeometry(s.radius,s.tube,s.radialSegments,s.tubularSegments,s.p,s.q,s.heightScale);break;case"BufferGeometry":o=r.parse(s);break;case"Geometry":o=i.parse(s.data).geometry;break}o.uuid=s.uuid;if(s.name!==undefined)o.name=s.name;t[s.uuid]=o}}return t},parseMaterials:function(e,t){var i={};if(e!==undefined){var r=function(e){if(t[e]===undefined){THREE.warn("THREE.ObjectLoader: Undefined texture",e)}return t[e]};var n=new THREE.MaterialLoader;for(var a=0,o=e.length;a<o;a++){var s=e[a];var h=n.parse(s);h.uuid=s.uuid;if(s.name!==undefined)h.name=s.name;if(s.map!==undefined){h.map=r(s.map)}if(s.bumpMap!==undefined){h.bumpMap=r(s.bumpMap);if(s.bumpScale){h.bumpScale=new THREE.Vector2(s.bumpScale,s.bumpScale)}}if(s.alphaMap!==undefined){h.alphaMap=r(s.alphaMap)}if(s.envMap!==undefined){h.envMap=r(s.envMap)}if(s.normalMap!==undefined){h.normalMap=r(s.normalMap);if(s.normalScale){h.normalScale=new THREE.Vector2(s.normalScale,s.normalScale)}}if(s.lightMap!==undefined){h.lightMap=r(s.lightMap)}if(s.specularMap!==undefined){h.specularMap=r(s.specularMap)}i[s.uuid]=h}}return i},parseImages:function(e,t){var i=this;var r={};if(e!==undefined&&e.length>0){var n=new THREE.LoadingManager(t);var a=new THREE.ImageLoader(n);a.setCrossOrigin(this.crossOrigin);var o=function(e){i.manager.itemStart(e);return a.load(e,function(){i.manager.itemEnd(e)})};for(var s=0,h=e.length;s<h;s++){var l=e[s];var u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:i.texturePath+l.url;r[l.uuid]=o(u)}}return r},parseTextures:function(e,t){var i={};if(e!==undefined){for(var r=0,n=e.length;r<n;r++){var a=e[r];if(a.image===undefined){THREE.warn('THREE.ObjectLoader: No "image" speficied for',a.uuid)}if(t[a.image]===undefined){THREE.warn("THREE.ObjectLoader: Undefined image",a.image)}var o=new THREE.Texture(t[a.image]);o.needsUpdate=true;o.uuid=a.uuid;if(a.name!==undefined)o.name=a.name;if(a.repeat!==undefined)o.repeat=new THREE.Vector2(a.repeat[0],a.repeat[1]);if(a.minFilter!==undefined)o.minFilter=THREE[a.minFilter];if(a.magFilter!==undefined)o.magFilter=THREE[a.magFilter];if(a.anisotropy!==undefined)o.anisotropy=a.anisotropy;if(a.wrap instanceof Array){o.wrapS=THREE[a.wrap[0]];o.wrapT=THREE[a.wrap[1]]}i[a.uuid]=o}}return i},parseObject:function(){var e=new THREE.Matrix4;return function(t,i,r){var n;var a=function(e){if(i[e]===undefined){THREE.warn("THREE.ObjectLoader: Undefined geometry",e)}return i[e]};var o=function(e){if(r[e]===undefined){THREE.warn("THREE.ObjectLoader: Undefined material",e)}return r[e]};switch(t.type){case"Scene":n=new THREE.Scene;break;case"PerspectiveCamera":n=new THREE.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":n=new THREE.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":n=new THREE.AmbientLight(t.color);break;case"DirectionalLight":n=new THREE.DirectionalLight(t.color,t.intensity);break;case"PointLight":n=new THREE.PointLight(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":n=new THREE.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent,t.decay);break;case"HemisphereLight":n=new THREE.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":n=new THREE.Mesh(a(t.geometry),o(t.material));break;case"Line":n=new THREE.Line(a(t.geometry),o(t.material),t.mode);break;case"PointCloud":n=new THREE.PointCloud(a(t.geometry),o(t.material));break;case"Sprite":n=new THREE.Sprite(o(t.material));break;case"Group":n=new THREE.Group;break;default:n=new THREE.Object3D}n.uuid=t.uuid;if(t.name!==undefined)n.name=t.name;if(t.matrix!==undefined){e.fromArray(t.matrix);e.decompose(n.position,n.quaternion,n.scale)}else{if(t.position!==undefined)n.position.fromArray(t.position);if(t.rotation!==undefined)n.rotation.fromArray(t.rotation);if(t.scale!==undefined)n.scale.fromArray(t.scale)}if(t.visible!==undefined)n.visible=t.visible;if(t.userData!==undefined)n.userData=t.userData;if(t.children!==undefined){for(var s in t.children){n.add(this.parseObject(t.children[s],i,r))}}return n}}()};THREE.TextureLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager};THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(e,t,i,r){var n=this;var a=new THREE.ImageLoader(n.manager);a.setCrossOrigin(this.crossOrigin);a.load(e,function(e){var i=new THREE.Texture(e);i.needsUpdate=true;if(t!==undefined){t(i)}},i,r)},setCrossOrigin:function(e){this.crossOrigin=e}};THREE.DataTextureLoader=THREE.BinaryTextureLoader=function(){this._parser=null};THREE.BinaryTextureLoader.prototype={constructor:THREE.BinaryTextureLoader,load:function(e,t,i,r){var n=this;var a=new THREE.DataTexture;var o=new THREE.XHRLoader;o.setResponseType("arraybuffer");o.load(e,function(e){var i=n._parser(e);if(!i)return;if(undefined!==i.image){a.image=i.image}else if(undefined!==i.data){a.image.width=i.width;a.image.height=i.height;a.image.data=i.data}a.wrapS=undefined!==i.wrapS?i.wrapS:THREE.ClampToEdgeWrapping;a.wrapT=undefined!==i.wrapT?i.wrapT:THREE.ClampToEdgeWrapping;a.magFilter=undefined!==i.magFilter?i.magFilter:THREE.LinearFilter;a.minFilter=undefined!==i.minFilter?i.minFilter:THREE.LinearMipMapLinearFilter;a.anisotropy=undefined!==i.anisotropy?i.anisotropy:1;if(undefined!==i.format){a.format=i.format}if(undefined!==i.type){a.type=i.type}if(undefined!==i.mipmaps){a.mipmaps=i.mipmaps}if(1===i.mipmapCount){a.minFilter=THREE.LinearFilter}a.needsUpdate=true;if(t)t(a,i)},i,r);return a}};THREE.CompressedTextureLoader=function(){this._parser=null};THREE.CompressedTextureLoader.prototype={constructor:THREE.CompressedTextureLoader,load:function(e,t,i){var r=this;var n=[];var a=new THREE.CompressedTexture;a.image=n;var o=new THREE.XHRLoader;o.setResponseType("arraybuffer");if(e instanceof Array){var s=0;var h=function(i){o.load(e[i],function(e){var o=r._parser(e,true);n[i]={width:o.width,height:o.height,format:o.format,mipmaps:o.mipmaps};s+=1;if(s===6){if(o.mipmapCount==1)a.minFilter=THREE.LinearFilter;a.format=o.format;a.needsUpdate=true;if(t)t(a)}})};for(var l=0,u=e.length;l<u;++l){h(l)}}else{o.load(e,function(e){var i=r._parser(e,true);if(i.isCubemap){var o=i.mipmaps.length/i.mipmapCount;for(var s=0;s<o;s++){n[s]={mipmaps:[]};for(var h=0;h<i.mipmapCount;h++){n[s].mipmaps.push(i.mipmaps[s*i.mipmapCount+h]);n[s].format=i.format;n[s].width=i.width;n[s].height=i.height}}}else{a.image.width=i.width;a.image.height=i.height;a.mipmaps=i.mipmaps}if(i.mipmapCount===1){a.minFilter=THREE.LinearFilter}a.format=i.format;a.needsUpdate=true;if(t)t(a)})}return a}};THREE.Material=function(){Object.defineProperty(this,"id",{value:THREE.MaterialIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Material";this.side=THREE.FrontSide;this.opacity=1;this.transparent=false;this.blending=THREE.NormalBlending;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.blendSrcAlpha=null;this.blendDstAlpha=null;this.blendEquationAlpha=null;this.depthTest=true;this.depthWrite=true;this.colorWrite=true;this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.alphaTest=0;this.overdraw=0;this.visible=true;this._needsUpdate=true};THREE.Material.prototype={constructor:THREE.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){if(e===true)this.update();this._needsUpdate=e},setValues:function(e){if(e===undefined)return;for(var t in e){var i=e[t];if(i===undefined){THREE.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t in this){var r=this[t];if(r instanceof THREE.Color){r.set(i)}else if(r instanceof THREE.Vector3&&i instanceof THREE.Vector3){r.copy(i)}else if(t=="overdraw"){this[t]=Number(i)}else{this[t]=i}}}},toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};if(this.name!=="")e.name=this.name;if(this instanceof THREE.MeshBasicMaterial){e.color=this.color.getHex();if(this.vertexColors!==THREE.NoColors)e.vertexColors=this.vertexColors;if(this.blending!==THREE.NormalBlending)e.blending=this.blending;if(this.side!==THREE.FrontSide)e.side=this.side}else if(this instanceof THREE.MeshLambertMaterial){e.color=this.color.getHex();e.emissive=this.emissive.getHex();if(this.vertexColors!==THREE.NoColors)e.vertexColors=this.vertexColors;if(this.shading!==THREE.SmoothShading)e.shading=this.shading;if(this.blending!==THREE.NormalBlending)e.blending=this.blending;if(this.side!==THREE.FrontSide)e.side=this.side}else if(this instanceof THREE.MeshPhongMaterial){e.color=this.color.getHex();e.emissive=this.emissive.getHex();e.specular=this.specular.getHex();e.shininess=this.shininess;if(this.vertexColors!==THREE.NoColors)e.vertexColors=this.vertexColors;if(this.shading!==THREE.SmoothShading)e.shading=this.shading;if(this.blending!==THREE.NormalBlending)e.blending=this.blending;if(this.side!==THREE.FrontSide)e.side=this.side}else if(this instanceof THREE.MeshNormalMaterial){if(this.blending!==THREE.NormalBlending)e.blending=this.blending;if(this.side!==THREE.FrontSide)e.side=this.side}else if(this instanceof THREE.MeshDepthMaterial){if(this.blending!==THREE.NormalBlending)e.blending=this.blending;if(this.side!==THREE.FrontSide)e.side=this.side}else if(this instanceof THREE.PointCloudMaterial){e.size=this.size;e.sizeAttenuation=this.sizeAttenuation;e.color=this.color.getHex();if(this.vertexColors!==THREE.NoColors)e.vertexColors=this.vertexColors;if(this.blending!==THREE.NormalBlending)e.blending=this.blending}else if(this instanceof THREE.ShaderMaterial){e.uniforms=this.uniforms;e.vertexShader=this.vertexShader;e.fragmentShader=this.fragmentShader}else if(this instanceof THREE.SpriteMaterial){e.color=this.color.getHex()}if(this.opacity<1)e.opacity=this.opacity;if(this.transparent!==false)e.transparent=this.transparent;if(this.wireframe!==false)e.wireframe=this.wireframe;return e},clone:function(e){if(e===undefined)e=new THREE.Material;e.name=this.name;e.side=this.side;e.opacity=this.opacity;e.transparent=this.transparent;e.blending=this.blending;e.blendSrc=this.blendSrc;e.blendDst=this.blendDst;e.blendEquation=this.blendEquation;e.blendSrcAlpha=this.blendSrcAlpha;e.blendDstAlpha=this.blendDstAlpha;e.blendEquationAlpha=this.blendEquationAlpha;e.depthTest=this.depthTest;e.depthWrite=this.depthWrite;e.polygonOffset=this.polygonOffset;e.polygonOffsetFactor=this.polygonOffsetFactor;e.polygonOffsetUnits=this.polygonOffsetUnits;e.alphaTest=this.alphaTest;e.overdraw=this.overdraw;e.visible=this.visible;return e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Material.prototype);THREE.MaterialIdCount=0;THREE.LineBasicMaterial=function(e){THREE.Material.call(this);this.type="LineBasicMaterial";this.color=new THREE.Color(16777215);this.linewidth=1;this.linecap="round";this.linejoin="round";this.vertexColors=THREE.NoColors;this.fog=true;this.setValues(e)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;THREE.LineBasicMaterial.prototype.clone=function(){var e=new THREE.LineBasicMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.linewidth=this.linewidth;e.linecap=this.linecap;e.linejoin=this.linejoin;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};THREE.LineDashedMaterial=function(e){THREE.Material.call(this);this.type="LineDashedMaterial";this.color=new THREE.Color(16777215);this.linewidth=1;this.scale=1;this.dashSize=3;this.gapSize=1;this.vertexColors=false;this.fog=true;this.setValues(e)};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineDashedMaterial.prototype.constructor=THREE.LineDashedMaterial;THREE.LineDashedMaterial.prototype.clone=function(){var e=new THREE.LineDashedMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.linewidth=this.linewidth;e.scale=this.scale;e.dashSize=this.dashSize;e.gapSize=this.gapSize;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};THREE.MeshBasicMaterial=function(e){THREE.Material.call(this);this.type="MeshBasicMaterial";this.color=new THREE.Color(16777215);this.map=null;this.lightMap=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.setValues(e)};THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;THREE.MeshBasicMaterial.prototype.clone=function(){var e=new THREE.MeshBasicMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.lightMap=this.lightMap;e.specularMap=this.specularMap;e.alphaMap=this.alphaMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;return e};THREE.MeshLambertMaterial=function(e){THREE.Material.call(this);this.type="MeshLambertMaterial";this.color=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;THREE.MeshLambertMaterial.prototype.clone=function(){var e=new THREE.MeshLambertMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.emissive.copy(this.emissive);e.wrapAround=this.wrapAround;e.wrapRGB.copy(this.wrapRGB);e.map=this.map;e.lightMap=this.lightMap;e.specularMap=this.specularMap;e.alphaMap=this.alphaMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};THREE.MeshPhongMaterial=function(e){THREE.Material.call(this);this.type="MeshPhongMaterial";this.color=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.specular=new THREE.Color(1118481);this.shininess=30;this.metal=false;this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;THREE.MeshPhongMaterial.prototype.clone=function(){var e=new THREE.MeshPhongMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.emissive.copy(this.emissive);e.specular.copy(this.specular);e.shininess=this.shininess;e.metal=this.metal;e.wrapAround=this.wrapAround;e.wrapRGB.copy(this.wrapRGB);e.map=this.map;e.lightMap=this.lightMap;e.bumpMap=this.bumpMap;e.bumpScale=this.bumpScale;e.normalMap=this.normalMap;e.normalScale.copy(this.normalScale);e.specularMap=this.specularMap;e.alphaMap=this.alphaMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};THREE.MeshDepthMaterial=function(e){THREE.Material.call(this);this.type="MeshDepthMaterial";this.morphTargets=false;this.wireframe=false;this.wireframeLinewidth=1;this.setValues(e)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;THREE.MeshDepthMaterial.prototype.clone=function(){var e=new THREE.MeshDepthMaterial;THREE.Material.prototype.clone.call(this,e);e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;return e};THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e);this.type="MeshNormalMaterial";this.wireframe=false;this.wireframeLinewidth=1;this.morphTargets=false;this.setValues(e)};THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshNormalMaterial.prototype.clone=function(){var e=new THREE.MeshNormalMaterial;THREE.Material.prototype.clone.call(this,e);e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;return e};THREE.MeshFaceMaterial=function(e){this.uuid=THREE.Math.generateUUID();this.type="MeshFaceMaterial";this.materials=e instanceof Array?e:[]};THREE.MeshFaceMaterial.prototype={constructor:THREE.MeshFaceMaterial,toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]};for(var t=0,i=this.materials.length;t<i;t++){e.materials.push(this.materials[t].toJSON())}return e},clone:function(){var e=new THREE.MeshFaceMaterial;for(var t=0;t<this.materials.length;t++){e.materials.push(this.materials[t].clone())}return e}};THREE.PointCloudMaterial=function(e){THREE.Material.call(this);this.type="PointCloudMaterial";this.color=new THREE.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=true;this.vertexColors=THREE.NoColors;this.fog=true;this.setValues(e)};THREE.PointCloudMaterial.prototype=Object.create(THREE.Material.prototype);THREE.PointCloudMaterial.prototype.constructor=THREE.PointCloudMaterial;THREE.PointCloudMaterial.prototype.clone=function(){var e=new THREE.PointCloudMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.size=this.size;e.sizeAttenuation=this.sizeAttenuation;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};THREE.ParticleBasicMaterial=function(e){THREE.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial.");return new THREE.PointCloudMaterial(e)};THREE.ParticleSystemMaterial=function(e){THREE.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial.");return new THREE.PointCloudMaterial(e)};THREE.ShaderMaterial=function(e){THREE.Material.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.attributes=null;this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.shading=THREE.SmoothShading;this.linewidth=1;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=undefined;this.setValues(e)};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial;THREE.ShaderMaterial.prototype.clone=function(){var e=new THREE.ShaderMaterial;THREE.Material.prototype.clone.call(this,e);e.fragmentShader=this.fragmentShader;e.vertexShader=this.vertexShader;e.uniforms=THREE.UniformsUtils.clone(this.uniforms);e.attributes=this.attributes;e.defines=this.defines;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.fog=this.fog;e.lights=this.lights;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};THREE.RawShaderMaterial=function(e){THREE.ShaderMaterial.call(this,e);this.type="RawShaderMaterial"};THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);THREE.RawShaderMaterial.prototype.constructor=THREE.RawShaderMaterial;THREE.RawShaderMaterial.prototype.clone=function(){var e=new THREE.RawShaderMaterial;THREE.ShaderMaterial.prototype.clone.call(this,e);return e};THREE.SpriteMaterial=function(e){THREE.Material.call(this);this.type="SpriteMaterial";this.color=new THREE.Color(16777215);this.map=null;this.rotation=0;this.fog=false;this.setValues(e)};THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteMaterial.prototype.constructor=THREE.SpriteMaterial;THREE.SpriteMaterial.prototype.clone=function(){var e=new THREE.SpriteMaterial;THREE.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.rotation=this.rotation;e.fog=this.fog;return e};THREE.Texture=function(e,t,i,r,n,a,o,s,h){Object.defineProperty(this,"id",{value:THREE.TextureIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.sourceFile="";this.image=e!==undefined?e:THREE.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=t!==undefined?t:THREE.Texture.DEFAULT_MAPPING;this.wrapS=i!==undefined?i:THREE.ClampToEdgeWrapping;this.wrapT=r!==undefined?r:THREE.ClampToEdgeWrapping;this.magFilter=n!==undefined?n:THREE.LinearFilter;this.minFilter=a!==undefined?a:THREE.LinearMipMapLinearFilter;this.anisotropy=h!==undefined?h:1;this.format=o!==undefined?o:THREE.RGBAFormat;this.type=s!==undefined?s:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.unpackAlignment=4;this._needsUpdate=false;this.onUpdate=null};THREE.Texture.DEFAULT_IMAGE=undefined;THREE.Texture.DEFAULT_MAPPING=THREE.UVMapping;THREE.Texture.prototype={constructor:THREE.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){if(e===true)this.update();this._needsUpdate=e},clone:function(e){if(e===undefined)e=new THREE.Texture;e.image=this.image;e.mipmaps=this.mipmaps.slice(0);e.mapping=this.mapping;e.wrapS=this.wrapS;e.wrapT=this.wrapT;e.magFilter=this.magFilter;e.minFilter=this.minFilter;e.anisotropy=this.anisotropy;e.format=this.format;e.type=this.type;e.offset.copy(this.offset);e.repeat.copy(this.repeat);e.generateMipmaps=this.generateMipmaps;e.premultiplyAlpha=this.premultiplyAlpha;e.flipY=this.flipY;e.unpackAlignment=this.unpackAlignment;return e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype);THREE.TextureIdCount=0;THREE.CubeTexture=function(e,t,i,r,n,a,o,s,h){t=t!==undefined?t:THREE.CubeReflectionMapping;THREE.Texture.call(this,e,t,i,r,n,a,o,s,h);this.images=e};THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CubeTexture.prototype.constructor=THREE.CubeTexture;THREE.CubeTexture.clone=function(e){if(e===undefined)e=new THREE.CubeTexture;THREE.Texture.prototype.clone.call(this,e);e.images=this.images;return e};THREE.CompressedTexture=function(e,t,i,r,n,a,o,s,h,l,u){THREE.Texture.call(this,null,a,o,s,h,l,r,n,u);this.image={width:t,height:i};this.mipmaps=e;this.flipY=false;this.generateMipmaps=false};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.constructor=THREE.CompressedTexture;THREE.CompressedTexture.prototype.clone=function(){var e=new THREE.CompressedTexture;THREE.Texture.prototype.clone.call(this,e);return e};THREE.DataTexture=function(e,t,i,r,n,a,o,s,h,l,u){THREE.Texture.call(this,null,a,o,s,h,l,r,n,u);this.image={data:e,width:t,height:i}};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.constructor=THREE.DataTexture;THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture;THREE.Texture.prototype.clone.call(this,e);return e};THREE.VideoTexture=function(e,t,i,r,n,a,o,s,h){THREE.Texture.call(this,e,t,i,r,n,a,o,s,h);this.generateMipmaps=false;var l=this;var u=function(){requestAnimationFrame(u);if(e.readyState===e.HAVE_ENOUGH_DATA){l.needsUpdate=true}};u()};THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype);THREE.VideoTexture.prototype.constructor=THREE.VideoTexture;THREE.Group=function(){THREE.Object3D.call(this);this.type="Group"};THREE.Group.prototype=Object.create(THREE.Object3D.prototype);THREE.Group.prototype.constructor=THREE.Group;THREE.PointCloud=function(e,t){THREE.Object3D.call(this);this.type="PointCloud";this.geometry=e!==undefined?e:new THREE.Geometry;this.material=t!==undefined?t:new THREE.PointCloudMaterial({color:Math.random()*16777215})};THREE.PointCloud.prototype=Object.create(THREE.Object3D.prototype);THREE.PointCloud.prototype.constructor=THREE.PointCloud;THREE.PointCloud.prototype.raycast=function(){var e=new THREE.Matrix4;var t=new THREE.Ray;return function(i,r){var n=this;var a=n.geometry;var o=i.params.PointCloud.threshold;e.getInverse(this.matrixWorld);t.copy(i.ray).applyMatrix4(e);if(a.boundingBox!==null){if(t.isIntersectionBox(a.boundingBox)===false){return}}var s=o/((this.scale.x+this.scale.y+this.scale.z)/3);var h=new THREE.Vector3;var l=function(e,a){var o=t.distanceToPoint(e);if(o<s){var h=t.closestPointToPoint(e);h.applyMatrix4(n.matrixWorld);var l=i.ray.origin.distanceTo(h);r.push({distance:l,distanceToRay:o,point:h.clone(),index:a,face:null,object:n})}};if(a instanceof THREE.BufferGeometry){var u=a.attributes;var c=u.position.array;if(u.index!==undefined){var p=u.index.array;var f=a.offsets;if(f.length===0){var d={start:0,count:p.length,index:0};f=[d]}for(var m=0,g=f.length;m<g;++m){var v=f[m].start;var y=f[m].count;var E=f[m].index;for(var w=v,b=v+y;w<b;w++){var _=E+p[w];h.fromArray(c,_*3);l(h,_)}}}else{var x=c.length/3;for(var w=0;w<x;w++){h.set(c[3*w],c[3*w+1],c[3*w+2]);l(h,w)}}}else{var T=this.geometry.vertices;for(var w=0;w<T.length;w++){l(T[w],w)}}}}();THREE.PointCloud.prototype.clone=function(e){if(e===undefined)e=new THREE.PointCloud(this.geometry,this.material);THREE.Object3D.prototype.clone.call(this,e);return e};THREE.ParticleSystem=function(e,t){THREE.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud.");return new THREE.PointCloud(e,t)};THREE.Line=function(e,t,i){THREE.Object3D.call(this);this.type="Line";this.geometry=e!==undefined?e:new THREE.Geometry;this.material=t!==undefined?t:new THREE.LineBasicMaterial({color:Math.random()*16777215});this.mode=i!==undefined?i:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=Object.create(THREE.Object3D.prototype);THREE.Line.prototype.constructor=THREE.Line;THREE.Line.prototype.raycast=function(){var e=new THREE.Matrix4;var t=new THREE.Ray;var i=new THREE.Sphere;return function(r,n){var a=r.linePrecision;var o=a*a;var s=this.geometry;if(s.boundingSphere===null)s.computeBoundingSphere();i.copy(s.boundingSphere);i.applyMatrix4(this.matrixWorld);if(r.ray.isIntersectionSphere(i)===false){return}e.getInverse(this.matrixWorld);t.copy(r.ray).applyMatrix4(e);var h=new THREE.Vector3;var l=new THREE.Vector3;var u=new THREE.Vector3;var c=new THREE.Vector3;var p=this.mode===THREE.LineStrip?1:2;if(s instanceof THREE.BufferGeometry){var f=s.attributes;if(f.index!==undefined){var d=f.index.array;var m=f.position.array;var g=s.offsets;if(g.length===0){g=[{start:0,count:d.length,index:0}]}for(var v=0;v<g.length;v++){var y=g[v].start;var E=g[v].count;var w=g[v].index;for(var b=y;b<y+E-1;b+=p){var _=w+d[b];var x=w+d[b+1];h.fromArray(m,_*3);l.fromArray(m,x*3);var T=t.distanceSqToSegment(h,l,c,u);if(T>o)continue;var R=t.origin.distanceTo(c);if(R<r.near||R>r.far)continue;n.push({distance:R,point:u.clone().applyMatrix4(this.matrixWorld),index:b,offsetIndex:v,face:null,faceIndex:null,object:this})}}}else{var m=f.position.array;for(var b=0;b<m.length/3-1;b+=p){h.fromArray(m,3*b);l.fromArray(m,3*b+3);var T=t.distanceSqToSegment(h,l,c,u);if(T>o)continue;var R=t.origin.distanceTo(c);if(R<r.near||R>r.far)continue;n.push({distance:R,point:u.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}else if(s instanceof THREE.Geometry){var k=s.vertices;var H=k.length;for(var b=0;b<H-1;b+=p){var T=t.distanceSqToSegment(k[b],k[b+1],c,u);if(T>o)continue;var R=t.origin.distanceTo(c);if(R<r.near||R>r.far)continue;n.push({distance:R,point:u.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}}();THREE.Line.prototype.clone=function(e){if(e===undefined)e=new THREE.Line(this.geometry,this.material,this.mode);THREE.Object3D.prototype.clone.call(this,e);return e};THREE.Mesh=function(e,t){THREE.Object3D.call(this);this.type="Mesh";this.geometry=e!==undefined?e:new THREE.Geometry;this.material=t!==undefined?t:new THREE.MeshBasicMaterial({color:Math.random()*16777215});this.updateMorphTargets()};THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets!==undefined&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}}};THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){if(this.morphTargetDictionary[e]!==undefined){return this.morphTargetDictionary[e]}THREE.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0.");return 0};THREE.Mesh.prototype.raycast=function(){var e=new THREE.Matrix4;var t=new THREE.Ray;var i=new THREE.Sphere;var r=new THREE.Vector3;var n=new THREE.Vector3;var a=new THREE.Vector3;return function(o,s){var h=this.geometry;if(h.boundingSphere===null)h.computeBoundingSphere();i.copy(h.boundingSphere);i.applyMatrix4(this.matrixWorld);if(o.ray.isIntersectionSphere(i)===false){return}e.getInverse(this.matrixWorld);t.copy(o.ray).applyMatrix4(e);if(h.boundingBox!==null){if(t.isIntersectionBox(h.boundingBox)===false){return}}if(h instanceof THREE.BufferGeometry){var l=this.material;if(l===undefined)return;var u=h.attributes;var c,p,f;var d=o.precision;if(u.index!==undefined){var m=u.index.array;var g=u.position.array;var v=h.offsets;if(v.length===0){v=[{start:0,count:m.length,index:0}]}for(var y=0,E=v.length;y<E;++y){var w=v[y].start;var b=v[y].count;var _=v[y].index;for(var x=w,T=w+b;x<T;x+=3){c=_+m[x];p=_+m[x+1];f=_+m[x+2];r.fromArray(g,c*3);n.fromArray(g,p*3);a.fromArray(g,f*3);if(l.side===THREE.BackSide){var R=t.intersectTriangle(a,n,r,true)}else{var R=t.intersectTriangle(r,n,a,l.side!==THREE.DoubleSide)}if(R===null)continue;R.applyMatrix4(this.matrixWorld);var k=o.ray.origin.distanceTo(R);if(k<d||k<o.near||k>o.far)continue;s.push({distance:k,point:R,face:new THREE.Face3(c,p,f,THREE.Triangle.normal(r,n,a)),faceIndex:null,object:this})}}}else{var g=u.position.array;for(var x=0,H=0,T=g.length;x<T;x+=3,H+=9){c=x;p=x+1;f=x+2;r.fromArray(g,H);n.fromArray(g,H+3);a.fromArray(g,H+6);if(l.side===THREE.BackSide){var R=t.intersectTriangle(a,n,r,true)}else{var R=t.intersectTriangle(r,n,a,l.side!==THREE.DoubleSide)}if(R===null)continue;R.applyMatrix4(this.matrixWorld);var k=o.ray.origin.distanceTo(R);if(k<d||k<o.near||k>o.far)continue;s.push({distance:k,point:R,face:new THREE.Face3(c,p,f,THREE.Triangle.normal(r,n,a)),faceIndex:null,object:this})}}}else if(h instanceof THREE.Geometry){var M=this.material instanceof THREE.MeshFaceMaterial;var S=M===true?this.material.materials:null;var c,p,f;var d=o.precision;var A=h.vertices;for(var C=0,z=h.faces.length;C<z;C++){var P=h.faces[C];var l=M===true?S[P.materialIndex]:this.material;if(l===undefined)continue;c=A[P.a];p=A[P.b];f=A[P.c];if(l.morphTargets===true){var L=h.morphTargets;var O=this.morphTargetInfluences;r.set(0,0,0);n.set(0,0,0);a.set(0,0,0);for(var D=0,F=L.length;D<F;D++){var B=O[D];if(B===0)continue;var U=L[D].vertices;r.x+=(U[P.a].x-c.x)*B;r.y+=(U[P.a].y-c.y)*B;r.z+=(U[P.a].z-c.z)*B;n.x+=(U[P.b].x-p.x)*B;n.y+=(U[P.b].y-p.y)*B;n.z+=(U[P.b].z-p.z)*B;a.x+=(U[P.c].x-f.x)*B;a.y+=(U[P.c].y-f.y)*B;a.z+=(U[P.c].z-f.z)*B}r.add(c);n.add(p);a.add(f);c=r;p=n;f=a}if(l.side===THREE.BackSide){var R=t.intersectTriangle(f,p,c,true)}else{var R=t.intersectTriangle(c,p,f,l.side!==THREE.DoubleSide)}if(R===null)continue;R.applyMatrix4(this.matrixWorld);var k=o.ray.origin.distanceTo(R);if(k<d||k<o.near||k>o.far)continue;s.push({distance:k,point:R,face:P,faceIndex:C,object:this})}}}}();THREE.Mesh.prototype.clone=function(e,t){if(e===undefined)e=new THREE.Mesh(this.geometry,this.material);THREE.Object3D.prototype.clone.call(this,e,t);return e};THREE.Bone=function(e){THREE.Object3D.call(this);this.type="Bone";this.skin=e};THREE.Bone.prototype=Object.create(THREE.Object3D.prototype);THREE.Bone.prototype.constructor=THREE.Bone;THREE.Skeleton=function(e,t,i){this.useVertexTexture=i!==undefined?i:true;this.identityMatrix=new THREE.Matrix4;e=e||[];this.bones=e.slice(0);if(this.useVertexTexture){var r;if(this.bones.length>256)r=64;else if(this.bones.length>64)r=32;else if(this.bones.length>16)r=16;else r=8;this.boneTextureWidth=r;this.boneTextureHeight=r;this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4);this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType);this.boneTexture.minFilter=THREE.NearestFilter;this.boneTexture.magFilter=THREE.NearestFilter;this.boneTexture.generateMipmaps=false;this.boneTexture.flipY=false}else{this.boneMatrices=new Float32Array(16*this.bones.length)}if(t===undefined){this.calculateInverses()}else{if(this.bones.length===t.length){this.boneInverses=t.slice(0)}else{THREE.warn("THREE.Skeleton bonInverses is the wrong length.");this.boneInverses=[];for(var n=0,a=this.bones.length;n<a;n++){this.boneInverses.push(new THREE.Matrix4)}}}};THREE.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var i=new THREE.Matrix4;if(this.bones[e]){i.getInverse(this.bones[e].matrixWorld)}this.boneInverses.push(i)}};THREE.Skeleton.prototype.pose=function(){var e;for(var t=0,i=this.bones.length;t<i;t++){e=this.bones[t];if(e){e.matrixWorld.getInverse(this.boneInverses[t])}}for(var t=0,i=this.bones.length;t<i;t++){e=this.bones[t];if(e){if(e.parent){e.matrix.getInverse(e.parent.matrixWorld);e.matrix.multiply(e.matrixWorld)}else{e.matrix.copy(e.matrixWorld)}e.matrix.decompose(e.position,e.quaternion,e.scale)}}};THREE.Skeleton.prototype.update=function(){var e=new THREE.Matrix4;return function(){for(var t=0,i=this.bones.length;t<i;t++){var r=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;e.multiplyMatrices(r,this.boneInverses[t]);e.flattenToArrayOffset(this.boneMatrices,t*16)}if(this.useVertexTexture){this.boneTexture.needsUpdate=true}}}();THREE.SkinnedMesh=function(e,t,i){THREE.Mesh.call(this,e,t);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new THREE.Matrix4;this.bindMatrixInverse=new THREE.Matrix4;var r=[];if(this.geometry&&this.geometry.bones!==undefined){var n,a,o,s,h;for(var l=0,u=this.geometry.bones.length;l<u;++l){a=this.geometry.bones[l];o=a.pos;s=a.rotq;h=a.scl;n=new THREE.Bone(this);r.push(n);n.name=a.name;n.position.set(o[0],o[1],o[2]);n.quaternion.set(s[0],s[1],s[2],s[3]);if(h!==undefined){n.scale.set(h[0],h[1],h[2])}else{n.scale.set(1,1,1)}}for(var l=0,u=this.geometry.bones.length;l<u;++l){a=this.geometry.bones[l];if(a.parent!==-1){r[a.parent].add(r[l])}else{this.add(r[l])}}}this.normalizeSkinWeights();this.updateMatrixWorld(true);this.bind(new THREE.Skeleton(r,undefined,i))};THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;THREE.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e;if(t===undefined){this.updateMatrixWorld(true);t=this.matrixWorld}this.bindMatrix.copy(t);this.bindMatrixInverse.getInverse(t)};THREE.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()};THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry){for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e];var i=1/t.lengthManhattan();if(i!==Infinity){t.multiplyScalar(i)}else{t.set(1)}}}else{}};THREE.SkinnedMesh.prototype.updateMatrixWorld=function(e){THREE.Mesh.prototype.updateMatrixWorld.call(this,true);if(this.bindMode==="attached"){this.bindMatrixInverse.getInverse(this.matrixWorld)}else if(this.bindMode==="detached"){this.bindMatrixInverse.getInverse(this.bindMatrix)}else{THREE.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)}};THREE.SkinnedMesh.prototype.clone=function(e){if(e===undefined){e=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)}THREE.Mesh.prototype.clone.call(this,e);return e};THREE.MorphAnimMesh=function(e,t){THREE.Mesh.call(this,e,t);this.type="MorphAnimMesh";this.duration=1e3;this.mirroredLoop=false;this.time=0;this.lastKeyframe=0;this.currentKeyframe=0;this.direction=1;this.directionBackwards=false;this.setFrameRange(0,this.geometry.morphTargets.length-1)};THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphAnimMesh.prototype.constructor=THREE.MorphAnimMesh;THREE.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e;this.endKeyframe=t;this.length=this.endKeyframe-this.startKeyframe+1};THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=false};THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=true};THREE.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;if(!e.animations)e.animations={};var t,i=e.animations;var r=/([a-z]+)_?(\d+)/;for(var n=0,a=e.morphTargets.length;n<a;n++){var o=e.morphTargets[n];var s=o.name.match(r);if(s&&s.length>1){var h=s[1];if(!i[h])i[h]={start:Infinity,end:-Infinity};var l=i[h];if(n<l.start)l.start=n;if(n>l.end)l.end=n;if(!t)t=h}}e.firstAnimation=t};THREE.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,i){if(!this.geometry.animations)this.geometry.animations={};this.geometry.animations[e]={start:t,end:i}};THREE.MorphAnimMesh.prototype.playAnimation=function(e,t){var i=this.geometry.animations[e];if(i){this.setFrameRange(i.start,i.end);this.duration=1e3*((i.end-i.start)/t);this.time=0}else{THREE.warn("THREE.MorphAnimMesh: animation["+e+"] undefined in .playAnimation()")}};THREE.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration;this.directionBackwards=true}if(this.time<0){this.time=0;this.directionBackwards=false}}}else{this.time=this.time%this.duration;if(this.time<0)this.time+=this.duration}var i=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/t),0,this.length-1);if(i!==this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0;this.morphTargetInfluences[this.currentKeyframe]=1;this.morphTargetInfluences[i]=0;this.lastKeyframe=this.currentKeyframe;this.currentKeyframe=i}var r=this.time%t/t;if(this.directionBackwards){r=1-r}this.morphTargetInfluences[this.currentKeyframe]=r;this.morphTargetInfluences[this.lastKeyframe]=1-r};THREE.MorphAnimMesh.prototype.interpolateTargets=function(e,t,i){var r=this.morphTargetInfluences;for(var n=0,a=r.length;n<a;n++){r[n]=0}if(e>-1)r[e]=1-i;if(t>-1)r[t]=i};THREE.MorphAnimMesh.prototype.clone=function(e){if(e===undefined)e=new THREE.MorphAnimMesh(this.geometry,this.material);e.duration=this.duration;e.mirroredLoop=this.mirroredLoop;e.time=this.time;e.lastKeyframe=this.lastKeyframe;e.currentKeyframe=this.currentKeyframe;e.direction=this.direction;e.directionBackwards=this.directionBackwards;THREE.Mesh.prototype.clone.call(this,e);return e};THREE.LOD=function(){THREE.Object3D.call(this);this.objects=[]};THREE.LOD.prototype=Object.create(THREE.Object3D.prototype);THREE.LOD.prototype.constructor=THREE.LOD;THREE.LOD.prototype.addLevel=function(e,t){if(t===undefined)t=0;t=Math.abs(t);for(var i=0;i<this.objects.length;i++){if(t<this.objects[i].distance){break}}this.objects.splice(i,0,{distance:t,object:e});this.add(e)};THREE.LOD.prototype.getObjectForDistance=function(e){for(var t=1,i=this.objects.length;t<i;t++){if(e<this.objects[t].distance){break}}return this.objects[t-1].object};THREE.LOD.prototype.raycast=function(){var e=new THREE.Vector3;return function(t,i){e.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(e);this.getObjectForDistance(r).raycast(t,i)}}();THREE.LOD.prototype.update=function(){var e=new THREE.Vector3;var t=new THREE.Vector3;return function(i){if(this.objects.length>1){e.setFromMatrixPosition(i.matrixWorld);t.setFromMatrixPosition(this.matrixWorld);var r=e.distanceTo(t);this.objects[0].object.visible=true;for(var n=1,a=this.objects.length;n<a;n++){if(r>=this.objects[n].distance){this.objects[n-1].object.visible=false;this.objects[n].object.visible=true}else{break}}for(;n<a;n++){this.objects[n].object.visible=false}}}}();THREE.LOD.prototype.clone=function(e){if(e===undefined)e=new THREE.LOD;THREE.Object3D.prototype.clone.call(this,e);for(var t=0,i=this.objects.length;t<i;t++){var r=this.objects[t].object.clone();r.visible=t===0;e.addLevel(r,this.objects[t].distance)}return e};THREE.Sprite=function(){var e=new Uint16Array([0,1,2,0,2,3]);var t=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]);var i=new Float32Array([0,0,1,0,1,1,0,1]);var r=new THREE.BufferGeometry;r.addAttribute("index",new THREE.BufferAttribute(e,1));r.addAttribute("position",new THREE.BufferAttribute(t,3));r.addAttribute("uv",new THREE.BufferAttribute(i,2));return function(e){THREE.Object3D.call(this);this.type="Sprite";this.geometry=r;this.material=e!==undefined?e:new THREE.SpriteMaterial}}();THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype);THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.raycast=function(){var e=new THREE.Vector3;return function(t,i){e.setFromMatrixPosition(this.matrixWorld);var r=t.ray.distanceToPoint(e);if(r>this.scale.x){return}i.push({distance:r,point:this.position,face:null,object:this})}}();THREE.Sprite.prototype.clone=function(e){if(e===undefined)e=new THREE.Sprite(this.material);THREE.Object3D.prototype.clone.call(this,e);return e};THREE.Particle=THREE.Sprite;THREE.LensFlare=function(e,t,i,r,n){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=undefined;if(e!==undefined){this.add(e,t,i,r,n)}};THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare.prototype.constructor=THREE.LensFlare;THREE.LensFlare.prototype.add=function(e,t,i,r,n,a){if(t===undefined)t=-1;if(i===undefined)i=0;if(a===undefined)a=1;if(n===undefined)n=new THREE.Color(16777215);if(r===undefined)r=THREE.NormalBlending;i=Math.min(i,Math.max(0,i));this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:1,opacity:a,color:n,blending:r})};THREE.LensFlare.prototype.updateLensFlares=function(){var e,t=this.lensFlares.length;var i;var r=-this.positionScreen.x*2;var n=-this.positionScreen.y*2;for(e=0;e<t;e++){i=this.lensFlares[e];i.x=this.positionScreen.x+r*i.distance;i.y=this.positionScreen.y+n*i.distance;i.wantedRotation=i.x*Math.PI*.25;i.rotation+=(i.wantedRotation-i.rotation)*.25}};THREE.Scene=function(){THREE.Object3D.call(this);this.type="Scene";this.fog=null;this.overrideMaterial=null;this.autoUpdate=true};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.clone=function(e){if(e===undefined)e=new THREE.Scene;THREE.Object3D.prototype.clone.call(this,e);if(this.fog!==null)e.fog=this.fog.clone();if(this.overrideMaterial!==null)e.overrideMaterial=this.overrideMaterial.clone();e.autoUpdate=this.autoUpdate;e.matrixAutoUpdate=this.matrixAutoUpdate;return e};THREE.Fog=function(e,t,i){this.name="";this.color=new THREE.Color(e);this.near=t!==undefined?t:1;this.far=i!==undefined?i:1e3};THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)};THREE.FogExp2=function(e,t){this.name="";this.color=new THREE.Color(e);this.density=t!==undefined?t:25e-5};THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)};THREE.ShaderChunk={};THREE.ShaderChunk["common"]="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\nfloat square( in float a ) { return a*a; }\nvec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }\nvec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }\nvec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }\nfloat saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }\nvec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }\nvec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }\nvec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }\nfloat average( in float a ) { return a; }\nfloat average( in vec2 a )  { return ( a.x + a.y) * 0.5; }\nfloat average( in vec3 a )  { return ( a.x + a.y + a.z) / 3.0; }\nfloat average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }\nfloat whiteCompliment( in float a ) { return saturate( 1.0 - a ); }\nvec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }\nvec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }\nvec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n}\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\n\tfloat distance = dot( planeNormal, point-pointOnPlane );\n\treturn point - distance * planeNormal;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );\n}\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\tif ( decayExponent > 0.0 ) {\n\t  return pow( saturate( 1.0 - lightDistance / cutoffDistance ), decayExponent );\n\t}\n\treturn 1.0;\n}\n\nvec3 inputToLinear( in vec3 a ) {\n#ifdef GAMMA_INPUT\n\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\nvec3 linearToOutput( in vec3 a ) {\n#ifdef GAMMA_OUTPUT\n\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\n";THREE.ShaderChunk["alphatest_fragment"]="#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n";THREE.ShaderChunk["lights_lambert_vertex"]="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\tfloat dotProduct = dot( transformedNormal, dirVector );\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t#endif\n\n\t#endif\n\n\t#ifdef WRAP_AROUND\n\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n\t\t#endif\n\n\t#endif\n\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n\t#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * attenuation;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * attenuation;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\t\tlVector = normalize( lVector );\n\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n\t\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * attenuation * spotEffect;\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * attenuation * spotEffect;\n\n\t\t\t#endif\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n\t\t#endif\n\n\t}\n\n#endif\n\nvLightFront += ambientLightColor;\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack += ambientLightColor;\n\n#endif\n";THREE.ShaderChunk["map_particle_pars_fragment"]="#ifdef USE_MAP\n\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n\n#endif\n";THREE.ShaderChunk["default_vertex"]="#ifdef USE_SKINNING\n\n\tvec4 mvPosition = modelViewMatrix * skinned;\n\n#elif defined( USE_MORPHTARGETS )\n\n\tvec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#else\n\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n";THREE.ShaderChunk["map_pars_fragment"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif";THREE.ShaderChunk["skinnormal_vertex"]="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\t#ifdef USE_MORPHNORMALS\n\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n\t#else\n\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["logdepthbuf_pars_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif";THREE.ShaderChunk["lightmap_pars_vertex"]="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\n#endif";THREE.ShaderChunk["lights_phong_fragment"]="#ifndef FLAT_SHADED\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n\t#endif\n\n#else\n\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef USE_NORMALMAP\n\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += pointLightColor[ i ] * pointDiffuseWeight * attenuation;\n\n\t\t\t\t// specular\n\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * attenuation * specularNormalization;\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\t// diffuse\n\n\t\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t#else\n\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t#endif\n\n\t\t\ttotalDiffuseLight += spotLightColor[ i ] * spotDiffuseWeight * attenuation * spotEffect;\n\n\t\t\t// specular\n\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n\t\t\ttotalSpecularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * attenuation * specularNormalization * spotEffect;\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, dirVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += directionalLightColor[ i ] * dirDiffuseWeight;\n\n\t\t// specular\n\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n\t\t/*\n\t\t// fresnel term from skin shader\n\t\tconst float F0 = 0.128;\n\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\n\t\tfloat exponential = pow( base, 5.0 );\n\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\n\t\t*/\n\n\t\t/*\n\t\t// fresnel term from fresnel shader\n\t\tconst float mFresnelBias = 0.08;\n\t\tconst float mFresnelScale = 0.3;\n\t\tconst float mFresnelPower = 5.0;\n\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n\t\t*/\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\ttotalDiffuseLight += hemiColor;\n\n\t\t// specular (sky light)\n\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n\t\t// specular (ground light)\n\n\t\tvec3 lVectorGround = -lVector;\n\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n\t}\n\n#endif\n\n#ifdef METAL\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) * specular + totalSpecularLight + emissive;\n\n#else\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) + totalSpecularLight + emissive;\n\n#endif\n";THREE.ShaderChunk["fog_pars_fragment"]="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif";THREE.ShaderChunk["morphnormal_vertex"]="#ifdef USE_MORPHNORMALS\n\n\tvec3 morphedNormal = vec3( 0.0 );\n\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n\tmorphedNormal += normal;\n\n#endif";THREE.ShaderChunk["envmap_pars_fragment"]="#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["logdepthbuf_fragment"]="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif";THREE.ShaderChunk["normalmap_pars_fragment"]="#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n";THREE.ShaderChunk["lights_phong_pars_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n";THREE.ShaderChunk["lightmap_pars_fragment"]="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\tuniform sampler2D lightMap;\n\n#endif";THREE.ShaderChunk["shadowmap_vertex"]="#ifdef USE_SHADOWMAP\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n\t}\n\n#endif";THREE.ShaderChunk["lights_phong_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif";THREE.ShaderChunk["map_fragment"]="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\n\n\tdiffuseColor *= texelColor;\n\n#endif";THREE.ShaderChunk["lightmap_vertex"]="#ifdef USE_LIGHTMAP\n\n\tvUv2 = uv2;\n\n#endif";THREE.ShaderChunk["map_particle_fragment"]="#ifdef USE_MAP\n\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n";THREE.ShaderChunk["color_pars_fragment"]="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n";THREE.ShaderChunk["color_vertex"]="#ifdef USE_COLOR\n\n\tvColor.xyz = inputToLinear( color.xyz );\n\n#endif";THREE.ShaderChunk["skinning_vertex"]="#ifdef USE_SKINNING\n\n\t#ifdef USE_MORPHTARGETS\n\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n";THREE.ShaderChunk["envmap_pars_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\n#endif\n";THREE.ShaderChunk["linear_to_gamma_fragment"]="\n\toutgoingLight = linearToOutput( outgoingLight );\n";THREE.ShaderChunk["color_pars_vertex"]="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif";THREE.ShaderChunk["lights_lambert_pars_vertex"]="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n";THREE.ShaderChunk["map_pars_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n";THREE.ShaderChunk["envmap_fragment"]="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\n\tenvColor.xyz = inputToLinear( envColor.xyz );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["specularmap_pars_fragment"]="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif";THREE.ShaderChunk["logdepthbuf_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif";THREE.ShaderChunk["morphtarget_pars_vertex"]="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif";THREE.ShaderChunk["specularmap_fragment"]="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif";THREE.ShaderChunk["fog_fragment"]="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );\n\t\tfogFactor = whiteCompliment( fogFactor );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\t\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif";THREE.ShaderChunk["bumpmap_pars_fragment"]="#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n";THREE.ShaderChunk["defaultnormal_vertex"]="#ifdef USE_SKINNING\n\n\tvec3 objectNormal = skinnedNormal.xyz;\n\n#elif defined( USE_MORPHNORMALS )\n\n\tvec3 objectNormal = morphedNormal;\n\n#else\n\n\tvec3 objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n";THREE.ShaderChunk["lights_phong_pars_fragment"]="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n";THREE.ShaderChunk["skinbase_vertex"]="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif";THREE.ShaderChunk["map_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif";THREE.ShaderChunk["lightmap_fragment"]="#ifdef USE_LIGHTMAP\n\n\toutgoingLight *= diffuseColor.xyz * texture2D( lightMap, vUv2 ).xyz;\n\n#endif";THREE.ShaderChunk["shadowmap_pars_vertex"]="#ifdef USE_SHADOWMAP\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif";THREE.ShaderChunk["color_fragment"]="#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif";THREE.ShaderChunk["morphtarget_vertex"]="#ifdef USE_MORPHTARGETS\n\n\tvec3 morphed = vec3( 0.0 );\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n\tmorphed += position;\n\n#endif";THREE.ShaderChunk["envmap_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvec3 worldNormal = transformDirection( objectNormal, modelMatrix );\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t#else\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["shadowmap_fragment"]="#ifdef USE_SHADOWMAP\n\n\t#ifdef SHADOWMAP_DEBUG\n\n\t\tvec3 frustumColors[3];\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n\t#endif\n\n\t#ifdef SHADOWMAP_CASCADE\n\n\t\tint inFrustumCount = 0;\n\n\t#endif\n\n\tfloat fDepth;\n\tvec3 shadowColor = vec3( 1.0 );\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\t\t\t// don't shadow pixels outside of light frustum\n\t\t\t\t// use just first frustum (for cascades)\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\n\n\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\tinFrustumCount += int( inFrustum );\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n\t\t#else\n\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\t#endif\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t/*\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n\t\t\t\t\t\t// must enroll loop manually\n\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\t\t\tshadow += 1.0;\n\n\t\t\t\t}\n\n\t\t\t\tshadow /= 9.0;\n\n\t\t*/\n\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\n\n\t\t\t\tmat3 shadowKernel;\n\t\t\t\tmat3 depthKernel;\n\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\n\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n\t\t\t\tvec4 shadowValues;\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#else\n\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\tif ( fDepth < shadowCoord.z )\n\n\t\t// spot with multiple shadows is darker\n\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n\t\t// spot with multiple shadows has the same color as single shadow spot\n\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n\t\t\t#endif\n\n\t\t}\n\n\n\t\t#ifdef SHADOWMAP_DEBUG\n\n\t\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#else\n\n\t\t\t\tif ( inFrustum ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t}\n\n\t// NOTE: I am unsure if this is correct in linear space.  -bhouston, Dec 29, 2014\n\tshadowColor = inputToLinear( shadowColor );\n\n\toutgoingLight = outgoingLight * shadowColor;\n\n#endif\n";THREE.ShaderChunk["worldpos_vertex"]="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#elif defined( USE_MORPHTARGETS )\n\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["shadowmap_pars_fragment"]="#ifdef USE_SHADOWMAP\n\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform float shadowBias[ MAX_SHADOWS ];\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\tfloat depth = dot( rgba_depth, bit_shift );\n\t\treturn depth;\n\n\t}\n\n#endif";THREE.ShaderChunk["skinning_pars_vertex"]="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["logdepthbuf_pars_fragment"]="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\t#extension GL_EXT_frag_depth : enable\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif";THREE.ShaderChunk["alphamap_fragment"]="#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n";THREE.ShaderChunk["alphamap_pars_fragment"]="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n";THREE.UniformsUtils={merge:function(e){var t={};for(var i=0;i<e.length;i++){var r=this.clone(e[i]);for(var n in r){t[n]=r[n]}}return t},clone:function(e){var t={};for(var i in e){t[i]={};for(var r in e[i]){var n=e[i][r];if(n instanceof THREE.Color||n instanceof THREE.Vector2||n instanceof THREE.Vector3||n instanceof THREE.Vector4||n instanceof THREE.Matrix4||n instanceof THREE.Texture){t[i][r]=n.clone()}else if(n instanceof Array){t[i][r]=n.slice()}else{t[i][r]=n}}}return t}};THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],THREE.UniformsLib["shadowmap"]]),vertexShader:[THREE.ShaderChunk["common"],THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["skinbase_vertex"],"\t#ifdef USE_ENVMAP",THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],"\t#endif",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["alphamap_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["alphamap_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],"\toutgoingLight = diffuseColor.rgb;",THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",THREE.ShaderChunk["common"],THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["lights_lambert_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["lights_lambert_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["alphamap_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["alphamap_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],"\t#ifdef DOUBLE_SIDED","\t\tif ( gl_FrontFacing )","\t\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t\telse","\t\t\toutgoingLight += diffuseColor.rgb * vLightBack + emissive;","\t#else","\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t#endif",THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["bump"],THREE.UniformsLib["normalmap"],THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif",THREE.ShaderChunk["common"],THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["lights_phong_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],"#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"\tvViewPosition = -mvPosition.xyz;",THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["lights_phong_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["alphamap_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["lights_phong_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["bumpmap_pars_fragment"],THREE.ShaderChunk["normalmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["alphamap_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],THREE.ShaderChunk["lights_phong_fragment"],THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["particle"],THREE.UniformsLib["shadowmap"]]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["color_vertex"],"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\t#ifdef USE_SIZEATTENUATION","\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );","\t#else","\t\tgl_PointSize = size;","\t#endif","\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk["logdepthbuf_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_particle_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( psColor, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_particle_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["alphatest_fragment"],"\toutgoingLight = diffuseColor.rgb;",THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["color_vertex"],"\tvLineDistance = scale * lineDistance;","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tif ( mod( vLineDistance, totalSize ) > dashSize ) {","\t\tdiscard;","\t}","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["color_fragment"],"\toutgoingLight = diffuseColor.rgb;",THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[THREE.ShaderChunk["common"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {",THREE.ShaderChunk["logdepthbuf_fragment"],"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );","\tgl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk["common"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","\tvNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",THREE.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",THREE.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk["common"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:[THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"vec4 pack_depth( const in float depth ) {","\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","\tres -= res.xxyz * bit_mask;","\treturn res;","}","void main() {",THREE.ShaderChunk["logdepthbuf_fragment"],"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","\t#else","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","\t#endif","}"].join("\n")}};THREE.WebGLRenderer=function(e){console.log("THREE.WebGLRenderer",THREE.REVISION);e=e||{};var t=e.canvas!==undefined?e.canvas:document.createElement("canvas"),i=e.context!==undefined?e.context:null,r=1,n=e.precision!==undefined?e.precision:"highp",a=e.alpha!==undefined?e.alpha:false,o=e.depth!==undefined?e.depth:true,s=e.stencil!==undefined?e.stencil:true,h=e.antialias!==undefined?e.antialias:false,l=e.premultipliedAlpha!==undefined?e.premultipliedAlpha:true,u=e.preserveDrawingBuffer!==undefined?e.preserveDrawingBuffer:false,c=e.logarithmicDepthBuffer!==undefined?e.logarithmicDepthBuffer:false,p=new THREE.Color(0),f=0;var d=[];var m={};var g=[];var v=[];var y=[];var E=[];var w=[];this.domElement=t;this.context=null;this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;this.sortObjects=true;this.gammaFactor=2;this.gammaInput=false;this.gammaOutput=false;this.shadowMapEnabled=false;this.shadowMapType=THREE.PCFShadowMap;this.shadowMapCullFace=THREE.CullFaceFront;this.shadowMapDebug=false;this.shadowMapCascade=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var b=this,_=[],x=null,T=null,R=-1,k="",H=null,M=0,S=0,A=0,C=t.width,z=t.height,P=0,L=0,O=new THREE.Frustum,D=new THREE.Matrix4,F=new THREE.Vector3,B=new THREE.Vector3,U=true,N={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};var V;try{var I={alpha:a,depth:o,stencil:s,antialias:h,premultipliedAlpha:l,preserveDrawingBuffer:u};V=i||t.getContext("webgl",I)||t.getContext("experimental-webgl",I);if(V===null){if(t.getContext("webgl")!==null){throw"Error creating WebGL context with your selected attributes."}else{throw"Error creating WebGL context."}}t.addEventListener("webglcontextlost",function(e){e.preventDefault();X();q();m={}},false)}catch(e){THREE.error("THREE.WebGLRenderer: "+e)}var j=new THREE.WebGLState(V,Mt);if(V.getShaderPrecisionFormat===undefined){V.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}}var G=new THREE.WebGLExtensions(V);G.get("OES_texture_float");G.get("OES_texture_float_linear");G.get("OES_texture_half_float");G.get("OES_texture_half_float_linear");G.get("OES_standard_derivatives");if(c){G.get("EXT_frag_depth")}var W=function(e,t,i,r){if(l===true){e*=r;t*=r;i*=r}V.clearColor(e,t,i,r)};var q=function(){V.clearColor(0,0,0,1);V.clearDepth(1);V.clearStencil(0);V.enable(V.DEPTH_TEST);V.depthFunc(V.LEQUAL);V.frontFace(V.CCW);V.cullFace(V.BACK);V.enable(V.CULL_FACE);V.enable(V.BLEND);V.blendEquation(V.FUNC_ADD);V.blendFunc(V.SRC_ALPHA,V.ONE_MINUS_SRC_ALPHA);V.viewport(S,A,C,z);W(p.r,p.g,p.b,f)};var X=function(){x=null;H=null;k="";R=-1;U=true;j.reset()};q();this.context=V;this.state=j;var Y=V.getParameter(V.MAX_TEXTURE_IMAGE_UNITS);var Z=V.getParameter(V.MAX_VERTEX_TEXTURE_IMAGE_UNITS);var K=V.getParameter(V.MAX_TEXTURE_SIZE);var Q=V.getParameter(V.MAX_CUBE_MAP_TEXTURE_SIZE);var J=Z>0;var $=J&&G.get("OES_texture_float");var ee=V.getShaderPrecisionFormat(V.VERTEX_SHADER,V.HIGH_FLOAT);var te=V.getShaderPrecisionFormat(V.VERTEX_SHADER,V.MEDIUM_FLOAT);var ie=V.getShaderPrecisionFormat(V.FRAGMENT_SHADER,V.HIGH_FLOAT);var re=V.getShaderPrecisionFormat(V.FRAGMENT_SHADER,V.MEDIUM_FLOAT);var ne=function(){var e;return function(){if(e!==undefined){return e}e=[];if(G.get("WEBGL_compressed_texture_pvrtc")||G.get("WEBGL_compressed_texture_s3tc")){var t=V.getParameter(V.COMPRESSED_TEXTURE_FORMATS);for(var i=0;i<t.length;i++){e.push(t[i])}}return e}}();var ae=ee.precision>0&&ie.precision>0;var oe=te.precision>0&&re.precision>0;if(n==="highp"&&!ae){if(oe){n="mediump";THREE.warn("THREE.WebGLRenderer: highp not supported, using mediump.")}else{n="lowp";THREE.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp.")}}if(n==="mediump"&&!oe){n="lowp";THREE.warn("THREE.WebGLRenderer: mediump not supported, using lowp.")}var se=new THREE.ShadowMapPlugin(this,d,m,g);var he=new THREE.SpritePlugin(this,E);var le=new THREE.LensFlarePlugin(this,w);this.getContext=function(){return V};this.forceContextLoss=function(){G.get("WEBGL_lose_context").loseContext()};this.supportsVertexTextures=function(){return J};this.supportsFloatTextures=function(){return G.get("OES_texture_float")};this.supportsHalfFloatTextures=function(){return G.get("OES_texture_half_float")};this.supportsStandardDerivatives=function(){return G.get("OES_standard_derivatives")};this.supportsCompressedTextureS3TC=function(){return G.get("WEBGL_compressed_texture_s3tc")};this.supportsCompressedTexturePVRTC=function(){return G.get("WEBGL_compressed_texture_pvrtc")};this.supportsBlendMinMax=function(){return G.get("EXT_blend_minmax")};this.getMaxAnisotropy=function(){var e;return function(){if(e!==undefined){return e}var t=G.get("EXT_texture_filter_anisotropic");e=t!==null?V.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;return e}}();this.getPrecision=function(){return n};this.getPixelRatio=function(){return r};this.setPixelRatio=function(e){r=e};this.setSize=function(e,i,n){t.width=e*r;t.height=i*r;if(n!==false){t.style.width=e+"px";t.style.height=i+"px"}this.setViewport(0,0,e,i)};this.setViewport=function(e,t,i,n){S=e*r;A=t*r;C=i*r;z=n*r;V.viewport(S,A,C,z)};this.setScissor=function(e,t,i,n){V.scissor(e*r,t*r,i*r,n*r)};this.enableScissorTest=function(e){e?V.enable(V.SCISSOR_TEST):V.disable(V.SCISSOR_TEST)};this.getClearColor=function(){return p};this.setClearColor=function(e,t){p.set(e);f=t!==undefined?t:1;W(p.r,p.g,p.b,f)};this.getClearAlpha=function(){return f};this.setClearAlpha=function(e){f=e;W(p.r,p.g,p.b,f)};this.clear=function(e,t,i){var r=0;if(e===undefined||e)r|=V.COLOR_BUFFER_BIT;if(t===undefined||t)r|=V.DEPTH_BUFFER_BIT;if(i===undefined||i)r|=V.STENCIL_BUFFER_BIT;V.clear(r)};this.clearColor=function(){V.clear(V.COLOR_BUFFER_BIT)};this.clearDepth=function(){V.clear(V.DEPTH_BUFFER_BIT)};this.clearStencil=function(){V.clear(V.STENCIL_BUFFER_BIT)};this.clearTarget=function(e,t,i,r){this.setRenderTarget(e);this.clear(t,i,r)};this.resetGLState=X;function ue(e){e.__webglVertexBuffer=V.createBuffer();e.__webglColorBuffer=V.createBuffer();b.info.memory.geometries++}function ce(e){e.__webglVertexBuffer=V.createBuffer();e.__webglColorBuffer=V.createBuffer();e.__webglLineDistanceBuffer=V.createBuffer();b.info.memory.geometries++}function pe(e){e.__webglVertexBuffer=V.createBuffer();e.__webglNormalBuffer=V.createBuffer();e.__webglTangentBuffer=V.createBuffer();e.__webglColorBuffer=V.createBuffer();e.__webglUVBuffer=V.createBuffer();e.__webglUV2Buffer=V.createBuffer();e.__webglSkinIndicesBuffer=V.createBuffer();e.__webglSkinWeightsBuffer=V.createBuffer();e.__webglFaceBuffer=V.createBuffer();e.__webglLineBuffer=V.createBuffer();var t=e.numMorphTargets;if(t){e.__webglMorphTargetsBuffers=[];for(var i=0,r=t;i<r;i++){e.__webglMorphTargetsBuffers.push(V.createBuffer())}}var n=e.numMorphNormals;if(n){e.__webglMorphNormalsBuffers=[];for(var i=0,r=n;i<r;i++){e.__webglMorphNormalsBuffers.push(V.createBuffer())}}b.info.memory.geometries++}var fe=function(e){var t=e.target;t.traverse(function(e){e.removeEventListener("remove",fe);Je(e)})};var de=function(e){var t=e.target;t.removeEventListener("dispose",de);Ee(t)};var me=function(e){var t=e.target;t.removeEventListener("dispose",me);we(t);b.info.memory.textures--};var ge=function(e){var t=e.target;t.removeEventListener("dispose",ge);be(t);b.info.memory.textures--};var ve=function(e){var t=e.target;t.removeEventListener("dispose",ve);_e(t)};var ye=function(e){var t=["__webglVertexBuffer","__webglNormalBuffer","__webglTangentBuffer","__webglColorBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","__webglLineDistanceBuffer"];for(var i=0,r=t.length;i<r;i++){var n=t[i];if(e[n]!==undefined){V.deleteBuffer(e[n]);delete e[n]}}if(e.__webglCustomAttributesList!==undefined){for(var n in e.__webglCustomAttributesList){V.deleteBuffer(e.__webglCustomAttributesList[n].buffer)}delete e.__webglCustomAttributesList}b.info.memory.geometries--};var Ee=function(e){delete e.__webglInit;if(e instanceof THREE.BufferGeometry){for(var t in e.attributes){var i=e.attributes[t];if(i.buffer!==undefined){V.deleteBuffer(i.buffer);delete i.buffer}}b.info.memory.geometries--}else{var r=je[e.id];if(r!==undefined){for(var n=0,a=r.length;n<a;n++){var o=r[n];if(o.numMorphTargets!==undefined){for(var s=0,h=o.numMorphTargets;s<h;s++){V.deleteBuffer(o.__webglMorphTargetsBuffers[s])}delete o.__webglMorphTargetsBuffers}if(o.numMorphNormals!==undefined){for(var s=0,h=o.numMorphNormals;s<h;s++){V.deleteBuffer(o.__webglMorphNormalsBuffers[s])}delete o.__webglMorphNormalsBuffers}ye(o)}delete je[e.id]}else{ye(e)}}k=""};var we=function(e){if(e.image&&e.image.__webglTextureCube){V.deleteTexture(e.image.__webglTextureCube);delete e.image.__webglTextureCube}else{if(e.__webglInit===undefined)return;V.deleteTexture(e.__webglTexture);delete e.__webglTexture;delete e.__webglInit}};var be=function(e){if(!e||e.__webglTexture===undefined)return;V.deleteTexture(e.__webglTexture);delete e.__webglTexture;if(e instanceof THREE.WebGLRenderTargetCube){for(var t=0;t<6;t++){V.deleteFramebuffer(e.__webglFramebuffer[t]);V.deleteRenderbuffer(e.__webglRenderbuffer[t])}}else{V.deleteFramebuffer(e.__webglFramebuffer);V.deleteRenderbuffer(e.__webglRenderbuffer)}delete e.__webglFramebuffer;delete e.__webglRenderbuffer};var _e=function(e){var t=e.program.program;if(t===undefined)return;e.program=undefined;var i,r,n;var a=false;for(i=0,r=_.length;i<r;i++){n=_[i];if(n.program===t){n.usedTimes--;if(n.usedTimes===0){a=true}break}}if(a===true){var o=[];for(i=0,r=_.length;i<r;i++){n=_[i];if(n.program!==t){o.push(n)}}_=o;V.deleteProgram(t);b.info.memory.programs--}};function xe(e){var t=e.geometry;var i=e.material;var r=t.vertices.length;if(i.attributes){if(t.__webglCustomAttributesList===undefined){t.__webglCustomAttributesList=[]}for(var n in i.attributes){var a=i.attributes[n];if(!a.__webglInitialized||a.createUniqueBuffers){a.__webglInitialized=true;var o=1;if(a.type==="v2")o=2;else if(a.type==="v3")o=3;else if(a.type==="v4")o=4;else if(a.type==="c")o=3;a.size=o;a.array=new Float32Array(r*o);a.buffer=V.createBuffer();a.buffer.belongsToAttribute=n;a.needsUpdate=true}t.__webglCustomAttributesList.push(a)}}}function Te(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(i*3);e.__colorArray=new Float32Array(i*3);e.__webglParticleCount=i;xe(t)}function Re(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(i*3);e.__colorArray=new Float32Array(i*3);e.__lineDistanceArray=new Float32Array(i*1);e.__webglLineCount=i;xe(t)}function ke(e,t){var i=t.geometry,r=e.faces3,n=r.length*3,a=r.length*1,o=r.length*3,s=He(t,e);e.__vertexArray=new Float32Array(n*3);e.__normalArray=new Float32Array(n*3);e.__colorArray=new Float32Array(n*3);e.__uvArray=new Float32Array(n*2);if(i.faceVertexUvs.length>1){e.__uv2Array=new Float32Array(n*2)}if(i.hasTangents){e.__tangentArray=new Float32Array(n*4)}if(t.geometry.skinWeights.length&&t.geometry.skinIndices.length){e.__skinIndexArray=new Float32Array(n*4);e.__skinWeightArray=new Float32Array(n*4)}var h=G.get("OES_element_index_uint")!==null&&a>21845?Uint32Array:Uint16Array;e.__typeArray=h;e.__faceArray=new h(a*3);e.__lineArray=new h(o*2);var l=e.numMorphTargets;if(l){e.__morphTargetsArrays=[];for(var u=0,c=l;u<c;u++){e.__morphTargetsArrays.push(new Float32Array(n*3))}}var p=e.numMorphNormals;if(p){e.__morphNormalsArrays=[];for(var u=0,c=p;u<c;u++){e.__morphNormalsArrays.push(new Float32Array(n*3))}}e.__webglFaceCount=a*3;e.__webglLineCount=o*2;if(s.attributes){if(e.__webglCustomAttributesList===undefined){e.__webglCustomAttributesList=[]}for(var f in s.attributes){var d=s.attributes[f];var m={};for(var g in d){m[g]=d[g]}if(!m.__webglInitialized||m.createUniqueBuffers){m.__webglInitialized=true;var v=1;if(m.type==="v2")v=2;else if(m.type==="v3")v=3;else if(m.type==="v4")v=4;else if(m.type==="c")v=3;m.size=v;m.array=new Float32Array(n*v);m.buffer=V.createBuffer();m.buffer.belongsToAttribute=f;d.needsUpdate=true;m.__original=d}e.__webglCustomAttributesList.push(m)}}e.__inittedArrays=true}function He(e,t){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function Me(e){return e instanceof THREE.MeshPhongMaterial===false&&e.shading===THREE.FlatShading}function Se(e,t,i){var r,n,a,o,s,h=e.vertices,l=h.length,u=e.colors,c=u.length,p=e.__vertexArray,f=e.__colorArray,d=e.verticesNeedUpdate,m=e.colorsNeedUpdate,g=e.__webglCustomAttributesList,v,y,E,w,b,_;if(d){for(r=0;r<l;r++){a=h[r];o=r*3;p[o]=a.x;p[o+1]=a.y;p[o+2]=a.z}V.bindBuffer(V.ARRAY_BUFFER,e.__webglVertexBuffer);V.bufferData(V.ARRAY_BUFFER,p,t)}if(m){for(n=0;n<c;n++){s=u[n];o=n*3;f[o]=s.r;f[o+1]=s.g;f[o+2]=s.b}V.bindBuffer(V.ARRAY_BUFFER,e.__webglColorBuffer);V.bufferData(V.ARRAY_BUFFER,f,t)}if(g){for(v=0,y=g.length;v<y;v++){_=g[v];if(_.needsUpdate&&(_.boundTo===undefined||_.boundTo==="vertices")){w=_.value.length;o=0;if(_.size===1){for(E=0;E<w;E++){_.array[E]=_.value[E]}}else if(_.size===2){for(E=0;E<w;E++){b=_.value[E];_.array[o]=b.x;_.array[o+1]=b.y;o+=2}}else if(_.size===3){if(_.type==="c"){for(E=0;E<w;E++){b=_.value[E];_.array[o]=b.r;_.array[o+1]=b.g;_.array[o+2]=b.b;o+=3}}else{for(E=0;E<w;E++){b=_.value[E];_.array[o]=b.x;_.array[o+1]=b.y;_.array[o+2]=b.z;o+=3}}}else if(_.size===4){for(E=0;E<w;E++){b=_.value[E];_.array[o]=b.x;_.array[o+1]=b.y;_.array[o+2]=b.z;_.array[o+3]=b.w;o+=4}}}V.bindBuffer(V.ARRAY_BUFFER,_.buffer);V.bufferData(V.ARRAY_BUFFER,_.array,t);_.needsUpdate=false}}}function Ae(e,t){var i,r,n,a,o,s,h=e.vertices,l=e.colors,u=e.lineDistances,c=h.length,p=l.length,f=u.length,d=e.__vertexArray,m=e.__colorArray,g=e.__lineDistanceArray,v=e.verticesNeedUpdate,y=e.colorsNeedUpdate,E=e.lineDistancesNeedUpdate,w=e.__webglCustomAttributesList,b,_,x,T,R,k;if(v){for(i=0;i<c;i++){a=h[i];o=i*3;d[o]=a.x;d[o+1]=a.y;d[o+2]=a.z}V.bindBuffer(V.ARRAY_BUFFER,e.__webglVertexBuffer);V.bufferData(V.ARRAY_BUFFER,d,t)}if(y){for(r=0;r<p;r++){s=l[r];o=r*3;m[o]=s.r;m[o+1]=s.g;m[o+2]=s.b}V.bindBuffer(V.ARRAY_BUFFER,e.__webglColorBuffer);V.bufferData(V.ARRAY_BUFFER,m,t)}if(E){for(n=0;n<f;n++){g[n]=u[n]}V.bindBuffer(V.ARRAY_BUFFER,e.__webglLineDistanceBuffer);V.bufferData(V.ARRAY_BUFFER,g,t)}if(w){for(b=0,_=w.length;b<_;b++){k=w[b];if(k.needsUpdate&&(k.boundTo===undefined||k.boundTo==="vertices")){o=0;T=k.value.length;if(k.size===1){for(x=0;x<T;x++){k.array[x]=k.value[x]}}else if(k.size===2){for(x=0;x<T;x++){R=k.value[x];k.array[o]=R.x;k.array[o+1]=R.y;o+=2}}else if(k.size===3){if(k.type==="c"){for(x=0;x<T;x++){R=k.value[x];k.array[o]=R.r;k.array[o+1]=R.g;k.array[o+2]=R.b;o+=3}}else{for(x=0;x<T;x++){R=k.value[x];k.array[o]=R.x;k.array[o+1]=R.y;k.array[o+2]=R.z;o+=3}}}else if(k.size===4){for(x=0;x<T;x++){R=k.value[x];k.array[o]=R.x;k.array[o+1]=R.y;k.array[o+2]=R.z;k.array[o+3]=R.w;o+=4}}V.bindBuffer(V.ARRAY_BUFFER,k.buffer);V.bufferData(V.ARRAY_BUFFER,k.array,t);k.needsUpdate=false}}}}function Ce(e,t,i,r,n){if(!e.__inittedArrays){return}var a=Me(n);var o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M,S,A,C,z,P,L,O,D,F,B,U,N,I,j,G,W,q,X=0,Y=0,Z=0,K=0,Q=0,J=0,$=0,ee=0,te=0,ie=0,re=0,ne=0,ae,oe=e.__vertexArray,se=e.__uvArray,he=e.__uv2Array,le=e.__normalArray,ue=e.__tangentArray,ce=e.__colorArray,pe=e.__skinIndexArray,fe=e.__skinWeightArray,de=e.__morphTargetsArrays,me=e.__morphNormalsArrays,ge=e.__webglCustomAttributesList,ve,ye=e.__faceArray,Ee=e.__lineArray,we=t.geometry,be=we.verticesNeedUpdate,_e=we.elementsNeedUpdate,xe=we.uvsNeedUpdate,Te=we.normalsNeedUpdate,Re=we.tangentsNeedUpdate,ke=we.colorsNeedUpdate,He=we.morphTargetsNeedUpdate,Se=we.vertices,Ae=e.faces3,Ce=we.faces,ze=we.faceVertexUvs[0],Pe=we.faceVertexUvs[1],Le=we.skinIndices,Oe=we.skinWeights,De=we.morphTargets,Fe=we.morphNormals;if(be){for(o=0,s=Ae.length;o<s;o++){l=Ce[Ae[o]];v=Se[l.a];y=Se[l.b];E=Se[l.c];oe[Y]=v.x;oe[Y+1]=v.y;oe[Y+2]=v.z;oe[Y+3]=y.x;oe[Y+4]=y.y;oe[Y+5]=y.z;oe[Y+6]=E.x;oe[Y+7]=E.y;oe[Y+8]=E.z;Y+=9}V.bindBuffer(V.ARRAY_BUFFER,e.__webglVertexBuffer);V.bufferData(V.ARRAY_BUFFER,oe,i)}if(He){for(N=0,I=De.length;N<I;N++){re=0;for(o=0,s=Ae.length;o<s;o++){W=Ae[o];l=Ce[W];v=De[N].vertices[l.a];y=De[N].vertices[l.b];E=De[N].vertices[l.c];j=de[N];j[re]=v.x;j[re+1]=v.y;j[re+2]=v.z;j[re+3]=y.x;j[re+4]=y.y;j[re+5]=y.z;j[re+6]=E.x;j[re+7]=E.y;j[re+8]=E.z;if(n.morphNormals){if(a){x=Fe[N].faceNormals[W];T=x;R=x}else{q=Fe[N].vertexNormals[W];x=q.a;T=q.b;R=q.c}G=me[N];G[re]=x.x;G[re+1]=x.y;G[re+2]=x.z;G[re+3]=T.x;G[re+4]=T.y;G[re+5]=T.z;G[re+6]=R.x;G[re+7]=R.y;G[re+8]=R.z}re+=9}V.bindBuffer(V.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[N]);V.bufferData(V.ARRAY_BUFFER,de[N],i);if(n.morphNormals){V.bindBuffer(V.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[N]);V.bufferData(V.ARRAY_BUFFER,me[N],i)}}}if(Oe.length){for(o=0,s=Ae.length;o<s;o++){l=Ce[Ae[o]];S=Oe[l.a];A=Oe[l.b];C=Oe[l.c];fe[ie]=S.x;fe[ie+1]=S.y;fe[ie+2]=S.z;fe[ie+3]=S.w;fe[ie+4]=A.x;fe[ie+5]=A.y;fe[ie+6]=A.z;fe[ie+7]=A.w;fe[ie+8]=C.x;fe[ie+9]=C.y;fe[ie+10]=C.z;fe[ie+11]=C.w;z=Le[l.a];P=Le[l.b];L=Le[l.c];pe[ie]=z.x;pe[ie+1]=z.y;pe[ie+2]=z.z;pe[ie+3]=z.w;pe[ie+4]=P.x;pe[ie+5]=P.y;pe[ie+6]=P.z;pe[ie+7]=P.w;pe[ie+8]=L.x;pe[ie+9]=L.y;pe[ie+10]=L.z;pe[ie+11]=L.w;ie+=12}if(ie>0){V.bindBuffer(V.ARRAY_BUFFER,e.__webglSkinIndicesBuffer);V.bufferData(V.ARRAY_BUFFER,pe,i);V.bindBuffer(V.ARRAY_BUFFER,e.__webglSkinWeightsBuffer);V.bufferData(V.ARRAY_BUFFER,fe,i)}}if(ke){for(o=0,s=Ae.length;o<s;o++){l=Ce[Ae[o]];p=l.vertexColors;f=l.color;if(p.length===3&&n.vertexColors===THREE.VertexColors){k=p[0];H=p[1];M=p[2]}else{k=f;H=f;M=f}ce[te]=k.r;ce[te+1]=k.g;ce[te+2]=k.b;ce[te+3]=H.r;ce[te+4]=H.g;ce[te+5]=H.b;ce[te+6]=M.r;ce[te+7]=M.g;ce[te+8]=M.b;te+=9}if(te>0){V.bindBuffer(V.ARRAY_BUFFER,e.__webglColorBuffer);V.bufferData(V.ARRAY_BUFFER,ce,i)}}if(Re&&we.hasTangents){for(o=0,s=Ae.length;o<s;o++){l=Ce[Ae[o]];d=l.vertexTangents;w=d[0];b=d[1];_=d[2];ue[$]=w.x;ue[$+1]=w.y;ue[$+2]=w.z;ue[$+3]=w.w;ue[$+4]=b.x;ue[$+5]=b.y;ue[$+6]=b.z;ue[$+7]=b.w;ue[$+8]=_.x;ue[$+9]=_.y;ue[$+10]=_.z;ue[$+11]=_.w;$+=12}V.bindBuffer(V.ARRAY_BUFFER,e.__webglTangentBuffer);V.bufferData(V.ARRAY_BUFFER,ue,i)}if(Te){for(o=0,s=Ae.length;o<s;o++){l=Ce[Ae[o]];u=l.vertexNormals;c=l.normal;if(u.length===3&&a===false){for(O=0;O<3;O++){F=u[O];le[J]=F.x;le[J+1]=F.y;le[J+2]=F.z;J+=3}}else{for(O=0;O<3;O++){le[J]=c.x;le[J+1]=c.y;le[J+2]=c.z;J+=3}}}V.bindBuffer(V.ARRAY_BUFFER,e.__webglNormalBuffer);V.bufferData(V.ARRAY_BUFFER,le,i)}if(xe&&ze){for(o=0,s=Ae.length;o<s;o++){h=Ae[o];m=ze[h];if(m===undefined)continue;for(O=0;O<3;O++){B=m[O];se[Z]=B.x;se[Z+1]=B.y;Z+=2}}if(Z>0){V.bindBuffer(V.ARRAY_BUFFER,e.__webglUVBuffer);V.bufferData(V.ARRAY_BUFFER,se,i)}}if(xe&&Pe){for(o=0,s=Ae.length;o<s;o++){h=Ae[o];g=Pe[h];if(g===undefined)continue;for(O=0;O<3;O++){U=g[O];he[K]=U.x;he[K+1]=U.y;K+=2}}if(K>0){V.bindBuffer(V.ARRAY_BUFFER,e.__webglUV2Buffer);V.bufferData(V.ARRAY_BUFFER,he,i)}}if(_e){for(o=0,s=Ae.length;o<s;o++){ye[Q]=X;ye[Q+1]=X+1;ye[Q+2]=X+2;Q+=3;Ee[ee]=X;Ee[ee+1]=X+1;Ee[ee+2]=X;Ee[ee+3]=X+2;Ee[ee+4]=X+1;Ee[ee+5]=X+2;ee+=6;X+=3}V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer);V.bufferData(V.ELEMENT_ARRAY_BUFFER,ye,i);V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer);V.bufferData(V.ELEMENT_ARRAY_BUFFER,Ee,i)}if(ge){for(O=0,D=ge.length;O<D;O++){ve=ge[O];if(!ve.__original.needsUpdate)continue;ne=0;if(ve.size===1){if(ve.boundTo===undefined||ve.boundTo==="vertices"){for(o=0,s=Ae.length;o<s;o++){l=Ce[Ae[o]];ve.array[ne]=ve.value[l.a];ve.array[ne+1]=ve.value[l.b];ve.array[ne+2]=ve.value[l.c];ne+=3}}else if(ve.boundTo==="faces"){for(o=0,s=Ae.length;o<s;o++){ae=ve.value[Ae[o]];ve.array[ne]=ae;ve.array[ne+1]=ae;ve.array[ne+2]=ae;ne+=3}}}else if(ve.size===2){if(ve.boundTo===undefined||ve.boundTo==="vertices"){for(o=0,s=Ae.length;o<s;o++){l=Ce[Ae[o]];v=ve.value[l.a];y=ve.value[l.b];E=ve.value[l.c];ve.array[ne]=v.x;ve.array[ne+1]=v.y;ve.array[ne+2]=y.x;ve.array[ne+3]=y.y;ve.array[ne+4]=E.x;ve.array[ne+5]=E.y;ne+=6}}else if(ve.boundTo==="faces"){for(o=0,s=Ae.length;o<s;o++){ae=ve.value[Ae[o]];v=ae;y=ae;E=ae;ve.array[ne]=v.x;ve.array[ne+1]=v.y;ve.array[ne+2]=y.x;ve.array[ne+3]=y.y;ve.array[ne+4]=E.x;ve.array[ne+5]=E.y;ne+=6}}}else if(ve.size===3){var Be;if(ve.type==="c"){Be=["r","g","b"]}else{Be=["x","y","z"]}if(ve.boundTo===undefined||ve.boundTo==="vertices"){for(o=0,s=Ae.length;o<s;o++){l=Ce[Ae[o]];v=ve.value[l.a];y=ve.value[l.b];E=ve.value[l.c];ve.array[ne]=v[Be[0]];ve.array[ne+1]=v[Be[1]];ve.array[ne+2]=v[Be[2]];ve.array[ne+3]=y[Be[0]];ve.array[ne+4]=y[Be[1]];ve.array[ne+5]=y[Be[2]];ve.array[ne+6]=E[Be[0]];ve.array[ne+7]=E[Be[1]];ve.array[ne+8]=E[Be[2]];ne+=9}}else if(ve.boundTo==="faces"){for(o=0,s=Ae.length;o<s;o++){ae=ve.value[Ae[o]];v=ae;y=ae;E=ae;ve.array[ne]=v[Be[0]];ve.array[ne+1]=v[Be[1]];ve.array[ne+2]=v[Be[2]];ve.array[ne+3]=y[Be[0]];ve.array[ne+4]=y[Be[1]];ve.array[ne+5]=y[Be[2]];ve.array[ne+6]=E[Be[0]];ve.array[ne+7]=E[Be[1]];ve.array[ne+8]=E[Be[2]];ne+=9}}else if(ve.boundTo==="faceVertices"){for(o=0,s=Ae.length;o<s;o++){ae=ve.value[Ae[o]];v=ae[0];y=ae[1];E=ae[2];ve.array[ne]=v[Be[0]];ve.array[ne+1]=v[Be[1]];ve.array[ne+2]=v[Be[2]];ve.array[ne+3]=y[Be[0]];ve.array[ne+4]=y[Be[1]];ve.array[ne+5]=y[Be[2]];ve.array[ne+6]=E[Be[0]];ve.array[ne+7]=E[Be[1]];ve.array[ne+8]=E[Be[2]];ne+=9}}}else if(ve.size===4){if(ve.boundTo===undefined||ve.boundTo==="vertices"){for(o=0,s=Ae.length;o<s;o++){l=Ce[Ae[o]];v=ve.value[l.a];y=ve.value[l.b];E=ve.value[l.c];ve.array[ne]=v.x;ve.array[ne+1]=v.y;ve.array[ne+2]=v.z;ve.array[ne+3]=v.w;ve.array[ne+4]=y.x;ve.array[ne+5]=y.y;ve.array[ne+6]=y.z;ve.array[ne+7]=y.w;ve.array[ne+8]=E.x;ve.array[ne+9]=E.y;ve.array[ne+10]=E.z;ve.array[ne+11]=E.w;ne+=12}}else if(ve.boundTo==="faces"){for(o=0,s=Ae.length;o<s;o++){ae=ve.value[Ae[o]];v=ae;y=ae;E=ae;ve.array[ne]=v.x;ve.array[ne+1]=v.y;ve.array[ne+2]=v.z;ve.array[ne+3]=v.w;ve.array[ne+4]=y.x;ve.array[ne+5]=y.y;ve.array[ne+6]=y.z;ve.array[ne+7]=y.w;ve.array[ne+8]=E.x;ve.array[ne+9]=E.y;ve.array[ne+10]=E.z;ve.array[ne+11]=E.w;ne+=12}}else if(ve.boundTo==="faceVertices"){for(o=0,s=Ae.length;o<s;o++){ae=ve.value[Ae[o]];v=ae[0];y=ae[1];E=ae[2];ve.array[ne]=v.x;ve.array[ne+1]=v.y;ve.array[ne+2]=v.z;ve.array[ne+3]=v.w;ve.array[ne+4]=y.x;ve.array[ne+5]=y.y;ve.array[ne+6]=y.z;ve.array[ne+7]=y.w;ve.array[ne+8]=E.x;ve.array[ne+9]=E.y;ve.array[ne+10]=E.z;ve.array[ne+11]=E.w;ne+=12}}}V.bindBuffer(V.ARRAY_BUFFER,ve.buffer);V.bufferData(V.ARRAY_BUFFER,ve.array,i)}}if(r){delete e.__inittedArrays;delete e.__colorArray;delete e.__normalArray;delete e.__tangentArray;delete e.__uvArray;delete e.__uv2Array;delete e.__faceArray;delete e.__vertexArray;delete e.__lineArray;delete e.__skinIndexArray;delete e.__skinWeightArray}}this.renderBufferImmediate=function(e,t,i){j.initAttributes();if(e.hasPositions&&!e.__webglVertexBuffer)e.__webglVertexBuffer=V.createBuffer();if(e.hasNormals&&!e.__webglNormalBuffer)e.__webglNormalBuffer=V.createBuffer();if(e.hasUvs&&!e.__webglUvBuffer)e.__webglUvBuffer=V.createBuffer();if(e.hasColors&&!e.__webglColorBuffer)e.__webglColorBuffer=V.createBuffer();if(e.hasPositions){V.bindBuffer(V.ARRAY_BUFFER,e.__webglVertexBuffer);V.bufferData(V.ARRAY_BUFFER,e.positionArray,V.DYNAMIC_DRAW);j.enableAttribute(t.attributes.position);V.vertexAttribPointer(t.attributes.position,3,V.FLOAT,false,0,0)}if(e.hasNormals){V.bindBuffer(V.ARRAY_BUFFER,e.__webglNormalBuffer);if(i instanceof THREE.MeshPhongMaterial===false&&i.shading===THREE.FlatShading){var r,n,a,o,s,h,l,u,c,p,f,d,m,g,v=e.count*3;for(g=0;g<v;g+=9){m=e.normalArray;o=m[g];l=m[g+1];p=m[g+2];s=m[g+3];u=m[g+4];f=m[g+5];h=m[g+6];c=m[g+7];d=m[g+8];r=(o+s+h)/3;n=(l+u+c)/3;a=(p+f+d)/3;m[g]=r;m[g+1]=n;m[g+2]=a;m[g+3]=r;m[g+4]=n;m[g+5]=a;m[g+6]=r;m[g+7]=n;m[g+8]=a}}V.bufferData(V.ARRAY_BUFFER,e.normalArray,V.DYNAMIC_DRAW);j.enableAttribute(t.attributes.normal);V.vertexAttribPointer(t.attributes.normal,3,V.FLOAT,false,0,0)}if(e.hasUvs&&i.map){V.bindBuffer(V.ARRAY_BUFFER,e.__webglUvBuffer);V.bufferData(V.ARRAY_BUFFER,e.uvArray,V.DYNAMIC_DRAW);j.enableAttribute(t.attributes.uv);V.vertexAttribPointer(t.attributes.uv,2,V.FLOAT,false,0,0)}if(e.hasColors&&i.vertexColors!==THREE.NoColors){V.bindBuffer(V.ARRAY_BUFFER,e.__webglColorBuffer);V.bufferData(V.ARRAY_BUFFER,e.colorArray,V.DYNAMIC_DRAW);j.enableAttribute(t.attributes.color);V.vertexAttribPointer(t.attributes.color,3,V.FLOAT,false,0,0)}j.disableUnusedAttributes();V.drawArrays(V.TRIANGLES,0,e.count);e.count=0};function ze(e,t,i,r){var n=i.attributes;var a=t.attributes;var o=t.attributesKeys;for(var s=0,h=o.length;s<h;s++){var l=o[s];var u=a[l];if(u>=0){var c=n[l];if(c!==undefined){var p=c.itemSize;V.bindBuffer(V.ARRAY_BUFFER,c.buffer);j.enableAttribute(u);V.vertexAttribPointer(u,p,V.FLOAT,false,0,r*p*4)}else if(e.defaultAttributeValues!==undefined){if(e.defaultAttributeValues[l].length===2){V.vertexAttrib2fv(u,e.defaultAttributeValues[l])}else if(e.defaultAttributeValues[l].length===3){V.vertexAttrib3fv(u,e.defaultAttributeValues[l])}}}}j.disableUnusedAttributes()}this.renderBufferDirect=function(e,t,i,n,a,o){if(n.visible===false)return;Ze(o);var s=rt(e,t,i,n,o);var h=false,l=n.wireframe?1:0,u="direct_"+a.id+"_"+s.id+"_"+l;if(u!==k){k=u;h=true}if(h){j.initAttributes()}if(o instanceof THREE.Mesh){var c=n.wireframe===true?V.LINES:V.TRIANGLES;var p=a.attributes.index;if(p){var f,d;if(p.array instanceof Uint32Array&&G.get("OES_element_index_uint")){f=V.UNSIGNED_INT;d=4}else{f=V.UNSIGNED_SHORT;d=2}var m=a.offsets;if(m.length===0){if(h){ze(n,s,a,0);V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,p.buffer)}V.drawElements(c,p.array.length,f,0);b.info.render.calls++;b.info.render.vertices+=p.array.length;b.info.render.faces+=p.array.length/3}else{h=true;for(var g=0,v=m.length;g<v;g++){var y=m[g].index;if(h){ze(n,s,a,y);V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,p.buffer)}V.drawElements(c,m[g].count,f,m[g].start*d);b.info.render.calls++;b.info.render.vertices+=m[g].count;b.info.render.faces+=m[g].count/3}}}else{if(h){ze(n,s,a,0)}var E=a.attributes["position"];V.drawArrays(c,0,E.array.length/E.itemSize);b.info.render.calls++;b.info.render.vertices+=E.array.length/E.itemSize;b.info.render.faces+=E.array.length/(3*E.itemSize)}}else if(o instanceof THREE.PointCloud){var c=V.POINTS;var p=a.attributes.index;if(p){var f,d;if(p.array instanceof Uint32Array&&G.get("OES_element_index_uint")){f=V.UNSIGNED_INT;d=4}else{f=V.UNSIGNED_SHORT;d=2}var m=a.offsets;if(m.length===0){if(h){ze(n,s,a,0);V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,p.buffer)}V.drawElements(c,p.array.length,f,0);b.info.render.calls++;b.info.render.points+=p.array.length}else{if(m.length>1)h=true;for(var g=0,v=m.length;g<v;g++){var y=m[g].index;if(h){ze(n,s,a,y);V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,p.buffer)}V.drawElements(c,m[g].count,f,m[g].start*d);b.info.render.calls++;b.info.render.points+=m[g].count}}}else{if(h){ze(n,s,a,0)}var E=a.attributes.position;var m=a.offsets;if(m.length===0){V.drawArrays(c,0,E.array.length/3);b.info.render.calls++;b.info.render.points+=E.array.length/3}else{for(var g=0,v=m.length;g<v;g++){V.drawArrays(c,m[g].index,m[g].count);b.info.render.calls++;b.info.render.points+=m[g].count}}}}else if(o instanceof THREE.Line){var c=o.mode===THREE.LineStrip?V.LINE_STRIP:V.LINES;j.setLineWidth(n.linewidth*r);var p=a.attributes.index;if(p){var f,d;if(p.array instanceof Uint32Array){f=V.UNSIGNED_INT;d=4}else{f=V.UNSIGNED_SHORT;d=2}var m=a.offsets;if(m.length===0){if(h){ze(n,s,a,0);V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,p.buffer)}V.drawElements(c,p.array.length,f,0);b.info.render.calls++;b.info.render.vertices+=p.array.length}else{if(m.length>1)h=true;for(var g=0,v=m.length;g<v;g++){var y=m[g].index;if(h){ze(n,s,a,y);V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,p.buffer)}V.drawElements(c,m[g].count,f,m[g].start*d);b.info.render.calls++;b.info.render.vertices+=m[g].count}}}else{if(h){ze(n,s,a,0)}var E=a.attributes.position;var m=a.offsets;if(m.length===0){V.drawArrays(c,0,E.array.length/3);b.info.render.calls++;b.info.render.vertices+=E.array.length/3}else{for(var g=0,v=m.length;g<v;g++){V.drawArrays(c,m[g].index,m[g].count);b.info.render.calls++;b.info.render.vertices+=m[g].count}}}}};this.renderBuffer=function(e,t,i,n,a,o){if(n.visible===false)return;Ze(o);var s=rt(e,t,i,n,o);var h=s.attributes;var l=false,u=n.wireframe?1:0,c=a.id+"_"+s.id+"_"+u;if(c!==k){k=c;l=true}if(l){j.initAttributes()}if(!n.morphTargets&&h.position>=0){if(l){V.bindBuffer(V.ARRAY_BUFFER,a.__webglVertexBuffer);j.enableAttribute(h.position);V.vertexAttribPointer(h.position,3,V.FLOAT,false,0,0)}}else{if(o.morphTargetBase){Pe(n,a,o)}}if(l){if(a.__webglCustomAttributesList){for(var p=0,f=a.__webglCustomAttributesList.length;p<f;p++){var d=a.__webglCustomAttributesList[p];if(h[d.buffer.belongsToAttribute]>=0){V.bindBuffer(V.ARRAY_BUFFER,d.buffer);j.enableAttribute(h[d.buffer.belongsToAttribute]);V.vertexAttribPointer(h[d.buffer.belongsToAttribute],d.size,V.FLOAT,false,0,0)}}}if(h.color>=0){if(o.geometry.colors.length>0||o.geometry.faces.length>0){V.bindBuffer(V.ARRAY_BUFFER,a.__webglColorBuffer);j.enableAttribute(h.color);V.vertexAttribPointer(h.color,3,V.FLOAT,false,0,0)}else if(n.defaultAttributeValues!==undefined){V.vertexAttrib3fv(h.color,n.defaultAttributeValues.color)}}if(h.normal>=0){V.bindBuffer(V.ARRAY_BUFFER,a.__webglNormalBuffer);j.enableAttribute(h.normal);V.vertexAttribPointer(h.normal,3,V.FLOAT,false,0,0)}if(h.tangent>=0){V.bindBuffer(V.ARRAY_BUFFER,a.__webglTangentBuffer);j.enableAttribute(h.tangent);V.vertexAttribPointer(h.tangent,4,V.FLOAT,false,0,0)}if(h.uv>=0){if(o.geometry.faceVertexUvs[0]){V.bindBuffer(V.ARRAY_BUFFER,a.__webglUVBuffer);j.enableAttribute(h.uv);V.vertexAttribPointer(h.uv,2,V.FLOAT,false,0,0)}else if(n.defaultAttributeValues!==undefined){V.vertexAttrib2fv(h.uv,n.defaultAttributeValues.uv)}}if(h.uv2>=0){if(o.geometry.faceVertexUvs[1]){V.bindBuffer(V.ARRAY_BUFFER,a.__webglUV2Buffer);j.enableAttribute(h.uv2);V.vertexAttribPointer(h.uv2,2,V.FLOAT,false,0,0)}else if(n.defaultAttributeValues!==undefined){V.vertexAttrib2fv(h.uv2,n.defaultAttributeValues.uv2)}}if(n.skinning&&h.skinIndex>=0&&h.skinWeight>=0){V.bindBuffer(V.ARRAY_BUFFER,a.__webglSkinIndicesBuffer);j.enableAttribute(h.skinIndex);V.vertexAttribPointer(h.skinIndex,4,V.FLOAT,false,0,0);V.bindBuffer(V.ARRAY_BUFFER,a.__webglSkinWeightsBuffer);j.enableAttribute(h.skinWeight);V.vertexAttribPointer(h.skinWeight,4,V.FLOAT,false,0,0)}if(h.lineDistance>=0){V.bindBuffer(V.ARRAY_BUFFER,a.__webglLineDistanceBuffer);j.enableAttribute(h.lineDistance);V.vertexAttribPointer(h.lineDistance,1,V.FLOAT,false,0,0)}}j.disableUnusedAttributes();if(o instanceof THREE.Mesh){var m=a.__typeArray===Uint32Array?V.UNSIGNED_INT:V.UNSIGNED_SHORT;if(n.wireframe){j.setLineWidth(n.wireframeLinewidth*r);if(l)V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,a.__webglLineBuffer);V.drawElements(V.LINES,a.__webglLineCount,m,0)}else{if(l)V.bindBuffer(V.ELEMENT_ARRAY_BUFFER,a.__webglFaceBuffer);V.drawElements(V.TRIANGLES,a.__webglFaceCount,m,0)}b.info.render.calls++;b.info.render.vertices+=a.__webglFaceCount;b.info.render.faces+=a.__webglFaceCount/3}else if(o instanceof THREE.Line){var g=o.mode===THREE.LineStrip?V.LINE_STRIP:V.LINES;j.setLineWidth(n.linewidth*r);V.drawArrays(g,0,a.__webglLineCount);b.info.render.calls++}else if(o instanceof THREE.PointCloud){V.drawArrays(V.POINTS,0,a.__webglParticleCount);b.info.render.calls++;b.info.render.points+=a.__webglParticleCount}};function Pe(e,t,i){var r=e.program.attributes;if(i.morphTargetBase!==-1&&r.position>=0){V.bindBuffer(V.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[i.morphTargetBase]);j.enableAttribute(r.position);V.vertexAttribPointer(r.position,3,V.FLOAT,false,0,0)}else if(r.position>=0){V.bindBuffer(V.ARRAY_BUFFER,t.__webglVertexBuffer);j.enableAttribute(r.position);V.vertexAttribPointer(r.position,3,V.FLOAT,false,0,0)}if(i.morphTargetForcedOrder.length){var n=0;var a=i.morphTargetForcedOrder;var o=i.morphTargetInfluences;var s;while(n<e.numSupportedMorphTargets&&n<a.length){s=r["morphTarget"+n];if(s>=0){V.bindBuffer(V.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[a[n]]);j.enableAttribute(s);V.vertexAttribPointer(s,3,V.FLOAT,false,0,0)}s=r["morphNormal"+n];if(s>=0&&e.morphNormals){V.bindBuffer(V.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[a[n]]);j.enableAttribute(s);V.vertexAttribPointer(s,3,V.FLOAT,false,0,0)}i.__webglMorphTargetInfluences[n]=o[a[n]];n++}}else{var h=[];var o=i.morphTargetInfluences;var l=i.geometry.morphTargets;if(o.length>l.length){console.warn("THREE.WebGLRenderer: Influences array is bigger than morphTargets array.");o.length=l.length}for(var u=0,c=o.length;u<c;u++){var p=o[u];h.push([p,u])}if(h.length>e.numSupportedMorphTargets){h.sort(De);h.length=e.numSupportedMorphTargets}else if(h.length>e.numSupportedMorphNormals){h.sort(De)}else if(h.length===0){h.push([0,0])}var s;for(var n=0,f=e.numSupportedMorphTargets;n<f;n++){if(h[n]){var d=h[n][1];s=r["morphTarget"+n];if(s>=0){V.bindBuffer(V.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[d]);j.enableAttribute(s);V.vertexAttribPointer(s,3,V.FLOAT,false,0,0)}s=r["morphNormal"+n];if(s>=0&&e.morphNormals){V.bindBuffer(V.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[d]);j.enableAttribute(s);V.vertexAttribPointer(s,3,V.FLOAT,false,0,0)}i.__webglMorphTargetInfluences[n]=o[d]}else{i.__webglMorphTargetInfluences[n]=0}}}if(e.program.uniforms.morphTargetInfluences!==null){V.uniform1fv(e.program.uniforms.morphTargetInfluences,i.__webglMorphTargetInfluences)}}function Le(e,t){if(e.object.renderOrder!==t.object.renderOrder){return e.object.renderOrder-t.object.renderOrder}else if(e.material.id!==t.material.id){return e.material.id-t.material.id}else if(e.z!==t.z){return e.z-t.z}else{return e.id-t.id}}function Oe(e,t){if(e.object.renderOrder!==t.object.renderOrder){return e.object.renderOrder-t.object.renderOrder}if(e.z!==t.z){return t.z-e.z}else{return e.id-t.id}}function De(e,t){return t[0]-e[0]}this.render=function(e,t,i,r){if(t instanceof THREE.Camera===false){THREE.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var n=e.fog;k="";R=-1;H=null;U=true;if(e.autoUpdate===true)e.updateMatrixWorld();if(t.parent===undefined)t.updateMatrixWorld();e.traverse(function(e){if(e instanceof THREE.SkinnedMesh){e.skeleton.update()}});t.matrixWorldInverse.getInverse(t.matrixWorld);D.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);O.setFromMatrix(D);d.length=0;v.length=0;y.length=0;E.length=0;w.length=0;Fe(e);if(b.sortObjects===true){v.sort(Le);y.sort(Oe)}se.render(e,t);b.info.render.calls=0;b.info.render.vertices=0;b.info.render.faces=0;b.info.render.points=0;this.setRenderTarget(i);if(this.autoClear||r){this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil)}for(var a=0,o=g.length;a<o;a++){var s=g[a];var h=s.object;if(h.visible){vt(h,t);Ne(s)}}if(e.overrideMaterial){var l=e.overrideMaterial;it(l);Be(v,t,d,n,l);Be(y,t,d,n,l);Ue(g,"",t,d,n,l)}else{j.setBlending(THREE.NoBlending);Be(v,t,d,n,null);Ue(g,"opaque",t,d,n,null);Be(y,t,d,n,null);Ue(g,"transparent",t,d,n,null)}he.render(e,t);le.render(e,t,P,L);if(i&&i.generateMipmaps&&i.minFilter!==THREE.NearestFilter&&i.minFilter!==THREE.LinearFilter){kt(i)}j.setDepthTest(true);j.setDepthWrite(true);j.setColorWrite(true)};function Fe(e){if(e.visible===false)return;if(e instanceof THREE.Scene||e instanceof THREE.Group){}else{Ie(e);if(e instanceof THREE.Light){d.push(e)}else if(e instanceof THREE.Sprite){E.push(e)}else if(e instanceof THREE.LensFlare){w.push(e)}else{var t=m[e.id];if(t&&(e.frustumCulled===false||O.intersectsObject(e)===true)){for(var i=0,r=t.length;i<r;i++){var n=t[i];Ve(n);n.render=true;if(b.sortObjects===true){F.setFromMatrixPosition(e.matrixWorld);F.applyProjection(D);n.z=F.z}}}}}for(var i=0,r=e.children.length;i<r;i++){Fe(e.children[i])}}function Be(e,t,i,r,n){var a;for(var o=0,s=e.length;o<s;o++){var h=e[o];var l=h.object;var u=h.buffer;vt(l,t);if(n){a=n}else{a=h.material;if(!a)continue;it(a)}b.setMaterialFaces(a);if(u instanceof THREE.BufferGeometry){b.renderBufferDirect(t,i,r,a,u,l)}else{b.renderBuffer(t,i,r,a,u,l)}}}function Ue(e,t,i,r,n,a){var o;for(var s=0,h=e.length;s<h;s++){var l=e[s];var u=l.object;if(u.visible){if(a){o=a}else{o=l[t];if(!o)continue;it(o)}b.renderImmediateObject(i,r,n,o,u)}}}this.renderImmediateObject=function(e,t,i,r,n){var a=rt(e,t,i,r,n);k="";b.setMaterialFaces(r);if(n.immediateRenderCallback){n.immediateRenderCallback(a,V,O)}else{n.render(function(e){b.renderBufferImmediate(e,a,r)})}};function Ne(e){var t=e.object,i=t.material;if(i.transparent){e.transparent=i;e.opaque=null}else{e.opaque=i;e.transparent=null}}function Ve(e){var t=e.object;var i=e.buffer;var r=t.geometry;var n=t.material;if(n instanceof THREE.MeshFaceMaterial){var a=r instanceof THREE.BufferGeometry?0:i.materialIndex;n=n.materials[a];e.material=n;if(n.transparent){y.push(e)}else{v.push(e)}}else if(n){e.material=n;if(n.transparent){y.push(e)}else{v.push(e)}}}function Ie(e){if(e.__webglInit===undefined){e.__webglInit=true;e._modelViewMatrix=new THREE.Matrix4;e._normalMatrix=new THREE.Matrix3;e.addEventListener("removed",fe)}var t=e.geometry;if(t===undefined){}else if(t.__webglInit===undefined){t.__webglInit=true;t.addEventListener("dispose",de);if(t instanceof THREE.BufferGeometry){b.info.memory.geometries++}else if(e instanceof THREE.Mesh){qe(e,t)}else if(e instanceof THREE.Line){if(t.__webglVertexBuffer===undefined){ce(t);Re(t,e);t.verticesNeedUpdate=true;t.colorsNeedUpdate=true;t.lineDistancesNeedUpdate=true}}else if(e instanceof THREE.PointCloud){if(t.__webglVertexBuffer===undefined){ue(t);Te(t,e);t.verticesNeedUpdate=true;t.colorsNeedUpdate=true}}}if(e.__webglActive===undefined){e.__webglActive=true;if(e instanceof THREE.Mesh){if(t instanceof THREE.BufferGeometry){Xe(m,t,e)}else if(t instanceof THREE.Geometry){var i=je[t.id];for(var r=0,n=i.length;r<n;r++){Xe(m,i[r],e)}}}else if(e instanceof THREE.Line||e instanceof THREE.PointCloud){Xe(m,t,e)}else if(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback){Ye(g,e)}}}var je={};var Ge=0;function We(e,t){var i=G.get("OES_element_index_uint")?4294967296:65535;var r,n={};var a=e.morphTargets.length;var o=e.morphNormals.length;var s;var h={};var l=[];for(var u=0,c=e.faces.length;u<c;u++){var p=e.faces[u];var f=t?p.materialIndex:0;if(!(f in n)){n[f]={hash:f,counter:0}}r=n[f].hash+"_"+n[f].counter;if(!(r in h)){s={id:Ge++,faces3:[],materialIndex:f,vertices:0,numMorphTargets:a,numMorphNormals:o};h[r]=s;l.push(s)}if(h[r].vertices+3>i){n[f].counter+=1;r=n[f].hash+"_"+n[f].counter;if(!(r in h)){s={id:Ge++,faces3:[],materialIndex:f,vertices:0,numMorphTargets:a,numMorphNormals:o};h[r]=s;l.push(s)}}h[r].faces3.push(u);h[r].vertices+=3}return l}function qe(e,t){var i=e.material,r=false;if(je[t.id]===undefined||t.groupsNeedUpdate===true){delete m[e.id];je[t.id]=We(t,i instanceof THREE.MeshFaceMaterial);t.groupsNeedUpdate=false}var n=je[t.id];for(var a=0,o=n.length;a<o;a++){var s=n[a];if(s.__webglVertexBuffer===undefined){pe(s);ke(s,e);t.verticesNeedUpdate=true;t.morphTargetsNeedUpdate=true;t.elementsNeedUpdate=true;t.uvsNeedUpdate=true;t.normalsNeedUpdate=true;t.tangentsNeedUpdate=true;t.colorsNeedUpdate=true;r=true}else{r=false}if(r||e.__webglActive===undefined){Xe(m,s,e)}}e.__webglActive=true}function Xe(e,t,i){var r=i.id;e[r]=e[r]||[];e[r].push({id:r,buffer:t,object:i,material:null,z:0})}function Ye(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}function Ze(e){var t=e.geometry;if(t instanceof THREE.BufferGeometry){var i=t.attributes;var r=t.attributesKeys;for(var n=0,a=r.length;n<a;n++){var o=r[n];var s=i[o];var h=o==="index"?V.ELEMENT_ARRAY_BUFFER:V.ARRAY_BUFFER;if(s.buffer===undefined){s.buffer=V.createBuffer();V.bindBuffer(h,s.buffer);V.bufferData(h,s.array,s instanceof THREE.DynamicBufferAttribute?V.DYNAMIC_DRAW:V.STATIC_DRAW);s.needsUpdate=false}else if(s.needsUpdate===true){V.bindBuffer(h,s.buffer);if(s.updateRange===undefined||s.updateRange.count===-1){V.bufferSubData(h,0,s.array)}else if(s.updateRange.count===0){console.error("THREE.WebGLRenderer.updateObject: using updateRange for THREE.DynamicBufferAttribute and marked as needsUpdate but count is 0, ensure you are using set methods or updating manually.")}else{V.bufferSubData(h,s.updateRange.offset*s.array.BYTES_PER_ELEMENT,s.array.subarray(s.updateRange.offset,s.updateRange.offset+s.updateRange.count));s.updateRange.count=0}s.needsUpdate=false}}}else if(e instanceof THREE.Mesh){if(t.groupsNeedUpdate===true){qe(e,t)}var l=je[t.id];for(var n=0,u=l.length;n<u;n++){var c=l[n];var p=He(e,c);var f=p.attributes&&Ke(p);if(t.verticesNeedUpdate||t.morphTargetsNeedUpdate||t.elementsNeedUpdate||t.uvsNeedUpdate||t.normalsNeedUpdate||t.colorsNeedUpdate||t.tangentsNeedUpdate||f){Ce(c,e,V.DYNAMIC_DRAW,!t.dynamic,p)}}t.verticesNeedUpdate=false;t.morphTargetsNeedUpdate=false;t.elementsNeedUpdate=false;t.uvsNeedUpdate=false;t.normalsNeedUpdate=false;t.colorsNeedUpdate=false;t.tangentsNeedUpdate=false;p.attributes&&Qe(p)}else if(e instanceof THREE.Line){var p=He(e,t);var f=p.attributes&&Ke(p);if(t.verticesNeedUpdate||t.colorsNeedUpdate||t.lineDistancesNeedUpdate||f){Ae(t,V.DYNAMIC_DRAW)}t.verticesNeedUpdate=false;t.colorsNeedUpdate=false;t.lineDistancesNeedUpdate=false;p.attributes&&Qe(p)}else if(e instanceof THREE.PointCloud){var p=He(e,t);var f=p.attributes&&Ke(p);if(t.verticesNeedUpdate||t.colorsNeedUpdate||f){Se(t,V.DYNAMIC_DRAW,e)}t.verticesNeedUpdate=false;t.colorsNeedUpdate=false;p.attributes&&Qe(p)}}function Ke(e){for(var t in e.attributes){if(e.attributes[t].needsUpdate)return true}return false}function Qe(e){for(var t in e.attributes){e.attributes[t].needsUpdate=false}}function Je(e){if(e instanceof THREE.Mesh||e instanceof THREE.PointCloud||e instanceof THREE.Line){delete m[e.id]}else if(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback){$e(g,e)}delete e.__webglInit;delete e._modelViewMatrix;delete e._normalMatrix;delete e.__webglActive}function $e(e,t){for(var i=e.length-1;i>=0;i--){if(e[i].object===t){e.splice(i,1)}}}var et={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointCloudMaterial:"particle_basic"};function tt(e,t,i,r){e.addEventListener("dispose",ve);var a=et[e.type];if(a){var o=THREE.ShaderLib[a];e.__webglShader={uniforms:THREE.UniformsUtils.clone(o.uniforms),vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}}else{e.__webglShader={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}}var s=At(t);var h=Ct(t);var l=St(r);var u={precision:n,supportsVertexTextures:J,map:!!e.map,envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,combine:e.combine,vertexColors:e.vertexColors,fog:i,useFog:e.fog,fogExp:i instanceof THREE.FogExp2,flatShading:e.shading===THREE.FlatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:c,skinning:e.skinning,maxBones:l,useVertexTexture:$&&r&&r.skeleton&&r.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:b.maxMorphTargets,maxMorphNormals:b.maxMorphNormals,maxDirLights:s.directional,maxPointLights:s.point,maxSpotLights:s.spot,maxHemiLights:s.hemi,maxShadows:h,shadowMapEnabled:b.shadowMapEnabled&&r.receiveShadow&&h>0,shadowMapType:b.shadowMapType,shadowMapDebug:b.shadowMapDebug,shadowMapCascade:b.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,wrapAround:e.wrapAround,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide};var p=[];if(a){p.push(a)}else{p.push(e.fragmentShader);p.push(e.vertexShader)}if(e.defines!==undefined){for(var f in e.defines){p.push(f);p.push(e.defines[f])}}for(var f in u){p.push(f);p.push(u[f])}var d=p.join();var m;for(var g=0,v=_.length;g<v;g++){var y=_[g];if(y.code===d){m=y;m.usedTimes++;break}}if(m===undefined){m=new THREE.WebGLProgram(b,d,e,u);_.push(m);b.info.memory.programs=_.length}e.program=m;var E=m.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var w,x="morphTarget";for(var T=0;T<b.maxMorphTargets;T++){w=x+T;if(E[w]>=0){e.numSupportedMorphTargets++}}}if(e.morphNormals){e.numSupportedMorphNormals=0;var w,x="morphNormal";for(T=0;T<b.maxMorphNormals;T++){w=x+T;if(E[w]>=0){e.numSupportedMorphNormals++}}}e.uniformsList=[];for(var R in e.__webglShader.uniforms){var k=e.program.uniforms[R];if(k){e.uniformsList.push([e.__webglShader.uniforms[R],k])}}}function it(e){if(e.transparent===true){j.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha)}else{j.setBlending(THREE.NoBlending)}j.setDepthTest(e.depthTest);j.setDepthWrite(e.depthWrite);j.setColorWrite(e.colorWrite);j.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function rt(e,t,i,r,n){M=0;if(r.needsUpdate){if(r.program)_e(r);tt(r,t,i,n);r.needsUpdate=false}if(r.morphTargets){if(!n.__webglMorphTargetInfluences){n.__webglMorphTargetInfluences=new Float32Array(b.maxMorphTargets)}}var a=false;var o=false;var s=false;var h=r.program,l=h.uniforms,u=r.__webglShader.uniforms;if(h.id!==x){V.useProgram(h.program);x=h.id;a=true;o=true;s=true}if(r.id!==R){if(R===-1)s=true;R=r.id;o=true}if(a||e!==H){V.uniformMatrix4fv(l.projectionMatrix,false,e.projectionMatrix.elements);if(c){V.uniform1f(l.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2))}if(e!==H)H=e;if(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap){if(l.cameraPosition!==null){F.setFromMatrixPosition(e.matrixWorld);V.uniform3f(l.cameraPosition,F.x,F.y,F.z)}}if(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshBasicMaterial||r instanceof THREE.ShaderMaterial||r.skinning){if(l.viewMatrix!==null){V.uniformMatrix4fv(l.viewMatrix,false,e.matrixWorldInverse.elements)}}}if(r.skinning){if(n.bindMatrix&&l.bindMatrix!==null){V.uniformMatrix4fv(l.bindMatrix,false,n.bindMatrix.elements)}if(n.bindMatrixInverse&&l.bindMatrixInverse!==null){V.uniformMatrix4fv(l.bindMatrixInverse,false,n.bindMatrixInverse.elements)}if($&&n.skeleton&&n.skeleton.useVertexTexture){if(l.boneTexture!==null){var p=mt();V.uniform1i(l.boneTexture,p);b.setTexture(n.skeleton.boneTexture,p)}if(l.boneTextureWidth!==null){V.uniform1i(l.boneTextureWidth,n.skeleton.boneTextureWidth)}if(l.boneTextureHeight!==null){V.uniform1i(l.boneTextureHeight,n.skeleton.boneTextureHeight)}}else if(n.skeleton&&n.skeleton.boneMatrices){if(l.boneGlobalMatrices!==null){V.uniformMatrix4fv(l.boneGlobalMatrices,false,n.skeleton.boneMatrices)}}}if(o){if(i&&r.fog){ht(u,i)}if(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights){if(U){s=true;Et(t);U=false}if(s){ct(u,N);pt(u,true)}else{pt(u,false)}}if(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial){nt(u,r)}if(r instanceof THREE.LineBasicMaterial){at(u,r)}else if(r instanceof THREE.LineDashedMaterial){at(u,r);ot(u,r)}else if(r instanceof THREE.PointCloudMaterial){st(u,r)}else if(r instanceof THREE.MeshPhongMaterial){lt(u,r)}else if(r instanceof THREE.MeshLambertMaterial){ut(u,r)}else if(r instanceof THREE.MeshDepthMaterial){u.mNear.value=e.near;u.mFar.value=e.far;u.opacity.value=r.opacity}else if(r instanceof THREE.MeshNormalMaterial){u.opacity.value=r.opacity}if(n.receiveShadow&&!r._shadowPass){ft(u,t)}gt(r.uniformsList)}dt(l,n);if(l.modelMatrix!==null){V.uniformMatrix4fv(l.modelMatrix,false,n.matrixWorld.elements)}return h}function nt(e,t){e.opacity.value=t.opacity;e.diffuse.value=t.color;e.map.value=t.map;e.lightMap.value=t.lightMap;e.specularMap.value=t.specularMap;e.alphaMap.value=t.alphaMap;if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale)}var i;if(t.map){i=t.map}else if(t.specularMap){i=t.specularMap}else if(t.normalMap){i=t.normalMap}else if(t.bumpMap){i=t.bumpMap}else if(t.alphaMap){i=t.alphaMap}if(i!==undefined){var r=i.offset;var n=i.repeat;e.offsetRepeat.value.set(r.x,r.y,n.x,n.y)}e.envMap.value=t.envMap;e.flipEnvMap.value=t.envMap instanceof THREE.WebGLRenderTargetCube?1:-1;e.reflectivity.value=t.reflectivity;e.refractionRatio.value=t.refractionRatio}function at(e,t){e.diffuse.value=t.color;e.opacity.value=t.opacity}function ot(e,t){e.dashSize.value=t.dashSize;e.totalSize.value=t.dashSize+t.gapSize;e.scale.value=t.scale}function st(e,i){e.psColor.value=i.color;e.opacity.value=i.opacity;e.size.value=i.size;e.scale.value=t.height/2;e.map.value=i.map;if(i.map!==null){var r=i.map.offset;var n=i.map.repeat;e.offsetRepeat.value.set(r.x,r.y,n.x,n.y)}}function ht(e,t){e.fogColor.value=t.color;if(t instanceof THREE.Fog){e.fogNear.value=t.near;e.fogFar.value=t.far}else if(t instanceof THREE.FogExp2){e.fogDensity.value=t.density}}function lt(e,t){e.shininess.value=t.shininess;e.emissive.value=t.emissive;e.specular.value=t.specular;if(t.wrapAround){e.wrapRGB.value.copy(t.wrapRGB)}}function ut(e,t){e.emissive.value=t.emissive;if(t.wrapAround){e.wrapRGB.value.copy(t.wrapRGB)}}function ct(e,t){e.ambientLightColor.value=t.ambient;e.directionalLightColor.value=t.directional.colors;e.directionalLightDirection.value=t.directional.positions;e.pointLightColor.value=t.point.colors;e.pointLightPosition.value=t.point.positions;e.pointLightDistance.value=t.point.distances;e.pointLightDecay.value=t.point.decays;e.spotLightColor.value=t.spot.colors;e.spotLightPosition.value=t.spot.positions;e.spotLightDistance.value=t.spot.distances;e.spotLightDirection.value=t.spot.directions;e.spotLightAngleCos.value=t.spot.anglesCos;e.spotLightExponent.value=t.spot.exponents;e.spotLightDecay.value=t.spot.decays;e.hemisphereLightSkyColor.value=t.hemi.skyColors;e.hemisphereLightGroundColor.value=t.hemi.groundColors;e.hemisphereLightDirection.value=t.hemi.positions}function pt(e,t){e.ambientLightColor.needsUpdate=t;e.directionalLightColor.needsUpdate=t;e.directionalLightDirection.needsUpdate=t;e.pointLightColor.needsUpdate=t;e.pointLightPosition.needsUpdate=t;e.pointLightDistance.needsUpdate=t;e.pointLightDecay.needsUpdate=t;e.spotLightColor.needsUpdate=t;e.spotLightPosition.needsUpdate=t;e.spotLightDistance.needsUpdate=t;e.spotLightDirection.needsUpdate=t;e.spotLightAngleCos.needsUpdate=t;e.spotLightExponent.needsUpdate=t;e.spotLightDecay.needsUpdate=t;e.hemisphereLightSkyColor.needsUpdate=t;e.hemisphereLightGroundColor.needsUpdate=t;e.hemisphereLightDirection.needsUpdate=t}function ft(e,t){if(e.shadowMatrix){var i=0;for(var r=0,n=t.length;r<n;r++){var a=t[r];if(!a.castShadow)continue;if(a instanceof THREE.SpotLight||a instanceof THREE.DirectionalLight&&!a.shadowCascade){e.shadowMap.value[i]=a.shadowMap;e.shadowMapSize.value[i]=a.shadowMapSize;e.shadowMatrix.value[i]=a.shadowMatrix;e.shadowDarkness.value[i]=a.shadowDarkness;e.shadowBias.value[i]=a.shadowBias;i++}}}}function dt(e,t){V.uniformMatrix4fv(e.modelViewMatrix,false,t._modelViewMatrix.elements);if(e.normalMatrix){V.uniformMatrix3fv(e.normalMatrix,false,t._normalMatrix.elements)}}function mt(){var e=M;if(e>=Y){THREE.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Y)}M+=1;return e}function gt(e){var t,i,r;for(var n=0,a=e.length;n<a;n++){var o=e[n][0];if(o.needsUpdate===false)continue;var s=o.type;var h=o.value;var l=e[n][1];switch(s){case"1i":V.uniform1i(l,h);break;case"1f":V.uniform1f(l,h);break;case"2f":V.uniform2f(l,h[0],h[1]);break;case"3f":V.uniform3f(l,h[0],h[1],h[2]);break;case"4f":V.uniform4f(l,h[0],h[1],h[2],h[3]);break;case"1iv":V.uniform1iv(l,h);break;case"3iv":V.uniform3iv(l,h);break;case"1fv":V.uniform1fv(l,h);break;case"2fv":V.uniform2fv(l,h);break;case"3fv":V.uniform3fv(l,h);break;case"4fv":V.uniform4fv(l,h);break;case"Matrix3fv":V.uniformMatrix3fv(l,false,h);break;case"Matrix4fv":V.uniformMatrix4fv(l,false,h);break;case"i":V.uniform1i(l,h);break;case"f":V.uniform1f(l,h);break;case"v2":V.uniform2f(l,h.x,h.y);break;case"v3":V.uniform3f(l,h.x,h.y,h.z);break;case"v4":V.uniform4f(l,h.x,h.y,h.z,h.w);break;case"c":V.uniform3f(l,h.r,h.g,h.b);break;case"iv1":V.uniform1iv(l,h);break;case"iv":V.uniform3iv(l,h);break;case"fv1":V.uniform1fv(l,h);break;case"fv":V.uniform3fv(l,h);break;case"v2v":if(o._array===undefined){o._array=new Float32Array(2*h.length)}for(var u=0,c=h.length;u<c;u++){r=u*2;o._array[r]=h[u].x;o._array[r+1]=h[u].y}V.uniform2fv(l,o._array);break;case"v3v":if(o._array===undefined){o._array=new Float32Array(3*h.length)}for(var u=0,c=h.length;u<c;u++){r=u*3;o._array[r]=h[u].x;o._array[r+1]=h[u].y;o._array[r+2]=h[u].z}V.uniform3fv(l,o._array);break;case"v4v":if(o._array===undefined){o._array=new Float32Array(4*h.length)}for(var u=0,c=h.length;u<c;u++){r=u*4;o._array[r]=h[u].x;o._array[r+1]=h[u].y;o._array[r+2]=h[u].z;o._array[r+3]=h[u].w}V.uniform4fv(l,o._array);break;case"m3":V.uniformMatrix3fv(l,false,h.elements);break;case"m3v":if(o._array===undefined){o._array=new Float32Array(9*h.length)}for(var u=0,c=h.length;u<c;u++){h[u].flattenToArrayOffset(o._array,u*9)}V.uniformMatrix3fv(l,false,o._array);break;case"m4":V.uniformMatrix4fv(l,false,h.elements);break;case"m4v":if(o._array===undefined){o._array=new Float32Array(16*h.length)}for(var u=0,c=h.length;u<c;u++){h[u].flattenToArrayOffset(o._array,u*16)}V.uniformMatrix4fv(l,false,o._array);break;case"t":t=h;i=mt();V.uniform1i(l,i);if(!t)continue;if(t instanceof THREE.CubeTexture||t.image instanceof Array&&t.image.length===6){_t(t,i)}else if(t instanceof THREE.WebGLRenderTargetCube){xt(t,i)}else{b.setTexture(t,i)}break;case"tv":if(o._array===undefined){o._array=[]}for(var u=0,c=o.value.length;u<c;u++){o._array[u]=mt()}V.uniform1iv(l,o._array);for(var u=0,c=o.value.length;u<c;u++){t=o.value[u];i=o._array[u];if(!t)continue;b.setTexture(t,i)}break;default:THREE.warn("THREE.WebGLRenderer: Unknown uniform type: "+s)}}}function vt(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld);e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function yt(e,t,i,r){e[t]=i.r*r;e[t+1]=i.g*r;e[t+2]=i.b*r}function Et(e){var t,i,r,n=0,a=0,o=0,s,h,l,u,c,p=N,f=p.directional.colors,d=p.directional.positions,m=p.point.colors,g=p.point.positions,v=p.point.distances,y=p.point.decays,E=p.spot.colors,w=p.spot.positions,b=p.spot.distances,_=p.spot.directions,x=p.spot.anglesCos,T=p.spot.exponents,R=p.spot.decays,k=p.hemi.skyColors,H=p.hemi.groundColors,M=p.hemi.positions,S=0,A=0,C=0,z=0,P=0,L=0,O=0,D=0,U=0,V=0,I=0,j=0;for(t=0,i=e.length;t<i;t++){r=e[t];if(r.onlyShadow)continue;s=r.color;u=r.intensity;c=r.distance;if(r instanceof THREE.AmbientLight){if(!r.visible)continue;n+=s.r;a+=s.g;o+=s.b}else if(r instanceof THREE.DirectionalLight){P+=1;if(!r.visible)continue;B.setFromMatrixPosition(r.matrixWorld);F.setFromMatrixPosition(r.target.matrixWorld);B.sub(F);B.normalize();U=S*3;d[U]=B.x;d[U+1]=B.y;d[U+2]=B.z;yt(f,U,s,u);S+=1}else if(r instanceof THREE.PointLight){L+=1;if(!r.visible)continue;V=A*3;yt(m,V,s,u);F.setFromMatrixPosition(r.matrixWorld);g[V]=F.x;g[V+1]=F.y;g[V+2]=F.z;v[A]=c;y[A]=r.distance===0?0:r.decay;A+=1}else if(r instanceof THREE.SpotLight){O+=1;if(!r.visible)continue;I=C*3;yt(E,I,s,u);B.setFromMatrixPosition(r.matrixWorld);w[I]=B.x;w[I+1]=B.y;w[I+2]=B.z;b[C]=c;F.setFromMatrixPosition(r.target.matrixWorld);B.sub(F);B.normalize();_[I]=B.x;_[I+1]=B.y;_[I+2]=B.z;x[C]=Math.cos(r.angle);T[C]=r.exponent;R[C]=r.distance===0?0:r.decay;C+=1}else if(r instanceof THREE.HemisphereLight){D+=1;if(!r.visible)continue;B.setFromMatrixPosition(r.matrixWorld);B.normalize();j=z*3;M[j]=B.x;M[j+1]=B.y;M[j+2]=B.z;h=r.color;l=r.groundColor;yt(k,j,h,u);yt(H,j,l,u);z+=1}}for(t=S*3,i=Math.max(f.length,P*3);t<i;t++)f[t]=0;for(t=A*3,i=Math.max(m.length,L*3);t<i;t++)m[t]=0;for(t=C*3,i=Math.max(E.length,O*3);t<i;t++)E[t]=0;for(t=z*3,i=Math.max(k.length,D*3);t<i;t++)k[t]=0;for(t=z*3,i=Math.max(H.length,D*3);t<i;t++)H[t]=0;p.directional.length=S;p.point.length=A;p.spot.length=C;p.hemi.length=z;p.ambient[0]=n;p.ambient[1]=a;p.ambient[2]=o}this.setFaceCulling=function(e,t){if(e===THREE.CullFaceNone){V.disable(V.CULL_FACE)}else{if(t===THREE.FrontFaceDirectionCW){V.frontFace(V.CW)}else{V.frontFace(V.CCW)}if(e===THREE.CullFaceBack){V.cullFace(V.BACK)}else if(e===THREE.CullFaceFront){V.cullFace(V.FRONT)}else{V.cullFace(V.FRONT_AND_BACK)}V.enable(V.CULL_FACE)}};this.setMaterialFaces=function(e){j.setDoubleSided(e.side===THREE.DoubleSide);j.setFlipSided(e.side===THREE.BackSide)};function wt(e,t,i){var r;if(i){V.texParameteri(e,V.TEXTURE_WRAP_S,Mt(t.wrapS));V.texParameteri(e,V.TEXTURE_WRAP_T,Mt(t.wrapT));V.texParameteri(e,V.TEXTURE_MAG_FILTER,Mt(t.magFilter));V.texParameteri(e,V.TEXTURE_MIN_FILTER,Mt(t.minFilter))}else{V.texParameteri(e,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE);V.texParameteri(e,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE);if(t.wrapS!==THREE.ClampToEdgeWrapping||t.wrapT!==THREE.ClampToEdgeWrapping){THREE.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+t.sourceFile+" )")}V.texParameteri(e,V.TEXTURE_MAG_FILTER,Ht(t.magFilter));V.texParameteri(e,V.TEXTURE_MIN_FILTER,Ht(t.minFilter));if(t.minFilter!==THREE.NearestFilter&&t.minFilter!==THREE.LinearFilter){THREE.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+t.sourceFile+" )")}}r=G.get("EXT_texture_filter_anisotropic");if(r&&t.type!==THREE.FloatType&&t.type!==THREE.HalfFloatType){if(t.anisotropy>1||t.__currentAnisotropy){V.texParameterf(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,b.getMaxAnisotropy()));t.__currentAnisotropy=t.anisotropy}}}this.uploadTexture=function(e){if(e.__webglInit===undefined){e.__webglInit=true;e.addEventListener("dispose",me);e.__webglTexture=V.createTexture();b.info.memory.textures++}V.bindTexture(V.TEXTURE_2D,e.__webglTexture);V.pixelStorei(V.UNPACK_FLIP_Y_WEBGL,e.flipY);V.pixelStorei(V.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha);V.pixelStorei(V.UNPACK_ALIGNMENT,e.unpackAlignment);e.image=bt(e.image,K);var t=e.image,i=THREE.Math.isPowerOfTwo(t.width)&&THREE.Math.isPowerOfTwo(t.height),r=Mt(e.format),n=Mt(e.type);wt(V.TEXTURE_2D,e,i);var a,o=e.mipmaps;if(e instanceof THREE.DataTexture){if(o.length>0&&i){for(var s=0,h=o.length;s<h;s++){a=o[s];V.texImage2D(V.TEXTURE_2D,s,r,a.width,a.height,0,r,n,a.data)}e.generateMipmaps=false}else{V.texImage2D(V.TEXTURE_2D,0,r,t.width,t.height,0,r,n,t.data)}}else if(e instanceof THREE.CompressedTexture){for(var s=0,h=o.length;s<h;s++){a=o[s];if(e.format!==THREE.RGBAFormat&&e.format!==THREE.RGBFormat){if(ne().indexOf(r)>-1){V.compressedTexImage2D(V.TEXTURE_2D,s,r,a.width,a.height,0,a.data)}else{THREE.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()")}}else{V.texImage2D(V.TEXTURE_2D,s,r,a.width,a.height,0,r,n,a.data)}}}else{if(o.length>0&&i){for(var s=0,h=o.length;s<h;s++){a=o[s];V.texImage2D(V.TEXTURE_2D,s,r,r,n,a)}e.generateMipmaps=false}else{V.texImage2D(V.TEXTURE_2D,0,r,r,n,e.image)}}if(e.generateMipmaps&&i)V.generateMipmap(V.TEXTURE_2D);e.needsUpdate=false;if(e.onUpdate)e.onUpdate()};this.setTexture=function(e,t){V.activeTexture(V.TEXTURE0+t);if(e.needsUpdate){b.uploadTexture(e)}else{V.bindTexture(V.TEXTURE_2D,e.__webglTexture)}};function bt(e,t){if(e.width>t||e.height>t){var i=t/Math.max(e.width,e.height);var r=document.createElement("canvas");r.width=Math.floor(e.width*i);r.height=Math.floor(e.height*i);var n=r.getContext("2d");n.drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height);THREE.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+r.width+"x"+r.height,e);return r}return e}function _t(e,t){if(e.image.length===6){if(e.needsUpdate){if(!e.image.__webglTextureCube){e.addEventListener("dispose",me);e.image.__webglTextureCube=V.createTexture();b.info.memory.textures++}V.activeTexture(V.TEXTURE0+t);V.bindTexture(V.TEXTURE_CUBE_MAP,e.image.__webglTextureCube);V.pixelStorei(V.UNPACK_FLIP_Y_WEBGL,e.flipY);var i=e instanceof THREE.CompressedTexture;var r=e.image[0]instanceof THREE.DataTexture;var n=[];for(var a=0;a<6;a++){if(b.autoScaleCubemaps&&!i&&!r){n[a]=bt(e.image[a],Q)}else{n[a]=r?e.image[a].image:e.image[a]}}var o=n[0],s=THREE.Math.isPowerOfTwo(o.width)&&THREE.Math.isPowerOfTwo(o.height),h=Mt(e.format),l=Mt(e.type);wt(V.TEXTURE_CUBE_MAP,e,s);for(var a=0;a<6;a++){if(!i){if(r){V.texImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,h,n[a].width,n[a].height,0,h,l,n[a].data)}else{V.texImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,h,h,l,n[a])}}else{var u,c=n[a].mipmaps;for(var p=0,f=c.length;p<f;p++){u=c[p];if(e.format!==THREE.RGBAFormat&&e.format!==THREE.RGBFormat){if(ne().indexOf(h)>-1){V.compressedTexImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+a,p,h,u.width,u.height,0,u.data)}else{THREE.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()")}}else{V.texImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+a,p,h,u.width,u.height,0,h,l,u.data)}}}}if(e.generateMipmaps&&s){V.generateMipmap(V.TEXTURE_CUBE_MAP)}e.needsUpdate=false;if(e.onUpdate)e.onUpdate()}else{V.activeTexture(V.TEXTURE0+t);V.bindTexture(V.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}}}function xt(e,t){V.activeTexture(V.TEXTURE0+t);V.bindTexture(V.TEXTURE_CUBE_MAP,e.__webglTexture)}function Tt(e,t,i){V.bindFramebuffer(V.FRAMEBUFFER,e);V.framebufferTexture2D(V.FRAMEBUFFER,V.COLOR_ATTACHMENT0,i,t.__webglTexture,0)}function Rt(e,t){V.bindRenderbuffer(V.RENDERBUFFER,e);if(t.depthBuffer&&!t.stencilBuffer){V.renderbufferStorage(V.RENDERBUFFER,V.DEPTH_COMPONENT16,t.width,t.height);V.framebufferRenderbuffer(V.FRAMEBUFFER,V.DEPTH_ATTACHMENT,V.RENDERBUFFER,e)}else if(t.depthBuffer&&t.stencilBuffer){V.renderbufferStorage(V.RENDERBUFFER,V.DEPTH_STENCIL,t.width,t.height);V.framebufferRenderbuffer(V.FRAMEBUFFER,V.DEPTH_STENCIL_ATTACHMENT,V.RENDERBUFFER,e)}else{V.renderbufferStorage(V.RENDERBUFFER,V.RGBA4,t.width,t.height)}}this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&e.__webglFramebuffer===undefined){if(e.depthBuffer===undefined)e.depthBuffer=true;if(e.stencilBuffer===undefined)e.stencilBuffer=true;e.addEventListener("dispose",ge);e.__webglTexture=V.createTexture();b.info.memory.textures++;var i=THREE.Math.isPowerOfTwo(e.width)&&THREE.Math.isPowerOfTwo(e.height),r=Mt(e.format),n=Mt(e.type);if(t){e.__webglFramebuffer=[];e.__webglRenderbuffer=[];V.bindTexture(V.TEXTURE_CUBE_MAP,e.__webglTexture);wt(V.TEXTURE_CUBE_MAP,e,i);for(var a=0;a<6;a++){e.__webglFramebuffer[a]=V.createFramebuffer();e.__webglRenderbuffer[a]=V.createRenderbuffer();V.texImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,r,e.width,e.height,0,r,n,null);Tt(e.__webglFramebuffer[a],e,V.TEXTURE_CUBE_MAP_POSITIVE_X+a);Rt(e.__webglRenderbuffer[a],e)}if(i)V.generateMipmap(V.TEXTURE_CUBE_MAP)}else{e.__webglFramebuffer=V.createFramebuffer();if(e.shareDepthFrom){e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer}else{e.__webglRenderbuffer=V.createRenderbuffer()}V.bindTexture(V.TEXTURE_2D,e.__webglTexture);wt(V.TEXTURE_2D,e,i);V.texImage2D(V.TEXTURE_2D,0,r,e.width,e.height,0,r,n,null);Tt(e.__webglFramebuffer,e,V.TEXTURE_2D);if(e.shareDepthFrom){if(e.depthBuffer&&!e.stencilBuffer){V.framebufferRenderbuffer(V.FRAMEBUFFER,V.DEPTH_ATTACHMENT,V.RENDERBUFFER,e.__webglRenderbuffer)}else if(e.depthBuffer&&e.stencilBuffer){V.framebufferRenderbuffer(V.FRAMEBUFFER,V.DEPTH_STENCIL_ATTACHMENT,V.RENDERBUFFER,e.__webglRenderbuffer)}}else{Rt(e.__webglRenderbuffer,e)}if(i)V.generateMipmap(V.TEXTURE_2D)}if(t){V.bindTexture(V.TEXTURE_CUBE_MAP,null)}else{V.bindTexture(V.TEXTURE_2D,null)}V.bindRenderbuffer(V.RENDERBUFFER,null);V.bindFramebuffer(V.FRAMEBUFFER,null)}var o,s,h,l,u;if(e){if(t){o=e.__webglFramebuffer[e.activeCubeFace]}else{o=e.__webglFramebuffer}s=e.width;h=e.height;l=0;u=0}else{o=null;s=C;h=z;l=S;u=A}if(o!==T){V.bindFramebuffer(V.FRAMEBUFFER,o);V.viewport(l,u,s,h);T=o}P=s;L=h};this.readRenderTargetPixels=function(e,t,i,r,n,a){if(!(e instanceof THREE.WebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}if(e.__webglFramebuffer){if(e.format!==THREE.RGBAFormat){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.");return}var o=false;if(e.__webglFramebuffer!==T){V.bindFramebuffer(V.FRAMEBUFFER,e.__webglFramebuffer);o=true}if(V.checkFramebufferStatus(V.FRAMEBUFFER)===V.FRAMEBUFFER_COMPLETE){V.readPixels(t,i,r,n,V.RGBA,V.UNSIGNED_BYTE,a)}else{console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}if(o){V.bindFramebuffer(V.FRAMEBUFFER,T)}}};function kt(e){if(e instanceof THREE.WebGLRenderTargetCube){V.bindTexture(V.TEXTURE_CUBE_MAP,e.__webglTexture);V.generateMipmap(V.TEXTURE_CUBE_MAP);V.bindTexture(V.TEXTURE_CUBE_MAP,null)}else{V.bindTexture(V.TEXTURE_2D,e.__webglTexture);V.generateMipmap(V.TEXTURE_2D);V.bindTexture(V.TEXTURE_2D,null)}}function Ht(e){if(e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter){return V.NEAREST}return V.LINEAR}function Mt(e){var t;if(e===THREE.RepeatWrapping)return V.REPEAT;if(e===THREE.ClampToEdgeWrapping)return V.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return V.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return V.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return V.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return V.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return V.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return V.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return V.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return V.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return V.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return V.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return V.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return V.BYTE;if(e===THREE.ShortType)return V.SHORT;if(e===THREE.UnsignedShortType)return V.UNSIGNED_SHORT;if(e===THREE.IntType)return V.INT;if(e===THREE.UnsignedIntType)return V.UNSIGNED_INT;if(e===THREE.FloatType)return V.FLOAT;t=G.get("OES_texture_half_float");if(t!==null){if(e===THREE.HalfFloatType)return t.HALF_FLOAT_OES}if(e===THREE.AlphaFormat)return V.ALPHA;if(e===THREE.RGBFormat)return V.RGB;if(e===THREE.RGBAFormat)return V.RGBA;if(e===THREE.LuminanceFormat)return V.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return V.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return V.FUNC_ADD;if(e===THREE.SubtractEquation)return V.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return V.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return V.ZERO;if(e===THREE.OneFactor)return V.ONE;if(e===THREE.SrcColorFactor)return V.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return V.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return V.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return V.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return V.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return V.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return V.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return V.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return V.SRC_ALPHA_SATURATE;t=G.get("WEBGL_compressed_texture_s3tc");if(t!==null){if(e===THREE.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}t=G.get("WEBGL_compressed_texture_pvrtc");if(t!==null){if(e===THREE.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===THREE.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===THREE.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===THREE.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}t=G.get("EXT_blend_minmax");if(t!==null){if(e===THREE.MinEquation)return t.MIN_EXT;if(e===THREE.MaxEquation)return t.MAX_EXT}return 0}function St(e){if($&&e&&e.skeleton&&e.skeleton.useVertexTexture){return 1024}else{var t=V.getParameter(V.MAX_VERTEX_UNIFORM_VECTORS);var i=Math.floor((t-20)/4);var r=i;if(e!==undefined&&e instanceof THREE.SkinnedMesh){r=Math.min(e.skeleton.bones.length,r);if(r<e.skeleton.bones.length){THREE.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)")}}return r}}function At(e){var t=0;var i=0;var r=0;var n=0;for(var a=0,o=e.length;a<o;a++){var s=e[a];if(s.onlyShadow||s.visible===false)continue;if(s instanceof THREE.DirectionalLight)t++;if(s instanceof THREE.PointLight)i++;if(s instanceof THREE.SpotLight)r++;if(s instanceof THREE.HemisphereLight)n++}return{directional:t,point:i,spot:r,hemi:n}}function Ct(e){var t=0;for(var i=0,r=e.length;i<r;i++){var n=e[i];if(!n.castShadow)continue;if(n instanceof THREE.SpotLight)t++;if(n instanceof THREE.DirectionalLight&&!n.shadowCascade)t++}return t}this.initMaterial=function(){THREE.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};this.addPrePlugin=function(){THREE.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};this.addPostPlugin=function(){THREE.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};this.updateShadowMap=function(){THREE.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}};THREE.WebGLRenderTarget=function(e,t,i){this.width=e;this.height=t;i=i||{};this.wrapS=i.wrapS!==undefined?i.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=i.wrapT!==undefined?i.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=i.magFilter!==undefined?i.magFilter:THREE.LinearFilter;this.minFilter=i.minFilter!==undefined?i.minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=i.anisotropy!==undefined?i.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=i.format!==undefined?i.format:THREE.RGBAFormat;this.type=i.type!==undefined?i.type:THREE.UnsignedByteType;this.depthBuffer=i.depthBuffer!==undefined?i.depthBuffer:true;this.stencilBuffer=i.stencilBuffer!==undefined?i.stencilBuffer:true;this.generateMipmaps=true;this.shareDepthFrom=i.shareDepthFrom!==undefined?i.shareDepthFrom:null};THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,setSize:function(e,t){this.width=e;this.height=t},clone:function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);e.wrapS=this.wrapS;e.wrapT=this.wrapT;e.magFilter=this.magFilter;e.minFilter=this.minFilter;e.anisotropy=this.anisotropy;e.offset.copy(this.offset);e.repeat.copy(this.repeat);e.format=this.format;e.type=this.type;e.depthBuffer=this.depthBuffer;e.stencilBuffer=this.stencilBuffer;e.generateMipmaps=this.generateMipmaps;e.shareDepthFrom=this.shareDepthFrom;return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube=function(e,t,i){THREE.WebGLRenderTarget.call(this,e,t,i);this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube;THREE.WebGLExtensions=function(e){var t={};this.get=function(i){if(t[i]!==undefined){return t[i]}var r;switch(i){case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(i)}if(r===null){THREE.warn("THREE.WebGLRenderer: "+i+" extension not supported.")}t[i]=r;return r}};THREE.WebGLProgram=function(){var e=0;var t=function(e){var t,i,r=[];for(var n in e){t=e[n];if(t===false)continue;i="#define "+n+" "+t;r.push(i)}return r.join("\n")};var i=function(e,t,i){var r={};for(var n=0,a=i.length;n<a;n++){var o=i[n];r[o]=e.getUniformLocation(t,o)}return r};var r=function(e,t,i){var r={};for(var n=0,a=i.length;n<a;n++){var o=i[n];r[o]=e.getAttribLocation(t,o)}return r};return function(n,a,o,s){var h=n;var l=h.context;var u=o.defines;var c=o.__webglShader.uniforms;var p=o.attributes;var f=o.__webglShader.vertexShader;var d=o.__webglShader.fragmentShader;var m=o.index0AttributeName;if(m===undefined&&s.morphTargets===true){m="position"}var g="SHADOWMAP_TYPE_BASIC";if(s.shadowMapType===THREE.PCFShadowMap){g="SHADOWMAP_TYPE_PCF"}else if(s.shadowMapType===THREE.PCFSoftShadowMap){g="SHADOWMAP_TYPE_PCF_SOFT"}var v="ENVMAP_TYPE_CUBE";var y="ENVMAP_MODE_REFLECTION";var E="ENVMAP_BLENDING_MULTIPLY";if(s.envMap){switch(o.envMap.mapping){case THREE.CubeReflectionMapping:case THREE.CubeRefractionMapping:v="ENVMAP_TYPE_CUBE";break;case THREE.EquirectangularReflectionMapping:case THREE.EquirectangularRefractionMapping:v="ENVMAP_TYPE_EQUIREC";break;case THREE.SphericalReflectionMapping:v="ENVMAP_TYPE_SPHERE";break}switch(o.envMap.mapping){case THREE.CubeRefractionMapping:case THREE.EquirectangularRefractionMapping:y="ENVMAP_MODE_REFRACTION";break}switch(o.combine){case THREE.MultiplyOperation:E="ENVMAP_BLENDING_MULTIPLY";break;case THREE.MixOperation:E="ENVMAP_BLENDING_MIX";break;case THREE.AddOperation:E="ENVMAP_BLENDING_ADD";break}}var w=n.gammaFactor>0?n.gammaFactor:1;var b=t(u);var _=l.createProgram();var x,T;if(o instanceof THREE.RawShaderMaterial){x="";T=""}else{x=["precision "+s.precision+" float;","precision "+s.precision+" int;",b,s.supportsVertexTextures?"#define VERTEX_TEXTURES":"",h.gammaInput?"#define GAMMA_INPUT":"",h.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+w,"#define MAX_DIR_LIGHTS "+s.maxDirLights,"#define MAX_POINT_LIGHTS "+s.maxPointLights,"#define MAX_SPOT_LIGHTS "+s.maxSpotLights,"#define MAX_HEMI_LIGHTS "+s.maxHemiLights,"#define MAX_SHADOWS "+s.maxShadows,"#define MAX_BONES "+s.maxBones,s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.envMap?"#define "+y:"",s.lightMap?"#define USE_LIGHTMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.alphaMap?"#define USE_ALPHAMAP":"",s.vertexColors?"#define USE_COLOR":"",s.flatShading?"#define FLAT_SHADED":"",s.skinning?"#define USE_SKINNING":"",s.useVertexTexture?"#define BONE_TEXTURE":"",s.morphTargets?"#define USE_MORPHTARGETS":"",s.morphNormals?"#define USE_MORPHNORMALS":"",s.wrapAround?"#define WRAP_AROUND":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+g:"",s.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",s.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",s.sizeAttenuation?"#define USE_SIZEATTENUATION":"",s.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif",""].join("\n");T=["precision "+s.precision+" float;","precision "+s.precision+" int;",s.bumpMap||s.normalMap||s.flatShading?"#extension GL_OES_standard_derivatives : enable":"",b,"#define MAX_DIR_LIGHTS "+s.maxDirLights,"#define MAX_POINT_LIGHTS "+s.maxPointLights,"#define MAX_SPOT_LIGHTS "+s.maxSpotLights,"#define MAX_HEMI_LIGHTS "+s.maxHemiLights,"#define MAX_SHADOWS "+s.maxShadows,s.alphaTest?"#define ALPHATEST "+s.alphaTest:"",h.gammaInput?"#define GAMMA_INPUT":"",h.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+w,s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp?"#define FOG_EXP2":"",s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.envMap?"#define "+v:"",s.envMap?"#define "+y:"",s.envMap?"#define "+E:"",s.lightMap?"#define USE_LIGHTMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.alphaMap?"#define USE_ALPHAMAP":"",s.vertexColors?"#define USE_COLOR":"",s.flatShading?"#define FLAT_SHADED":"",s.metal?"#define METAL":"",s.wrapAround?"#define WRAP_AROUND":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+g:"",s.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",s.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",s.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n")}var R=new THREE.WebGLShader(l,l.VERTEX_SHADER,x+f);var k=new THREE.WebGLShader(l,l.FRAGMENT_SHADER,T+d);l.attachShader(_,R);l.attachShader(_,k);if(m!==undefined){l.bindAttribLocation(_,0,m)}l.linkProgram(_);var H=l.getProgramInfoLog(_);if(l.getProgramParameter(_,l.LINK_STATUS)===false){THREE.error("THREE.WebGLProgram: shader error: "+l.getError(),"gl.VALIDATE_STATUS",l.getProgramParameter(_,l.VALIDATE_STATUS),"gl.getPRogramInfoLog",H)}if(H!==""){THREE.warn("THREE.WebGLProgram: gl.getProgramInfoLog()"+H)}l.deleteShader(R);l.deleteShader(k);var M=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];if(s.useVertexTexture){M.push("boneTexture");M.push("boneTextureWidth");M.push("boneTextureHeight")}else{M.push("boneGlobalMatrices")}if(s.logarithmicDepthBuffer){M.push("logDepthBufFC")}for(var S in c){M.push(S)}this.uniforms=i(l,_,M);M=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var A=0;A<s.maxMorphTargets;A++){M.push("morphTarget"+A)}for(var A=0;A<s.maxMorphNormals;A++){M.push("morphNormal"+A)}for(var C in p){M.push(C)}this.attributes=r(l,_,M);this.attributesKeys=Object.keys(this.attributes);this.id=e++;this.code=a;this.usedTimes=1;this.program=_;this.vertexShader=R;this.fragmentShader=k;return this}}();THREE.WebGLShader=function(){var e=function(e){var t=e.split("\n");for(var i=0;i<t.length;i++){t[i]=i+1+": "+t[i]}return t.join("\n")};return function(t,i,r){var n=t.createShader(i);t.shaderSource(n,r);t.compileShader(n);if(t.getShaderParameter(n,t.COMPILE_STATUS)===false){THREE.error("THREE.WebGLShader: Shader couldn't compile.")}if(t.getShaderInfoLog(n)!==""){THREE.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t.getShaderInfoLog(n),e(r))}return n}}();THREE.WebGLState=function(e,t){var i=new Uint8Array(16);var r=new Uint8Array(16);var n=null;var a=null;var o=null;var s=null;var h=null;var l=null;var u=null;var c=null;var p=null;var f=null;var d=null;var m=null;var g=null;var v=null;var y=null;var E=null;this.initAttributes=function(){for(var e=0,t=i.length;e<t;e++){i[e]=0}};this.enableAttribute=function(t){i[t]=1;if(r[t]===0){e.enableVertexAttribArray(t);r[t]=1}};this.disableUnusedAttributes=function(){for(var t=0,n=r.length;t<n;t++){if(r[t]!==i[t]){e.disableVertexAttribArray(t);r[t]=0}}};this.setBlending=function(i,r,c,p,f,d,m){if(i!==n){if(i===THREE.NoBlending){e.disable(e.BLEND)}else if(i===THREE.AdditiveBlending){e.enable(e.BLEND);e.blendEquation(e.FUNC_ADD);e.blendFunc(e.SRC_ALPHA,e.ONE)}else if(i===THREE.SubtractiveBlending){e.enable(e.BLEND);e.blendEquation(e.FUNC_ADD);e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)}else if(i===THREE.MultiplyBlending){e.enable(e.BLEND);e.blendEquation(e.FUNC_ADD);e.blendFunc(e.ZERO,e.SRC_COLOR)}else if(i===THREE.CustomBlending){e.enable(e.BLEND)}else{e.enable(e.BLEND);e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD);e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)}n=i}if(i===THREE.CustomBlending){f=f||r;d=d||c;m=m||p;if(r!==a||f!==h){e.blendEquationSeparate(t(r),t(f));a=r;h=f}if(c!==o||p!==s||d!==l||m!==u){e.blendFuncSeparate(t(c),t(p),t(d),t(m));o=c;s=p;l=d;u=m}}else{a=null;o=null;s=null;h=null;l=null;u=null}};this.setDepthTest=function(t){if(c!==t){if(t){e.enable(e.DEPTH_TEST)}else{e.disable(e.DEPTH_TEST)}c=t}};this.setDepthWrite=function(t){if(p!==t){e.depthMask(t);p=t}};this.setColorWrite=function(t){if(f!==t){e.colorMask(t,t,t,t);f=t}};this.setDoubleSided=function(t){if(d!==t){if(t){e.disable(e.CULL_FACE)}else{e.enable(e.CULL_FACE)}d=t}};this.setFlipSided=function(t){if(m!==t){if(t){e.frontFace(e.CW)}else{e.frontFace(e.CCW)}m=t}};this.setLineWidth=function(t){if(t!==g){e.lineWidth(t);g=t}};this.setPolygonOffset=function(t,i,r){if(v!==t){if(t){e.enable(e.POLYGON_OFFSET_FILL)}else{e.disable(e.POLYGON_OFFSET_FILL)}v=t}if(t&&(y!==i||E!==r)){e.polygonOffset(i,r);y=i;E=r}};this.reset=function(){for(var e=0;e<r.length;e++){r[e]=0}n=null;c=null;p=null;f=null;d=null;m=null}};THREE.LensFlarePlugin=function(e,t){var i=e.context;var r,n;var a,o,s;var h;var l,u;var c=function(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]);var t=new Uint16Array([0,1,2,0,2,3]);r=i.createBuffer();n=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,r);i.bufferData(i.ARRAY_BUFFER,e,i.STATIC_DRAW);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n);i.bufferData(i.ELEMENT_ARRAY_BUFFER,t,i.STATIC_DRAW);l=i.createTexture();u=i.createTexture();i.bindTexture(i.TEXTURE_2D,l);i.texImage2D(i.TEXTURE_2D,0,i.RGB,16,16,0,i.RGB,i.UNSIGNED_BYTE,null);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST);i.bindTexture(i.TEXTURE_2D,u);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,16,16,0,i.RGBA,i.UNSIGNED_BYTE,null);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST);h=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var c;if(h){c={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}else{c={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}a=p(c);o={vertex:i.getAttribLocation(a,"position"),uv:i.getAttribLocation(a,"uv")};s={renderType:i.getUniformLocation(a,"renderType"),map:i.getUniformLocation(a,"map"),occlusionMap:i.getUniformLocation(a,"occlusionMap"),opacity:i.getUniformLocation(a,"opacity"),color:i.getUniformLocation(a,"color"),scale:i.getUniformLocation(a,"scale"),rotation:i.getUniformLocation(a,"rotation"),screenPosition:i.getUniformLocation(a,"screenPosition")}};this.render=function(p,f,d,m){if(t.length===0)return;var g=new THREE.Vector3;var v=m/d,y=d*.5,E=m*.5;var w=16/m,b=new THREE.Vector2(w*v,w);var _=new THREE.Vector3(1,1,0),x=new THREE.Vector2(1,1);if(a===undefined){c()}i.useProgram(a);i.enableVertexAttribArray(o.vertex);i.enableVertexAttribArray(o.uv);i.uniform1i(s.occlusionMap,0);i.uniform1i(s.map,1);i.bindBuffer(i.ARRAY_BUFFER,r);i.vertexAttribPointer(o.vertex,2,i.FLOAT,false,2*8,0);i.vertexAttribPointer(o.uv,2,i.FLOAT,false,2*8,8);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n);i.disable(i.CULL_FACE);i.depthMask(false);for(var T=0,R=t.length;T<R;T++){w=16/m;b.set(w*v,w);var k=t[T];g.set(k.matrixWorld.elements[12],k.matrixWorld.elements[13],k.matrixWorld.elements[14]);g.applyMatrix4(f.matrixWorldInverse);g.applyProjection(f.projectionMatrix);_.copy(g);x.x=_.x*y+y;x.y=_.y*E+E;if(h||x.x>0&&x.x<d&&x.y>0&&x.y<m){i.activeTexture(i.TEXTURE1);i.bindTexture(i.TEXTURE_2D,l);i.copyTexImage2D(i.TEXTURE_2D,0,i.RGB,x.x-8,x.y-8,16,16,0);i.uniform1i(s.renderType,0);i.uniform2f(s.scale,b.x,b.y);i.uniform3f(s.screenPosition,_.x,_.y,_.z);i.disable(i.BLEND);i.enable(i.DEPTH_TEST);i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0);i.activeTexture(i.TEXTURE0);i.bindTexture(i.TEXTURE_2D,u);i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,x.x-8,x.y-8,16,16,0);i.uniform1i(s.renderType,1);i.disable(i.DEPTH_TEST);i.activeTexture(i.TEXTURE1);i.bindTexture(i.TEXTURE_2D,l);i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0);k.positionScreen.copy(_);if(k.customUpdateCallback){k.customUpdateCallback(k)}else{k.updateLensFlares()}i.uniform1i(s.renderType,2);i.enable(i.BLEND);for(var H=0,M=k.lensFlares.length;H<M;H++){var S=k.lensFlares[H];if(S.opacity>.001&&S.scale>.001){_.x=S.x;_.y=S.y;_.z=S.z;w=S.size*S.scale/m;b.x=w*v;b.y=w;i.uniform3f(s.screenPosition,_.x,_.y,_.z);i.uniform2f(s.scale,b.x,b.y);i.uniform1f(s.rotation,S.rotation);i.uniform1f(s.opacity,S.opacity);i.uniform3f(s.color,S.color.r,S.color.g,S.color.b);e.state.setBlending(S.blending,S.blendEquation,S.blendSrc,S.blendDst);e.setTexture(S.texture,1);i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0)}}}}i.enable(i.CULL_FACE);i.enable(i.DEPTH_TEST);i.depthMask(true);e.resetGLState()};function p(t){var r=i.createProgram();var n=i.createShader(i.FRAGMENT_SHADER);var a=i.createShader(i.VERTEX_SHADER);var o="precision "+e.getPrecision()+" float;\n";i.shaderSource(n,o+t.fragmentShader);i.shaderSource(a,o+t.vertexShader);i.compileShader(n);i.compileShader(a);i.attachShader(r,n);i.attachShader(r,a);i.linkProgram(r);return r}};THREE.ShadowMapPlugin=function(e,t,i,r){var n=e.context;var a,o,s,h,l=new THREE.Frustum,u=new THREE.Matrix4,c=new THREE.Vector3,p=new THREE.Vector3,f=new THREE.Vector3,d=[];var m=THREE.ShaderLib["depthRGBA"];var g=THREE.UniformsUtils.clone(m.uniforms);a=new THREE.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader});o=new THREE.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,morphTargets:true});s=new THREE.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,skinning:true});h=new THREE.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,morphTargets:true,skinning:true});a._shadowPass=true;o._shadowPass=true;s._shadowPass=true;h._shadowPass=true;this.render=function(i,c){if(e.shadowMapEnabled===false)return;var p,m,g,_,x,T,R,k,H,M,S,A,C,z=[],P=0,L=null;n.clearColor(1,1,1,1);n.disable(n.BLEND);n.enable(n.CULL_FACE);n.frontFace(n.CCW);if(e.shadowMapCullFace===THREE.CullFaceFront){n.cullFace(n.FRONT)}else{n.cullFace(n.BACK)}e.state.setDepthTest(true);for(p=0,m=t.length;p<m;p++){C=t[p];if(!C.castShadow)continue;if(C instanceof THREE.DirectionalLight&&C.shadowCascade){for(x=0;x<C.shadowCascadeCount;x++){var O;if(!C.shadowCascadeArray[x]){O=y(C,x);O.originalCamera=c;var D=new THREE.Gyroscope;D.position.copy(C.shadowCascadeOffset);D.add(O);D.add(O.target);c.add(D);C.shadowCascadeArray[x]=O}else{O=C.shadowCascadeArray[x]}E(C,x);z[P]=O;P++}}else{z[P]=C;P++}}for(p=0,m=z.length;p<m;p++){C=z[p];if(!C.shadowMap){var F=THREE.LinearFilter;if(e.shadowMapType===THREE.PCFSoftShadowMap){F=THREE.NearestFilter}var B={minFilter:F,magFilter:F,format:THREE.RGBAFormat};C.shadowMap=new THREE.WebGLRenderTarget(C.shadowMapWidth,C.shadowMapHeight,B);C.shadowMapSize=new THREE.Vector2(C.shadowMapWidth,C.shadowMapHeight);C.shadowMatrix=new THREE.Matrix4}if(!C.shadowCamera){if(C instanceof THREE.SpotLight){C.shadowCamera=new THREE.PerspectiveCamera(C.shadowCameraFov,C.shadowMapWidth/C.shadowMapHeight,C.shadowCameraNear,C.shadowCameraFar)}else if(C instanceof THREE.DirectionalLight){C.shadowCamera=new THREE.OrthographicCamera(C.shadowCameraLeft,C.shadowCameraRight,C.shadowCameraTop,C.shadowCameraBottom,C.shadowCameraNear,C.shadowCameraFar)}else{THREE.error("THREE.ShadowMapPlugin: Unsupported light type for shadow",C);continue}i.add(C.shadowCamera);if(i.autoUpdate===true)i.updateMatrixWorld()}if(C.shadowCameraVisible&&!C.cameraHelper){C.cameraHelper=new THREE.CameraHelper(C.shadowCamera);i.add(C.cameraHelper)}if(C.isVirtual&&O.originalCamera==c){w(c,C)}T=C.shadowMap;R=C.shadowMatrix;k=C.shadowCamera;k.position.setFromMatrixPosition(C.matrixWorld);f.setFromMatrixPosition(C.target.matrixWorld);k.lookAt(f);k.updateMatrixWorld();k.matrixWorldInverse.getInverse(k.matrixWorld);if(C.cameraHelper)C.cameraHelper.visible=C.shadowCameraVisible;if(C.shadowCameraVisible)C.cameraHelper.update();R.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);R.multiply(k.projectionMatrix);R.multiply(k.matrixWorldInverse);u.multiplyMatrices(k.projectionMatrix,k.matrixWorldInverse);l.setFromMatrix(u);e.setRenderTarget(T);e.clear();d.length=0;v(i,i,k);var U,N,V;for(g=0,_=d.length;g<_;g++){S=d[g];A=S.object;H=S.buffer;U=b(A);N=A.geometry.morphTargets!==undefined&&A.geometry.morphTargets.length>0&&U.morphTargets;V=A instanceof THREE.SkinnedMesh&&U.skinning;if(A.customDepthMaterial){M=A.customDepthMaterial}else if(V){M=N?h:s}else if(N){M=o}else{M=a}e.setMaterialFaces(U);if(H instanceof THREE.BufferGeometry){e.renderBufferDirect(k,t,L,M,H,A)}else{e.renderBuffer(k,t,L,M,H,A)}}for(g=0,_=r.length;g<_;g++){S=r[g];A=S.object;if(A.visible&&A.castShadow){A._modelViewMatrix.multiplyMatrices(k.matrixWorldInverse,A.matrixWorld);e.renderImmediateObject(k,t,L,a,A)}}}var I=e.getClearColor(),j=e.getClearAlpha();n.clearColor(I.r,I.g,I.b,j);n.enable(n.BLEND);if(e.shadowMapCullFace===THREE.CullFaceFront){n.cullFace(n.BACK)}e.resetGLState()};function v(e,t,r){if(t.visible){var n=i[t.id];if(n&&t.castShadow&&(t.frustumCulled===false||l.intersectsObject(t)===true)){for(var a=0,o=n.length;a<o;a++){var s=n[a];t._modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld);d.push(s)}}for(var a=0,o=t.children.length;a<o;a++){v(e,t.children[a],r)}}}function y(e,t){var i=new THREE.DirectionalLight;i.isVirtual=true;i.onlyShadow=true;i.castShadow=true;i.shadowCameraNear=e.shadowCameraNear;i.shadowCameraFar=e.shadowCameraFar;i.shadowCameraLeft=e.shadowCameraLeft;i.shadowCameraRight=e.shadowCameraRight;i.shadowCameraBottom=e.shadowCameraBottom;i.shadowCameraTop=e.shadowCameraTop;i.shadowCameraVisible=e.shadowCameraVisible;i.shadowDarkness=e.shadowDarkness;i.shadowBias=e.shadowCascadeBias[t];i.shadowMapWidth=e.shadowCascadeWidth[t];i.shadowMapHeight=e.shadowCascadeHeight[t];i.pointsWorld=[];i.pointsFrustum=[];var r=i.pointsWorld,n=i.pointsFrustum;for(var a=0;a<8;a++){r[a]=new THREE.Vector3;n[a]=new THREE.Vector3}var o=e.shadowCascadeNearZ[t];var s=e.shadowCascadeFarZ[t];n[0].set(-1,-1,o);n[1].set(1,-1,o);n[2].set(-1,1,o);n[3].set(1,1,o);n[4].set(-1,-1,s);n[5].set(1,-1,s);n[6].set(-1,1,s);n[7].set(1,1,s);return i}function E(e,t){var i=e.shadowCascadeArray[t];i.position.copy(e.position);i.target.position.copy(e.target.position);i.lookAt(i.target);i.shadowCameraVisible=e.shadowCameraVisible;i.shadowDarkness=e.shadowDarkness;i.shadowBias=e.shadowCascadeBias[t];var r=e.shadowCascadeNearZ[t];var n=e.shadowCascadeFarZ[t];var a=i.pointsFrustum;a[0].z=r;a[1].z=r;a[2].z=r;a[3].z=r;a[4].z=n;a[5].z=n;a[6].z=n;a[7].z=n}function w(e,t){var i=t.shadowCamera,r=t.pointsFrustum,n=t.pointsWorld;c.set(Infinity,Infinity,Infinity);p.set(-Infinity,-Infinity,-Infinity);for(var a=0;a<8;a++){var o=n[a];o.copy(r[a]);o.unproject(e);o.applyMatrix4(i.matrixWorldInverse);if(o.x<c.x)c.x=o.x;if(o.x>p.x)p.x=o.x;if(o.y<c.y)c.y=o.y;if(o.y>p.y)p.y=o.y;if(o.z<c.z)c.z=o.z;if(o.z>p.z)p.z=o.z}i.left=c.x;i.right=p.x;i.top=p.y;i.bottom=c.y;i.updateProjectionMatrix()}function b(e){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[0]:e.material}};THREE.SpritePlugin=function(e,t){var i=e.context;var r,n;var a,o,s;var h;var l=new THREE.Vector3;var u=new THREE.Quaternion;var c=new THREE.Vector3;var p=function(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]);var t=new Uint16Array([0,1,2,0,2,3]);r=i.createBuffer();n=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,r);i.bufferData(i.ARRAY_BUFFER,e,i.STATIC_DRAW);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n);i.bufferData(i.ELEMENT_ARRAY_BUFFER,t,i.STATIC_DRAW);a=f();o={position:i.getAttribLocation(a,"position"),uv:i.getAttribLocation(a,"uv")};s={uvOffset:i.getUniformLocation(a,"uvOffset"),uvScale:i.getUniformLocation(a,"uvScale"),rotation:i.getUniformLocation(a,"rotation"),scale:i.getUniformLocation(a,"scale"),color:i.getUniformLocation(a,"color"),map:i.getUniformLocation(a,"map"),opacity:i.getUniformLocation(a,"opacity"),modelViewMatrix:i.getUniformLocation(a,"modelViewMatrix"),projectionMatrix:i.getUniformLocation(a,"projectionMatrix"),fogType:i.getUniformLocation(a,"fogType"),fogDensity:i.getUniformLocation(a,"fogDensity"),fogNear:i.getUniformLocation(a,"fogNear"),fogFar:i.getUniformLocation(a,"fogFar"),fogColor:i.getUniformLocation(a,"fogColor"),alphaTest:i.getUniformLocation(a,"alphaTest")};var l=document.createElement("canvas");l.width=8;l.height=8;var u=l.getContext("2d");u.fillStyle="white";u.fillRect(0,0,8,8);h=new THREE.Texture(l);h.needsUpdate=true};this.render=function(f,m){if(t.length===0)return;if(a===undefined){p()}i.useProgram(a);i.enableVertexAttribArray(o.position);i.enableVertexAttribArray(o.uv);i.disable(i.CULL_FACE);i.enable(i.BLEND);i.bindBuffer(i.ARRAY_BUFFER,r);i.vertexAttribPointer(o.position,2,i.FLOAT,false,2*8,0);i.vertexAttribPointer(o.uv,2,i.FLOAT,false,2*8,8);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n);i.uniformMatrix4fv(s.projectionMatrix,false,m.projectionMatrix.elements);i.activeTexture(i.TEXTURE0);i.uniform1i(s.map,0);var g=0;var v=0;var y=f.fog;if(y){i.uniform3f(s.fogColor,y.color.r,y.color.g,y.color.b);if(y instanceof THREE.Fog){i.uniform1f(s.fogNear,y.near);i.uniform1f(s.fogFar,y.far);i.uniform1i(s.fogType,1);g=1;v=1}else if(y instanceof THREE.FogExp2){i.uniform1f(s.fogDensity,y.density);i.uniform1i(s.fogType,2);g=2;v=2}}else{i.uniform1i(s.fogType,0);g=0;v=0}for(var E=0,w=t.length;E<w;E++){var b=t[E];b._modelViewMatrix.multiplyMatrices(m.matrixWorldInverse,b.matrixWorld);b.z=-b._modelViewMatrix.elements[14]}t.sort(d);var _=[];for(var E=0,w=t.length;E<w;E++){var b=t[E];var x=b.material;i.uniform1f(s.alphaTest,x.alphaTest);i.uniformMatrix4fv(s.modelViewMatrix,false,b._modelViewMatrix.elements);b.matrixWorld.decompose(l,u,c);_[0]=c.x;_[1]=c.y;var T=0;if(f.fog&&x.fog){T=v}if(g!==T){i.uniform1i(s.fogType,T);g=T}if(x.map!==null){i.uniform2f(s.uvOffset,x.map.offset.x,x.map.offset.y);i.uniform2f(s.uvScale,x.map.repeat.x,x.map.repeat.y)}else{i.uniform2f(s.uvOffset,0,0);i.uniform2f(s.uvScale,1,1)}i.uniform1f(s.opacity,x.opacity);i.uniform3f(s.color,x.color.r,x.color.g,x.color.b);i.uniform1f(s.rotation,x.rotation);i.uniform2fv(s.scale,_);e.state.setBlending(x.blending,x.blendEquation,x.blendSrc,x.blendDst);e.state.setDepthTest(x.depthTest);e.state.setDepthWrite(x.depthWrite);if(x.map&&x.map.image&&x.map.image.width){e.setTexture(x.map,0)}else{e.setTexture(h,0)}i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0)}i.enable(i.CULL_FACE);e.resetGLState()};function f(){var t=i.createProgram();var r=i.createShader(i.VERTEX_SHADER);var n=i.createShader(i.FRAGMENT_SHADER);i.shaderSource(r,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n"));i.shaderSource(n,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n"));i.compileShader(r);i.compileShader(n);i.attachShader(t,r);i.attachShader(t,n);i.linkProgram(t);return t}function d(e,t){if(e.z!==t.z){return t.z-e.z}else{return t.id-e.id}}};THREE.GeometryUtils={merge:function(e,t,i){THREE.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var r;if(t instanceof THREE.Mesh){t.matrixAutoUpdate&&t.updateMatrix();r=t.matrix;t=t.geometry}e.merge(t,r,i)},center:function(e){THREE.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return e.center()}};THREE.ImageUtils={crossOrigin:undefined,loadTexture:function(e,t,i,r){var n=new THREE.ImageLoader;n.crossOrigin=this.crossOrigin;var a=new THREE.Texture(undefined,t);n.load(e,function(e){a.image=e;a.needsUpdate=true;if(i)i(a)},undefined,function(e){if(r)r(e)});a.sourceFile=e;return a},loadTextureCube:function(e,t,i,r){var n=[];var a=new THREE.ImageLoader;a.crossOrigin=this.crossOrigin;var o=new THREE.CubeTexture(n,t);o.flipY=false;var s=0;var h=function(t){a.load(e[t],function(e){o.images[t]=e;s+=1;if(s===6){o.needsUpdate=true;if(i)i(o)}},undefined,r)};for(var l=0,u=e.length;l<u;++l){h(l)}return o},loadCompressedTexture:function(){THREE.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){THREE.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(e,t){var i=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]};var r=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]};var n=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t=t|1;var a=e.width;var o=e.height;var s=document.createElement("canvas");s.width=a;s.height=o;var h=s.getContext("2d");h.drawImage(e,0,0);var l=h.getImageData(0,0,a,o).data;var u=h.createImageData(a,o);var c=u.data;for(var p=0;p<a;p++){for(var f=0;f<o;f++){var d=f-1<0?0:f-1;var m=f+1>o-1?o-1:f+1;var g=p-1<0?0:p-1;var v=p+1>a-1?a-1:p+1;var y=[];var E=[0,0,l[(f*a+p)*4]/255*t];y.push([-1,0,l[(f*a+g)*4]/255*t]);y.push([-1,-1,l[(d*a+g)*4]/255*t]);y.push([0,-1,l[(d*a+p)*4]/255*t]);y.push([1,-1,l[(d*a+v)*4]/255*t]);y.push([1,0,l[(f*a+v)*4]/255*t]);y.push([1,1,l[(m*a+v)*4]/255*t]);y.push([0,1,l[(m*a+p)*4]/255*t]);y.push([-1,1,l[(m*a+g)*4]/255*t]);var w=[];var b=y.length;for(var _=0;_<b;_++){var x=y[_];var T=y[(_+1)%b];x=r(x,E);T=r(T,E);w.push(n(i(x,T)))}var R=[0,0,0];for(var _=0;_<w.length;_++){R[0]+=w[_][0];R[1]+=w[_][1];R[2]+=w[_][2]}R[0]/=w.length;R[1]/=w.length;R[2]/=w.length;var k=(f*a+p)*4;c[k]=(R[0]+1)/2*255|0;c[k+1]=(R[1]+1)/2*255|0;c[k+2]=R[2]*255|0;c[k+3]=255}}h.putImageData(u,0,0);return s},generateDataTexture:function(e,t,i){var r=e*t;var n=new Uint8Array(3*r);var a=Math.floor(i.r*255);var o=Math.floor(i.g*255);var s=Math.floor(i.b*255);for(var h=0;h<r;h++){n[h*3]=a;n[h*3+1]=o;n[h*3+2]=s}var l=new THREE.DataTexture(n,e,t,THREE.RGBFormat);l.needsUpdate=true;return l}};THREE.SceneUtils={createMultiMaterialObject:function(e,t){var i=new THREE.Object3D;for(var r=0,n=t.length;r<n;r++){i.add(new THREE.Mesh(e,t[r]))}return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld);t.remove(e);i.add(e)},attach:function(e,t,i){var r=new THREE.Matrix4;r.getInverse(i.matrixWorld);e.applyMatrix(r);t.remove(e);i.add(e)}};THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(e){var t=e.familyName.toLowerCase();var i=this;i.faces[t]=i.faces[t]||{};i.faces[t][e.cssFontWeight]=i.faces[t][e.cssFontWeight]||{};i.faces[t][e.cssFontWeight][e.cssFontStyle]=e;i.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t,i=this.getFace(),r=this.size/i.resolution,n=0,a=String(e).split(""),o=a.length;var s=[];for(t=0;t<o;t++){var h=new THREE.Path;var l=this.extractGlyphPoints(a[t],i,r,n,h);n+=l.offset;s.push(l.path)}var u=n/2;return{paths:s,offset:u}},extractGlyphPoints:function(e,t,i,r,n){var a=[];var o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R=t.glyphs[e]||t.glyphs["?"];if(!R)return;if(R.o){l=R._cachedOutline||(R._cachedOutline=R.o.split(" "));c=l.length;p=i;f=i;for(o=0;o<c;){u=l[o++];switch(u){case"m":d=l[o++]*p+r;m=l[o++]*f;n.moveTo(d,m);break;case"l":d=l[o++]*p+r;m=l[o++]*f;n.lineTo(d,m);break;case"q":g=l[o++]*p+r;v=l[o++]*f;w=l[o++]*p+r;b=l[o++]*f;n.quadraticCurveTo(w,b,g,v);T=a[a.length-1];if(T){y=T.x;E=T.y;for(s=1,h=this.divisions;s<=h;s++){var k=s/h;THREE.Shape.Utils.b2(k,y,w,g);THREE.Shape.Utils.b2(k,E,b,v)}}break;case"b":g=l[o++]*p+r;v=l[o++]*f;w=l[o++]*p+r;b=l[o++]*f;_=l[o++]*p+r;x=l[o++]*f;n.bezierCurveTo(w,b,_,x,g,v);T=a[a.length-1];if(T){y=T.x;E=T.y;for(s=1,h=this.divisions;s<=h;s++){var k=s/h;THREE.Shape.Utils.b3(k,y,w,_,g);THREE.Shape.Utils.b3(k,E,b,x,v)}}break}}}return{offset:R.ha*i,path:n}}};THREE.FontUtils.generateShapes=function(e,t){t=t||{};var i=t.size!==undefined?t.size:100;var r=t.curveSegments!==undefined?t.curveSegments:4;var n=t.font!==undefined?t.font:"helvetiker";var a=t.weight!==undefined?t.weight:"normal";var o=t.style!==undefined?t.style:"normal";THREE.FontUtils.size=i;THREE.FontUtils.divisions=r;THREE.FontUtils.face=n;THREE.FontUtils.weight=a;THREE.FontUtils.style=o;var s=THREE.FontUtils.drawText(e);var h=s.paths;var l=[];for(var u=0,c=h.length;u<c;u++){Array.prototype.push.apply(l,h[u].toShapes())}return l};(function(e){var t=1e-10;var i=function(e,t){var i=e.length;if(i<3)return null;var a=[],o=[],s=[];var h,l,u;if(r(e)>0){for(l=0;l<i;l++)o[l]=l}else{for(l=0;l<i;l++)o[l]=i-1-l}var c=i;var p=2*c;for(l=c-1;c>2;){if(p--<=0){THREE.warn("THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()");if(t)return s;return a}h=l;if(c<=h)h=0;l=h+1;if(c<=l)l=0;u=l+1;if(c<=u)u=0;if(n(e,h,l,u,c,o)){var f,d,m,g,v;f=o[h];d=o[l];m=o[u];a.push([e[f],e[d],e[m]]);s.push([o[h],o[l],o[u]]);for(g=l,v=l+1;v<c;g++,v++){o[g]=o[v]}c--;p=2*c}}if(t)return s;return a};var r=function(e){var t=e.length;var i=0;for(var r=t-1,n=0;n<t;r=n++){i+=e[r].x*e[n].y-e[n].x*e[r].y}return i*.5};var n=function(e,i,r,n,a,o){var s;var h,l,u,c;var p,f,d,m;h=e[o[i]].x;l=e[o[i]].y;u=e[o[r]].x;c=e[o[r]].y;p=e[o[n]].x;f=e[o[n]].y;if(t>(u-h)*(f-l)-(c-l)*(p-h))return false;var g,v,y,E,w,b;var _,x,T,R,k,H;var M,S,A;g=p-u;v=f-c;y=h-p;E=l-f;w=u-h;b=c-l;for(s=0;s<a;s++){d=e[o[s]].x;m=e[o[s]].y;if(d===h&&m===l||d===u&&m===c||d===p&&m===f)continue;_=d-h;x=m-l;T=d-u;R=m-c;k=d-p;H=m-f;A=g*R-v*T;M=w*x-b*_;S=y*H-E*k;if(A>=-t&&S>=-t&&M>=-t)return false}return true};e.Triangulate=i;e.Triangulate.area=r;return e})(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.typeface_js=self._typeface_js;THREE.Audio=function(e){THREE.Object3D.call(this);this.type="Audio";this.context=e.context;this.source=this.context.createBufferSource();this.source.onended=this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.panner=this.context.createPanner();this.panner.connect(this.gain);this.autoplay=false;this.startTime=0;this.isPlaying=false};THREE.Audio.prototype=Object.create(THREE.Object3D.prototype);THREE.Audio.prototype.constructor=THREE.Audio;THREE.Audio.prototype.load=function(e){var t=this;var i=new XMLHttpRequest;i.open("GET",e,true);i.responseType="arraybuffer";i.onload=function(e){t.context.decodeAudioData(this.response,function(e){t.source.buffer=e;if(t.autoplay)t.play()})};i.send();return this};THREE.Audio.prototype.play=function(){if(this.isPlaying===true){THREE.warn("THREE.Audio: Audio is already playing.");return}var e=this.context.createBufferSource();e.buffer=this.source.buffer;e.loop=this.source.loop;e.onended=this.source.onended;e.connect(this.panner);e.start(0,this.startTime);this.isPlaying=true;this.source=e};THREE.Audio.prototype.pause=function(){this.source.stop();this.startTime=this.context.currentTime};THREE.Audio.prototype.stop=function(){this.source.stop();this.startTime=0};THREE.Audio.prototype.onEnded=function(){this.isPlaying=false};THREE.Audio.prototype.setLoop=function(e){this.source.loop=e};THREE.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e};THREE.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e};THREE.Audio.prototype.setVolume=function(e){this.gain.gain.value=e};THREE.Audio.prototype.updateMatrixWorld=function(){var e=new THREE.Vector3;return function(t){THREE.Object3D.prototype.updateMatrixWorld.call(this,t);e.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(e.x,e.y,e.z)}}();THREE.AudioListener=function(){THREE.Object3D.call(this);this.type="AudioListener";this.context=new(window.AudioContext||window.webkitAudioContext)};THREE.AudioListener.prototype=Object.create(THREE.Object3D.prototype);THREE.AudioListener.prototype.constructor=THREE.AudioListener;THREE.AudioListener.prototype.updateMatrixWorld=function(){var e=new THREE.Vector3;var t=new THREE.Quaternion;var i=new THREE.Vector3;var r=new THREE.Vector3;var n=new THREE.Vector3;var a=new THREE.Vector3;return function(o){THREE.Object3D.prototype.updateMatrixWorld.call(this,o);var s=this.context.listener;var h=this.up;this.matrixWorld.decompose(e,t,i);r.set(0,0,-1).applyQuaternion(t);n.subVectors(e,a);s.setPosition(e.x,e.y,e.z);s.setOrientation(r.x,r.y,r.z,h.x,h.y,h.z);s.setVelocity(n.x,n.y,n.z);a.copy(e)}}();THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(e){THREE.warn("THREE.Curve: Warning, getPoint() not implemented!");return null};THREE.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)};THREE.Curve.prototype.getPoints=function(e){if(!e)e=5;var t,i=[];for(t=0;t<=e;t++){i.push(this.getPoint(t/e))}return i};THREE.Curve.prototype.getSpacedPoints=function(e){if(!e)e=5;var t,i=[];for(t=0;t<=e;t++){i.push(this.getPointAt(t/e))}return i};THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]};THREE.Curve.prototype.getLengths=function(e){if(!e)e=this.__arcLengthDivisions?this.__arcLengthDivisions:200;if(this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=false;var t=[];var i,r=this.getPoint(0);var n,a=0;t.push(0);for(n=1;n<=e;n++){i=this.getPoint(n/e);a+=i.distanceTo(r);t.push(a);r=i}this.cacheArcLengths=t;return t};THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=true;this.getLengths()};THREE.Curve.prototype.getUtoTmapping=function(e,t){var i=this.getLengths();var r=0,n=i.length;var a;if(t){a=t}else{a=e*i[n-1]}var o=0,s=n-1,h;while(o<=s){r=Math.floor(o+(s-o)/2);h=i[r]-a;if(h<0){o=r+1}else if(h>0){s=r-1}else{s=r;break}}r=s;if(i[r]==a){var l=r/(n-1);return l}var u=i[r];var c=i[r+1];var p=c-u;var f=(a-u)/p;var l=(r+f)/(n-1);return l};THREE.Curve.prototype.getTangent=function(e){var t=1e-4;var i=e-t;var r=e+t;if(i<0)i=0;if(r>1)r=1;var n=this.getPoint(i);var a=this.getPoint(r);var o=a.clone().sub(n);return o.normalize()};THREE.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)};THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,i,r){return 2*(1-e)*(i-t)+2*e*(r-i)},tangentCubicBezier:function(e,t,i,r,n){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*n},tangentSpline:function(e,t,i,r,n){var a=6*e*e-6*e;var o=3*e*e-4*e+1;var s=-6*e*e+6*e;var h=3*e*e-2*e;return a+o+s+h},interpolate:function(e,t,i,r,n){var a=(i-e)*.5;var o=(r-t)*.5;var s=n*n;var h=n*s;return(2*t-2*i+a+o)*h+(-3*t+3*i-2*a-o)*s+a*n+t}};THREE.Curve.create=function(e,t){e.prototype=Object.create(THREE.Curve.prototype);e.prototype.constructor=e;e.prototype.getPoint=t;return e};THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=false};THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype);THREE.CurvePath.prototype.constructor=THREE.CurvePath;THREE.CurvePath.prototype.add=function(e){this.curves.push(e)};THREE.CurvePath.prototype.checkConnection=function(){};THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0);var t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){this.curves.push(new THREE.LineCurve(t,e))}};THREE.CurvePath.prototype.getPoint=function(e){var t=e*this.getLength();var i=this.getCurveLengths();var r=0,n,a;while(r<i.length){if(i[r]>=t){n=i[r]-t;a=this.curves[r];var o=1-n/a.getLength();return a.getPointAt(o)}r++}return null};THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]};THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths}var e=[],t=0;var i,r=this.curves.length;for(i=0;i<r;i++){t+=this.curves[i].getLength();e.push(t)}this.cacheLengths=e;return e};THREE.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints();var t,i,r;var n,a,o;t=i=Number.NEGATIVE_INFINITY;n=a=Number.POSITIVE_INFINITY;var s,h,l,u;var c=e[0]instanceof THREE.Vector3;u=c?new THREE.Vector3:new THREE.Vector2;for(h=0,l=e.length;h<l;h++){s=e[h];if(s.x>t)t=s.x;else if(s.x<n)n=s.x;if(s.y>i)i=s.y;else if(s.y<a)a=s.y;if(c){if(s.z>r)r=s.z;else if(s.z<o)o=s.z}u.add(s)}var p={minX:n,minY:a,maxX:t,maxY:i};if(c){p.maxZ=r;p.minZ=o}return p};THREE.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,true);return this.createGeometry(t)};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,true);return this.createGeometry(t)};THREE.CurvePath.prototype.createGeometry=function(e){var t=new THREE.Geometry;for(var i=0;i<e.length;i++){t.vertices.push(new THREE.Vector3(e[i].x,e[i].y,e[i].z||0))}return t};THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)};THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var i=this.getPoints(e);var r,n;if(!t){t=this.bends}for(r=0,n=t.length;r<n;r++){i=this.getWrapPoints(i,t[r])}return i};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var i=this.getSpacedPoints(e);var r,n;if(!t){t=this.bends}for(r=0,n=t.length;r<n;r++){i=this.getWrapPoints(i,t[r])}return i};THREE.CurvePath.prototype.getWrapPoints=function(e,t){var i=this.getBoundingBox();var r,n,a,o,s,h;for(r=0,n=e.length;r<n;r++){a=e[r];o=a.x;s=a.y;h=o/i.maxX;h=t.getUtoTmapping(h,o);var l=t.getPoint(h);var u=t.getTangent(h);u.set(-u.y,u.x).multiplyScalar(s);a.x=l.x+u.x;a.y=l.y+u.y}return e};THREE.Gyroscope=function(){THREE.Object3D.call(this)};THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype);THREE.Gyroscope.prototype.constructor=THREE.Gyroscope;THREE.Gyroscope.prototype.updateMatrixWorld=function(){var e=new THREE.Vector3;var t=new THREE.Quaternion;var i=new THREE.Vector3;var r=new THREE.Vector3;var n=new THREE.Quaternion;var a=new THREE.Vector3;return function(o){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||o){if(this.parent){this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);this.matrixWorld.decompose(r,n,a);this.matrix.decompose(e,t,i);this.matrixWorld.compose(r,t,a)}else{this.matrixWorld.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;o=true}for(var s=0,h=this.children.length;s<h;s++){this.children[s].updateMatrixWorld(o)}}}();THREE.Path=function(e){THREE.CurvePath.call(this);this.actions=[];if(e){this.fromPoints(e)}};THREE.Path.prototype=Object.create(THREE.CurvePath.prototype);THREE.Path.prototype.constructor=THREE.Path;THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++){this.lineTo(e[t].x,e[t].y)}};THREE.Path.prototype.moveTo=function(e,t){var i=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:i})};THREE.Path.prototype.lineTo=function(e,t){var i=Array.prototype.slice.call(arguments);var r=this.actions[this.actions.length-1].args;var n=r[r.length-2];var a=r[r.length-1];var o=new THREE.LineCurve(new THREE.Vector2(n,a),new THREE.Vector2(e,t));this.curves.push(o);this.actions.push({action:THREE.PathActions.LINE_TO,args:i})};THREE.Path.prototype.quadraticCurveTo=function(e,t,i,r){var n=Array.prototype.slice.call(arguments);var a=this.actions[this.actions.length-1].args;var o=a[a.length-2];var s=a[a.length-1];var h=new THREE.QuadraticBezierCurve(new THREE.Vector2(o,s),new THREE.Vector2(e,t),new THREE.Vector2(i,r));this.curves.push(h);this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:n})};THREE.Path.prototype.bezierCurveTo=function(e,t,i,r,n,a){var o=Array.prototype.slice.call(arguments);var s=this.actions[this.actions.length-1].args;var h=s[s.length-2];var l=s[s.length-1];var u=new THREE.CubicBezierCurve(new THREE.Vector2(h,l),new THREE.Vector2(e,t),new THREE.Vector2(i,r),new THREE.Vector2(n,a));this.curves.push(u);this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:o})};THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments);var i=this.actions[this.actions.length-1].args;var r=i[i.length-2];var n=i[i.length-1];var a=[new THREE.Vector2(r,n)];Array.prototype.push.apply(a,e);var o=new THREE.SplineCurve(a);this.curves.push(o);this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})};THREE.Path.prototype.arc=function(e,t,i,r,n,a){var o=this.actions[this.actions.length-1].args;var s=o[o.length-2];var h=o[o.length-1];this.absarc(e+s,t+h,i,r,n,a)};THREE.Path.prototype.absarc=function(e,t,i,r,n,a){this.absellipse(e,t,i,i,r,n,a)};THREE.Path.prototype.ellipse=function(e,t,i,r,n,a,o){var s=this.actions[this.actions.length-1].args;var h=s[s.length-2];var l=s[s.length-1];this.absellipse(e+h,t+l,i,r,n,a,o)};THREE.Path.prototype.absellipse=function(e,t,i,r,n,a,o){var s=Array.prototype.slice.call(arguments);var h=new THREE.EllipseCurve(e,t,i,r,n,a,o);this.curves.push(h);var l=h.getPoint(1);s.push(l.x);s.push(l.y);this.actions.push({action:THREE.PathActions.ELLIPSE,args:s})};THREE.Path.prototype.getSpacedPoints=function(e,t){if(!e)e=40;var i=[];for(var r=0;r<e;r++){i.push(this.getPoint(r/e))}return i};THREE.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints){console.log("tata");return this.getSpacedPoints(e,t)}e=e||12;var i=[];var r,n,a,o,s;var h,l,u,c,p,f,d,m,g,v,y,E,w;for(r=0,n=this.actions.length;r<n;r++){a=this.actions[r];o=a.action;s=a.args;switch(o){case THREE.PathActions.MOVE_TO:i.push(new THREE.Vector2(s[0],s[1]));break;case THREE.PathActions.LINE_TO:i.push(new THREE.Vector2(s[0],s[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:h=s[2];l=s[3];p=s[0];f=s[1];if(i.length>0){g=i[i.length-1];d=g.x;m=g.y}else{g=this.actions[r-1].args;d=g[g.length-2];m=g[g.length-1]}for(v=1;v<=e;v++){y=v/e;E=THREE.Shape.Utils.b2(y,d,p,h);w=THREE.Shape.Utils.b2(y,m,f,l);i.push(new THREE.Vector2(E,w))}break;case THREE.PathActions.BEZIER_CURVE_TO:h=s[4];l=s[5];p=s[0];f=s[1];u=s[2];c=s[3];if(i.length>0){g=i[i.length-1];d=g.x;m=g.y}else{g=this.actions[r-1].args;d=g[g.length-2];m=g[g.length-1]}for(v=1;v<=e;v++){y=v/e;E=THREE.Shape.Utils.b3(y,d,p,u,h);w=THREE.Shape.Utils.b3(y,m,f,c,l);i.push(new THREE.Vector2(E,w))}break;case THREE.PathActions.CSPLINE_THRU:g=this.actions[r-1].args;var b=new THREE.Vector2(g[g.length-2],g[g.length-1]);var _=[b];var x=e*s[0].length;_=_.concat(s[0]);var T=new THREE.SplineCurve(_);for(v=1;v<=x;v++){i.push(T.getPointAt(v/x))}break;case THREE.PathActions.ARC:var R=s[0],k=s[1],H=s[2],M=s[3],S=s[4],A=!!s[5];var C=S-M;var z;var P=e*2;for(v=1;v<=P;v++){y=v/P;if(!A){y=1-y}z=M+y*C;E=R+H*Math.cos(z);w=k+H*Math.sin(z);i.push(new THREE.Vector2(E,w))}break;case THREE.PathActions.ELLIPSE:var R=s[0],k=s[1],L=s[2],O=s[3],M=s[4],S=s[5],A=!!s[6];var C=S-M;var z;var P=e*2;for(v=1;v<=P;v++){y=v/P;if(!A){y=1-y}z=M+y*C;E=R+L*Math.cos(z);w=k+O*Math.sin(z);i.push(new THREE.Vector2(E,w))}break}}var D=i[i.length-1];var F=1e-10;if(Math.abs(D.x-i[0].x)<F&&Math.abs(D.y-i[0].y)<F)i.splice(i.length-1,1);if(t){i.push(i[0])}return i};THREE.Path.prototype.toShapes=function(e,t){function i(e){var t,i,r,n,a;var o=[],s=new THREE.Path;for(t=0,i=e.length;t<i;t++){r=e[t];a=r.args;n=r.action;if(n==THREE.PathActions.MOVE_TO){if(s.actions.length!=0){o.push(s);s=new THREE.Path}}s[n].apply(s,a)}if(s.actions.length!=0){o.push(s)}return o}function r(e){var t=[];for(var i=0,r=e.length;i<r;i++){var n=e[i];var a=new THREE.Shape;a.actions=n.actions;a.curves=n.curves;t.push(a)}return t}function n(e,t){var i=1e-10;var r=t.length;var n=false;for(var a=r-1,o=0;o<r;a=o++){var s=t[a];var h=t[o];var l=h.x-s.x;var u=h.y-s.y;if(Math.abs(u)>i){if(u<0){s=t[o];l=-l;h=t[a];u=-u}if(e.y<s.y||e.y>h.y)continue;if(e.y==s.y){if(e.x==s.x)return true}else{var c=u*(e.x-s.x)-l*(e.y-s.y);if(c==0)return true;if(c<0)continue;n=!n}}else{if(e.y!=s.y)continue;if(h.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=h.x)return true}}return n}var a=i(this.actions);if(a.length==0)return[];if(t===true)return r(a);var o,s,h,l=[];if(a.length==1){s=a[0];h=new THREE.Shape;h.actions=s.actions;h.curves=s.curves;l.push(h);return l}var u=!THREE.Shape.Utils.isClockWise(a[0].getPoints());u=e?!u:u;var c=[];var p=[];var f=[];var d=0;var m;p[d]=undefined;f[d]=[];var g,v;for(g=0,v=a.length;g<v;g++){s=a[g];m=s.getPoints();o=THREE.Shape.Utils.isClockWise(m);o=e?!o:o;if(o){if(!u&&p[d])d++;p[d]={s:new THREE.Shape,p:m};p[d].s.actions=s.actions;p[d].s.curves=s.curves;if(u)d++;f[d]=[]}else{f[d].push({h:s,p:m[0]})}}if(!p[0])return r(a);if(p.length>1){var y=false;var E=[];for(var w=0,b=p.length;w<b;w++){c[w]=[]}for(var w=0,b=p.length;w<b;w++){var _=f[w];for(var x=0;x<_.length;x++){var T=_[x];var R=true;for(var k=0;k<p.length;k++){if(n(T.p,p[k].p)){if(w!=k)E.push({froms:w,tos:k,hole:x});if(R){R=false;c[k].push(T)}else{y=true}}}if(R){c[w].push(T)}}}if(E.length>0){if(!y)f=c}}var H,M,S;for(g=0,v=p.length;g<v;g++){h=p[g].s;l.push(h);H=f[g];for(M=0,S=H.length;M<S;M++){h.holes.push(H[M].h)}}return l};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=Object.create(THREE.Path.prototype);THREE.Shape.prototype.constructor=THREE.Shape;THREE.Shape.prototype.extrude=function(e){var t=new THREE.ExtrudeGeometry(this,e);return t};THREE.Shape.prototype.makeGeometry=function(e){var t=new THREE.ShapeGeometry(this,e);return t};THREE.Shape.prototype.getPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;t<i;t++){r[t]=this.holes[t].getTransformedPoints(e,this.bends)}return r};THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;t<i;t++){r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends)}return r};THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}};THREE.Shape.prototype.extractPoints=function(e){if(this.useSpacedPoints){return this.extractAllSpacedPoints(e)}return this.extractAllPoints(e)};THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}};THREE.Shape.Utils={triangulateShape:function(e,t){function i(e,t,i){if(e.x!=t.x){if(e.x<t.x){return e.x<=i.x&&i.x<=t.x}else{return t.x<=i.x&&i.x<=e.x}}else{if(e.y<t.y){return e.y<=i.y&&i.y<=t.y}else{return t.y<=i.y&&i.y<=e.y}}}function r(e,t,r,n,a){var o=1e-10;var s=t.x-e.x,h=t.y-e.y;var l=n.x-r.x,u=n.y-r.y;var c=e.x-r.x;var p=e.y-r.y;var f=h*l-s*u;var d=h*c-s*p;if(Math.abs(f)>o){var m;if(f>0){if(d<0||d>f)return[];m=u*c-l*p;if(m<0||m>f)return[]}else{if(d>0||d<f)return[];m=u*c-l*p;if(m>0||m<f)return[]}if(m==0){if(a&&(d==0||d==f))return[];return[e]}if(m==f){if(a&&(d==0||d==f))return[];return[t]}if(d==0)return[r];if(d==f)return[n];var g=m/f;return[{x:e.x+g*s,y:e.y+g*h}]}else{if(d!=0||u*c!=l*p)return[];var v=s==0&&h==0;var y=l==0&&u==0;if(v&&y){if(e.x!=r.x||e.y!=r.y)return[];return[e]}if(v){if(!i(r,n,e))return[];return[e]}if(y){if(!i(e,t,r))return[];return[r]}var E,w,b,_;var x,T,R,k;if(s!=0){if(e.x<t.x){E=e;b=e.x;w=t;_=t.x}else{E=t;b=t.x;w=e;_=e.x}if(r.x<n.x){x=r;R=r.x;T=n;k=n.x}else{x=n;R=n.x;T=r;k=r.x}}else{if(e.y<t.y){E=e;b=e.y;w=t;_=t.y}else{E=t;b=t.y;w=e;_=e.y}if(r.y<n.y){x=r;R=r.y;T=n;k=n.y}else{x=n;R=n.y;T=r;k=r.y}}if(b<=R){if(_<R)return[];if(_==R){if(a)return[];return[x]}if(_<=k)return[x,w];return[x,T]}else{if(b>k)return[];if(b==k){if(a)return[];return[E]}if(_<=k)return[E,w];return[E,T]}}}function n(e,t,i,r){var n=1e-10;var a=t.x-e.x,o=t.y-e.y;var s=i.x-e.x,h=i.y-e.y;var l=r.x-e.x,u=r.y-e.y;var c=a*h-o*s;var p=a*u-o*l;if(Math.abs(c)>n){var f=l*h-u*s;if(c>0){return p>=0&&f>=0}else{return p>=0||f>=0}}else{return p>0}}function a(e,t){var i=e.concat();var a;function o(e,t){var r=i.length-1;var o=e-1;if(o<0)o=r;var s=e+1;if(s>r)s=0;var h=n(i[e],i[o],i[s],a[t]);if(!h){return false}var l=a.length-1;var u=t-1;if(u<0)u=l;var c=t+1;if(c>l)c=0;h=n(a[t],a[u],a[c],i[e]);if(!h){return false}return true}function s(e,t){var n,a,o;for(n=0;n<i.length;n++){a=n+1;a%=i.length;o=r(e,t,i[n],i[a],true);if(o.length>0)return true}return false}var h=[];function l(e,i){var n,a,o,s,l;for(n=0;n<h.length;n++){a=t[h[n]];for(o=0;o<a.length;o++){s=o+1;s%=a.length;l=r(e,i,a[o],a[s],true);if(l.length>0)return true}}return false}var u,c,p,f,d,m,g=[],v,y,E,w;for(var b=0,_=t.length;b<_;b++){h.push(b)}var x=0;var T=h.length*2;while(h.length>0){T--;if(T<0){console.log("Infinite Loop! Holes left:"+h.length+", Probably Hole outside Shape!");break}for(c=x;c<i.length;c++){p=i[c];u=-1;for(var b=0;b<h.length;b++){d=h[b];m=p.x+":"+p.y+":"+d;if(g[m]!==undefined)continue;a=t[d];for(var R=0;R<a.length;R++){f=a[R];if(!o(c,R))continue;if(s(p,f))continue;if(l(p,f))continue;u=R;h.splice(b,1);v=i.slice(0,c+1);y=i.slice(c);E=a.slice(u);w=a.slice(0,u+1);i=v.concat(E).concat(w).concat(y);x=c;break}if(u>=0)break;g[m]=true}if(u>=0)break}}return i}var o,s,h,l,u,c,p={};var f=e.concat();for(var d=0,m=t.length;d<m;d++){Array.prototype.push.apply(f,t[d])}for(o=0,s=f.length;o<s;o++){u=f[o].x+":"+f[o].y;if(p[u]!==undefined){THREE.warn("THREE.Shape: Duplicate point",u)}p[u]=o}var g=a(e,t);var v=THREE.FontUtils.Triangulate(g,false);for(o=0,s=v.length;o<s;o++){l=v[o];for(h=0;h<3;h++){u=l[h].x+":"+l[h].y;c=p[u];if(c!==undefined){l[h]=c}}}return v.concat()},isClockWise:function(e){return THREE.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,r){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,r)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){var i=1-e;return 3*i*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,r,n){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,r)+this.b3p3(e,n)}};THREE.LineCurve=function(e,t){this.v1=e;this.v2=t};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.constructor=THREE.LineCurve;THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);t.multiplyScalar(e).add(this.v1);return t};THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)};THREE.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()};THREE.QuadraticBezierCurve=function(e,t,i){this.v0=e;this.v1=t;this.v2=i};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve;THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t=new THREE.Vector2;t.x=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);t.y=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);return t};THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t=new THREE.Vector2;t.x=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x);t.y=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);return t.normalize()};THREE.CubicBezierCurve=function(e,t,i,r){this.v0=e;this.v1=t;this.v2=i;this.v3=r};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve;THREE.CubicBezierCurve.prototype.getPoint=function(e){var t,i;t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);i=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(t,i)};THREE.CubicBezierCurve.prototype.getTangent=function(e){var t,i;t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);i=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var r=new THREE.Vector2(t,i);r.normalize();return r};THREE.SplineCurve=function(e){this.points=e==undefined?[]:e};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.constructor=THREE.SplineCurve;THREE.SplineCurve.prototype.getPoint=function(e){var t=this.points;var i=(t.length-1)*e;var r=Math.floor(i);var n=i-r;var a=t[r==0?r:r-1];var o=t[r];var s=t[r>t.length-2?t.length-1:r+1];var h=t[r>t.length-3?t.length-1:r+2];var l=new THREE.Vector2;l.x=THREE.Curve.Utils.interpolate(a.x,o.x,s.x,h.x,n);l.y=THREE.Curve.Utils.interpolate(a.y,o.y,s.y,h.y,n);return l};THREE.EllipseCurve=function(e,t,i,r,n,a,o){this.aX=e;this.aY=t;this.xRadius=i;this.yRadius=r;this.aStartAngle=n;this.aEndAngle=a;this.aClockwise=o};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.constructor=THREE.EllipseCurve;THREE.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;if(t<0)t+=Math.PI*2;if(t>Math.PI*2)t-=Math.PI*2;var i;if(this.aClockwise===true){i=this.aEndAngle+(1-e)*(Math.PI*2-t)}else{i=this.aStartAngle+e*t}var r=new THREE.Vector2;r.x=this.aX+this.xRadius*Math.cos(i);r.y=this.aY+this.yRadius*Math.sin(i);return r};THREE.ArcCurve=function(e,t,i,r,n,a){THREE.EllipseCurve.call(this,e,t,i,i,r,n,a)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.ArcCurve.prototype.constructor=THREE.ArcCurve;THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e;this.v2=t},function(e){var t=new THREE.Vector3;t.subVectors(this.v2,this.v1);t.multiplyScalar(e);t.add(this.v1);return t});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,i){this.v0=e;this.v1=t;this.v2=i},function(e){var t=new THREE.Vector3;t.x=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);t.y=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);t.z=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z);return t});THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,i,r){this.v0=e;this.v1=t;this.v2=i;this.v3=r},function(e){var t=new THREE.Vector3;t.x=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);t.y=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);t.z=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return t});THREE.SplineCurve3=THREE.Curve.create(function(e){this.points=e==undefined?[]:e},function(e){var t=this.points;var i=(t.length-1)*e;var r=Math.floor(i);var n=i-r;var a=t[r==0?r:r-1];var o=t[r];var s=t[r>t.length-2?t.length-1:r+1];var h=t[r>t.length-3?t.length-1:r+2];var l=new THREE.Vector3;l.x=THREE.Curve.Utils.interpolate(a.x,o.x,s.x,h.x,n);l.y=THREE.Curve.Utils.interpolate(a.y,o.y,s.y,h.y,n);l.z=THREE.Curve.Utils.interpolate(a.z,o.z,s.z,h.z,n);return l});THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=e==undefined?[]:e},function(e){var t=this.points;var i=(t.length-0)*e;var r=Math.floor(i);var n=i-r;r+=r>0?0:(Math.floor(Math.abs(r)/t.length)+1)*t.length;var a=t[(r-1)%t.length];var o=t[r%t.length];var s=t[(r+1)%t.length];var h=t[(r+2)%t.length];var l=new THREE.Vector3;l.x=THREE.Curve.Utils.interpolate(a.x,o.x,s.x,h.x,n);l.y=THREE.Curve.Utils.interpolate(a.y,o.y,s.y,h.y,n);l.z=THREE.Curve.Utils.interpolate(a.z,o.z,s.z,h.z,n);return l});THREE.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){THREE.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){THREE.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){THREE.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(e){if(e.initialized===true)return e;for(var t=0;t<e.hierarchy.length;t++){for(var i=0;i<e.hierarchy[t].keys.length;i++){if(e.hierarchy[t].keys[i].time<0){e.hierarchy[t].keys[i].time=0}if(e.hierarchy[t].keys[i].rot!==undefined&&!(e.hierarchy[t].keys[i].rot instanceof THREE.Quaternion)){var r=e.hierarchy[t].keys[i].rot;e.hierarchy[t].keys[i].rot=(new THREE.Quaternion).fromArray(r)}}if(e.hierarchy[t].keys.length&&e.hierarchy[t].keys[0].morphTargets!==undefined){var n={};for(var i=0;i<e.hierarchy[t].keys.length;i++){for(var a=0;a<e.hierarchy[t].keys[i].morphTargets.length;a++){var o=e.hierarchy[t].keys[i].morphTargets[a];n[o]=-1}}e.hierarchy[t].usedMorphTargets=n;for(var i=0;i<e.hierarchy[t].keys.length;i++){var s={};for(var o in n){for(var a=0;a<e.hierarchy[t].keys[i].morphTargets.length;a++){if(e.hierarchy[t].keys[i].morphTargets[a]===o){s[o]=e.hierarchy[t].keys[i].morphTargetsInfluences[a];break}}if(a===e.hierarchy[t].keys[i].morphTargets.length){s[o]=0}}e.hierarchy[t].keys[i].morphTargetsInfluences=s}}for(var i=1;i<e.hierarchy[t].keys.length;i++){if(e.hierarchy[t].keys[i].time===e.hierarchy[t].keys[i-1].time){e.hierarchy[t].keys.splice(i,1);i--}}for(var i=0;i<e.hierarchy[t].keys.length;i++){e.hierarchy[t].keys[i].index=i}}e.initialized=true;return e},parse:function(e){var t=function(e,i){i.push(e);for(var r=0;r<e.children.length;r++)t(e.children[r],i)};var i=[];if(e instanceof THREE.SkinnedMesh){for(var r=0;r<e.skeleton.bones.length;r++){i.push(e.skeleton.bones[r])}}else{t(e,i)}return i},play:function(e){if(this.animations.indexOf(e)===-1){this.animations.push(e)}},stop:function(e){var t=this.animations.indexOf(e);if(t!==-1){this.animations.splice(t,1)}},update:function(e){for(var t=0;t<this.animations.length;t++){this.animations[t].resetBlendWeights()}for(var t=0;t<this.animations.length;t++){this.animations[t].update(e)}}};THREE.Animation=function(e,t){this.root=e;this.data=THREE.AnimationHandler.init(t);this.hierarchy=THREE.AnimationHandler.parse(e);this.currentTime=0;this.timeScale=1;this.isPlaying=false;this.loop=true;this.weight=0;this.interpolationType=THREE.AnimationHandler.LINEAR};THREE.Animation.prototype={constructor:THREE.Animation,keyTypes:["pos","rot","scl"],play:function(e,t){this.currentTime=e!==undefined?e:0;this.weight=t!==undefined?t:1;this.isPlaying=true;this.reset();THREE.AnimationHandler.play(this)},stop:function(){this.isPlaying=false;THREE.AnimationHandler.stop(this)},reset:function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var i=this.hierarchy[e];if(i.animationCache===undefined){i.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}}}var r=this.data.name;var n=i.animationCache.animations;var a=n[r];if(a===undefined){a={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:i.matrix};n[r]=a}for(var o=0;o<3;o++){var s=this.keyTypes[o];var h=this.data.hierarchy[e].keys[0];var l=this.getNextKeyWith(s,e,1);while(l.time<this.currentTime&&l.index>h.index){h=l;l=this.getNextKeyWith(s,e,l.index+1)}a.prevKey[s]=h;a.nextKey[s]=l}}},resetBlendWeights:function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var i=this.hierarchy[e];var r=i.animationCache;if(r!==undefined){var n=r.blending;n.positionWeight=0;n.quaternionWeight=0;n.scaleWeight=0}}},update:function(){var e=[];var t=new THREE.Vector3;var i=new THREE.Vector3;var r=new THREE.Quaternion;var n=function(e,t){var i=[],r=[],n,o,s,h,l,u,c,p,f;n=(e.length-1)*t;o=Math.floor(n);s=n-o;i[0]=o===0?o:o-1;i[1]=o;i[2]=o>e.length-2?o:o+1;i[3]=o>e.length-3?o:o+2;u=e[i[0]];c=e[i[1]];p=e[i[2]];f=e[i[3]];h=s*s;l=s*h;r[0]=a(u[0],c[0],p[0],f[0],s,h,l);r[1]=a(u[1],c[1],p[1],f[1],s,h,l);r[2]=a(u[2],c[2],p[2],f[2],s,h,l);return r};var a=function(e,t,i,r,n,a,o){var s=(i-e)*.5,h=(r-t)*.5;return(2*(t-i)+s+h)*o+(-3*(t-i)-2*s-h)*a+s*n+t};return function(a){if(this.isPlaying===false)return;this.currentTime+=a*this.timeScale;if(this.weight===0)return;var o=this.data.length;if(this.currentTime>o||this.currentTime<0){if(this.loop){this.currentTime%=o;if(this.currentTime<0)this.currentTime+=o;this.reset()}else{this.stop()}}for(var s=0,h=this.hierarchy.length;s<h;s++){var l=this.hierarchy[s];var u=l.animationCache.animations[this.data.name];var c=l.animationCache.blending;for(var p=0;p<3;p++){var f=this.keyTypes[p];var d=u.prevKey[f];var m=u.nextKey[f];if(this.timeScale>0&&m.time<=this.currentTime||this.timeScale<0&&d.time>=this.currentTime){d=this.data.hierarchy[s].keys[0];m=this.getNextKeyWith(f,s,1);while(m.time<this.currentTime&&m.index>d.index){d=m;m=this.getNextKeyWith(f,s,m.index+1)}u.prevKey[f]=d;u.nextKey[f]=m}var g=(this.currentTime-d.time)/(m.time-d.time);var v=d[f];var y=m[f];if(g<0)g=0;if(g>1)g=1;if(f==="pos"){if(this.interpolationType===THREE.AnimationHandler.LINEAR){i.x=v[0]+(y[0]-v[0])*g;i.y=v[1]+(y[1]-v[1])*g;i.z=v[2]+(y[2]-v[2])*g;var E=this.weight/(this.weight+c.positionWeight);l.position.lerp(i,E);c.positionWeight+=this.weight}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",s,d.index-1)["pos"];e[1]=v;e[2]=y;e[3]=this.getNextKeyWith("pos",s,m.index+1)["pos"];g=g*.33+.33;var w=n(e,g);var E=this.weight/(this.weight+c.positionWeight);c.positionWeight+=this.weight;var b=l.position;b.x=b.x+(w[0]-b.x)*E;b.y=b.y+(w[1]-b.y)*E;b.z=b.z+(w[2]-b.z)*E;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){var _=n(e,g*1.01);t.set(_[0],_[1],_[2]);t.sub(b);t.y=0;t.normalize();var x=Math.atan2(t.x,t.z);l.rotation.set(0,x,0)}}}else if(f==="rot"){THREE.Quaternion.slerp(v,y,r,g);if(c.quaternionWeight===0){l.quaternion.copy(r);c.quaternionWeight=this.weight}else{var E=this.weight/(this.weight+c.quaternionWeight);THREE.Quaternion.slerp(l.quaternion,r,l.quaternion,E);c.quaternionWeight+=this.weight}}else if(f==="scl"){i.x=v[0]+(y[0]-v[0])*g;i.y=v[1]+(y[1]-v[1])*g;i.z=v[2]+(y[2]-v[2])*g;var E=this.weight/(this.weight+c.scaleWeight);l.scale.lerp(i,E);c.scaleWeight+=this.weight}}}return true}}(),getNextKeyWith:function(e,t,i){var r=this.data.hierarchy[t].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){i=i<r.length-1?i:r.length-1}else{i=i%r.length}for(;i<r.length;i++){if(r[i][e]!==undefined){return r[i]}}return this.data.hierarchy[t].keys[0]},getPrevKeyWith:function(e,t,i){var r=this.data.hierarchy[t].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){i=i>0?i:0}else{i=i>=0?i:i+r.length}for(;i>=0;i--){if(r[i][e]!==undefined){return r[i]}}return this.data.hierarchy[t].keys[r.length-1]}};THREE.KeyFrameAnimation=function(e){this.root=e.node;this.data=THREE.AnimationHandler.init(e);this.hierarchy=THREE.AnimationHandler.parse(this.root);this.currentTime=0;this.timeScale=.001;this.isPlaying=false;this.isPaused=true;this.loop=true;for(var t=0,i=this.hierarchy.length;t<i;t++){var r=this.data.hierarchy[t].keys,n=this.data.hierarchy[t].sids,a=this.hierarchy[t];if(r.length&&n){for(var o=0;o<n.length;o++){var s=n[o],h=this.getNextKeyWith(s,t,0);if(h){h.apply(s)}}a.matrixAutoUpdate=false;this.data.hierarchy[t].node.updateMatrix();a.matrixWorldNeedsUpdate=true}}};THREE.KeyFrameAnimation.prototype={constructor:THREE.KeyFrameAnimation,play:function(e){this.currentTime=e!==undefined?e:0;if(this.isPlaying===false){this.isPlaying=true;var t,i=this.hierarchy.length,r,n;for(t=0;t<i;t++){r=this.hierarchy[t];n=this.data.hierarchy[t];if(n.animationCache===undefined){n.animationCache={};n.animationCache.prevKey=null;n.animationCache.nextKey=null;n.animationCache.originalMatrix=r.matrix}var a=this.data.hierarchy[t].keys;if(a.length){n.animationCache.prevKey=a[0];n.animationCache.nextKey=a[1];this.startTime=Math.min(a[0].time,this.startTime);this.endTime=Math.max(a[a.length-1].time,this.endTime)}}this.update(0)}this.isPaused=false;THREE.AnimationHandler.play(this)},stop:function(){this.isPlaying=false;this.isPaused=false;THREE.AnimationHandler.stop(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e];var i=this.data.hierarchy[e];if(i.animationCache!==undefined){var r=i.animationCache.originalMatrix;r.copy(t.matrix);t.matrix=r;delete i.animationCache}}},update:function(e){if(this.isPlaying===false)return;this.currentTime+=e*this.timeScale;var t=this.data.length;if(this.loop===true&&this.currentTime>t){this.currentTime%=t}this.currentTime=Math.min(this.currentTime,t);for(var i=0,r=this.hierarchy.length;i<r;i++){var n=this.hierarchy[i];var a=this.data.hierarchy[i];var o=a.keys,s=a.animationCache;if(o.length){var h=s.prevKey;var l=s.nextKey;if(l.time<=this.currentTime){while(l.time<this.currentTime&&l.index>h.index){h=l;l=o[h.index+1]}s.prevKey=h;s.nextKey=l}if(l.time>=this.currentTime){h.interpolate(l,this.currentTime)}else{h.interpolate(l,l.time)}this.data.hierarchy[i].node.updateMatrix();n.matrixWorldNeedsUpdate=true}}},getNextKeyWith:function(e,t,i){var r=this.data.hierarchy[t].keys;i=i%r.length;for(;i<r.length;i++){if(r[i].hasTarget(e)){return r[i]}}return r[0]},getPrevKeyWith:function(e,t,i){var r=this.data.hierarchy[t].keys;i=i>=0?i:i+r.length;for(;i>=0;i--){if(r[i].hasTarget(e)){return r[i]}}return r[r.length-1]}};THREE.MorphAnimation=function(e){this.mesh=e;this.frames=e.morphTargetInfluences.length;this.currentTime=0;this.duration=1e3;this.loop=true;this.lastFrame=0;this.currentFrame=0;this.isPlaying=false};THREE.MorphAnimation.prototype={constructor:THREE.MorphAnimation,play:function(){this.isPlaying=true},pause:function(){this.isPlaying=false},update:function(e){if(this.isPlaying===false)return;this.currentTime+=e;if(this.loop===true&&this.currentTime>this.duration){this.currentTime%=this.duration}this.currentTime=Math.min(this.currentTime,this.duration);var t=this.duration/this.frames;var i=Math.floor(this.currentTime/t);var r=this.mesh.morphTargetInfluences;if(i!=this.currentFrame){r[this.lastFrame]=0;r[this.currentFrame]=1;r[i]=0;this.lastFrame=this.currentFrame;this.currentFrame=i}r[i]=this.currentTime%t/t;r[this.lastFrame]=1-r[i]}};THREE.BoxGeometry=function(e,t,i,r,n,a){THREE.Geometry.call(this);this.type="BoxGeometry";this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:a};this.widthSegments=r||1;this.heightSegments=n||1;this.depthSegments=a||1;var o=this;var s=e/2;var h=t/2;var l=i/2;u("z","y",-1,-1,i,t,s,0);u("z","y",1,-1,i,t,-s,1);u("x","z",1,1,e,i,h,2);u("x","z",1,-1,e,i,-h,3);u("x","y",1,-1,e,t,l,4);u("x","y",-1,-1,e,t,-l,5);function u(e,t,i,r,n,a,s,h){var l,u,c,p=o.widthSegments,f=o.heightSegments,d=n/2,m=a/2,g=o.vertices.length;if(e==="x"&&t==="y"||e==="y"&&t==="x"){l="z"}else if(e==="x"&&t==="z"||e==="z"&&t==="x"){l="y";f=o.depthSegments}else if(e==="z"&&t==="y"||e==="y"&&t==="z"){l="x";p=o.depthSegments}var v=p+1,y=f+1,E=n/p,w=a/f,b=new THREE.Vector3;b[l]=s>0?1:-1;for(c=0;c<y;c++){for(u=0;u<v;u++){var _=new THREE.Vector3;_[e]=(u*E-d)*i;_[t]=(c*w-m)*r;_[l]=s;o.vertices.push(_)}}for(c=0;c<f;c++){for(u=0;u<p;u++){var x=u+v*c;var T=u+v*(c+1);var R=u+1+v*(c+1);var k=u+1+v*c;var H=new THREE.Vector2(u/p,1-c/f);var M=new THREE.Vector2(u/p,1-(c+1)/f);var S=new THREE.Vector2((u+1)/p,1-(c+1)/f);var A=new THREE.Vector2((u+1)/p,1-c/f);var C=new THREE.Face3(x+g,T+g,k+g);C.normal.copy(b);C.vertexNormals.push(b.clone(),b.clone(),b.clone());C.materialIndex=h;o.faces.push(C);o.faceVertexUvs[0].push([H,M,A]);C=new THREE.Face3(T+g,R+g,k+g);C.normal.copy(b);C.vertexNormals.push(b.clone(),b.clone(),b.clone());C.materialIndex=h;o.faces.push(C);o.faceVertexUvs[0].push([M.clone(),S,A.clone()])}}}this.mergeVertices()};THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.BoxGeometry.prototype.constructor=THREE.BoxGeometry;THREE.CircleGeometry=function(e,t,i,r){THREE.Geometry.call(this);this.type="CircleGeometry";this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r};e=e||50;t=t!==undefined?Math.max(3,t):8;i=i!==undefined?i:0;r=r!==undefined?r:Math.PI*2;var n,a=[],o=new THREE.Vector3,s=new THREE.Vector2(.5,.5);this.vertices.push(o);a.push(s);for(n=0;n<=t;n++){var h=new THREE.Vector3;var l=i+n/t*r;h.x=e*Math.cos(l);h.y=e*Math.sin(l);this.vertices.push(h);a.push(new THREE.Vector2((h.x/e+1)/2,(h.y/e+1)/2))}var u=new THREE.Vector3(0,0,1);for(n=1;n<=t;n++){this.faces.push(new THREE.Face3(n,n+1,0,[u.clone(),u.clone(),u.clone()]));this.faceVertexUvs[0].push([a[n].clone(),a[n+1].clone(),s.clone()])}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CircleGeometry.prototype.constructor=THREE.CircleGeometry;THREE.CubeGeometry=function(e,t,i,r,n,a){THREE.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry.");return new THREE.BoxGeometry(e,t,i,r,n,a)};THREE.CylinderGeometry=function(e,t,i,r,n,a,o,s){THREE.Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:a,thetaStart:o,thetaLength:s};e=e!==undefined?e:20;t=t!==undefined?t:20;i=i!==undefined?i:100;r=r||8;n=n||1;a=a!==undefined?a:false;o=o!==undefined?o:0;s=s!==undefined?s:2*Math.PI;var h=i/2;var l,u,c=[],p=[];for(u=0;u<=n;u++){var f=[];var d=[];var m=u/n;var g=m*(t-e)+e;for(l=0;l<=r;l++){var v=l/r;var y=new THREE.Vector3;y.x=g*Math.sin(v*s+o);y.y=-m*i+h;y.z=g*Math.cos(v*s+o);this.vertices.push(y);f.push(this.vertices.length-1);d.push(new THREE.Vector2(v,1-m))}c.push(f);p.push(d)}var E=(t-e)/i;var w,b;for(l=0;l<r;l++){if(e!==0){w=this.vertices[c[0][l]].clone();b=this.vertices[c[0][l+1]].clone()}else{w=this.vertices[c[1][l]].clone();b=this.vertices[c[1][l+1]].clone()}w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*E).normalize();b.setY(Math.sqrt(b.x*b.x+b.z*b.z)*E).normalize();for(u=0;u<n;u++){var _=c[u][l];var x=c[u+1][l];var T=c[u+1][l+1];var R=c[u][l+1];var k=w.clone();var H=w.clone();var M=b.clone();var S=b.clone();var A=p[u][l].clone();var C=p[u+1][l].clone();var z=p[u+1][l+1].clone();var P=p[u][l+1].clone();this.faces.push(new THREE.Face3(_,x,R,[k,H,S]));this.faceVertexUvs[0].push([A,C,P]);this.faces.push(new THREE.Face3(x,T,R,[H.clone(),M,S.clone()]));this.faceVertexUvs[0].push([C.clone(),z,P.clone()])}}if(a===false&&e>0){this.vertices.push(new THREE.Vector3(0,h,0));for(l=0;l<r;l++){var _=c[0][l];var x=c[0][l+1];var T=this.vertices.length-1;var k=new THREE.Vector3(0,1,0);var H=new THREE.Vector3(0,1,0);var M=new THREE.Vector3(0,1,0);var A=p[0][l].clone();var C=p[0][l+1].clone();var z=new THREE.Vector2(C.x,0);this.faces.push(new THREE.Face3(_,x,T,[k,H,M]));this.faceVertexUvs[0].push([A,C,z])}}if(a===false&&t>0){this.vertices.push(new THREE.Vector3(0,-h,0));for(l=0;l<r;l++){var _=c[n][l+1];var x=c[n][l];var T=this.vertices.length-1;var k=new THREE.Vector3(0,-1,0);var H=new THREE.Vector3(0,-1,0);var M=new THREE.Vector3(0,-1,0);var A=p[n][l+1].clone();var C=p[n][l].clone();var z=new THREE.Vector2(C.x,1);this.faces.push(new THREE.Face3(_,x,T,[k,H,M]));this.faceVertexUvs[0].push([A,C,z])}}this.computeFaceNormals()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry;THREE.ExtrudeGeometry=function(e,t){if(typeof e==="undefined"){e=[];return}THREE.Geometry.call(this);this.type="ExtrudeGeometry";e=e instanceof Array?e:[e];this.addShapeList(e,t);this.computeFaceNormals()};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry;THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){var i=e.length;for(var r=0;r<i;r++){var n=e[r];this.addShape(n,t)}};THREE.ExtrudeGeometry.prototype.addShape=function(e,t){var i=t.amount!==undefined?t.amount:100;var r=t.bevelThickness!==undefined?t.bevelThickness:6;var n=t.bevelSize!==undefined?t.bevelSize:r-2;var a=t.bevelSegments!==undefined?t.bevelSegments:3;var o=t.bevelEnabled!==undefined?t.bevelEnabled:true;var s=t.curveSegments!==undefined?t.curveSegments:12;var h=t.steps!==undefined?t.steps:1;var l=t.extrudePath;var u,c=false;var p=t.material;var f=t.extrudeMaterial;var d=t.UVGenerator!==undefined?t.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;var m,g,v,y;if(l){u=l.getSpacedPoints(h);c=true;o=false;m=t.frames!==undefined?t.frames:new THREE.TubeGeometry.FrenetFrames(l,h,false);g=new THREE.Vector3;v=new THREE.Vector3;y=new THREE.Vector3}if(!o){a=0;r=0;n=0}var E,w,b;var _=this;var x=this.vertices.length;var T=e.extractPoints(s);var R=T.shape;var k=T.holes;var H=!THREE.Shape.Utils.isClockWise(R);if(H){R=R.reverse();for(w=0,b=k.length;w<b;w++){E=k[w];if(THREE.Shape.Utils.isClockWise(E)){k[w]=E.reverse()}}H=false}var M=THREE.Shape.Utils.triangulateShape(R,k);var S=R;for(w=0,b=k.length;w<b;w++){E=k[w];R=R.concat(E)}function A(e,t,i){if(!t)THREE.error("THREE.ExtrudeGeometry: vec does not exist");return t.clone().multiplyScalar(i).add(e)}var C,z,P,L,O,D=R.length,F,B=M.length;function U(e,t,i){var r=1e-10;var n,a,o=1;var s=e.x-t.x,h=e.y-t.y;var l=i.x-e.x,u=i.y-e.y;var c=s*s+h*h;var p=s*u-h*l;if(Math.abs(p)>r){var f=Math.sqrt(c);var d=Math.sqrt(l*l+u*u);var m=t.x-h/f;var g=t.y+s/f;var v=i.x-u/d;var y=i.y+l/d;var E=((v-m)*u-(y-g)*l)/(s*u-h*l);n=m+s*E-e.x;a=g+h*E-e.y;var w=n*n+a*a;if(w<=2){return new THREE.Vector2(n,a)}else{o=Math.sqrt(w/2)}}else{var b=false;if(s>r){if(l>r){b=true}}else{if(s<-r){if(l<-r){b=true}}else{if(Math.sign(h)==Math.sign(u)){b=true}}}if(b){n=-h;a=s;o=Math.sqrt(c)}else{n=s;a=h;o=Math.sqrt(c/2)}}return new THREE.Vector2(n/o,a/o)}var N=[];for(var V=0,I=S.length,j=I-1,G=V+1;V<I;V++,j++,G++){if(j===I)j=0;if(G===I)G=0;N[V]=U(S[V],S[j],S[G])}var W=[],q,X=N.concat();for(w=0,b=k.length;w<b;w++){E=k[w];q=[];for(V=0,I=E.length,j=I-1,G=V+1;V<I;V++,j++,G++){if(j===I)j=0;if(G===I)G=0;q[V]=U(E[V],E[j],E[G])}W.push(q);X=X.concat(q)}for(C=0;C<a;C++){P=C/a;L=r*(1-P);z=n*Math.sin(P*Math.PI/2);for(V=0,I=S.length;V<I;V++){O=A(S[V],N[V],z);J(O.x,O.y,-L)}for(w=0,b=k.length;w<b;w++){E=k[w];q=W[w];for(V=0,I=E.length;V<I;V++){O=A(E[V],q[V],z);J(O.x,O.y,-L)}}}z=n;for(V=0;V<D;V++){O=o?A(R[V],X[V],z):R[V];if(!c){J(O.x,O.y,0)}else{v.copy(m.normals[0]).multiplyScalar(O.x);g.copy(m.binormals[0]).multiplyScalar(O.y);y.copy(u[0]).add(v).add(g);J(y.x,y.y,y.z)}}var Y;for(Y=1;Y<=h;Y++){for(V=0;V<D;V++){O=o?A(R[V],X[V],z):R[V];if(!c){J(O.x,O.y,i/h*Y)}else{v.copy(m.normals[Y]).multiplyScalar(O.x);g.copy(m.binormals[Y]).multiplyScalar(O.y);y.copy(u[Y]).add(v).add(g);J(y.x,y.y,y.z)}}}for(C=a-1;C>=0;C--){P=C/a;L=r*(1-P);z=n*Math.sin(P*Math.PI/2);for(V=0,I=S.length;V<I;V++){O=A(S[V],N[V],z);J(O.x,O.y,i+L)}for(w=0,b=k.length;w<b;w++){E=k[w];q=W[w];for(V=0,I=E.length;V<I;V++){O=A(E[V],q[V],z);if(!c){J(O.x,O.y,i+L)}else{J(O.x,O.y+u[h-1].y,u[h-1].x+L)}}}}Z();K();function Z(){if(o){var e=0;var t=D*e;for(V=0;V<B;V++){F=M[V];$(F[2]+t,F[1]+t,F[0]+t)}e=h+a*2;t=D*e;for(V=0;V<B;V++){F=M[V];$(F[0]+t,F[1]+t,F[2]+t)}}else{for(V=0;V<B;V++){F=M[V];$(F[2],F[1],F[0])}for(V=0;V<B;V++){F=M[V];$(F[0]+D*h,F[1]+D*h,F[2]+D*h)}}}function K(){var e=0;Q(S,e);e+=S.length;for(w=0,b=k.length;w<b;w++){E=k[w];Q(E,e);e+=E.length}}function Q(e,t){var i,r;V=e.length;while(--V>=0){i=V;r=V-1;if(r<0)r=e.length-1;var n=0,o=h+a*2;for(n=0;n<o;n++){var s=D*n;var l=D*(n+1);var u=t+i+s,c=t+r+s,p=t+r+l,f=t+i+l;ee(u,c,p,f,e,n,o,i,r)}}}function J(e,t,i){_.vertices.push(new THREE.Vector3(e,t,i))}function $(e,t,i){e+=x;t+=x;i+=x;_.faces.push(new THREE.Face3(e,t,i,null,null,p));var r=d.generateTopUV(_,e,t,i);_.faceVertexUvs[0].push(r)}function ee(e,t,i,r,n,a,o,s,h){e+=x;t+=x;i+=x;r+=x;_.faces.push(new THREE.Face3(e,t,r,null,null,f));_.faces.push(new THREE.Face3(t,i,r,null,null,f));var l=d.generateSideWallUV(_,e,t,i,r);_.faceVertexUvs[0].push([l[0],l[1],l[3]]);_.faceVertexUvs[0].push([l[1],l[2],l[3]])}};THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,i,r){var n=e.vertices;var a=n[t];var o=n[i];var s=n[r];return[new THREE.Vector2(a.x,a.y),new THREE.Vector2(o.x,o.y),new THREE.Vector2(s.x,s.y)]},generateSideWallUV:function(e,t,i,r,n){var a=e.vertices;var o=a[t];var s=a[i];var h=a[r];var l=a[n];if(Math.abs(o.y-s.y)<.01){return[new THREE.Vector2(o.x,1-o.z),new THREE.Vector2(s.x,1-s.z),new THREE.Vector2(h.x,1-h.z),new THREE.Vector2(l.x,1-l.z)]}else{return[new THREE.Vector2(o.y,1-o.z),new THREE.Vector2(s.y,1-s.z),new THREE.Vector2(h.y,1-h.z),new THREE.Vector2(l.y,1-l.z)]}}};THREE.ShapeGeometry=function(e,t){THREE.Geometry.call(this);this.type="ShapeGeometry";if(e instanceof Array===false)e=[e];this.addShapeList(e,t);this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.constructor=THREE.ShapeGeometry;THREE.ShapeGeometry.prototype.addShapeList=function(e,t){for(var i=0,r=e.length;i<r;i++){this.addShape(e[i],t)}return this};THREE.ShapeGeometry.prototype.addShape=function(e,t){if(t===undefined)t={};var i=t.curveSegments!==undefined?t.curveSegments:12;var r=t.material;var n=t.UVGenerator===undefined?THREE.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator;var a,o,s;var h=this.vertices.length;var l=e.extractPoints(i);var u=l.shape;var c=l.holes;var p=!THREE.Shape.Utils.isClockWise(u);if(p){u=u.reverse();for(a=0,o=c.length;a<o;a++){s=c[a];if(THREE.Shape.Utils.isClockWise(s)){c[a]=s.reverse()}}p=false}var f=THREE.Shape.Utils.triangulateShape(u,c);var d=u;for(a=0,o=c.length;a<o;a++){s=c[a];u=u.concat(s)}var m,g=u.length;var v,y=f.length;for(a=0;a<g;a++){m=u[a];this.vertices.push(new THREE.Vector3(m.x,m.y,0))}for(a=0;a<y;a++){v=f[a];var E=v[0]+h;var w=v[1]+h;var b=v[2]+h;this.faces.push(new THREE.Face3(E,w,b,null,null,r));this.faceVertexUvs[0].push(n.generateTopUV(this,E,w,b))}};THREE.LatheGeometry=function(e,t,i,r){THREE.Geometry.call(this);this.type="LatheGeometry";this.parameters={points:e,segments:t,phiStart:i,phiLength:r};t=t||12;i=i||0;r=r||2*Math.PI;var n=1/(e.length-1);var a=1/t;for(var o=0,s=t;o<=s;o++){var h=i+o*a*r;var l=Math.cos(h),u=Math.sin(h);for(var c=0,p=e.length;c<p;c++){var f=e[c];var d=new THREE.Vector3;d.x=l*f.x-u*f.y;d.y=u*f.x+l*f.y;d.z=f.z;this.vertices.push(d)}}var m=e.length;for(var o=0,s=t;o<s;o++){for(var c=0,p=e.length-1;c<p;c++){var g=c+m*o;var v=g;var y=g+m;var l=g+1+m;var E=g+1;var w=o*a;var b=c*n;var _=w+a;var x=b+n;this.faces.push(new THREE.Face3(v,y,E));this.faceVertexUvs[0].push([new THREE.Vector2(w,b),new THREE.Vector2(_,b),new THREE.Vector2(w,x)]);this.faces.push(new THREE.Face3(y,l,E));this.faceVertexUvs[0].push([new THREE.Vector2(_,b),new THREE.Vector2(_,x),new THREE.Vector2(w,x)])}}this.mergeVertices();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry;THREE.PlaneGeometry=function(e,t,i,r){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint.");THREE.Geometry.call(this);this.type="PlaneGeometry";this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};this.fromBufferGeometry(new THREE.PlaneBufferGeometry(e,t,i,r))};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry;THREE.PlaneBufferGeometry=function(e,t,i,r){THREE.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};var n=e/2;var a=t/2;var o=i||1;var s=r||1;var h=o+1;var l=s+1;var u=e/o;var c=t/s;var p=new Float32Array(h*l*3);var f=new Float32Array(h*l*3);var d=new Float32Array(h*l*2);var m=0;var g=0;for(var v=0;v<l;v++){var y=v*c-a;for(var E=0;E<h;E++){var w=E*u-n;p[m]=w;p[m+1]=-y;f[m+2]=1;d[g]=E/o;d[g+1]=1-v/s;m+=3;g+=2}}m=0;var b=new(p.length/3>65535?Uint32Array:Uint16Array)(o*s*6);for(var v=0;v<s;v++){for(var E=0;E<o;E++){var _=E+h*v;var x=E+h*(v+1);var T=E+1+h*(v+1);var R=E+1+h*v;b[m]=_;b[m+1]=x;b[m+2]=R;b[m+3]=x;b[m+4]=T;b[m+5]=R;m+=6}}this.addAttribute("index",new THREE.BufferAttribute(b,1));this.addAttribute("position",new THREE.BufferAttribute(p,3));this.addAttribute("normal",new THREE.BufferAttribute(f,3));this.addAttribute("uv",new THREE.BufferAttribute(d,2))};THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry;THREE.RingGeometry=function(e,t,i,r,n,a){THREE.Geometry.call(this);this.type="RingGeometry";this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:a};e=e||0;t=t||50;n=n!==undefined?n:0;a=a!==undefined?a:Math.PI*2;i=i!==undefined?Math.max(3,i):8;r=r!==undefined?Math.max(1,r):8;var o,s,h=[],l=e,u=(t-e)/r;for(o=0;o<r+1;o++){for(s=0;s<i+1;s++){var c=new THREE.Vector3;var p=n+s/i*a;c.x=l*Math.cos(p);c.y=l*Math.sin(p);this.vertices.push(c);h.push(new THREE.Vector2((c.x/t+1)/2,(c.y/t+1)/2))}l+=u}var f=new THREE.Vector3(0,0,1);for(o=0;o<r;o++){var d=o*(i+1);for(s=0;s<i;s++){var p=s+d;var m=p;var g=p+i+1;var v=p+i+2;this.faces.push(new THREE.Face3(m,g,v,[f.clone(),f.clone(),f.clone()]));this.faceVertexUvs[0].push([h[m].clone(),h[g].clone(),h[v].clone()]);m=p;g=p+i+2;v=p+1;this.faces.push(new THREE.Face3(m,g,v,[f.clone(),f.clone(),f.clone()]));this.faceVertexUvs[0].push([h[m].clone(),h[g].clone(),h[v].clone()])}}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,l)};THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.RingGeometry.prototype.constructor=THREE.RingGeometry;THREE.SphereGeometry=function(e,t,i,r,n,a,o){THREE.Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:a,thetaLength:o};e=e||50;t=Math.max(3,Math.floor(t)||8);i=Math.max(2,Math.floor(i)||6);r=r!==undefined?r:0;n=n!==undefined?n:Math.PI*2;a=a!==undefined?a:0;o=o!==undefined?o:Math.PI;var s,h,l=[],u=[];for(h=0;h<=i;h++){var c=[];var p=[];for(s=0;s<=t;s++){var f=s/t;var d=h/i;var m=new THREE.Vector3;m.x=-e*Math.cos(r+f*n)*Math.sin(a+d*o);m.y=e*Math.cos(a+d*o);m.z=e*Math.sin(r+f*n)*Math.sin(a+d*o);this.vertices.push(m);c.push(this.vertices.length-1);p.push(new THREE.Vector2(f,1-d))}l.push(c);u.push(p)}for(h=0;h<i;h++){for(s=0;s<t;s++){var g=l[h][s+1];var v=l[h][s];var y=l[h+1][s];var E=l[h+1][s+1];var w=this.vertices[g].clone().normalize();var b=this.vertices[v].clone().normalize();var _=this.vertices[y].clone().normalize();var x=this.vertices[E].clone().normalize();var T=u[h][s+1].clone();var R=u[h][s].clone();var k=u[h+1][s].clone();var H=u[h+1][s+1].clone();if(Math.abs(this.vertices[g].y)===e){T.x=(T.x+R.x)/2;this.faces.push(new THREE.Face3(g,y,E,[w,_,x]));this.faceVertexUvs[0].push([T,k,H])}else if(Math.abs(this.vertices[y].y)===e){k.x=(k.x+H.x)/2;this.faces.push(new THREE.Face3(g,v,y,[w,b,_]));this.faceVertexUvs[0].push([T,R,k])}else{this.faces.push(new THREE.Face3(g,v,E,[w,b,x]));this.faceVertexUvs[0].push([T,R,H]);this.faces.push(new THREE.Face3(v,y,E,[b.clone(),_,x.clone()]));this.faceVertexUvs[0].push([R.clone(),k,H.clone()])}}}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry;THREE.TextGeometry=function(e,t){t=t||{};var i=THREE.FontUtils.generateShapes(e,t);t.amount=t.height!==undefined?t.height:50;if(t.bevelThickness===undefined)t.bevelThickness=10;if(t.bevelSize===undefined)t.bevelSize=8;if(t.bevelEnabled===undefined)t.bevelEnabled=false;THREE.ExtrudeGeometry.call(this,i,t);this.type="TextGeometry"};THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TextGeometry.prototype.constructor=THREE.TextGeometry;THREE.TorusGeometry=function(e,t,i,r,n){THREE.Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n};e=e||100;t=t||40;i=i||8;r=r||6;n=n||Math.PI*2;var a=new THREE.Vector3,o=[],s=[];for(var h=0;h<=i;h++){for(var l=0;l<=r;l++){var u=l/r*n;var c=h/i*Math.PI*2;a.x=e*Math.cos(u);a.y=e*Math.sin(u);var p=new THREE.Vector3;p.x=(e+t*Math.cos(c))*Math.cos(u);p.y=(e+t*Math.cos(c))*Math.sin(u);p.z=t*Math.sin(c);this.vertices.push(p);o.push(new THREE.Vector2(l/r,h/i));s.push(p.clone().sub(a).normalize())}}for(var h=1;h<=i;h++){for(var l=1;l<=r;l++){var f=(r+1)*h+l-1;var d=(r+1)*(h-1)+l-1;var m=(r+1)*(h-1)+l;var g=(r+1)*h+l;var v=new THREE.Face3(f,d,g,[s[f].clone(),s[d].clone(),s[g].clone()]);this.faces.push(v);this.faceVertexUvs[0].push([o[f].clone(),o[d].clone(),o[g].clone()]);v=new THREE.Face3(d,m,g,[s[d].clone(),s[m].clone(),s[g].clone()]);this.faces.push(v);this.faceVertexUvs[0].push([o[d].clone(),o[m].clone(),o[g].clone()])}}this.computeFaceNormals()};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry;THREE.TorusKnotGeometry=function(e,t,i,r,n,a,o){THREE.Geometry.call(this);this.type="TorusKnotGeometry";this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,p:n,q:a,heightScale:o};e=e||100;t=t||40;i=i||64;r=r||8;n=n||2;a=a||3;o=o||1;var s=new Array(i);var h=new THREE.Vector3;var l=new THREE.Vector3;var u=new THREE.Vector3;for(var c=0;c<i;++c){s[c]=new Array(r);var p=c/i*2*n*Math.PI;var f=A(p,a,n,e,o);var d=A(p+.01,a,n,e,o);h.subVectors(d,f);l.addVectors(d,f);u.crossVectors(h,l);l.crossVectors(u,h);u.normalize();l.normalize();for(var m=0;m<r;++m){var g=m/r*2*Math.PI;var v=-t*Math.cos(g);var y=t*Math.sin(g);var E=new THREE.Vector3;E.x=f.x+v*l.x+y*u.x;E.y=f.y+v*l.y+y*u.y;E.z=f.z+v*l.z+y*u.z;s[c][m]=this.vertices.push(E)-1}}for(var c=0;c<i;++c){for(var m=0;m<r;++m){var w=(c+1)%i;var b=(m+1)%r;var _=s[c][m];var x=s[w][m];var T=s[w][b];var R=s[c][b];var k=new THREE.Vector2(c/i,m/r);var H=new THREE.Vector2((c+1)/i,m/r);var M=new THREE.Vector2((c+1)/i,(m+1)/r);var S=new THREE.Vector2(c/i,(m+1)/r);this.faces.push(new THREE.Face3(_,x,R));this.faceVertexUvs[0].push([k,H,S]);this.faces.push(new THREE.Face3(x,T,R));this.faceVertexUvs[0].push([H.clone(),M,S.clone()])}}this.computeFaceNormals();this.computeVertexNormals();function A(e,t,i,r,n){var a=Math.cos(e);var o=Math.sin(e);var s=t/i*e;var h=Math.cos(s);var l=r*(2+h)*.5*a;var u=r*(2+h)*o*.5;var c=n*r*Math.sin(s)*.5;return new THREE.Vector3(l,u,c)}};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry;THREE.TubeGeometry=function(e,t,i,r,n,a){THREE.Geometry.call(this);this.type="TubeGeometry";this.parameters={path:e,segments:t,radius:i,radialSegments:r,closed:n};t=t||64;i=i||1;r=r||8;n=n||false;a=a||THREE.TubeGeometry.NoTaper;var o=[];var s=this,h,l,u,c=t+1,p,f,d,m,g,v,y=new THREE.Vector3,E,w,b,_,x,T,R,k,H,M,S,A;var C=new THREE.TubeGeometry.FrenetFrames(e,t,n),z=C.tangents,P=C.normals,L=C.binormals;this.tangents=z;this.normals=P;this.binormals=L;function O(e,t,i){return s.vertices.push(new THREE.Vector3(e,t,i))-1}for(E=0;E<c;E++){o[E]=[];p=E/(c-1);v=e.getPointAt(p);h=z[E];l=P[E];u=L[E];d=i*a(p);for(w=0;w<r;w++){f=w/r*2*Math.PI;m=-d*Math.cos(f);g=d*Math.sin(f);y.copy(v);y.x+=m*l.x+g*u.x;y.y+=m*l.y+g*u.y;y.z+=m*l.z+g*u.z;o[E][w]=O(y.x,y.y,y.z)}}for(E=0;E<t;E++){for(w=0;w<r;w++){b=n?(E+1)%t:E+1;_=(w+1)%r;x=o[E][w];T=o[b][w];R=o[b][_];k=o[E][_];H=new THREE.Vector2(E/t,w/r);M=new THREE.Vector2((E+1)/t,w/r);S=new THREE.Vector2((E+1)/t,(w+1)/r);A=new THREE.Vector2(E/t,(w+1)/r);this.faces.push(new THREE.Face3(x,T,k));this.faceVertexUvs[0].push([H,M,A]);this.faces.push(new THREE.Face3(T,R,k));this.faceVertexUvs[0].push([M.clone(),S,A.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry;THREE.TubeGeometry.NoTaper=function(e){return 1};THREE.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)};THREE.TubeGeometry.FrenetFrames=function(e,t,i){var r=new THREE.Vector3,n=[],a=[],o=[],s=new THREE.Vector3,h=new THREE.Matrix4,l=t+1,u,c=1e-4,p,f,d,m,g,v;this.tangents=n;this.normals=a;this.binormals=o;for(g=0;g<l;g++){v=g/(l-1);n[g]=e.getTangentAt(v);n[g].normalize()}y();function y(){a[0]=new THREE.Vector3;o[0]=new THREE.Vector3;p=Number.MAX_VALUE;f=Math.abs(n[0].x);d=Math.abs(n[0].y);m=Math.abs(n[0].z);if(f<=p){p=f;r.set(1,0,0)}if(d<=p){p=d;r.set(0,1,0)}if(m<=p){r.set(0,0,1)}s.crossVectors(n[0],r).normalize();a[0].crossVectors(n[0],s);o[0].crossVectors(n[0],a[0])}for(g=1;g<l;g++){a[g]=a[g-1].clone();o[g]=o[g-1].clone();s.crossVectors(n[g-1],n[g]);if(s.length()>c){s.normalize();u=Math.acos(THREE.Math.clamp(n[g-1].dot(n[g]),-1,1));a[g].applyMatrix4(h.makeRotationAxis(s,u))}o[g].crossVectors(n[g],a[g])}if(i){u=Math.acos(THREE.Math.clamp(a[0].dot(a[l-1]),-1,1));u/=l-1;if(n[0].dot(s.crossVectors(a[0],a[l-1]))>0){u=-u}for(g=1;g<l;g++){a[g].applyMatrix4(h.makeRotationAxis(n[g],u*g));o[g].crossVectors(n[g],a[g])}}};THREE.PolyhedronGeometry=function(e,t,i,r){THREE.Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:e,indices:t,radius:i,detail:r};i=i||1;r=r||0;var n=this;for(var a=0,o=e.length;a<o;a+=3){w(new THREE.Vector3(e[a],e[a+1],e[a+2]))}var s=this.vertices;var h=[];for(var a=0,l=0,o=t.length;a<o;a+=3,l++){var u=s[t[a]];var c=s[t[a+1]];var p=s[t[a+2]];h[l]=new THREE.Face3(u.index,c.index,p.index,[u.clone(),c.clone(),p.clone()])}var f=new THREE.Vector3;for(var a=0,o=h.length;a<o;a++){_(h[a],r)}for(var a=0,o=this.faceVertexUvs[0].length;a<o;a++){var d=this.faceVertexUvs[0][a];var m=d[0].x;var g=d[1].x;var v=d[2].x;var y=Math.max(m,Math.max(g,v));var E=Math.min(m,Math.min(g,v));if(y>.9&&E<.1){if(m<.2)d[0].x+=1;if(g<.2)d[1].x+=1;if(v<.2)d[2].x+=1}}for(var a=0,o=this.vertices.length;a<o;a++){this.vertices[a].multiplyScalar(i)}this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,i);function w(e){var t=e.normalize().clone();t.index=n.vertices.push(t)-1;var i=x(e)/2/Math.PI+.5;var r=T(e)/Math.PI+.5;t.uv=new THREE.Vector2(i,1-r);return t}function b(e,t,i){var r=new THREE.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()]);n.faces.push(r);f.copy(e).add(t).add(i).divideScalar(3);var a=x(f);n.faceVertexUvs[0].push([R(e.uv,e,a),R(t.uv,t,a),R(i.uv,i,a)])}function _(e,t){var i=Math.pow(2,t);var r=w(n.vertices[e.a]);var a=w(n.vertices[e.b]);var o=w(n.vertices[e.c]);var s=[];for(var h=0;h<=i;h++){s[h]=[];var l=w(r.clone().lerp(o,h/i));var u=w(a.clone().lerp(o,h/i));var c=i-h;for(var p=0;p<=c;p++){if(p==0&&h==i){s[h][p]=l}else{s[h][p]=w(l.clone().lerp(u,p/c))}}}for(var h=0;h<i;h++){for(var p=0;p<2*(i-h)-1;p++){var f=Math.floor(p/2);if(p%2==0){b(s[h][f+1],s[h+1][f],s[h][f])}else{b(s[h][f+1],s[h+1][f+1],s[h+1][f])}}}}function x(e){return Math.atan2(e.z,-e.x)}function T(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function R(e,t,i){if(i<0&&e.x===1)e=new THREE.Vector2(e.x-1,e.y);if(t.x===0&&t.z===0)e=new THREE.Vector2(i/2/Math.PI+.5,e.y);return e.clone()}};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry;THREE.DodecahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var i=(1+Math.sqrt(5))/2;var r=1/i;var n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r];var a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];THREE.PolyhedronGeometry.call(this,n,a,e,t)};THREE.DodecahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.DodecahedronGeometry.prototype.constructor=THREE.DodecahedronGeometry;THREE.IcosahedronGeometry=function(e,t){var i=(1+Math.sqrt(5))/2;var r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1];var n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];THREE.PolyhedronGeometry.call(this,r,n,e,t);this.type="IcosahedronGeometry";this.parameters={radius:e,detail:t}};THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry;THREE.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1];var r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];THREE.PolyhedronGeometry.call(this,i,r,e,t);this.type="OctahedronGeometry";this.parameters={radius:e,detail:t}};THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry;THREE.TetrahedronGeometry=function(e,t){var i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1];var r=[2,1,0,0,3,2,1,3,0,2,3,1];THREE.PolyhedronGeometry.call(this,i,r,e,t);this.type="TetrahedronGeometry";this.parameters={radius:e,detail:t}};THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry;THREE.ParametricGeometry=function(e,t,i){THREE.Geometry.call(this);this.type="ParametricGeometry";this.parameters={func:e,slices:t,stacks:i};var r=this.vertices;var n=this.faces;var a=this.faceVertexUvs[0];var o,s,h;var l,u;var c=t+1;for(o=0;o<=i;o++){u=o/i;for(s=0;s<=t;s++){l=s/t;h=e(l,u);r.push(h)}}var p,f,d,m;var g,v,y,E;for(o=0;o<i;o++){for(s=0;s<t;s++){p=o*c+s;f=o*c+s+1;d=(o+1)*c+s+1;m=(o+1)*c+s;g=new THREE.Vector2(s/t,o/i);v=new THREE.Vector2((s+1)/t,o/i);y=new THREE.Vector2((s+1)/t,(o+1)/i);E=new THREE.Vector2(s/t,(o+1)/i);n.push(new THREE.Face3(p,f,m));a.push([g,v,E]);n.push(new THREE.Face3(f,d,m));a.push([v.clone(),y,E.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry;THREE.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]);var i=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);var r=new THREE.BufferGeometry;r.addAttribute("position",new THREE.BufferAttribute(t,3));r.addAttribute("color",new THREE.BufferAttribute(i,3));var n=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,r,n,THREE.LinePieces)};THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype);THREE.AxisHelper.prototype.constructor=THREE.AxisHelper;THREE.ArrowHelper=function(){var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var t=new THREE.CylinderGeometry(0,.5,1,5,1);t.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0));return function(i,r,n,a,o,s){THREE.Object3D.call(this);if(a===undefined)a=16776960;if(n===undefined)n=1;if(o===undefined)o=.2*n;if(s===undefined)s=.2*o;this.position.copy(r);this.line=new THREE.Line(e,new THREE.LineBasicMaterial({color:a}));this.line.matrixAutoUpdate=false;this.add(this.line);this.cone=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:a}));this.cone.matrixAutoUpdate=false;this.add(this.cone);this.setDirection(i);this.setLength(n,o,s)}}();THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper;THREE.ArrowHelper.prototype.setDirection=function(){var e=new THREE.Vector3;var t;return function(i){if(i.y>.99999){this.quaternion.set(0,0,0,1)}else if(i.y<-.99999){this.quaternion.set(1,0,0,0)}else{e.set(i.z,0,-i.x).normalize();t=Math.acos(i.y);this.quaternion.setFromAxisAngle(e,t)}}}();THREE.ArrowHelper.prototype.setLength=function(e,t,i){if(t===undefined)t=.2*e;if(i===undefined)i=.2*t;this.line.scale.set(1,e-t,1);this.line.updateMatrix();this.cone.scale.set(i,t,i);this.cone.position.y=e;this.cone.updateMatrix()};THREE.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e);this.cone.material.color.set(e)};THREE.BoxHelper=function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(new Float32Array(72),3));THREE.Line.call(this,t,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces);if(e!==undefined){this.update(e)}};THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype);THREE.BoxHelper.prototype.constructor=THREE.BoxHelper;THREE.BoxHelper.prototype.update=function(e){var t=e.geometry;if(t.boundingBox===null){t.computeBoundingBox()}var i=t.boundingBox.min;var r=t.boundingBox.max;var n=this.geometry.attributes.position.array;n[0]=r.x;n[1]=r.y;n[2]=r.z;n[3]=i.x;n[4]=r.y;n[5]=r.z;n[6]=i.x;n[7]=r.y;n[8]=r.z;n[9]=i.x;n[10]=i.y;n[11]=r.z;n[12]=i.x;n[13]=i.y;n[14]=r.z;n[15]=r.x;n[16]=i.y;n[17]=r.z;n[18]=r.x;n[19]=i.y;n[20]=r.z;n[21]=r.x;n[22]=r.y;n[23]=r.z;n[24]=r.x;n[25]=r.y;n[26]=i.z;n[27]=i.x;n[28]=r.y;n[29]=i.z;n[30]=i.x;n[31]=r.y;n[32]=i.z;n[33]=i.x;n[34]=i.y;n[35]=i.z;n[36]=i.x;n[37]=i.y;n[38]=i.z;n[39]=r.x;n[40]=i.y;n[41]=i.z;n[42]=r.x;n[43]=i.y;n[44]=i.z;n[45]=r.x;n[46]=r.y;n[47]=i.z;n[48]=r.x;n[49]=r.y;n[50]=r.z;n[51]=r.x;n[52]=r.y;n[53]=i.z;n[54]=i.x;n[55]=r.y;n[56]=r.z;n[57]=i.x;n[58]=r.y;n[59]=i.z;n[60]=i.x;n[61]=i.y;n[62]=r.z;n[63]=i.x;n[64]=i.y;n[65]=i.z;n[66]=r.x;n[67]=i.y;n[68]=r.z;n[69]=r.x;n[70]=i.y;n[71]=i.z;this.geometry.attributes.position.needsUpdate=true;this.geometry.computeBoundingSphere();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false};THREE.BoundingBoxHelper=function(e,t){var i=t!==undefined?t:8947848;this.object=e;this.box=new THREE.Box3;THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:i,wireframe:true}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.constructor=THREE.BoundingBoxHelper;THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};THREE.CameraHelper=function(e){var t=new THREE.Geometry;var i=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors});var r={};var n=16755200;var a=16711680;var o=43775;var s=16777215;var h=3355443;l("n1","n2",n);l("n2","n4",n);l("n4","n3",n);l("n3","n1",n);l("f1","f2",n);l("f2","f4",n);l("f4","f3",n);l("f3","f1",n);l("n1","f1",n);l("n2","f2",n);l("n3","f3",n);l("n4","f4",n);l("p","n1",a);l("p","n2",a);l("p","n3",a);l("p","n4",a);l("u1","u2",o);l("u2","u3",o);l("u3","u1",o);l("c","t",s);l("p","c",h);l("cn1","cn2",h);l("cn3","cn4",h);l("cf1","cf2",h);l("cf3","cf4",h);function l(e,t,i){u(e,i);u(t,i)}function u(e,i){t.vertices.push(new THREE.Vector3);t.colors.push(new THREE.Color(i));if(r[e]===undefined){r[e]=[]}r[e].push(t.vertices.length-1)}THREE.Line.call(this,t,i,THREE.LinePieces);this.camera=e;this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.pointMap=r;this.update()};THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype);THREE.CameraHelper.prototype.constructor=THREE.CameraHelper;THREE.CameraHelper.prototype.update=function(){var e,t;var i=new THREE.Vector3;var r=new THREE.Camera;var n=function(n,a,o,s){i.set(a,o,s).unproject(r);var h=t[n];if(h!==undefined){for(var l=0,u=h.length;l<u;l++){e.vertices[h[l]].copy(i)}}};return function(){e=this.geometry;t=this.pointMap;var i=1,a=1;r.projectionMatrix.copy(this.camera.projectionMatrix);n("c",0,0,-1);n("t",0,0,1);n("n1",-i,-a,-1);n("n2",i,-a,-1);n("n3",-i,a,-1);n("n4",i,a,-1);n("f1",-i,-a,1);n("f2",i,-a,1);n("f3",-i,a,1);n("f4",i,a,1);n("u1",i*.7,a*1.1,-1);n("u2",-i*.7,a*1.1,-1);n("u3",0,a*2,-1);n("cf1",-i,0,1);n("cf2",i,0,1);n("cf3",0,-a,1);n("cf4",0,a,1);n("cn1",-i,0,-1);n("cn2",i,0,-1);n("cn3",0,-a,-1);n("cn4",0,a,-1);e.verticesNeedUpdate=true}}();THREE.DirectionalLightHelper=function(e,t){THREE.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;t=t||1;var i=new THREE.Geometry;i.vertices.push(new THREE.Vector3(-t,t,0),new THREE.Vector3(t,t,0),new THREE.Vector3(t,-t,0),new THREE.Vector3(-t,-t,0),new THREE.Vector3(-t,t,0));var r=new THREE.LineBasicMaterial({fog:false});r.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new THREE.Line(i,r);this.add(this.lightPlane);i=new THREE.Geometry;i.vertices.push(new THREE.Vector3,new THREE.Vector3);r=new THREE.LineBasicMaterial({fog:false});r.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new THREE.Line(i,r);this.add(this.targetLine);this.update()};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.DirectionalLightHelper.prototype.constructor=THREE.DirectionalLightHelper;THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};THREE.DirectionalLightHelper.prototype.update=function(){var e=new THREE.Vector3;var t=new THREE.Vector3;var i=new THREE.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld);t.setFromMatrixPosition(this.light.target.matrixWorld);i.subVectors(t,e);this.lightPlane.lookAt(i);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(i);this.targetLine.geometry.verticesNeedUpdate=true;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();THREE.EdgesHelper=function(e,t,i){var r=t!==undefined?t:16777215;i=i!==undefined?i:1;var n=Math.cos(THREE.Math.degToRad(i));var a=[0,0],o={};var s=function(e,t){return e-t};var h=["a","b","c"];var l=new THREE.BufferGeometry;var u;if(e.geometry instanceof THREE.BufferGeometry){u=new THREE.Geometry;u.fromBufferGeometry(e.geometry)}else{u=e.geometry.clone()}u.mergeVertices();u.computeFaceNormals();var c=u.vertices;var p=u.faces;var f=0;for(var d=0,m=p.length;d<m;d++){var g=p[d];for(var v=0;v<3;v++){a[0]=g[h[v]];a[1]=g[h[(v+1)%3]];a.sort(s);var y=a.toString();if(o[y]===undefined){o[y]={vert1:a[0],vert2:a[1],face1:d,face2:undefined};f++}else{o[y].face2=d}}}var E=new Float32Array(f*2*3);var w=0;for(var y in o){var b=o[y];if(b.face2===undefined||p[b.face1].normal.dot(p[b.face2].normal)<=n){var _=c[b.vert1];E[w++]=_.x;E[w++]=_.y;E[w++]=_.z;_=c[b.vert2];E[w++]=_.x;E[w++]=_.y;E[w++]=_.z}}l.addAttribute("position",new THREE.BufferAttribute(E,3));THREE.Line.call(this,l,new THREE.LineBasicMaterial({color:r}),THREE.LinePieces);this.matrix=e.matrixWorld;this.matrixAutoUpdate=false};THREE.EdgesHelper.prototype=Object.create(THREE.Line.prototype);THREE.EdgesHelper.prototype.constructor=THREE.EdgesHelper;THREE.FaceNormalsHelper=function(e,t,i,r){this.object=e;this.size=t!==undefined?t:1;var n=i!==undefined?i:16776960;var a=r!==undefined?r:1;var o=new THREE.Geometry;var s=this.object.geometry.faces;for(var h=0,l=s.length;h<l;h++){o.vertices.push(new THREE.Vector3,new THREE.Vector3)}THREE.Line.call(this,o,new THREE.LineBasicMaterial({color:n,linewidth:a}),THREE.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new THREE.Matrix3;this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype);THREE.FaceNormalsHelper.prototype.constructor=THREE.FaceNormalsHelper;THREE.FaceNormalsHelper.prototype.update=function(){var e=this.geometry.vertices;var t=this.object;var i=t.geometry.vertices;var r=t.geometry.faces;var n=t.matrixWorld;t.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(n);for(var a=0,o=0,s=r.length;a<s;a++,o+=2){var h=r[a];e[o].copy(i[h.a]).add(i[h.b]).add(i[h.c]).divideScalar(3).applyMatrix4(n);e[o+1].copy(h.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(e[o])}this.geometry.verticesNeedUpdate=true;return this};THREE.GridHelper=function(e,t){var i=new THREE.Geometry;var r=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924);this.color2=new THREE.Color(8947848);for(var n=-e;n<=e;n+=t){i.vertices.push(new THREE.Vector3(-e,0,n),new THREE.Vector3(e,0,n),new THREE.Vector3(n,0,-e),new THREE.Vector3(n,0,e));var a=n===0?this.color1:this.color2;i.colors.push(a,a,a,a)}THREE.Line.call(this,i,r,THREE.LinePieces)};THREE.GridHelper.prototype=Object.create(THREE.Line.prototype);THREE.GridHelper.prototype.constructor=THREE.GridHelper;THREE.GridHelper.prototype.setColors=function(e,t){this.color1.set(e);this.color2.set(t);this.geometry.colorsNeedUpdate=true};THREE.HemisphereLightHelper=function(e,t){THREE.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.colors=[new THREE.Color,new THREE.Color];var i=new THREE.SphereGeometry(t,4,2);i.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(var r=0,n=8;r<n;r++){i.faces[r].color=this.colors[r<4?0:1]}var a=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:true});this.lightSphere=new THREE.Mesh(i,a);this.add(this.lightSphere);this.update()};THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.constructor=THREE.HemisphereLightHelper;THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};THREE.HemisphereLightHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=true}}();THREE.PointLightHelper=function(e,t){this.light=e;this.light.updateMatrixWorld();var i=new THREE.SphereGeometry(t,4,2);var r=new THREE.MeshBasicMaterial({wireframe:true,fog:false});r.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,i,r);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=false};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.constructor=THREE.PointLightHelper;THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};THREE.SkeletonHelper=function(e){this.bones=this.getBoneList(e);var t=new THREE.Geometry;for(var i=0;i<this.bones.length;i++){var r=this.bones[i];if(r.parent instanceof THREE.Bone){t.vertices.push(new THREE.Vector3);t.vertices.push(new THREE.Vector3);t.colors.push(new THREE.Color(0,0,1));t.colors.push(new THREE.Color(0,1,0))}}var n=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:false,depthWrite:false,transparent:true});THREE.Line.call(this,t,n,THREE.LinePieces);this.root=e;this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;this.update()};THREE.SkeletonHelper.prototype=Object.create(THREE.Line.prototype);THREE.SkeletonHelper.prototype.constructor=THREE.SkeletonHelper;THREE.SkeletonHelper.prototype.getBoneList=function(e){var t=[];if(e instanceof THREE.Bone){t.push(e)}for(var i=0;i<e.children.length;i++){t.push.apply(t,this.getBoneList(e.children[i]))}return t};THREE.SkeletonHelper.prototype.update=function(){var e=this.geometry;var t=(new THREE.Matrix4).getInverse(this.root.matrixWorld);var i=new THREE.Matrix4;var r=0;for(var n=0;n<this.bones.length;n++){var a=this.bones[n];if(a.parent instanceof THREE.Bone){i.multiplyMatrices(t,a.matrixWorld);e.vertices[r].setFromMatrixPosition(i);i.multiplyMatrices(t,a.parent.matrixWorld);e.vertices[r+1].setFromMatrixPosition(i);r+=2}}e.verticesNeedUpdate=true;e.computeBoundingSphere()};THREE.SpotLightHelper=function(e){THREE.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrix=e.matrixWorld;this.matrixAutoUpdate=false;var t=new THREE.CylinderGeometry(0,1,1,8,1,true);t.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0));t.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var i=new THREE.MeshBasicMaterial({wireframe:true,fog:false});this.cone=new THREE.Mesh(t,i);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.SpotLightHelper.prototype.constructor=THREE.SpotLightHelper;THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};THREE.SpotLightHelper.prototype.update=function(){var e=new THREE.Vector3;var t=new THREE.Vector3;return function(){var i=this.light.distance?this.light.distance:1e4;var r=i*Math.tan(this.light.angle);this.cone.scale.set(r,r,i);e.setFromMatrixPosition(this.light.matrixWorld);t.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(t.sub(e));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();THREE.VertexNormalsHelper=function(e,t,i,r){this.object=e;this.size=t!==undefined?t:1;var n=i!==undefined?i:16711680;var a=r!==undefined?r:1;var o=new THREE.Geometry;var s=e.geometry.faces;for(var h=0,l=s.length;h<l;h++){var u=s[h];for(var c=0,p=u.vertexNormals.length;c<p;c++){o.vertices.push(new THREE.Vector3,new THREE.Vector3)}}THREE.Line.call(this,o,new THREE.LineBasicMaterial({color:n,linewidth:a}),THREE.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new THREE.Matrix3;this.update()};THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype);THREE.VertexNormalsHelper.prototype.constructor=THREE.VertexNormalsHelper;THREE.VertexNormalsHelper.prototype.update=function(e){var t=new THREE.Vector3;return function(e){var i=["a","b","c","d"];this.object.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);var r=this.geometry.vertices;var n=this.object.geometry.vertices;var a=this.object.geometry.faces;var o=this.object.matrixWorld;var s=0;for(var h=0,l=a.length;h<l;h++){var u=a[h];for(var c=0,p=u.vertexNormals.length;c<p;c++){var f=u[i[c]];var d=n[f];var m=u.vertexNormals[c];r[s].copy(d).applyMatrix4(o);t.copy(m).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);t.add(r[s]);s=s+1;r[s].copy(t);s=s+1}}this.geometry.verticesNeedUpdate=true;return this}}();THREE.VertexTangentsHelper=function(e,t,i,r){this.object=e;this.size=t!==undefined?t:1;var n=i!==undefined?i:255;var a=r!==undefined?r:1;var o=new THREE.Geometry;var s=e.geometry.faces;for(var h=0,l=s.length;h<l;h++){var u=s[h];for(var c=0,p=u.vertexTangents.length;c<p;c++){o.vertices.push(new THREE.Vector3);o.vertices.push(new THREE.Vector3)}}THREE.Line.call(this,o,new THREE.LineBasicMaterial({color:n,linewidth:a}),THREE.LinePieces);this.matrixAutoUpdate=false;this.update()};THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype);THREE.VertexTangentsHelper.prototype.constructor=THREE.VertexTangentsHelper;THREE.VertexTangentsHelper.prototype.update=function(e){var t=new THREE.Vector3;return function(e){var i=["a","b","c","d"];this.object.updateMatrixWorld(true);var r=this.geometry.vertices;var n=this.object.geometry.vertices;var a=this.object.geometry.faces;var o=this.object.matrixWorld;var s=0;for(var h=0,l=a.length;h<l;h++){var u=a[h];for(var c=0,p=u.vertexTangents.length;c<p;c++){var f=u[i[c]];var d=n[f];var m=u.vertexTangents[c];r[s].copy(d).applyMatrix4(o);t.copy(m).transformDirection(o).multiplyScalar(this.size);t.add(r[s]);s=s+1;r[s].copy(t);s=s+1}}this.geometry.verticesNeedUpdate=true;return this}}();THREE.WireframeHelper=function(e,t){var i=t!==undefined?t:16777215;var r=[0,0],n={};var a=function(e,t){return e-t};var o=["a","b","c"];var s=new THREE.BufferGeometry;if(e.geometry instanceof THREE.Geometry){var h=e.geometry.vertices;var l=e.geometry.faces;var u=0;var c=new Uint32Array(6*l.length);for(var p=0,f=l.length;p<f;p++){var d=l[p];for(var m=0;m<3;m++){r[0]=d[o[m]];r[1]=d[o[(m+1)%3]];r.sort(a);var g=r.toString();if(n[g]===undefined){c[2*u]=r[0];c[2*u+1]=r[1];n[g]=true;u++}}}var v=new Float32Array(u*2*3);for(var p=0,f=u;p<f;p++){for(var m=0;m<2;m++){var y=h[c[2*p+m]];var E=6*p+3*m;v[E+0]=y.x;v[E+1]=y.y;v[E+2]=y.z}}s.addAttribute("position",new THREE.BufferAttribute(v,3))}else if(e.geometry instanceof THREE.BufferGeometry){if(e.geometry.attributes.index!==undefined){var h=e.geometry.attributes.position.array;var w=e.geometry.attributes.index.array;var b=e.geometry.drawcalls;var u=0;if(b.length===0){b=[{count:w.length,index:0,start:0}]}var c=new Uint32Array(2*w.length);for(var _=0,x=b.length;_<x;++_){var T=b[_].start;var R=b[_].count;var E=b[_].index;for(var p=T,k=T+R;p<k;p+=3){for(var m=0;m<3;m++){r[0]=E+w[p+m];r[1]=E+w[p+(m+1)%3];r.sort(a);var g=r.toString();if(n[g]===undefined){c[2*u]=r[0];c[2*u+1]=r[1];n[g]=true;u++}}}}var v=new Float32Array(u*2*3);for(var p=0,f=u;p<f;p++){for(var m=0;m<2;m++){var E=6*p+3*m;var H=3*c[2*p+m];v[E+0]=h[H];v[E+1]=h[H+1];v[E+2]=h[H+2]}}s.addAttribute("position",new THREE.BufferAttribute(v,3))}else{var h=e.geometry.attributes.position.array;var u=h.length/3;var M=u/3;var v=new Float32Array(u*2*3);for(var p=0,f=M;p<f;p++){for(var m=0;m<3;m++){var E=18*p+6*m;var S=9*p+3*m;v[E+0]=h[S];v[E+1]=h[S+1];v[E+2]=h[S+2];var H=9*p+3*((m+1)%3);v[E+3]=h[H];v[E+4]=h[H+1];v[E+5]=h[H+2]}}s.addAttribute("position",new THREE.BufferAttribute(v,3))}}THREE.Line.call(this,s,new THREE.LineBasicMaterial({color:i}),THREE.LinePieces);this.matrix=e.matrixWorld;this.matrixAutoUpdate=false};THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype);THREE.WireframeHelper.prototype.constructor=THREE.WireframeHelper;THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(e){}};THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject;THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t);this.animationsMap={};this.animationsList=[];var i=this.geometry.morphTargets.length;var r="__default";var n=0;var a=i-1;var o=i/1;this.createAnimation(r,n,a,o);this.setAnimationWeight(r,1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh;THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,i,r){var n={startFrame:t,endFrame:i,length:i-t+1,fps:r,duration:(i-t)/r,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[e]=n;this.animationsList.push(n)};THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){var t=/([a-z]+)_?(\d+)/;var i,r={};var n=this.geometry;for(var a=0,o=n.morphTargets.length;a<o;a++){var s=n.morphTargets[a];var h=s.name.match(t);if(h&&h.length>1){var l=h[1];if(!r[l])r[l]={start:Infinity,end:-Infinity};var u=r[l];if(a<u.start)u.start=a;if(a>u.end)u.end=a;if(!i)i=l}}for(var l in r){var u=r[l];this.createAnimation(l,u.start,u.end,e)}this.firstAnimation=i};THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];if(t){t.direction=1;t.directionBackwards=false}};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];if(t){t.direction=-1;t.directionBackwards=true}};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var i=this.animationsMap[e];if(i){i.fps=t;i.duration=(i.end-i.start)/i.fps}};THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var i=this.animationsMap[e];if(i){i.duration=t;i.fps=(i.end-i.start)/i.duration}};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var i=this.animationsMap[e];if(i){i.weight=t}};THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var i=this.animationsMap[e];if(i){i.time=t}};THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;var i=this.animationsMap[e];if(i){t=i.time}return t};THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;var i=this.animationsMap[e];if(i){t=i.duration}return t};THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];if(t){t.time=0;t.active=true}else{THREE.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")}};THREE.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];if(t){t.active=false}};THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,i=this.animationsList.length;t<i;t++){var r=this.animationsList[t];if(!r.active)continue;var n=r.duration/r.length;r.time+=r.direction*e;if(r.mirroredLoop){if(r.time>r.duration||r.time<0){r.direction*=-1;if(r.time>r.duration){r.time=r.duration;r.directionBackwards=true}if(r.time<0){r.time=0;r.directionBackwards=false}}}else{r.time=r.time%r.duration;if(r.time<0)r.time+=r.duration}var a=r.startFrame+THREE.Math.clamp(Math.floor(r.time/n),0,r.length-1);var o=r.weight;if(a!==r.currentFrame){this.morphTargetInfluences[r.lastFrame]=0;this.morphTargetInfluences[r.currentFrame]=1*o;this.morphTargetInfluences[a]=0;r.lastFrame=r.currentFrame;r.currentFrame=a}var s=r.time%n/n;if(r.directionBackwards)s=1-s;this.morphTargetInfluences[r.currentFrame]=s*o;this.morphTargetInfluences[r.lastFrame]=(1-s)*o}};(function(){var e;var t=[],i=[];var r=0;var n=+new Date+"";var a=75;var o=40;var s=" \t\v\f\ufeff"+"\n\r\u2028\u2029"+"";var h=/\b__p \+= '';/g,l=/\b(__p \+=) '' \+/g,u=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var c=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var p=/\w*$/;var f=/^\s*function[ \n\r\t]+\w/;var d=/<%=([\s\S]+?)%>/g;var m=RegExp("^["+s+"]*0+(?=.$)");var g=/($^)/;var v=/\bthis\b/;var y=/['\n\r\t\u2028\u2029\\]/g;var E=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"];var w=0;var b="[object Arguments]",_="[object Array]",x="[object Boolean]",T="[object Date]",R="[object Function]",k="[object Number]",H="[object Object]",M="[object RegExp]",S="[object String]";var A={};A[R]=false;A[b]=A[_]=A[x]=A[T]=A[k]=A[H]=A[M]=A[S]=true;var C={leading:false,maxWait:0,trailing:false};var z={configurable:false,enumerable:false,value:null,writable:false};var P={boolean:false,function:true,object:true,number:false,string:false,undefined:false};var L={"\\":"\\","'":"'","\n":"n","\r":"r","\t":"t","\u2028":"u2028","\u2029":"u2029"};var O=P[typeof window]&&window||this;var D=P[typeof exports]&&exports&&!exports.nodeType&&exports;var F=P[typeof module]&&module&&!module.nodeType&&module;var B=F&&F.exports===D&&D;var U=P[typeof global]&&global;if(U&&(U.global===U||U.window===U)){O=U}function N(e,t,i){var r=(i||0)-1,n=e?e.length:0;while(++r<n){if(e[r]===t){return r}}return-1}function V(e,t){var i=typeof t;e=e.cache;if(i=="boolean"||t==null){return e[t]?0:-1}if(i!="number"&&i!="string"){i="object"}var r=i=="number"?t:n+t;e=(e=e[i])&&e[r];return i=="object"?e&&N(e,t)>-1?0:-1:e?0:-1}function I(e){var t=this.cache,i=typeof e;if(i=="boolean"||e==null){t[e]=true}else{if(i!="number"&&i!="string"){i="object"}var r=i=="number"?e:n+e,a=t[i]||(t[i]={});if(i=="object"){(a[r]||(a[r]=[])).push(e)}else{a[r]=true}}}function j(e){return e.charCodeAt(0)}function G(e,t){var i=e.criteria,r=t.criteria,n=-1,a=i.length;while(++n<a){var o=i[n],s=r[n];if(o!==s){if(o>s||typeof o=="undefined"){return 1}if(o<s||typeof s=="undefined"){return-1}}}return e.index-t.index}function W(e){var t=-1,i=e.length,r=e[0],n=e[i/2|0],a=e[i-1];if(r&&typeof r=="object"&&n&&typeof n=="object"&&a&&typeof a=="object"){return false}var o=Y();o["false"]=o["null"]=o["true"]=o["undefined"]=false;var s=Y();s.array=e;s.cache=o;s.push=I;while(++t<i){s.push(e[t])}return s}function q(e){return"\\"+L[e]}function X(){return t.pop()||[]}function Y(){return i.pop()||{array:null,cache:null,criteria:null,false:false,index:0,null:false,number:null,object:null,push:null,string:null,true:false,undefined:false,value:null}}function Z(e){e.length=0;if(t.length<o){t.push(e)}}function K(e){var t=e.cache;if(t){K(t)}e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null;if(i.length<o){i.push(e)}}function Q(e,t,i){t||(t=0);if(typeof i=="undefined"){i=e?e.length:0}var r=-1,n=i-t||0,a=Array(n<0?0:n);while(++r<n){a[r]=e[t+r]}return a}function J(t){t=t?$.defaults(O.Object(),t,$.pick(O,E)):O;var i=t.Array,o=t.Boolean,L=t.Date,D=t.Function,F=t.Math,B=t.Number,U=t.Object,I=t.RegExp,ee=t.String,te=t.TypeError;var ie=[];var re=U.prototype;var ne=t._;var ae=re.toString;var oe=I("^"+ee(ae).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");var se=F.ceil,he=t.clearTimeout,le=F.floor,ue=D.prototype.toString,ce=qe(ce=U.getPrototypeOf)&&ce,pe=re.hasOwnProperty,fe=ie.push,de=t.setTimeout,me=ie.splice,ge=ie.unshift;var ve=function(){try{var e={},t=qe(t=U.defineProperty)&&t,i=t(e,e,e)&&t}catch(e){}return i}();var ye=qe(ye=U.create)&&ye,Ee=qe(Ee=i.isArray)&&Ee,we=t.isFinite,be=t.isNaN,_e=qe(_e=U.keys)&&_e,xe=F.max,Te=F.min,Re=t.parseInt,ke=F.random;var He={};He[_]=i;He[x]=o;He[T]=L;He[R]=D;He[H]=U;He[k]=B;He[M]=I;He[S]=ee;function Me(e){return e&&typeof e=="object"&&!Qe(e)&&pe.call(e,"__wrapped__")?e:new Se(e)}function Se(e,t){this.__chain__=!!t;this.__wrapped__=e}Se.prototype=Me.prototype;var Ae=Me.support={};Ae.funcDecomp=!qe(t.WinRTError)&&v.test(J);Ae.funcNames=typeof D.name=="string";Me.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:d,variable:"",imports:{_:Me}};function Ce(e){var t=e[0],i=e[2],r=e[4];function n(){if(i){var e=Q(i);fe.apply(e,arguments)}if(this instanceof n){var a=Pe(t.prototype),o=t.apply(a,e||arguments);return Rt(o)?o:a}return t.apply(r,e||arguments)}Xe(n,e);return n}function ze(e,t,i,r,n){if(i){var a=i(e);if(typeof a!="undefined"){return a}}var o=Rt(e);if(o){var s=ae.call(e);if(!A[s]){return e}var h=He[s];switch(s){case x:case T:return new h(+e);case k:case S:return new h(e);case M:a=h(e.source,p.exec(e));a.lastIndex=e.lastIndex;return a}}else{return e}var l=Qe(e);if(t){var u=!r;r||(r=X());n||(n=X());var c=r.length;while(c--){if(r[c]==e){return n[c]}}a=l?h(e.length):{}}else{a=l?Q(e):nt({},e)}if(l){if(pe.call(e,"index")){a.index=e.index}if(pe.call(e,"input")){a.input=e.input}}if(!t){return a}r.push(e);n.push(a);(l?Xt:ft)(e,function(e,o){a[o]=ze(e,t,i,r,n)});if(u){Z(r);Z(n)}return a}function Pe(e,t){return Rt(e)?ye(e):{}}if(!ye){Pe=function(){function e(){}return function(i){if(Rt(i)){e.prototype=i;var r=new e;e.prototype=null}return r||t.Object()}}()}function Le(e,t,i){if(typeof e!="function"){return Ji}if(typeof t=="undefined"||!("prototype"in e)){return e}var r=e.__bindData__;if(typeof r=="undefined"){if(Ae.funcNames){r=!e.name}r=r||!Ae.funcDecomp;if(!r){var n=ue.call(e);if(!Ae.funcNames){r=!f.test(n)}if(!r){r=v.test(n);Xe(e,r)}}}if(r===false||r!==true&&r[1]&1){return e}switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,r){return e.call(t,i,r)};case 3:return function(i,r,n){return e.call(t,i,r,n)};case 4:return function(i,r,n,a){return e.call(t,i,r,n,a)}}return Oi(e,t)}function Oe(e){var t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5];var s=i&1,h=i&2,l=i&4,u=i&8,c=t;function p(){var e=s?a:this;if(r){var f=Q(r);fe.apply(f,arguments)}if(n||l){f||(f=Q(arguments));if(n){fe.apply(f,n)}if(l&&f.length<o){i|=16&~32;return Oe([t,u?i:i&~3,f,null,a,o])}}f||(f=arguments);if(h){t=e[c]}if(this instanceof p){e=Pe(t.prototype);var d=t.apply(e,f);return Rt(d)?d:e}return t.apply(e,f)}Xe(p,e);return p}function De(e,t){var i=-1,r=We(),n=e?e.length:0,o=n>=a&&r===N,s=[];if(o){var h=W(t);if(h){r=V;t=h}else{o=false}}while(++i<n){var l=e[i];if(r(t,l)<0){s.push(l)}}if(o){K(t)}return s}function Fe(e,t,i,r){var n=(r||0)-1,a=e?e.length:0,o=[];while(++n<a){var s=e[n];if(s&&typeof s=="object"&&typeof s.length=="number"&&(Qe(s)||Ke(s))){if(!t){s=Fe(s,t,i)}var h=-1,l=s.length,u=o.length;o.length+=l;while(++h<l){o[u++]=s[h]}}else if(!i){o.push(s)}}return o}function Be(e,t,i,r,n,a){if(i){var o=i(e,t);if(typeof o!="undefined"){return!!o}}if(e===t){return e!==0||1/e==1/t}var s=typeof e,h=typeof t;if(e===e&&!(e&&P[s])&&!(t&&P[h])){return false}if(e==null||t==null){return e===t}var l=ae.call(e),u=ae.call(t);if(l==b){l=H}if(u==b){u=H}if(l!=u){return false}switch(l){case x:case T:return+e==+t;case k:return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case M:case S:return e==ee(t)}var c=l==_;if(!c){var p=pe.call(e,"__wrapped__"),f=pe.call(t,"__wrapped__");if(p||f){return Be(p?e.__wrapped__:e,f?t.__wrapped__:t,i,r,n,a)}if(l!=H){return false}var d=e.constructor,m=t.constructor;if(d!=m&&!(Tt(d)&&d instanceof d&&Tt(m)&&m instanceof m)&&("constructor"in e&&"constructor"in t)){return false}}var g=!n;n||(n=X());a||(a=X());var v=n.length;while(v--){if(n[v]==e){return a[v]==t}}var y=0;o=true;n.push(e);a.push(t);if(c){v=e.length;y=t.length;o=y==v;if(o||r){while(y--){var E=v,w=t[y];if(r){while(E--){if(o=Be(e[E],w,i,r,n,a)){break}}}else if(!(o=Be(e[y],w,i,r,n,a))){break}}}}else{ct(t,function(t,s,h){if(pe.call(h,s)){y++;return o=pe.call(e,s)&&Be(e[s],t,i,r,n,a)}});if(o&&!r){ct(e,function(e,t,i){if(pe.call(i,t)){return o=--y>-1}})}}n.pop();a.pop();if(g){Z(n);Z(a)}return o}function Ue(e,t,i,r,n){(Qe(t)?Xt:ft)(t,function(t,a){var o,s,h=t,l=e[a];if(t&&((s=Qe(t))||St(t))){var u=r.length;while(u--){if(o=r[u]==t){l=n[u];break}}if(!o){var c;if(i){h=i(l,t);if(c=typeof h!="undefined"){l=h}}if(!c){l=s?Qe(l)?l:[]:St(l)?l:{}}r.push(t);n.push(l);if(!c){Ue(l,t,i,r,n)}}}else{if(i){h=i(l,t);if(typeof h=="undefined"){h=t}}if(typeof h!="undefined"){l=h}}e[a]=l})}function Ne(e,t){return e+le(ke()*(t-e+1))}function Ve(e,t,i){var r=-1,n=We(),o=e?e.length:0,s=[];var h=!t&&o>=a&&n===N,l=i||h?X():s;if(h){var u=W(l);n=V;l=u}while(++r<o){var c=e[r],p=i?i(c,r,e):c;if(t?!r||l[l.length-1]!==p:n(l,p)<0){if(i||h){l.push(p)}s.push(c)}}if(h){Z(l.array);K(l)}else if(i){Z(l)}return s}function Ie(e){return function(t,i,r){var n={};i=Me.createCallback(i,r,3);var a=-1,o=t?t.length:0;if(typeof o=="number"){while(++a<o){var s=t[a];e(n,s,i(s,a,t),t)}}else{ft(t,function(t,r,a){e(n,t,i(t,r,a),a)})}return n}}function je(e,t,i,r,n,a){var o=t&1,s=t&2,h=t&4,l=t&8,u=t&16,c=t&32;if(!s&&!Tt(e)){throw new te}if(u&&!i.length){t&=~16;u=i=false}if(c&&!r.length){t&=~32;c=r=false}var p=e&&e.__bindData__;if(p&&p!==true){p=Q(p);if(p[2]){p[2]=Q(p[2])}if(p[3]){p[3]=Q(p[3])}if(o&&!(p[1]&1)){p[4]=n}if(!o&&p[1]&1){t|=8}if(h&&!(p[1]&4)){p[5]=a}if(u){fe.apply(p[2]||(p[2]=[]),i)}if(c){ge.apply(p[3]||(p[3]=[]),r)}p[1]|=t;return je.apply(null,p)}var f=t==1||t===17?Ce:Oe;return f([e,t,i,r,n,a])}function Ge(e){return et[e]}function We(){var e=(e=Me.indexOf)===yi?N:e;return e}function qe(e){return typeof e=="function"&&oe.test(e)}var Xe=!ve?tr:function(e,t){z.value=t;ve(e,"__bindData__",z)};function Ye(e){var t,i;if(!(e&&ae.call(e)==H)||(t=e.constructor,Tt(t)&&!(t instanceof t))){return false}ct(e,function(e,t){i=t});return typeof i=="undefined"||pe.call(e,i)}function Ze(e){return tt[e]}function Ke(e){return e&&typeof e=="object"&&typeof e.length=="number"&&ae.call(e)==b||false}var Qe=Ee||function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&ae.call(e)==_||false};var Je=function(e){var t,i=e,r=[];if(!i)return r;if(!P[typeof e])return r;for(t in i){if(pe.call(i,t)){r.push(t)}}return r};var $e=!_e?Je:function(e){if(!Rt(e)){return[]}return _e(e)};var et={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};var tt=vt(et);var it=I("("+$e(tt).join("|")+")","g"),rt=I("["+$e(et).join("")+"]","g");var nt=function(e,t,i){var r,n=e,a=n;if(!n)return a;var o=arguments,s=0,h=typeof i=="number"?2:o.length;if(h>3&&typeof o[h-2]=="function"){var l=Le(o[--h-1],o[h--],2)}else if(h>2&&typeof o[h-1]=="function"){l=o[--h]}while(++s<h){n=o[s];if(n&&P[typeof n]){var u=-1,c=P[typeof n]&&$e(n),p=c?c.length:0;while(++u<p){r=c[u];a[r]=l?l(a[r],n[r]):n[r]}}}return a};function at(e,t,i,r){if(typeof t!="boolean"&&t!=null){r=i;i=t;t=false}return ze(e,t,typeof i=="function"&&Le(i,r,1))}function ot(e,t,i){return ze(e,true,typeof t=="function"&&Le(t,i,1))}function st(e,t){var i=Pe(e);return t?nt(i,t):i}var ht=function(e,t,i){var r,n=e,a=n;if(!n)return a;var o=arguments,s=0,h=typeof i=="number"?2:o.length;while(++s<h){n=o[s];if(n&&P[typeof n]){var l=-1,u=P[typeof n]&&$e(n),c=u?u.length:0;while(++l<c){r=u[l];if(typeof a[r]=="undefined")a[r]=n[r]}}}return a};function lt(e,t,i){var r;t=Me.createCallback(t,i,3);ft(e,function(e,i,n){if(t(e,i,n)){r=i;return false}});return r}function ut(e,t,i){var r;t=Me.createCallback(t,i,3);dt(e,function(e,i,n){if(t(e,i,n)){r=i;return false}});return r}var ct=function(e,t,i){var r,n=e,a=n;if(!n)return a;if(!P[typeof n])return a;t=t&&typeof i=="undefined"?t:Le(t,i,3);for(r in n){if(t(n[r],r,e)===false)return a}return a};function pt(e,t,i){var r=[];ct(e,function(e,t){r.push(t,e)});var n=r.length;t=Le(t,i,3);while(n--){if(t(r[n--],r[n],e)===false){break}}return e}var ft=function(e,t,i){var r,n=e,a=n;if(!n)return a;if(!P[typeof n])return a;t=t&&typeof i=="undefined"?t:Le(t,i,3);var o=-1,s=P[typeof n]&&$e(n),h=s?s.length:0;while(++o<h){r=s[o];if(t(n[r],r,e)===false)return a}return a};function dt(e,t,i){var r=$e(e),n=r.length;t=Le(t,i,3);while(n--){var a=r[n];if(t(e[a],a,e)===false){break}}return e}function mt(e){var t=[];ct(e,function(e,i){if(Tt(e)){t.push(i)}});return t.sort()}function gt(e,t){return e?pe.call(e,t):false}function vt(e){var t=-1,i=$e(e),r=i.length,n={};while(++t<r){var a=i[t];n[e[a]]=a}return n}function yt(e){return e===true||e===false||e&&typeof e=="object"&&ae.call(e)==x||false}function Et(e){return e&&typeof e=="object"&&ae.call(e)==T||false}function wt(e){return e&&e.nodeType===1||false}function bt(e){var t=true;if(!e){return t}var i=ae.call(e),r=e.length;if(i==_||i==S||i==b||i==H&&typeof r=="number"&&Tt(e.splice)){return!r}ft(e,function(){return t=false});return t}function _t(e,t,i,r){return Be(e,t,typeof i=="function"&&Le(i,r,2))}function xt(e){return we(e)&&!be(parseFloat(e))}function Tt(e){return typeof e=="function"}function Rt(e){return!!(e&&P[typeof e])}function kt(e){return Mt(e)&&e!=+e}function Ht(e){return e===null}function Mt(e){return typeof e=="number"||e&&typeof e=="object"&&ae.call(e)==k||false}var St=!ce?Ye:function(e){if(!(e&&ae.call(e)==H)){return false}var t=e.valueOf,i=qe(t)&&(i=ce(t))&&ce(i);return i?e==i||ce(e)==i:Ye(e)};function At(e){return e&&typeof e=="object"&&ae.call(e)==M||false}function Ct(e){return typeof e=="string"||e&&typeof e=="object"&&ae.call(e)==S||false}function zt(e){return typeof e=="undefined"}function Pt(e,t,i){var r={};t=Me.createCallback(t,i,3);ft(e,function(e,i,n){r[i]=t(e,i,n)});return r}function Lt(e){var t=arguments,i=2;if(!Rt(e)){return e}if(typeof t[2]!="number"){i=t.length}if(i>3&&typeof t[i-2]=="function"){var r=Le(t[--i-1],t[i--],2)}else if(i>2&&typeof t[i-1]=="function"){r=t[--i]}var n=Q(arguments,1,i),a=-1,o=X(),s=X();while(++a<i){Ue(e,n[a],r,o,s)}Z(o);Z(s);return e}function Ot(e,t,i){var r={};if(typeof t!="function"){var n=[];ct(e,function(e,t){n.push(t)});n=De(n,Fe(arguments,true,false,1));var a=-1,o=n.length;while(++a<o){var s=n[a];r[s]=e[s]}}else{t=Me.createCallback(t,i,3);ct(e,function(e,i,n){if(!t(e,i,n)){r[i]=e}})}return r}function Dt(e){var t=-1,r=$e(e),n=r.length,a=i(n);while(++t<n){var o=r[t];a[t]=[o,e[o]]}return a}function Ft(e,t,i){var r={};if(typeof t!="function"){var n=-1,a=Fe(arguments,true,false,1),o=Rt(e)?a.length:0;while(++n<o){var s=a[n];if(s in e){r[s]=e[s]}}}else{t=Me.createCallback(t,i,3);ct(e,function(e,i,n){if(t(e,i,n)){r[i]=e}})}return r}function Bt(e,t,i,r){var n=Qe(e);if(i==null){if(n){i=[]}else{var a=e&&e.constructor,o=a&&a.prototype;i=Pe(o)}}if(t){t=Me.createCallback(t,r,4);(n?Xt:ft)(e,function(e,r,n){return t(i,e,r,n)})}return i}function Ut(e){var t=-1,r=$e(e),n=r.length,a=i(n);while(++t<n){a[t]=e[r[t]]}return a}function Nt(e){var t=arguments,r=-1,n=Fe(t,true,false,1),a=t[2]&&t[2][t[1]]===e?1:n.length,o=i(a);while(++r<a){o[r]=e[n[r]]}return o}function Vt(e,t,i){var r=-1,n=We(),a=e?e.length:0,o=false;i=(i<0?xe(0,a+i):i)||0;if(Qe(e)){o=n(e,t,i)>-1}else if(typeof a=="number"){o=(Ct(e)?e.indexOf(t,i):n(e,t,i))>-1}else{ft(e,function(e){if(++r>=i){return!(o=e===t)}})}return o}var It=Ie(function(e,t,i){pe.call(e,i)?e[i]++:e[i]=1});function jt(e,t,i){var r=true;t=Me.createCallback(t,i,3);var n=-1,a=e?e.length:0;if(typeof a=="number"){while(++n<a){if(!(r=!!t(e[n],n,e))){break}}}else{ft(e,function(e,i,n){return r=!!t(e,i,n)})}return r}function Gt(e,t,i){var r=[];t=Me.createCallback(t,i,3);var n=-1,a=e?e.length:0;if(typeof a=="number"){while(++n<a){var o=e[n];if(t(o,n,e)){r.push(o)}}}else{ft(e,function(e,i,n){if(t(e,i,n)){r.push(e)}})}return r}function Wt(e,t,i){t=Me.createCallback(t,i,3);var r=-1,n=e?e.length:0;if(typeof n=="number"){while(++r<n){var a=e[r];if(t(a,r,e)){return a}}}else{var o;ft(e,function(e,i,r){if(t(e,i,r)){o=e;return false}});return o}}function qt(e,t,i){var r;t=Me.createCallback(t,i,3);Yt(e,function(e,i,n){if(t(e,i,n)){r=e;return false}});return r}function Xt(e,t,i){var r=-1,n=e?e.length:0;t=t&&typeof i=="undefined"?t:Le(t,i,3);if(typeof n=="number"){while(++r<n){if(t(e[r],r,e)===false){break}}}else{ft(e,t)}return e}function Yt(e,t,i){var r=e?e.length:0;t=t&&typeof i=="undefined"?t:Le(t,i,3);if(typeof r=="number"){while(r--){if(t(e[r],r,e)===false){break}}}else{var n=$e(e);r=n.length;ft(e,function(e,i,a){i=n?n[--r]:--r;return t(a[i],i,a)})}return e}var Zt=Ie(function(e,t,i){(pe.call(e,i)?e[i]:e[i]=[]).push(t)});var Kt=Ie(function(e,t,i){e[i]=t});function Qt(e,t){var r=Q(arguments,2),n=-1,a=typeof t=="function",o=e?e.length:0,s=i(typeof o=="number"?o:0);Xt(e,function(e){s[++n]=(a?t:e[t]).apply(e,r)});return s}function Jt(e,t,r){var n=-1,a=e?e.length:0;t=Me.createCallback(t,r,3);if(typeof a=="number"){var o=i(a);while(++n<a){o[n]=t(e[n],n,e)}}else{o=[];ft(e,function(e,i,r){o[++n]=t(e,i,r)})}return o}function $t(e,t,i){var r=-Infinity,n=r;if(typeof t!="function"&&i&&i[t]===e){t=null}if(t==null&&Qe(e)){var a=-1,o=e.length;while(++a<o){var s=e[a];if(s>n){n=s}}}else{t=t==null&&Ct(e)?j:Me.createCallback(t,i,3);Xt(e,function(e,i,a){var o=t(e,i,a);if(o>r){r=o;n=e}})}return n}function ei(e,t,i){var r=Infinity,n=r;if(typeof t!="function"&&i&&i[t]===e){t=null}if(t==null&&Qe(e)){var a=-1,o=e.length;while(++a<o){var s=e[a];if(s<n){n=s}}}else{t=t==null&&Ct(e)?j:Me.createCallback(t,i,3);Xt(e,function(e,i,a){var o=t(e,i,a);if(o<r){r=o;n=e}})}return n}var ti=Jt;function ii(e,t,i,r){if(!e)return i;var n=arguments.length<3;t=Me.createCallback(t,r,4);var a=-1,o=e.length;if(typeof o=="number"){if(n){i=e[++a]}while(++a<o){i=t(i,e[a],a,e)}}else{ft(e,function(e,r,a){i=n?(n=false,e):t(i,e,r,a)})}return i}function ri(e,t,i,r){var n=arguments.length<3;t=Me.createCallback(t,r,4);Yt(e,function(e,r,a){i=n?(n=false,e):t(i,e,r,a)});return i}function ni(e,t,i){t=Me.createCallback(t,i,3);return Gt(e,function(e,i,r){return!t(e,i,r)})}function ai(t,i,r){if(t&&typeof t.length!="number"){t=Ut(t)}if(i==null||r){return t?t[Ne(0,t.length-1)]:e}var n=oi(t);n.length=Te(xe(0,i),n.length);return n}function oi(e){var t=-1,r=e?e.length:0,n=i(typeof r=="number"?r:0);Xt(e,function(e){var i=Ne(0,++t);n[t]=n[i];n[i]=e});return n}function si(e){var t=e?e.length:0;return typeof t=="number"?t:$e(e).length}function hi(e,t,i){var r;t=Me.createCallback(t,i,3);var n=-1,a=e?e.length:0;if(typeof a=="number"){while(++n<a){if(r=t(e[n],n,e)){break}}}else{ft(e,function(e,i,n){return!(r=t(e,i,n))})}return!!r}function li(e,t,r){var n=-1,a=Qe(t),o=e?e.length:0,s=i(typeof o=="number"?o:0);if(!a){t=Me.createCallback(t,r,3)}Xt(e,function(e,i,r){var o=s[++n]=Y();if(a){o.criteria=Jt(t,function(t){return e[t]})}else{(o.criteria=X())[0]=t(e,i,r)}o.index=n;o.value=e});o=s.length;s.sort(G);while(o--){var h=s[o];s[o]=h.value;if(!a){Z(h.criteria)}K(h)}return s}function ui(e){if(e&&typeof e.length=="number"){return Q(e)}return Ut(e)}var ci=Gt;function pi(e){var t=-1,i=e?e.length:0,r=[];while(++t<i){var n=e[t];if(n){r.push(n)}}return r}function fi(e){return De(e,Fe(arguments,true,true,1))}function di(e,t,i){var r=-1,n=e?e.length:0;t=Me.createCallback(t,i,3);while(++r<n){if(t(e[r],r,e)){return r}}return-1}function mi(e,t,i){var r=e?e.length:0;t=Me.createCallback(t,i,3);while(r--){if(t(e[r],r,e)){return r}}return-1}function gi(t,i,r){var n=0,a=t?t.length:0;if(typeof i!="number"&&i!=null){var o=-1;i=Me.createCallback(i,r,3);while(++o<a&&i(t[o],o,t)){n++}}else{n=i;if(n==null||r){return t?t[0]:e}}return Q(t,0,Te(xe(0,n),a))}function vi(e,t,i,r){if(typeof t!="boolean"&&t!=null){r=i;i=typeof t!="function"&&r&&r[t]===e?null:t;t=false}if(i!=null){e=Jt(e,i,r)}return Fe(e,t)}function yi(e,t,i){if(typeof i=="number"){var r=e?e.length:0;i=i<0?xe(0,r+i):i||0}else if(i){var n=Hi(e,t);return e[n]===t?n:-1}return N(e,t,i)}function Ei(e,t,i){var r=0,n=e?e.length:0;if(typeof t!="number"&&t!=null){var a=n;t=Me.createCallback(t,i,3);while(a--&&t(e[a],a,e)){r++}}else{r=t==null||i?1:t||r}return Q(e,0,Te(xe(0,n-r),n))}function wi(){var e=[],t=-1,i=arguments.length,r=X(),n=We(),o=n===N,s=X();while(++t<i){var h=arguments[t];if(Qe(h)||Ke(h)){e.push(h);r.push(o&&h.length>=a&&W(t?e[t]:s))}}var l=e[0],u=-1,c=l?l.length:0,p=[];e:while(++u<c){var f=r[0];h=l[u];if((f?V(f,h):n(s,h))<0){t=i;(f||s).push(h);while(--t){f=r[t];if((f?V(f,h):n(e[t],h))<0){continue e}}p.push(h)}}while(i--){f=r[i];if(f){K(f)}}Z(r);Z(s);return p}function bi(t,i,r){var n=0,a=t?t.length:0;if(typeof i!="number"&&i!=null){var o=a;i=Me.createCallback(i,r,3);while(o--&&i(t[o],o,t)){n++}}else{n=i;if(n==null||r){return t?t[a-1]:e}}return Q(t,xe(0,a-n))}function _i(e,t,i){var r=e?e.length:0;if(typeof i=="number"){r=(i<0?xe(0,r+i):Te(i,r-1))+1}while(r--){if(e[r]===t){return r}}return-1}function xi(e){var t=arguments,i=0,r=t.length,n=e?e.length:0;while(++i<r){var a=-1,o=t[i];while(++a<n){if(e[a]===o){me.call(e,a--,1);n--}}}return e}function Ti(e,t,r){e=+e||0;r=typeof r=="number"?r:+r||1;if(t==null){t=e;e=0}var n=-1,a=xe(0,se((t-e)/(r||1))),o=i(a);while(++n<a){o[n]=e;e+=r}return o}function Ri(e,t,i){var r=-1,n=e?e.length:0,a=[];t=Me.createCallback(t,i,3);while(++r<n){var o=e[r];if(t(o,r,e)){a.push(o);me.call(e,r--,1);n--}}return a}function ki(e,t,i){if(typeof t!="number"&&t!=null){var r=0,n=-1,a=e?e.length:0;t=Me.createCallback(t,i,3);while(++n<a&&t(e[n],n,e)){r++}}else{r=t==null||i?1:xe(0,t)}return Q(e,r)}function Hi(e,t,i,r){var n=0,a=e?e.length:n;i=i?Me.createCallback(i,r,1):Ji;t=i(t);while(n<a){var o=n+a>>>1;i(e[o])<t?n=o+1:a=o}return n}function Mi(){return Ve(Fe(arguments,true,true))}function Si(e,t,i,r){if(typeof t!="boolean"&&t!=null){r=i;i=typeof t!="function"&&r&&r[t]===e?null:t;t=false}if(i!=null){i=Me.createCallback(i,r,3)}return Ve(e,t,i)}function Ai(e){return De(e,Q(arguments,1))}function Ci(){var e=-1,t=arguments.length;while(++e<t){var i=arguments[e];if(Qe(i)||Ke(i)){var r=r?Ve(De(r,i).concat(De(i,r))):i}}return r||[]}function zi(){var e=arguments.length>1?arguments:arguments[0],t=-1,r=e?$t(ti(e,"length")):0,n=i(r<0?0:r);while(++t<r){n[t]=ti(e,t)}return n}function Pi(e,t){var i=-1,r=e?e.length:0,n={};if(!t&&r&&!Qe(e[0])){t=[]}while(++i<r){var a=e[i];if(t){n[a]=t[i]}else if(a){n[a[0]]=a[1]}}return n}function Li(e,t){if(!Tt(t)){throw new te}return function(){if(--e<1){return t.apply(this,arguments)}}}function Oi(e,t){return arguments.length>2?je(e,17,Q(arguments,2),null,t):je(e,1,null,null,t)}function Di(e){var t=arguments.length>1?Fe(arguments,true,false,1):mt(e),i=-1,r=t.length;while(++i<r){var n=t[i];e[n]=je(e[n],1,null,null,e)}return e}function Fi(e,t){return arguments.length>2?je(t,19,Q(arguments,2),null,e):je(t,3,null,null,e)}function Bi(){var e=arguments,t=e.length;while(t--){if(!Tt(e[t])){throw new te}}return function(){var t=arguments,i=e.length;while(i--){t=[e[i].apply(this,t)]}return t[0]}}function Ui(e,t){t=typeof t=="number"?t:+t||e.length;return je(e,4,null,null,null,t)}function Ni(t,i,r){var n,a,o,s,h,l,u,c=0,p=false,f=true;if(!Tt(t)){throw new te}i=xe(0,i)||0;if(r===true){var d=true;f=false}else if(Rt(r)){d=r.leading;p="maxWait"in r&&(xe(i,r.maxWait)||0);f="trailing"in r?r.trailing:f}var m=function(){var r=i-(ir()-s);if(r<=0){if(a){he(a)}var p=u;a=l=u=e;if(p){c=ir();o=t.apply(h,n);if(!l&&!a){n=h=null}}}else{l=de(m,r)}};var g=function(){if(l){he(l)}a=l=u=e;if(f||p!==i){c=ir();o=t.apply(h,n);if(!l&&!a){n=h=null}}};return function(){n=arguments;s=ir();h=this;u=f&&(l||!d);if(p===false){var e=d&&!l}else{if(!a&&!d){c=s}var r=p-(s-c),v=r<=0;if(v){if(a){a=he(a)}c=s;o=t.apply(h,n)}else if(!a){a=de(g,r)}}if(v&&l){l=he(l)}else if(!l&&i!==p){l=de(m,i)}if(e){v=true;o=t.apply(h,n)}if(v&&!l&&!a){n=h=null}return o}}function Vi(t){if(!Tt(t)){throw new te}var i=Q(arguments,1);return de(function(){t.apply(e,i)},1)}function Ii(t,i){if(!Tt(t)){throw new te}var r=Q(arguments,2);return de(function(){t.apply(e,r)},i)}function ji(e,t){if(!Tt(e)){throw new te}var i=function(){var r=i.cache,a=t?t.apply(this,arguments):n+arguments[0];return pe.call(r,a)?r[a]:r[a]=e.apply(this,arguments)};i.cache={};return i}function Gi(e){var t,i;if(!Tt(e)){throw new te}return function(){if(t){return i}t=true;i=e.apply(this,arguments);e=null;return i}}function Wi(e){return je(e,16,Q(arguments,1))}function qi(e){return je(e,32,null,Q(arguments,1))}function Xi(e,t,i){var r=true,n=true;if(!Tt(e)){throw new te}if(i===false){r=false}else if(Rt(i)){r="leading"in i?i.leading:r;n="trailing"in i?i.trailing:n}C.leading=r;C.maxWait=t;C.trailing=n;return Ni(e,t,C)}function Yi(e,t){return je(t,16,[e])}function Zi(e){return function(){return e}}function Ki(e,t,i){var r=typeof e;if(e==null||r=="function"){return Le(e,t,i)}if(r!="object"){return nr(e)}var n=$e(e),a=n[0],o=e[a];if(n.length==1&&o===o&&!Rt(o)){return function(e){var t=e[a];return o===t&&(o!==0||1/o==1/t)}}return function(t){var i=n.length,r=false;while(i--){if(!(r=Be(t[n[i]],e[n[i]],null,true))){break}}return r}}function Qi(e){return e==null?"":ee(e).replace(rt,Ge)}function Ji(e){return e}function $i(e,t,i){var r=true,n=t&&mt(t);if(!t||!i&&!n.length){if(i==null){i=t}a=Se;t=e;e=Me;n=mt(t)}if(i===false){r=false}else if(Rt(i)&&"chain"in i){r=i.chain}var a=e,o=Tt(a);Xt(n,function(i){var n=e[i]=t[i];if(o){a.prototype[i]=function(){var t=this.__chain__,i=this.__wrapped__,o=[i];fe.apply(o,arguments);var s=n.apply(e,o);if(r||t){if(i===s&&Rt(s)){return this}s=new a(s);s.__chain__=t}return s}}})}function er(){t._=ne;return this}function tr(){}var ir=qe(ir=L.now)&&ir||function(){return(new L).getTime()};var rr=Re(s+"08")==8?Re:function(e,t){return Re(Ct(e)?e.replace(m,""):e,t||0)};function nr(e){return function(t){return t[e]}}function ar(e,t,i){var r=e==null,n=t==null;if(i==null){if(typeof e=="boolean"&&n){i=e;e=1}else if(!n&&typeof t=="boolean"){i=t;n=true}}if(r&&n){t=1}e=+e||0;if(n){t=e;e=0}else{t=+t||0}if(i||e%1||t%1){var a=ke();return Te(e+a*(t-e+parseFloat("1e-"+((a+"").length-1))),t)}return Ne(e,t)}function or(e,t){if(e){var i=e[t];return Tt(i)?e[t]():i}}function sr(t,i,r){var n=Me.templateSettings;t=ee(t||"");r=ht({},r,n);var a=ht({},r.imports,n.imports),o=$e(a),s=Ut(a);var p,f=0,m=r.interpolate||g,v="__p += '";var E=I((r.escape||g).source+"|"+m.source+"|"+(m===d?c:g).source+"|"+(r.evaluate||g).source+"|$","g");t.replace(E,function(e,i,r,n,a,o){r||(r=n);v+=t.slice(f,o).replace(y,q);if(i){v+="' +\n__e("+i+") +\n'"}if(a){p=true;v+="';\n"+a+";\n__p += '"}if(r){v+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"}f=o+e.length;return e});v+="';\n";var b=r.variable,_=b;if(!_){b="obj";v="with ("+b+") {\n"+v+"\n}\n"}v=(p?v.replace(h,""):v).replace(l,"$1").replace(u,"$1;");v="function("+b+") {\n"+(_?"":b+" || ("+b+" = {});\n")+"var __t, __p = '', __e = _.escape"+(p?", __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n":";\n")+v+"return __p\n}";var x="\n/*\n//# sourceURL="+(r.sourceURL||"/lodash/template/source["+w+++"]")+"\n*/";try{var T=D(o,"return "+v+x).apply(e,s)}catch(e){e.source=v;throw e}if(i){return T(i)}T.source=v;return T}function hr(e,t,r){e=(e=+e)>-1?e:0;var n=-1,a=i(e);t=Le(t,r,1);while(++n<e){a[n]=t(n)}return a}function lr(e){return e==null?"":ee(e).replace(it,Ze)}function ur(e){var t=++r;return ee(e==null?"":e)+t}function cr(e){e=new Se(e);e.__chain__=true;return e}function pr(e,t){t(e);return e}function fr(){this.__chain__=true;return this}function dr(){return ee(this.__wrapped__)}function mr(){return this.__wrapped__}Me.after=Li;Me.assign=nt;Me.at=Nt;Me.bind=Oi;Me.bindAll=Di;Me.bindKey=Fi;Me.chain=cr;Me.compact=pi;Me.compose=Bi;Me.constant=Zi;Me.countBy=It;Me.create=st;Me.createCallback=Ki;Me.curry=Ui;Me.debounce=Ni;Me.defaults=ht;Me.defer=Vi;Me.delay=Ii;Me.difference=fi;Me.filter=Gt;Me.flatten=vi;Me.forEach=Xt;Me.forEachRight=Yt;Me.forIn=ct;Me.forInRight=pt;Me.forOwn=ft;Me.forOwnRight=dt;Me.functions=mt;Me.groupBy=Zt;Me.indexBy=Kt;Me.initial=Ei;Me.intersection=wi;Me.invert=vt;Me.invoke=Qt;Me.keys=$e;Me.map=Jt;Me.mapValues=Pt;Me.max=$t;Me.memoize=ji;Me.merge=Lt;Me.min=ei;Me.omit=Ot;Me.once=Gi;Me.pairs=Dt;Me.partial=Wi;Me.partialRight=qi;Me.pick=Ft;Me.pluck=ti;Me.property=nr;Me.pull=xi;Me.range=Ti;Me.reject=ni;Me.remove=Ri;Me.rest=ki;Me.shuffle=oi;Me.sortBy=li;Me.tap=pr;Me.throttle=Xi;Me.times=hr;Me.toArray=ui;Me.transform=Bt;Me.union=Mi;Me.uniq=Si;Me.values=Ut;Me.where=ci;Me.without=Ai;Me.wrap=Yi;Me.xor=Ci;Me.zip=zi;Me.zipObject=Pi;Me.collect=Jt;Me.drop=ki;Me.each=Xt;Me.eachRight=Yt;Me.extend=nt;Me.methods=mt;Me.object=Pi;Me.select=Gt;Me.tail=ki;Me.unique=Si;Me.unzip=zi;$i(Me);Me.clone=at;Me.cloneDeep=ot;Me.contains=Vt;Me.escape=Qi;Me.every=jt;Me.find=Wt;Me.findIndex=di;Me.findKey=lt;Me.findLast=qt;Me.findLastIndex=mi;Me.findLastKey=ut;Me.has=gt;Me.identity=Ji;Me.indexOf=yi;Me.isArguments=Ke;Me.isArray=Qe;Me.isBoolean=yt;Me.isDate=Et;Me.isElement=wt;Me.isEmpty=bt;Me.isEqual=_t;Me.isFinite=xt;Me.isFunction=Tt;Me.isNaN=kt;Me.isNull=Ht;Me.isNumber=Mt;Me.isObject=Rt;Me.isPlainObject=St;Me.isRegExp=At;Me.isString=Ct;Me.isUndefined=zt;Me.lastIndexOf=_i;Me.mixin=$i;Me.noConflict=er;Me.noop=tr;Me.now=ir;Me.parseInt=rr;Me.random=ar;Me.reduce=ii;Me.reduceRight=ri;Me.result=or;Me.runInContext=J;Me.size=si;Me.some=hi;Me.sortedIndex=Hi;Me.template=sr;Me.unescape=lr;Me.uniqueId=ur;Me.all=jt;Me.any=hi;Me.detect=Wt;Me.findWhere=Wt;Me.foldl=ii;Me.foldr=ri;Me.include=Vt;Me.inject=ii;$i(function(){var e={};ft(Me,function(t,i){if(!Me.prototype[i]){e[i]=t}});return e}(),false);Me.first=gi;Me.last=bi;Me.sample=ai;Me.take=gi;Me.head=gi;ft(Me,function(e,t){var i=t!=="sample";if(!Me.prototype[t]){Me.prototype[t]=function(t,r){var n=this.__chain__,a=e(this.__wrapped__,t,r);return!n&&(t==null||r&&!(i&&typeof t=="function"))?a:new Se(a,n)}}});Me.VERSION="2.4.1";Me.prototype.chain=fr;Me.prototype.toString=dr;Me.prototype.value=mr;Me.prototype.valueOf=mr;Xt(["join","pop","shift"],function(e){var t=ie[e];Me.prototype[e]=function(){var e=this.__chain__,i=t.apply(this.__wrapped__,arguments);return e?new Se(i,e):i}});Xt(["push","reverse","sort","unshift"],function(e){var t=ie[e];Me.prototype[e]=function(){t.apply(this.__wrapped__,arguments);return this}});Xt(["concat","slice","splice"],function(e){var t=ie[e];Me.prototype[e]=function(){return new Se(t.apply(this.__wrapped__,arguments),this.__chain__)}});return Me}var $=J();if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){O._=$;define(function(){return $})}else if(D&&F){if(B){(F.exports=$)._=$}else{D._=$}}else{O._=$}}).call(this);THREE.Binder={bind:function(e,t){return function(i,r){if(!r.__binds){r.__binds=[]}var n=e;if(_.isArray(i)){n=i[0];i=i[1]}var a=/^([^.:]*(?:\.[^.:]+)*)?(?:\:(.*))?$/.exec(i);var o=a[1].split(/\./g);var s=o.pop();var h=a[2]||s;var l=o.shift();var u={this:r}[l]||t[l]||e[l]||n;while(u&&(i=o.shift())){u=u[i]}if(u&&(u.on||u.addEventListener)){var c=function(t){r[h]&&r[h](t,e)};THREE.Binder._polyfill(u,["addEventListener","on"],function(e){u[e](s,c)});var p={target:u,name:s,callback:c};r.__binds.push(p);return c}else{throw"Cannot bind '"+i+"' in "+this.__name}}},unbind:function(){return function(e){if(e.__binds){e.__binds.forEach(function(e){THREE.Binder._polyfill(e.target,["removeEventListener","off"],function(t){e.target[t](e.name,e.callback)})}.bind(this));e.__binds=[]}}},apply:function(e){THREE.EventDispatcher.prototype.apply(e);e.trigger=THREE.Binder._trigger;e.triggerOnce=THREE.Binder._triggerOnce;e.on=e.addEventListener;e.off=e.removeEventListener;e.dispatchEvent=e.trigger},_triggerOnce:function(e){this.trigger(e);if(this._listeners){delete this._listeners[e.type]}},_trigger:function(e){if(this._listeners===undefined)return;var t=e.type;var i=this._listeners[t];if(i!==undefined){i=i.slice();var r=i.length;e.target=this;for(var n=0;n<r;n++){i[n].call(this,e,this)}}},_polyfill:function(e,t,i){t.map(function(t){return e.method});if(t.length)i(t[0])}};THREE.Api={apply:function(e){e.set=function(e){var t=this.options||{};var i=_.reduce(e,function(e,i,r){if(t[r]!==i)e[r]=i;return e},{});this.options=_.extend(t,i);this.trigger({type:"change",options:e,changes:i})};e.get=function(){return this.options};e.api=function(e,t){e=e||{};t&&_.each(e,function(e,i,r){if(_.isFunction(e)){r[i]=_.partialRight(e,t)}});e.set=this.set.bind(this);e.get=this.get.bind(this);return e}}};THREE.Bootstrap=function(e){if(e){var t=[].slice.apply(arguments);e={};if(t[0]instanceof Node){node=t[0];t=t.slice(1);e.element=node}if(_.isString(t[0])){e.plugins=t}if(_.isArray(t[0])){e.plugins=t[0]}if(t[0]){e=_.defaults(e,t[0])}}if(!(this instanceof THREE.Bootstrap))return new THREE.Bootstrap(e);var i={init:true,element:document.body,plugins:["core"],aliases:{},plugindb:THREE.Bootstrap.Plugins||{},aliasdb:THREE.Bootstrap.Aliases||{}};this.__options=_.defaults(e||{},i);this.__inited=false;this.__destroyed=false;this.__installed=[];var r=this.__options.element;if(r===""+r){r=document.querySelector(r)}this.plugins={};this.element=r;if(this.__options.init){this.init()}};THREE.Bootstrap.prototype={init:function(){if(this.__inited)return;this.__inited=true;this.install(this.__options.plugins);return this},destroy:function(){if(!this.__inited)return;if(this.__destroyed)return;this.__destroyed=true;this.trigger({type:"destroy"});this.uninstall();return this},resolve:function(e){e=_.isArray(e)?e:[e];var t=this.__options;var i=_.extend({},t.aliasdb,t.aliases);var r=function(e){var t=e.split(":");if(!t[1])return true;i[t[0]]=[t[1]];return false};e=_.filter(e,r);_.each(i,function(e,t){i[t]=_.isArray(e)?e:[e]});function n(e,t,a){if(a>=256)throw"Plug-in alias recursion detected.";e=_.filter(e,r);_.each(e,function(e){var r=i[e];if(!r){t.push(e)}else{t=t.concat(n(r,[],a+1))}});return t}return n(e,[],0)},install:function(e){e=_.isArray(e)?e:[e];e=this.resolve(e);_.each(e,this.__install,this);this.__ready()},uninstall:function(e){if(e){e=_.isArray(e)?e:[e];e=this.resolve(e)}_.eachRight(e||this.__installed,this.__uninstall,this)},__install:function(e){var t=this.__options.plugindb[e];if(!t)throw"[three.install] Cannot install. '"+e+"' is not registered.";if(this.plugins[e])return console.warn("[three.install] "+e+" is already installed.");var i=t;var r=new i(this.__options[e]||{},e);this.plugins[e]=r;flag=r.install(this);this.__installed.push(r);this.trigger({type:"install",plugin:r});return flag},__uninstall:function(e,t){plugin=_.isString(e)?this.plugins[e]:e;if(!plugin)return console.warn("[three.uninstall] "+e+"' is not installed.");e=plugin.__name;plugin.uninstall(this);this.__installed=_.without(this.__installed,plugin);delete this.plugins[e];this.trigger({type:"uninstall",plugin:plugin})},__ready:function(){this.triggerOnce({type:"ready"})}};THREE.Binder.apply(THREE.Bootstrap.prototype);THREE.Bootstrap.Plugins={};THREE.Bootstrap.Aliases={};THREE.Bootstrap.Plugin=function(e){this.options=_.defaults(e||{},this.defaults)};THREE.Bootstrap.Plugin.prototype={listen:[],defaults:{},install:function(e){},uninstall:function(e){}};THREE.Binder.apply(THREE.Bootstrap.Plugin.prototype);THREE.Api.apply(THREE.Bootstrap.Plugin.prototype);THREE.Bootstrap.registerPlugin=function(e,t){var i=function(t){THREE.Bootstrap.Plugin.call(this,t);this.__name=e};i.prototype=_.extend(new THREE.Bootstrap.Plugin,t);THREE.Bootstrap.Plugins[e]=i};THREE.Bootstrap.unregisterPlugin=function(e){delete THREE.Bootstrap.Plugins[e]};THREE.Bootstrap.registerAlias=function(e,t){THREE.Bootstrap.Aliases[e]=t};THREE.Bootstrap.unregisterAlias=function(e){delete THREE.Bootstrap.Aliases[e]};THREE.Bootstrap.registerAlias("empty",["fallback","bind","renderer","size","fill","loop","time"]);THREE.Bootstrap.registerAlias("core",["empty","scene","camera","render","warmup"]);THREE.Bootstrap.registerAlias("VR",["core","cursor","fullscreen","render:vr"]);THREE.Bootstrap.registerPlugin("fallback",{defaults:{force:false,fill:true,begin:'<div class="threestrap-fallback" style="display: table; width: 100%; height: 100%;'+'box-sizing: border-box; border: 1px dashed rgba(0, 0, 0, .25);">'+'<div style="display: table-cell; padding: 10px; vertical-align: middle; text-align: center;">',end:"</div></div>",message:"<big><strong>This example requires WebGL</strong></big><br>"+'Visit <a target="_blank" href="http://get.webgl.org/">get.webgl.org</a> for more info</a>'},install:function(e){var t;try{t=document.createElement("canvas");gl=t.getContext("webgl")||t.getContext("experimental-webgl");if(!gl||this.options.force){throw"WebGL unavailable."}e.fallback=false}catch(t){var i=this.options.message;var r=this.options.begin;var n=this.options.end;var a=this.options.fill;var o=document.createElement("div");o.innerHTML=r+i+n;this.children=[];while(o.childNodes.length>0){this.children.push(o.firstChild);e.element.appendChild(o.firstChild)}if(a){e.install("fill")}this.div=o;e.fallback=true;return false}},uninstall:function(e){if(this.children){this.children.forEach(function(e){e.parentNode.removeChild(e)});this.children=null}delete e.fallback}});THREE.Bootstrap.registerPlugin("renderer",{defaults:{klass:THREE.WebGLRenderer,parameters:{depth:true,stencil:true,preserveDrawingBuffer:true,antialias:true}},listen:["resize"],install:function(e){var t=e.renderer=new this.options.klass(this.options.parameters);e.canvas=t.domElement;e.element.appendChild(t.domElement)},uninstall:function(e){e.element.removeChild(e.renderer.domElement);delete e.renderer;delete e.canvas},resize:function(e,t){var i=t.renderer;var r=i.domElement;if(r&&r.tagName=="CANVAS"){i.setSize(e.renderWidth,e.renderHeight,false)}else{if(i.setRenderSize){i.setRenderSize(e.renderWidth,e.renderHeight)}i.setSize(e.viewWidth,e.viewHeight,false)}}});THREE.Bootstrap.registerPlugin("bind",{install:function(e){var t={three:e,window:window};e.bind=THREE.Binder.bind(e,t);e.unbind=THREE.Binder.unbind(e);e.bind("install:bind",this);e.bind("uninstall:unbind",this)},uninstall:function(e){e.unbind(this);delete e.bind;delete e.unbind},bind:function(e,t){var i=e.plugin;var r=i.listen;r&&r.forEach(function(e){t.bind(e,i)})},unbind:function(e,t){t.unbind(e.plugin)}});THREE.Bootstrap.registerPlugin("size",{defaults:{width:null,height:null,aspect:null,scale:1,maxRenderWidth:Infinity,maxRenderHeight:Infinity,devicePixelRatio:true},listen:["window.resize:queue","element.resize:queue","this.change:queue","ready:resize","pre:pre"],install:function(e){e.Size=this.api({renderWidth:0,renderHeight:0,viewWidth:0,viewHeight:0});this.resized=false},uninstall:function(e){delete e.Size},queue:function(e,t){this.resized=true},pre:function(e,t){if(!this.resized)return;this.resized=false;this.resize(e,t)},resize:function(e,t){var i=this.options;var r=t.element;var n=t.renderer;var a,o,s,h,l,u,c,p,f,d,m=0,g=0;a=s=i.width===undefined||i.width==null?r.offsetWidth||r.innerWidth||0:i.width;o=h=i.height===undefined||i.height==null?r.offsetHeight||r.innerHeight||0:i.height;c=a/o;if(i.aspect){if(i.aspect>c){o=Math.round(a/i.aspect);g=Math.floor((h-o)/2)}else{a=Math.round(o*i.aspect);m=Math.floor((s-a)/2)}c=a/o}d=1;if(i.devicePixelRatio&&typeof window!="undefined"){d=window.devicePixelRatio||1}l=Math.min(a*d*i.scale,i.maxRenderWidth);u=Math.min(o*d*i.scale,i.maxRenderHeight);raspect=l/u;if(raspect>c){l=Math.round(u*c)}else{u=Math.round(l/c)}d=u/o;f=n.domElement.style;f.width=a+"px";f.height=o+"px";f.marginLeft=m+"px";f.marginTop=g+"px";_.extend(t.Size,{renderWidth:l,renderHeight:u,viewWidth:a,viewHeight:o,aspect:c,pixelRatio:d});t.trigger({type:"resize",renderWidth:l,renderHeight:u,viewWidth:a,viewHeight:o,aspect:c,pixelRatio:d})}});THREE.Bootstrap.registerPlugin("fill",{defaults:{block:true,body:true,layout:true},install:function(e){function t(e){var t=e.style.height;return t=="auto"||t==""}function i(e){e.style.height="100%";e.style.margin=0;e.style.padding=0;return e}if(this.options.body&&e.element==document.body){this.applied=[e.element,document.documentElement].filter(t).map(i)}if(this.options.block&&e.canvas){e.canvas.style.display="block";this.block=true}if(this.options.layout&&e.element){var r=window.getComputedStyle(e.element);if(r.position=="static"){e.element.style.position="relative";this.layout=true}}},uninstall:function(e){if(this.applied){function t(e){e.style.height="";e.style.margin="";e.style.padding="";return e}this.applied.map(t);delete this.applied}if(this.block&&e.canvas){e.canvas.style.display="";delete this.block}if(this.layout&&e.element){e.element.style.position="";delete this.layout}},change:function(e){this.uninstall(e);this.install(e)}});THREE.Bootstrap.registerPlugin("loop",{defaults:{start:true},listen:["ready"],install:function(e){this.running=false;e.Loop=this.api({start:this.start.bind(this),stop:this.stop.bind(this),running:false},e);this.events=["pre","update","render","post"].map(function(e){return{type:e}})},uninstall:function(e){this.stop(e)},ready:function(e,t){if(this.options.start)this.start(t)},start:function(e){if(this.running)return;e.Loop.running=this.running=true;var t=e.trigger.bind(e);var i=function(){this.running&&requestAnimationFrame(i);this.events.map(t)}.bind(this);requestAnimationFrame(i);e.trigger({type:"start"})},stop:function(e){if(!this.running)return;e.Loop.running=this.running=false;e.trigger({type:"stop"})}});THREE.Bootstrap.registerPlugin("time",{defaults:{speed:1,warmup:0,timeout:1},listen:["pre:tick","this.change"],now:function(){return+new Date/1e3},install:function(e){e.Time=this.api({now:this.now(),clock:0,step:1/60,frames:0,time:0,delta:1/60,average:0,fps:0});this.last=0;this.time=0;this.clock=0;this.wait=this.options.warmup;this.clockStart=0;this.timeStart=0},tick:function(e,t){var i=this.options.speed;var r=this.options.timeout;var n=t.Time;var a=n.now=this.now();var o=this.last;var s=this.time;var h=this.clock;if(o){var l=n.delta=a-o;var u=n.average||l;if(l>r){l=0}var c=l*i;s+=l;h+=c;if(n.frames>0){n.average=u+(l-u)*.1;n.fps=1/u}n.step=c;n.clock=h-this.clockStart;n.time=s-this.timeStart;n.frames++;if(this.wait-- >0){this.clockStart=h;this.timeStart=s;n.clock=0;n.step=1e-100}}this.last=a;this.clock=h;this.time=s},uninstall:function(e){delete e.Time}});THREE.Bootstrap.registerPlugin("scene",{install:function(e){e.scene=new THREE.Scene},uninstall:function(e){delete e.scene}});THREE.Bootstrap.registerPlugin("camera",{defaults:{near:.01,far:1e4,type:"perspective",fov:60,aspect:null,left:-1,right:1,bottom:-1,top:1,klass:null,parameters:null},listen:["resize","this.change"],install:function(e){e.Camera=this.api();e.camera=null;this.aspect=1;this.change({},e)},uninstall:function(e){delete e.Camera;delete e.camera},change:function(e,t){var i=this.options;var r=t.camera;if(!t.camera||e.changes.type||e.changes.klass){var n=i.klass||{perspective:THREE.PerspectiveCamera,orthographic:THREE.OrthographicCamera}[i.type]||THREE.Camera;t.camera=i.parameters?new n(i.parameters):new n}_.each(i,function(e,r){if(t.camera.hasOwnProperty(r))t.camera[r]=i[r]}.bind(this));this.update(t);r===t.camera||t.trigger({type:"camera",camera:t.camera})},resize:function(e,t){this.aspect=e.viewWidth/Math.max(1,e.viewHeight);this.update(t)},update:function(e){e.camera.aspect=this.options.aspect||this.aspect;e.camera.updateProjectionMatrix()}});THREE.Bootstrap.registerPlugin("render",{listen:["render"],render:function(e,t){if(t.scene&&t.camera){t.renderer.render(t.scene,t.camera)}}});THREE.Bootstrap.registerPlugin("warmup",{defaults:{delay:2},listen:["ready","post"],ready:function(e,t){t.renderer.domElement.style.visibility="hidden";this.frame=0;this.hidden=true},post:function(e,t){if(this.hidden&&this.frame>=this.options.delay){t.renderer.domElement.style.visibility="visible";this.hidden=false}this.frame++}});THREE.Stats=function(){var e=Date.now(),t=e,i=0,r=Infinity,n=0,a=0,o=Infinity,s=0,h=0,l=0,u=document.createElement("div");u.id="stats";u.addEventListener("mousedown",function(e){e.preventDefault();y(++l%2)},!1);u.style.cssText="width:80px;opacity:0.9;cursor:pointer";var c=document.createElement("div");c.id="fps";c.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002";u.appendChild(c);var p=document.createElement("div");p.id="fpsText";p.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";p.innerHTML="FPS";c.appendChild(p);var f=document.createElement("div");f.id="fpsGraph";f.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(c.appendChild(f);74>f.children.length;){var d=document.createElement("span");d.style.cssText="width:1px;height:30px;float:left;background-color:#113";f.appendChild(d)}var m=document.createElement("div");m.id="ms";m.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";u.appendChild(m);var g=document.createElement("div");g.id="msText";g.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px";g.innerHTML="MS";m.appendChild(g);var v=document.createElement("div");v.id="msGraph";v.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";for(m.appendChild(v);74>v.children.length;)d=document.createElement("span"),d.style.cssText="width:1px;height:30px;float:left;background-color:#131",v.appendChild(d);var y=function(e){l=e;switch(l){case 0:c.style.display="block";m.style.display="none";break;case 1:c.style.display="none",m.style.display="block"}};return{REVISION:11,domElement:u,setMode:y,begin:function(){e=Date.now()},end:function(){var l=Date.now();i=l-e;r=Math.min(r,i);n=Math.max(n,i);g.textContent=i+" MS ("+r+"-"+n+")";var u=Math.min(30,30-30*(i/200));v.appendChild(v.firstChild).style.height=u+"px";h++;l>t+1e3&&(a=Math.round(1e3*h/(l-t)),o=Math.min(o,a),s=Math.max(s,a),p.textContent=a+" FPS ("+o+"-"+s+")",u=Math.min(30,30-30*(a/100)),f.appendChild(f.firstChild).style.height=u+"px",t=l,h=0);return l},update:function(){e=this.end()}}};THREE.DeviceOrientationControls=function(e){var t=this;this.object=e;this.object.rotation.reorder("YXZ");this.freeze=true;this.deviceOrientation={};this.screenOrientation=0;var i=function(e){t.deviceOrientation=e};var r=function(){t.screenOrientation=window.orientation||0};var n=function(){var e=new THREE.Vector3(0,0,1);var t=new THREE.Euler;var i=new THREE.Quaternion;var r=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(n,a,o,s,h){t.set(o,a,-s,"YXZ");n.setFromEuler(t);n.multiply(r);n.multiply(i.setFromAxisAngle(e,-h))}}();this.connect=function(){r();window.addEventListener("orientationchange",r,false);window.addEventListener("deviceorientation",i,false);t.freeze=false};this.disconnect=function(){t.freeze=true;window.removeEventListener("orientationchange",r,false);window.removeEventListener("deviceorientation",i,false)};this.update=function(){if(t.freeze)return;var e=t.deviceOrientation.gamma?THREE.Math.degToRad(t.deviceOrientation.alpha):0;var i=t.deviceOrientation.beta?THREE.Math.degToRad(t.deviceOrientation.beta):0;var r=t.deviceOrientation.gamma?THREE.Math.degToRad(t.deviceOrientation.gamma):0;var a=t.screenOrientation?THREE.Math.degToRad(t.screenOrientation):0;n(t.object.quaternion,e,i,r,a)}};THREE.FirstPersonControls=function(e,t){this.object=e;this.target=new THREE.Vector3(0,0,0);this.domElement=t!==undefined?t:document;this.movementSpeed=1;this.lookSpeed=.005;this.lookVertical=true;this.autoForward=false;this.activeLook=true;this.heightSpeed=false;this.heightCoef=1;this.heightMin=0;this.heightMax=1;this.constrainVertical=false;this.verticalMin=0;this.verticalMax=Math.PI;this.autoSpeedFactor=0;this.mouseX=0;this.mouseY=0;this.lat=0;this.lon=0;this.phi=0;this.theta=0;this.moveForward=false;this.moveBackward=false;this.moveLeft=false;this.moveRight=false;this.freeze=false;this.mouseDragOn=false;this.viewHalfX=0;this.viewHalfY=0;if(this.domElement!==document){this.domElement.setAttribute("tabindex",-1)}this.handleResize=function(){if(this.domElement===document){this.viewHalfX=window.innerWidth/2;this.viewHalfY=window.innerHeight/2}else{this.viewHalfX=this.domElement.offsetWidth/2;this.viewHalfY=this.domElement.offsetHeight/2}};this.onMouseDown=function(e){if(this.domElement!==document){this.domElement.focus()}e.preventDefault();e.stopPropagation();if(this.activeLook){switch(e.button){case 0:this.moveForward=true;break;case 2:this.moveBackward=true;break}}this.mouseDragOn=true};this.onMouseUp=function(e){e.preventDefault();e.stopPropagation();if(this.activeLook){switch(e.button){case 0:this.moveForward=false;break;case 2:this.moveBackward=false;break}}this.mouseDragOn=false};this.onMouseMove=function(e){if(this.domElement===document){this.mouseX=e.pageX-this.viewHalfX;this.mouseY=e.pageY-this.viewHalfY}else{this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX;this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY}};this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=true;break;case 37:case 65:this.moveLeft=true;break;case 40:case 83:this.moveBackward=true;break;case 39:case 68:this.moveRight=true;break;case 82:this.moveUp=true;break;case 70:this.moveDown=true;break;case 81:this.freeze=!this.freeze;break}};this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=false;break;case 37:case 65:this.moveLeft=false;break;case 40:case 83:this.moveBackward=false;break;case 39:case 68:this.moveRight=false;break;case 82:this.moveUp=false;break;case 70:this.moveDown=false;break}};this.update=function(e){if(this.freeze){return}if(this.heightSpeed){var t=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax);var i=t-this.heightMin;this.autoSpeedFactor=e*(i*this.heightCoef)}else{this.autoSpeedFactor=0}var r=e*this.movementSpeed;if(this.moveForward||this.autoForward&&!this.moveBackward)this.object.translateZ(-(r+this.autoSpeedFactor));if(this.moveBackward)this.object.translateZ(r);if(this.moveLeft)this.object.translateX(-r);if(this.moveRight)this.object.translateX(r);if(this.moveUp)this.object.translateY(r);if(this.moveDown)this.object.translateY(-r);var n=e*this.lookSpeed;if(!this.activeLook){n=0}var a=1;if(this.constrainVertical){a=Math.PI/(this.verticalMax-this.verticalMin)}this.lon+=this.mouseX*n;if(this.lookVertical)this.lat-=this.mouseY*n*a;this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=THREE.Math.degToRad(90-this.lat);this.theta=THREE.Math.degToRad(this.lon);if(this.constrainVertical){this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)}var o=this.target,s=this.object.position;o.x=s.x+100*Math.sin(this.phi)*Math.cos(this.theta);o.y=s.y+100*Math.cos(this.phi);o.z=s.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(o)};this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},false);this.domElement.addEventListener("mousemove",i(this,this.onMouseMove),false);this.domElement.addEventListener("mousedown",i(this,this.onMouseDown),false);this.domElement.addEventListener("mouseup",i(this,this.onMouseUp),false);this.domElement.addEventListener("keydown",i(this,this.onKeyDown),false);this.domElement.addEventListener("keyup",i(this,this.onKeyUp),false);function i(e,t){return function(){t.apply(e,arguments)}}this.handleResize()};THREE.OrbitControls=function(e,t){this.object=e;this.domElement=t!==undefined?t:document;this.enabled=true;this.target=new THREE.Vector3;this.center=this.target;this.noZoom=false;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=false;this.rotateSpeed=1;this.noPan=false;this.keyPanSpeed=7;this.autoRotate=false;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.noKeys=false;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var i=this;var r=1e-6;var n=new THREE.Vector2;var a=new THREE.Vector2;var o=new THREE.Vector2;var s=new THREE.Vector2;var h=new THREE.Vector2;var l=new THREE.Vector2;var u=new THREE.Vector3;var c=new THREE.Vector3;var p=new THREE.Vector2;var f=new THREE.Vector2;var d=new THREE.Vector2;var m=0;var g=0;var v=1;var y=new THREE.Vector3;var E=new THREE.Vector3;var w={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5};var b=w.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();var _=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0));var x=_.clone().inverse();var T={type:"change"};var R={type:"start"};var k={type:"end"};this.rotateLeft=function(e){if(e===undefined){e=H()}g-=e};this.rotateUp=function(e){if(e===undefined){e=H()}m-=e};this.panLeft=function(e){var t=this.object.matrix.elements;u.set(t[0],t[1],t[2]);u.multiplyScalar(-e);y.add(u)};this.panUp=function(e){var t=this.object.matrix.elements;u.set(t[4],t[5],t[6]);u.multiplyScalar(e);y.add(u)};this.pan=function(e,t){var r=i.domElement===document?i.domElement.body:i.domElement;if(i.object.fov!==undefined){var n=i.object.position;var a=n.clone().sub(i.target);var o=a.length();o*=Math.tan(i.object.fov/2*Math.PI/180);i.panLeft(2*e*o/r.clientHeight);i.panUp(2*t*o/r.clientHeight)}else if(i.object.top!==undefined){i.panLeft(e*(i.object.right-i.object.left)/r.clientWidth);i.panUp(t*(i.object.top-i.object.bottom)/r.clientHeight)}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")}};this.dollyIn=function(e){if(e===undefined){e=M()}v/=e};this.dollyOut=function(e){if(e===undefined){e=M()}v*=e};this.update=function(){var e=this.object.position;c.copy(e).sub(this.target);c.applyQuaternion(_);var t=Math.atan2(c.x,c.z);var i=Math.atan2(Math.sqrt(c.x*c.x+c.z*c.z),c.y);if(this.autoRotate){this.rotateLeft(H())}t+=g;i+=m;i=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,i));i=Math.max(r,Math.min(Math.PI-r,i));var n=c.length()*v;n=Math.max(this.minDistance,Math.min(this.maxDistance,n));this.target.add(y);c.x=n*Math.sin(i)*Math.sin(t);c.y=n*Math.cos(i);c.z=n*Math.sin(i)*Math.cos(t);c.applyQuaternion(x);e.copy(this.target).add(c);this.object.lookAt(this.target);g=0;m=0;v=1;y.set(0,0,0);if(E.distanceToSquared(this.object.position)>r){this.dispatchEvent(T);E.copy(this.object.position)}};this.reset=function(){b=w.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};function H(){return 2*Math.PI/60/60*i.autoRotateSpeed}function M(){return Math.pow(.95,i.zoomSpeed)}function S(e){if(i.enabled===false)return;e.preventDefault();if(e.button===0){if(i.noRotate===true)return;b=w.ROTATE;n.set(e.clientX,e.clientY)}else if(e.button===1){if(i.noZoom===true)return;b=w.DOLLY;p.set(e.clientX,e.clientY)}else if(e.button===2){if(i.noPan===true)return;b=w.PAN;s.set(e.clientX,e.clientY)}document.documentElement.addEventListener("mousemove",A,false);document.documentElement.addEventListener("mouseup",C,false);i.dispatchEvent(R)}function A(e){if(i.enabled===false)return;e.preventDefault();var t=i.domElement===document?i.domElement.body:i.domElement;if(b===w.ROTATE){if(i.noRotate===true)return;a.set(e.clientX,e.clientY);o.subVectors(a,n);i.rotateLeft(2*Math.PI*o.x/t.clientWidth*i.rotateSpeed);i.rotateUp(2*Math.PI*o.y/t.clientHeight*i.rotateSpeed);n.copy(a)}else if(b===w.DOLLY){if(i.noZoom===true)return;f.set(e.clientX,e.clientY);d.subVectors(f,p);if(d.y>0){i.dollyIn()}else{i.dollyOut()}p.copy(f)}else if(b===w.PAN){if(i.noPan===true)return;h.set(e.clientX,e.clientY);l.subVectors(h,s);i.pan(l.x,l.y);s.copy(h)}i.update()}function C(){if(i.enabled===false)return;document.documentElement.removeEventListener("mousemove",A,false);document.documentElement.removeEventListener("mouseup",C,false);i.dispatchEvent(k);b=w.NONE}function z(e){if(i.enabled===false||i.noZoom===true)return;e.preventDefault();e.stopPropagation();var t=0;if(e.wheelDelta!==undefined){t=e.wheelDelta}else if(e.detail!==undefined){t=-e.detail}if(t>0){i.dollyOut()}else{i.dollyIn()}i.update();i.dispatchEvent(R);i.dispatchEvent(k)}function P(e){if(i.enabled===false||i.noKeys===true||i.noPan===true)return;switch(e.keyCode){case i.keys.UP:i.pan(0,i.keyPanSpeed);i.update();break;case i.keys.BOTTOM:i.pan(0,-i.keyPanSpeed);i.update();break;case i.keys.LEFT:i.pan(i.keyPanSpeed,0);i.update();break;case i.keys.RIGHT:i.pan(-i.keyPanSpeed,0);i.update();break}}function L(e){if(i.enabled===false)return;switch(e.touches.length){case 1:if(i.noRotate===true)return;b=w.TOUCH_ROTATE;n.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(i.noZoom===true)return;b=w.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX;var r=e.touches[0].pageY-e.touches[1].pageY;var a=Math.sqrt(t*t+r*r);p.set(0,a);break;case 3:if(i.noPan===true)return;b=w.TOUCH_PAN;s.set(e.touches[0].pageX,e.touches[0].pageY);break;default:b=w.NONE}i.dispatchEvent(R)}function O(e){if(i.enabled===false)return;e.preventDefault();e.stopPropagation();var t=i.domElement===document?i.domElement.body:i.domElement;switch(e.touches.length){case 1:if(i.noRotate===true)return;if(b!==w.TOUCH_ROTATE)return;a.set(e.touches[0].pageX,e.touches[0].pageY);o.subVectors(a,n);i.rotateLeft(2*Math.PI*o.x/t.clientWidth*i.rotateSpeed);i.rotateUp(2*Math.PI*o.y/t.clientHeight*i.rotateSpeed);n.copy(a);i.update();break;case 2:if(i.noZoom===true)return;if(b!==w.TOUCH_DOLLY)return;var r=e.touches[0].pageX-e.touches[1].pageX;var u=e.touches[0].pageY-e.touches[1].pageY;var c=Math.sqrt(r*r+u*u);f.set(0,c);d.subVectors(f,p);if(d.y>0){i.dollyOut()}else{i.dollyIn()}p.copy(f);i.update();break;case 3:if(i.noPan===true)return;if(b!==w.TOUCH_PAN)return;h.set(e.touches[0].pageX,e.touches[0].pageY);l.subVectors(h,s);i.pan(l.x,l.y);s.copy(h);i.update();break;default:b=w.NONE}}function D(){if(i.enabled===false)return;i.dispatchEvent(k);b=w.NONE}this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},false);this.domElement.addEventListener("mousedown",S,false);this.domElement.addEventListener("mousewheel",z,false);this.domElement.addEventListener("DOMMouseScroll",z,false);this.domElement.addEventListener("touchstart",L,false);this.domElement.addEventListener("touchend",D,false);this.domElement.addEventListener("touchmove",O,false);window.addEventListener("keydown",P,false);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.TrackballControls=function(e,t){var i=this;var r={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e;this.domElement=t!==undefined?t:document;this.enabled=true;this.screen={left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.noRotate=false;this.noZoom=false;this.noPan=false;this.staticMoving=false;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3;var n=1e-6;var a=new THREE.Vector3;var o=r.NONE,s=r.NONE,h=new THREE.Vector3,l=new THREE.Vector2,u=new THREE.Vector2,c=new THREE.Vector3,p=0,f=new THREE.Vector2,d=new THREE.Vector2,m=0,g=0,v=new THREE.Vector2,y=new THREE.Vector2;this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();var E={type:"change"};var w={type:"start"};var b={type:"end"};this.handleResize=function(){if(this.domElement===document){this.screen.left=0;this.screen.top=0;this.screen.width=window.innerWidth;this.screen.height=window.innerHeight}else{var e=this.domElement.getBoundingClientRect();var t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft;this.screen.top=e.top+window.pageYOffset-t.clientTop;this.screen.width=e.width;this.screen.height=e.height}};this.handleEvent=function(e){if(typeof this[e.type]=="function"){this[e.type](e)}};var _=function(){var e=new THREE.Vector2;return function(t,r){e.set((t-i.screen.left)/i.screen.width,(r-i.screen.top)/i.screen.height);return e}}();var x=function(){var e=new THREE.Vector2;return function(t,r){e.set((t-i.screen.width*.5-i.screen.left)/(i.screen.width*.5),(i.screen.height+2*(i.screen.top-r))/i.screen.width);return e}}();this.rotateCamera=function(){var e=new THREE.Vector3,t=new THREE.Quaternion,r=new THREE.Vector3,n=new THREE.Vector3,a=new THREE.Vector3,o=new THREE.Vector3,s;return function(){o.set(u.x-l.x,u.y-l.y,0);s=o.length();if(s){h.copy(i.object.position).sub(i.target);r.copy(h).normalize();n.copy(i.object.up).normalize();a.crossVectors(n,r).normalize();n.setLength(u.y-l.y);a.setLength(u.x-l.x);o.copy(n.add(a));e.crossVectors(o,h).normalize();s*=i.rotateSpeed;t.setFromAxisAngle(e,s);h.applyQuaternion(t);i.object.up.applyQuaternion(t);c.copy(e);p=s}else if(!i.staticMoving&&p){p*=Math.sqrt(1-i.dynamicDampingFactor);h.copy(i.object.position).sub(i.target);t.setFromAxisAngle(c,p);h.applyQuaternion(t);i.object.up.applyQuaternion(t)}l.copy(u)}}();this.zoomCamera=function(){var e;if(o===r.TOUCH_ZOOM_PAN){e=m/g;m=g;h.multiplyScalar(e)}else{e=1+(d.y-f.y)*i.zoomSpeed;if(e!==1&&e>0){h.multiplyScalar(e);if(i.staticMoving){f.copy(d)}else{f.y+=(d.y-f.y)*this.dynamicDampingFactor}}}};this.panCamera=function(){var e=new THREE.Vector2,t=new THREE.Vector3,r=new THREE.Vector3;return function(){e.copy(y).sub(v);if(e.lengthSq()){e.multiplyScalar(h.length()*i.panSpeed);r.copy(h).cross(i.object.up).setLength(e.x);r.add(t.copy(i.object.up).setLength(e.y));i.object.position.add(r);i.target.add(r);if(i.staticMoving){v.copy(y)}else{v.add(e.subVectors(y,v).multiplyScalar(i.dynamicDampingFactor))}}}}();this.checkDistances=function(){if(!i.noZoom||!i.noPan){if(h.lengthSq()>i.maxDistance*i.maxDistance){i.object.position.addVectors(i.target,h.setLength(i.maxDistance))}if(h.lengthSq()<i.minDistance*i.minDistance){i.object.position.addVectors(i.target,h.setLength(i.minDistance))}}};this.update=function(){h.subVectors(i.object.position,i.target);if(!i.noRotate){i.rotateCamera()}if(!i.noZoom){i.zoomCamera()}if(!i.noPan){i.panCamera()}i.object.position.addVectors(i.target,h);i.checkDistances();i.object.lookAt(i.target);if(a.distanceToSquared(i.object.position)>n){i.dispatchEvent(E);a.copy(i.object.position)}};this.reset=function(){o=r.NONE;s=r.NONE;i.target.copy(i.target0);i.object.position.copy(i.position0);i.object.up.copy(i.up0);h.subVectors(i.object.position,i.target);i.object.lookAt(i.target);i.dispatchEvent(E);a.copy(i.object.position)};function T(e){if(i.enabled===false)return;window.removeEventListener("keydown",T);s=o;if(o!==r.NONE){return}else if(e.keyCode===i.keys[r.ROTATE]&&!i.noRotate){o=r.ROTATE}else if(e.keyCode===i.keys[r.ZOOM]&&!i.noZoom){o=r.ZOOM}else if(e.keyCode===i.keys[r.PAN]&&!i.noPan){o=r.PAN}}function R(e){if(i.enabled===false)return;o=s;window.addEventListener("keydown",T,false)}function k(e){if(i.enabled===false)return;e.preventDefault();e.stopPropagation();if(o===r.NONE){o=e.button}if(o===r.ROTATE&&!i.noRotate){u.copy(x(e.pageX,e.pageY));l.copy(u)}else if(o===r.ZOOM&&!i.noZoom){f.copy(_(e.pageX,e.pageY));d.copy(f)}else if(o===r.PAN&&!i.noPan){v.copy(_(e.pageX,e.pageY));y.copy(v)}document.addEventListener("mousemove",H,false);document.addEventListener("mouseup",M,false);i.dispatchEvent(w)}function H(e){if(i.enabled===false)return;e.preventDefault();e.stopPropagation();if(o===r.ROTATE&&!i.noRotate){l.copy(u);u.copy(x(e.pageX,e.pageY))}else if(o===r.ZOOM&&!i.noZoom){d.copy(_(e.pageX,e.pageY))}else if(o===r.PAN&&!i.noPan){y.copy(_(e.pageX,e.pageY))}}function M(e){if(i.enabled===false)return;e.preventDefault();e.stopPropagation();o=r.NONE;document.removeEventListener("mousemove",H);document.removeEventListener("mouseup",M);i.dispatchEvent(b)}function S(e){if(i.enabled===false||i.noZoom)return;e.preventDefault();e.stopPropagation();var t=0;if(e.wheelDelta){t=e.wheelDelta/40}else if(e.detail){t=-e.detail/3}f.y+=t*.01;i.dispatchEvent(w);i.dispatchEvent(b)}function A(e){if(i.enabled===false)return;switch(e.touches.length){case 1:o=r.TOUCH_ROTATE;u.copy(x(e.touches[0].pageX,e.touches[0].pageY));l.copy(u);break;case 2:o=r.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX;var n=e.touches[0].pageY-e.touches[1].pageY;g=m=Math.sqrt(t*t+n*n);var a=(e.touches[0].pageX+e.touches[1].pageX)/2;var s=(e.touches[0].pageY+e.touches[1].pageY)/2;v.copy(_(a,s));y.copy(v);break;default:o=r.NONE}i.dispatchEvent(w)}function C(e){if(i.enabled===false)return;e.preventDefault();e.stopPropagation();switch(e.touches.length){case 1:l.copy(u);u.copy(x(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX;var n=e.touches[0].pageY-e.touches[1].pageY;g=Math.sqrt(t*t+n*n);var a=(e.touches[0].pageX+e.touches[1].pageX)/2;var s=(e.touches[0].pageY+e.touches[1].pageY)/2;y.copy(_(a,s));break;default:o=r.NONE}}function z(e){if(i.enabled===false)return;switch(e.touches.length){case 1:l.copy(u);u.copy(x(e.touches[0].pageX,e.touches[0].pageY));break;case 2:m=g=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2;var n=(e.touches[0].pageY+e.touches[1].pageY)/2;y.copy(_(t,n));v.copy(y);break}o=r.NONE;i.dispatchEvent(b)}this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},false);this.domElement.addEventListener("mousedown",k,false);this.domElement.addEventListener("mousewheel",S,false);this.domElement.addEventListener("DOMMouseScroll",S,false);this.domElement.addEventListener("touchstart",A,false);this.domElement.addEventListener("touchend",z,false);this.domElement.addEventListener("touchmove",C,false);window.addEventListener("keydown",T,false);window.addEventListener("keyup",R,false);this.handleResize();this.update()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;THREE.VRControls=function(e,t){var i=1e-5;var r=this.dummy=new THREE.Object3D;this.object=e;this.device=new THREE.DeviceOrientationControls(r,t);this.orbit=new THREE.OrbitControls(r,t);this.orbit.target.copy(e.position);this.orbit.target.z+=i;this.orbit.rotateSpeed=-.25;this.supported=false;var n=function(e){this.supported=e&&e.alpha==+e.alpha;window.removeEventListener("deviceorientation",n,false)}.bind(this);window.addEventListener("deviceorientation",n,false)};THREE.VRControls.prototype.vr=function(e){this.vrstate=e};THREE.VRControls.prototype.update=function(e){var t=false;if(this.vrstate&&this.vrstate.orientation){t=true;this.object.quaternion.copy(this.vrstate.orientation);this.object.position.copy(this.vrstate.position);this.device.object=this.dummy;this.orbit.object=this.dummy}else if(this.vrstate&&this.supported){if(this.device.freeze)this.device.connect();this.device.object=this.object;this.orbit.object=this.dummy;this.device.update(e)}else{t=true;this.device.object=this.dummy;this.orbit.object=this.object;this.orbit.update(e)}if(t&&!this.device.freeze)this.device.disconnect()};THREE.Bootstrap.registerPlugin("stats",{listen:["pre","post"],install:function(e){var t=this.stats=new THREE.Stats;var i=t.domElement.style;i.position="absolute";i.top=i.left=0;e.element.appendChild(t.domElement);e.stats=t},uninstall:function(e){document.body.removeChild(this.stats.domElement);delete e.stats},pre:function(e,t){this.stats.begin()},post:function(e,t){this.stats.end()}});THREE.Bootstrap.registerPlugin("controls",{listen:["update","resize","camera","this.change"],defaults:{klass:null,parameters:{}},install:function(e){if(!this.options.klass)throw"Must provide class for `controls.klass`";e.controls=null;this._camera=e.camera||new THREE.PerspectiveCamera;this.change(null,e)},uninstall:function(e){delete e.controls},change:function(e,t){if(this.options.klass){if(!e||e.changes.klass){t.controls=new this.options.klass(this._camera,t.renderer.domElement)}_.extend(t.controls,this.options.parameters)}else{t.controls=null}},update:function(e,t){var i=t.Time&&t.Time.delta||1/60;var r=t.VR&&t.VR.state;if(t.controls.vr)t.controls.vr(r);t.controls.update(i)},camera:function(e,t){t.controls.object=this._camera=e.camera},resize:function(e,t){t.controls.handleResize&&t.controls.handleResize()}});THREE.Bootstrap.registerPlugin("cursor",{listen:["update","this.change","install:change","uninstall:change","element.mousemove","vr"],defaults:{cursor:null,hide:false,timeout:3},install:function(e){this.timeout=this.options.timeout;this.element=e.element;this.change(null,e)},uninstall:function(e){delete e.controls},change:function(e,t){this.applyCursor(t)},mousemove:function(e,t){if(this.options.hide){this.applyCursor(t);this.timeout=+this.options.timeout||0}},update:function(e,t){var i=t.Time&&t.Time.delta||1/60;if(this.options.hide){this.timeout-=i;if(this.timeout<0){this.applyCursor(t,"none")}}},vr:function(e,t){this.hide=e.active&&!e.hmd.fake;this.applyCursor(t)},applyCursor:function(e,t){var i=e.controls?"move":"";t=t||this.options.cursor||i;if(this.hide)t="none";if(this.cursor!=t){this.element.style.cursor=t}}});THREE.Bootstrap.registerPlugin("fullscreen",{defaults:{key:"f"},listen:["ready","update"],install:function(e){e.Fullscreen=this.api({active:false,toggle:this.toggle.bind(this)},e)},uninstall:function(e){delete e.Fullscreen},ready:function(e,t){document.body.addEventListener("keypress",function(e){if(this.options.key&&e.charCode==this.options.key.charCodeAt(0)){this.toggle(t)}}.bind(this));var i=function(){var e=!!document.fullscreenElement||!!document.mozFullScreenElement||!!document.webkitFullscreenElement||!!document.msFullscreenElement;t.Fullscreen.active=this.active=e;t.trigger({type:"fullscreen",active:e})}.bind(this);document.addEventListener("fullscreenchange",i,false);document.addEventListener("webkitfullscreenchange",i,false);document.addEventListener("mozfullscreenchange",i,false)},toggle:function(e){var t=e.canvas;var i=e.VR&&e.VR.active?{vrDisplay:e.VR.hmd}:{};if(!this.active){if(t.requestFullScreen){t.requestFullScreen(i)}else if(t.msRequestFullScreen){t.msRequestFullscreen(i)}else if(t.webkitRequestFullscreen){t.webkitRequestFullscreen(i)}else if(t.mozRequestFullScreen){t.mozRequestFullScreen(i)}}else{if(document.exitFullscreen){document.exitFullscreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}else if(document.webkitExitFullscreen){document.webkitExitFullscreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}}}});THREE.Bootstrap.registerPlugin("vr",{defaults:{mode:"auto",device:null,fov:80},listen:["window.load","pre","render","resize","this.change"],install:function(e){e.VR=this.api({active:false,devices:[],hmd:null,sensor:null,renderer:null,state:null},e)},uninstall:function(e){delete e.VR},mocks:function(e,t,i){var r=.03;var n=function(e){return{left:{x:-r,y:0,z:0},right:{x:r,y:0,z:0}}[e]};var a=function(r){var n=e.camera;var a=n&&n.aspect||16/9;var o=(t||(n&&n.fov||i))/2;var s=Math.atan(Math.tan(o*Math.PI/180)*a/2)*180/Math.PI;var h=o;return{left:{rightDegrees:s,leftDegrees:s,downDegrees:h,upDegrees:h},right:{rightDegrees:s,leftDegrees:s,downDegrees:h,upDegrees:h}}[r]};var o=function(){return{}};return[{fake:true,force:1,deviceId:"emu",deviceName:"Emulated",getEyeTranslation:n,getRecommendedEyeFieldOfView:a},{force:2,getState:o}]},load:function(e,t){var i=function(e){this.callback(e,t)}.bind(this);if(navigator.getVRDevices){navigator.getVRDevices().then(i)}else if(navigator.mozGetVRDevices){navigator.mozGetVRDevices(i)}else{console.warn("No native VR support detected.");i(this.mocks(t,this.options.fov,this.defaults.fov),t)}},callback:function(e,t){var i,r;var n=window.HMDVRDevice||function(){};var a=window.PositionSensorVRDevice||function(){};e=t.VR.devices=e||t.VR.devices;var o=this.options.device;for(var s=0;s<e.length;++s){var h=e[s];if(h.force==1||h instanceof n){if(o&&o!=h.deviceId)continue;i=h;break}}if(i){for(var s=0;s<e.length;++s){var h=e[s];if(h.force==2||h instanceof a&&h.hardwareUnitId==i.hardwareUnitId){r=h;break}}this.hookup(i,r,t)}},hookup:function(e,t,i){if(!THREE.VRRenderer)console.log("THREE.VRRenderer not found");var r=THREE.VRRenderer||function(){};this.renderer=new r(i.renderer,e);this.hmd=e;this.sensor=t;i.VR.renderer=this.renderer;i.VR.hmd=e;i.VR.sensor=t;console.log("THREE.VRRenderer",e.deviceName)},change:function(e,t){if(e.changes.device){this.callback(null,t)}this.pre(e,t)},pre:function(e,t){var i=this.active;var r=this.active=this.renderer&&this.options.mode!="2d";t.VR.active=r;if(r&&this.sensor){var n=this.sensor.getState();t.VR.state=n}else{t.VR.state=null}if(i!=this.active){t.trigger({type:"vr",active:r,hmd:this.hmd,sensor:this.sensor})}},resize:function(e,t){if(this.active){this.renderer.initialize()}},render:function(e,t){if(t.scene&&t.camera){var i=this.active?this.renderer:t.renderer;if(this.last!=i){if(i==t.renderer){var r=i.getPixelRatio();var n=i.domElement.width/r;var a=i.domElement.height/r;i.enableScissorTest(false);i.setViewport(0,0,n,a)}}this.last=i;i.render(t.scene,t.camera)}}});THREE.Bootstrap.registerPlugin("ui",{defaults:{theme:"white",style:".threestrap-ui { position: absolute; bottom: 5px; right: 5px; float: left; }"+".threestrap-ui button { border: 0; background: none;"+"  vertical-align: middle; font-weight: bold; } "+".threestrap-ui .glyphicon { top: 2px; font-weight: bold; } "+"@media (max-width: 640px) { .threestrap-ui button { font-size: 120% } }"+".threestrap-white button { color: #fff; text-shadow: 0 1px 1px rgba(0, 0, 0, 1), "+"0 1px 3px rgba(0, 0, 0, 1); }"+".threestrap-black button { color: #000; text-shadow: 0 0px 1px rgba(255, 255, 255, 1), "+"0 0px 2px rgba(255, 255, 255, 1), "+"0 0px 2px rgba(255, 255, 255, 1) }"},listen:["fullscreen"],markup:function(e,t,i){var r="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css";if(location.href.match(/^file:\/\//))r="http://"+r;var n=[];if(e.Fullscreen){n.push('<button class="fullscreen" title="Full Screen">'+'<span class="glyphicon glyphicon-fullscreen"></span>'+"</button>")}if(e.VR){n.push('<button class="vr" title="VR Headset">VR</button>')}return'<style type="text/css">@import url("'+r+'"); '+i+"</style>"+'<div class="threestrap-ui threestrap-'+t+'">'+n.join("\n")+"</div>"},install:function(e){var t=this.ui=document.createElement("div");t.innerHTML=this.markup(e,this.options.theme,this.options.style);document.body.appendChild(t);var i=this.ui.fullscreen=t.querySelector("button.fullscreen");if(i){e.bind([i,"click:goFullscreen"],this)}var r=this.ui.vr=t.querySelector("button.vr");if(r&&e.VR){e.VR.set({mode:"2d"});e.bind([r,"click:goVR"],this)}},uninstall:function(e){document.body.removeChild(ui)},fullscreen:function(e,t){this.ui.style.display=e.active?"none":"block";if(!e.active)t.VR&&t.VR.set({mode:"2d"})},goFullscreen:function(e,t){if(t.Fullscreen){t.Fullscreen.toggle()}},goVR:function(e,t){if(t.VR){t.VR.set({mode:"auto"});t.Fullscreen.toggle()}},uninstall:function(e){document.body.removeChild(this.ui)}});"use strict";THREE.VRRenderer=function(e,t){var i=this;i.initialize=function(){var e=t.getEyeTranslation("left");i.halfIPD=new THREE.Vector3(e.x,e.y,e.z).length();i.fovLeft=t.getRecommendedEyeFieldOfView("left");i.fovRight=t.getRecommendedEyeFieldOfView("right")};i.FovToNDCScaleOffset=function(e){var t=2/(e.leftTan+e.rightTan);var i=(e.leftTan-e.rightTan)*t*.5;var r=2/(e.upTan+e.downTan);var n=(e.upTan-e.downTan)*r*.5;return{scale:[t,r],offset:[i,n]}};i.FovPortToProjection=function(e,t,r,n,a){r=r===undefined?true:r;n=n===undefined?.01:n;a=a===undefined?1e4:a;var o=r?-1:1;var s=e.elements;var h=i.FovToNDCScaleOffset(t);s[0*4+0]=h.scale[0];s[0*4+1]=0;s[0*4+2]=h.offset[0]*o;s[0*4+3]=0;s[1*4+0]=0;s[1*4+1]=h.scale[1];s[1*4+2]=-h.offset[1]*o;s[1*4+3]=0;s[2*4+0]=0;s[2*4+1]=0;s[2*4+2]=a/(n-a)*-o;s[2*4+3]=a*n/(n-a);s[3*4+0]=0;s[3*4+1]=0;s[3*4+2]=o;s[3*4+3]=0;e.transpose()};i.FovToProjection=function(e,t,r,n,a){var o={upTan:Math.tan(t.upDegrees*Math.PI/180),downTan:Math.tan(t.downDegrees*Math.PI/180),leftTan:Math.tan(t.leftDegrees*Math.PI/180),rightTan:Math.tan(t.rightDegrees*Math.PI/180)};return i.FovPortToProjection(e,o,r,n,a)};var r=new THREE.Vector3;var n=new THREE.PerspectiveCamera;var a=new THREE.PerspectiveCamera;i.render=function(t,o){i.FovToProjection(n.projectionMatrix,i.fovLeft,true,o.near,o.far);i.FovToProjection(a.projectionMatrix,i.fovRight,true,o.near,o.far);r.set(i.halfIPD,0,0);r.applyQuaternion(o.quaternion);n.position.copy(o.position).sub(r);a.position.copy(o.position).add(r);n.quaternion.copy(o.quaternion);a.quaternion.copy(o.quaternion);var s=e.devicePixelRatio||1;var h=e.domElement.width/2/s;var l=e.domElement.height/s;e.enableScissorTest(true);e.setViewport(0,0,h,l);e.setScissor(0,0,h,l);e.render(t,n);e.setViewport(h,0,h,l);e.setScissor(h,0,h,l);e.render(t,a)};i.initialize()};THREE.VRControls=function(e,t){var i=1e-5;var r=this.dummy=new THREE.Object3D;this.object=e;this.device=new THREE.DeviceOrientationControls(r,t);this.orbit=new THREE.OrbitControls(r,t);this.orbit.target.copy(e.position);this.orbit.target.z+=i;this.orbit.rotateSpeed=-.25;this.supported=false;var n=function(e){this.supported=e&&e.alpha==+e.alpha;window.removeEventListener("deviceorientation",n,false)}.bind(this);window.addEventListener("deviceorientation",n,false)};THREE.VRControls.prototype.vr=function(e){this.vrstate=e};THREE.VRControls.prototype.update=function(e){var t=false;if(this.vrstate&&this.vrstate.orientation){t=true;this.object.quaternion.copy(this.vrstate.orientation);this.object.position.copy(this.vrstate.position);this.device.object=this.dummy;this.orbit.object=this.dummy}else if(this.vrstate&&this.supported){if(this.device.freeze)this.device.connect();this.device.object=this.object;this.orbit.object=this.dummy;this.device.update(e)}else{t=true;this.device.object=this.dummy;this.orbit.object=this.object;this.orbit.update(e)}if(t&&!this.device.freeze)this.device.disconnect()};THREE.OrbitControls=function(e,t){this.object=e;this.domElement=t!==undefined?t:document;this.enabled=true;this.target=new THREE.Vector3;this.center=this.target;this.noZoom=false;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=false;this.rotateSpeed=1;this.noPan=false;this.keyPanSpeed=7;this.autoRotate=false;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.noKeys=false;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var i=this;var r=1e-6;var n=new THREE.Vector2;var a=new THREE.Vector2;var o=new THREE.Vector2;var s=new THREE.Vector2;var h=new THREE.Vector2;var l=new THREE.Vector2;var u=new THREE.Vector3;var c=new THREE.Vector3;var p=new THREE.Vector2;var f=new THREE.Vector2;var d=new THREE.Vector2;var m=0;var g=0;var v=1;var y=new THREE.Vector3;var E=new THREE.Vector3;var w={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5};var b=w.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();var _=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0));var x=_.clone().inverse();var T={type:"change"};var R={type:"start"};var k={type:"end"};this.rotateLeft=function(e){if(e===undefined){e=H()}g-=e};this.rotateUp=function(e){if(e===undefined){e=H()}m-=e};this.panLeft=function(e){var t=this.object.matrix.elements;u.set(t[0],t[1],t[2]);u.multiplyScalar(-e);y.add(u)};this.panUp=function(e){var t=this.object.matrix.elements;u.set(t[4],t[5],t[6]);u.multiplyScalar(e);y.add(u)};this.pan=function(e,t){var r=i.domElement===document?i.domElement.body:i.domElement;if(i.object.fov!==undefined){var n=i.object.position;var a=n.clone().sub(i.target);var o=a.length();o*=Math.tan(i.object.fov/2*Math.PI/180);i.panLeft(2*e*o/r.clientHeight);i.panUp(2*t*o/r.clientHeight)}else if(i.object.top!==undefined){i.panLeft(e*(i.object.right-i.object.left)/r.clientWidth);i.panUp(t*(i.object.top-i.object.bottom)/r.clientHeight)}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")}};this.dollyIn=function(e){if(e===undefined){e=M()}v/=e};this.dollyOut=function(e){if(e===undefined){e=M()}v*=e};this.update=function(){var e=this.object.position;c.copy(e).sub(this.target);c.applyQuaternion(_);var t=Math.atan2(c.x,c.z);var i=Math.atan2(Math.sqrt(c.x*c.x+c.z*c.z),c.y);if(this.autoRotate){this.rotateLeft(H())}t+=g;i+=m;i=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,i));i=Math.max(r,Math.min(Math.PI-r,i));var n=c.length()*v;n=Math.max(this.minDistance,Math.min(this.maxDistance,n));this.target.add(y);c.x=n*Math.sin(i)*Math.sin(t);c.y=n*Math.cos(i);c.z=n*Math.sin(i)*Math.cos(t);c.applyQuaternion(x);e.copy(this.target).add(c);this.object.lookAt(this.target);g=0;m=0;v=1;y.set(0,0,0);if(E.distanceToSquared(this.object.position)>r){this.dispatchEvent(T);E.copy(this.object.position)}};this.reset=function(){b=w.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};function H(){return 2*Math.PI/60/60*i.autoRotateSpeed}function M(){return Math.pow(.95,i.zoomSpeed)}function S(e){if(i.enabled===false)return;e.preventDefault();if(e.button===0){if(i.noRotate===true)return;b=w.ROTATE;n.set(e.clientX,e.clientY)}else if(e.button===1){if(i.noZoom===true)return;b=w.DOLLY;p.set(e.clientX,e.clientY)}else if(e.button===2){if(i.noPan===true)return;b=w.PAN;s.set(e.clientX,e.clientY)}document.documentElement.addEventListener("mousemove",A,false);document.documentElement.addEventListener("mouseup",C,false);i.dispatchEvent(R)}function A(e){if(i.enabled===false)return;e.preventDefault();var t=i.domElement===document?i.domElement.body:i.domElement;if(b===w.ROTATE){if(i.noRotate===true)return;a.set(e.clientX,e.clientY);o.subVectors(a,n);i.rotateLeft(2*Math.PI*o.x/t.clientWidth*i.rotateSpeed);i.rotateUp(2*Math.PI*o.y/t.clientHeight*i.rotateSpeed);n.copy(a)}else if(b===w.DOLLY){if(i.noZoom===true)return;f.set(e.clientX,e.clientY);d.subVectors(f,p);if(d.y>0){i.dollyIn()}else{i.dollyOut()}p.copy(f)}else if(b===w.PAN){if(i.noPan===true)return;h.set(e.clientX,e.clientY);l.subVectors(h,s);i.pan(l.x,l.y);s.copy(h)}i.update()}function C(){if(i.enabled===false)return;document.documentElement.removeEventListener("mousemove",A,false);document.documentElement.removeEventListener("mouseup",C,false);i.dispatchEvent(k);b=w.NONE}function z(e){if(i.enabled===false||i.noZoom===true)return;e.preventDefault();e.stopPropagation();var t=0;if(e.wheelDelta!==undefined){t=e.wheelDelta}else if(e.detail!==undefined){t=-e.detail}if(t>0){i.dollyOut()}else{i.dollyIn()}i.update();i.dispatchEvent(R);i.dispatchEvent(k)}function P(e){if(i.enabled===false||i.noKeys===true||i.noPan===true)return;switch(e.keyCode){case i.keys.UP:i.pan(0,i.keyPanSpeed);i.update();break;case i.keys.BOTTOM:i.pan(0,-i.keyPanSpeed);i.update();break;case i.keys.LEFT:i.pan(i.keyPanSpeed,0);i.update();break;case i.keys.RIGHT:i.pan(-i.keyPanSpeed,0);i.update();break}}function L(e){if(i.enabled===false)return;switch(e.touches.length){case 1:if(i.noRotate===true)return;b=w.TOUCH_ROTATE;n.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(i.noZoom===true)return;b=w.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX;var r=e.touches[0].pageY-e.touches[1].pageY;var a=Math.sqrt(t*t+r*r);p.set(0,a);break;case 3:if(i.noPan===true)return;b=w.TOUCH_PAN;s.set(e.touches[0].pageX,e.touches[0].pageY);break;default:b=w.NONE}i.dispatchEvent(R)}function O(e){if(i.enabled===false)return;e.preventDefault();e.stopPropagation();var t=i.domElement===document?i.domElement.body:i.domElement;switch(e.touches.length){case 1:if(i.noRotate===true)return;if(b!==w.TOUCH_ROTATE)return;a.set(e.touches[0].pageX,e.touches[0].pageY);o.subVectors(a,n);i.rotateLeft(2*Math.PI*o.x/t.clientWidth*i.rotateSpeed);i.rotateUp(2*Math.PI*o.y/t.clientHeight*i.rotateSpeed);n.copy(a);i.update();break;case 2:if(i.noZoom===true)return;if(b!==w.TOUCH_DOLLY)return;var r=e.touches[0].pageX-e.touches[1].pageX;var u=e.touches[0].pageY-e.touches[1].pageY;var c=Math.sqrt(r*r+u*u);f.set(0,c);d.subVectors(f,p);if(d.y>0){i.dollyOut()}else{i.dollyIn()}p.copy(f);i.update();break;case 3:if(i.noPan===true)return;if(b!==w.TOUCH_PAN)return;h.set(e.touches[0].pageX,e.touches[0].pageY);l.subVectors(h,s);i.pan(l.x,l.y);s.copy(h);i.update();break;default:b=w.NONE}}function D(){if(i.enabled===false)return;i.dispatchEvent(k);b=w.NONE}this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},false);this.domElement.addEventListener("mousedown",S,false);this.domElement.addEventListener("mousewheel",z,false);this.domElement.addEventListener("DOMMouseScroll",z,false);this.domElement.addEventListener("touchstart",L,false);this.domElement.addEventListener("touchend",D,false);this.domElement.addEventListener("touchmove",O,false);window.addEventListener("keydown",P,false);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.DeviceOrientationControls=function(e){var t=this;this.object=e;this.object.rotation.reorder("YXZ");this.freeze=true;this.deviceOrientation={};this.screenOrientation=0;var i=function(e){t.deviceOrientation=e};var r=function(){t.screenOrientation=window.orientation||0};var n=function(){var e=new THREE.Vector3(0,0,1);var t=new THREE.Euler;var i=new THREE.Quaternion;var r=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(n,a,o,s,h){t.set(o,a,-s,"YXZ");n.setFromEuler(t);n.multiply(r);n.multiply(i.setFromAxisAngle(e,-h))}}();this.connect=function(){r();window.addEventListener("orientationchange",r,false);window.addEventListener("deviceorientation",i,false);t.freeze=false};this.disconnect=function(){t.freeze=true;window.removeEventListener("orientationchange",r,false);window.removeEventListener("deviceorientation",i,false)};this.update=function(){if(t.freeze)return;var e=t.deviceOrientation.gamma?THREE.Math.degToRad(t.deviceOrientation.alpha):0;var i=t.deviceOrientation.beta?THREE.Math.degToRad(t.deviceOrientation.beta):0;var r=t.deviceOrientation.gamma?THREE.Math.degToRad(t.deviceOrientation.gamma):0;var a=t.screenOrientation?THREE.Math.degToRad(t.screenOrientation):0;n(t.object.quaternion,e,i,r,a)}};(function e(t,i,r){function n(o,s){if(!i[o]){if(!t[o]){var h=typeof require=="function"&&require;if(!s&&h)return h(o,!0);if(a)return a(o,!0);throw new Error("Cannot find module '"+o+"'")}var l=i[o]={exports:{}};t[o][0].call(l.exports,function(e){var i=t[o][1][e];return n(i?i:e)},l,l.exports,e,t,i,r)}return i[o].exports}var a=typeof require=="function"&&require;for(var o=0;o<r.length;o++)n(r[o]);return n})({1:[function(e,t,i){t.exports={"arrow.position":"uniform float worldUnit;\nuniform float lineDepth;\nuniform float lineWidth;\nuniform float focusDepth;\n\nuniform vec4 geometryClip;\nuniform float arrowSize;\nuniform float arrowSpace;\n\nattribute vec4 position4;\nattribute vec3 arrow;\nattribute vec2 attach;\n\n// External\nvec3 getPosition(vec4 xyzw, float canonical);\n\nvoid getArrowGeometry(vec4 xyzw, float near, float far, out vec3 left, out vec3 right, out vec3 start) {\n  right = getPosition(xyzw, 1.0);\n  left  = getPosition(vec4(near, xyzw.yzw), 0.0);\n  start = getPosition(vec4(far, xyzw.yzw), 0.0);\n}\n\nmat4 getArrowMatrix(vec3 left, vec3 right, vec3 start) {\n\n  float depth = focusDepth;\n  if (lineDepth < 1.0) {\n    // Depth blending\n    float z = max(0.00001, -right.z);\n    depth = mix(z, focusDepth, lineDepth);\n  }\n    \n  vec3 diff = left - right;\n  float l = length(diff);\n  if (l == 0.0) {\n    return mat4(1.0, 0.0, 0.0, 0.0,\n                0.0, 1.0, 0.0, 0.0,\n                0.0, 0.0, 1.0, 0.0,\n                0.0, 0.0, 0.0, 1.0);\n  }\n\n  // Construct TBN matrix around shaft\n  vec3 t = normalize(diff);\n  vec3 n = normalize(cross(t, t.yzx + vec3(.1, .2, .3)));\n  vec3 b = cross(n, t);\n  \n  // Shrink arrows when vector gets too small\n  // Approach linear scaling with cubic ease the smaller we get\n  float size = arrowSize * lineWidth * worldUnit * depth * 1.25;\n  diff = right - start;\n  l = length(diff) * arrowSpace;\n  float mini = clamp(1.0 - l / size * .333, 0.0, 1.0);\n  float scale = 1.0 - mini * mini * mini;\n  float range = size * scale;\n  \n  // Size to 2.5:1 ratio\n  float rangeNB = range / 2.5;\n\n  // Anchor at end position\n  return mat4(vec4(n * rangeNB,  0),\n              vec4(b * rangeNB,  0),\n              vec4(t * range, 0),\n              vec4(right,  1.0));\n}\n\nvec3 getArrowPosition() {\n  vec3 left, right, start;\n  \n  vec4 p = min(geometryClip, position4);\n  \n  getArrowGeometry(p, attach.x, attach.y, left, right, start);\n  mat4 matrix = getArrowMatrix(left, right, start);\n  return (matrix * vec4(arrow.xyz, 1.0)).xyz;\n\n}\n","axis.position":"uniform vec4 axisStep;\nuniform vec4 axisPosition;\n\nvec4 getAxisPosition(vec4 xyzw, inout vec4 stpq) {\n  return axisStep * xyzw.x + axisPosition;\n}\n","cartesian.position":"uniform mat4 viewMatrix;\n\nvec4 getCartesianPosition(vec4 position, inout vec4 stpq) {\n  return viewMatrix * vec4(position.xyz, 1.0);\n}\n","cartesian4.position":"uniform vec4 basisScale;\nuniform vec4 basisOffset;\nuniform vec4 viewScale;\nuniform vec4 viewOffset;\n\nvec4 getCartesian4Position(vec4 position, inout vec4 stpq) {\n  return position * basisScale + basisOffset;\n}\n","clamp.position":"uniform vec4 clampLimit;\n\nvec4 getClampXYZW(vec4 xyzw) {\n  return clamp(xyzw, vec4(0.0), clampLimit);\n}\n","color.opaque":"vec4 opaqueColor(vec4 color) {\n  return vec4(color.rgb, 1.0);\n}\n","face.position":"uniform vec4 geometryClip;\nattribute vec4 position4;\n\n// External\nvec3 getPosition(vec4 xyzw, float canonical);\n\nvec3 getFacePosition() {\n  vec4 p = min(geometryClip, position4);\n  return getPosition(p, 1.0);\n}\n","face.position.normal":"attribute vec4 position4;\n\n// External\nvec3 getPosition(vec4 xyzw, float canonical);\n\nvarying vec3 vNormal;\nvarying vec3 vLight;\nvarying vec3 vPosition;\n\nvoid getFaceGeometry(vec4 xyzw, out vec3 pos, out vec3 normal) {\n  vec3 a, b, c;\n\n  a   = getPosition(vec4(xyzw.xyz, 0.0), 0.0);\n  b   = getPosition(vec4(xyzw.xyz, 1.0), 0.0);\n  c   = getPosition(vec4(xyzw.xyz, 2.0), 0.0);\n\n  pos = getPosition(xyzw, 1.0);\n  normal = normalize(cross(c - a, b - a));\n}\n\nvec3 getFacePositionNormal() {\n  vec3 center, normal;\n\n  getFaceGeometry(position4, center, normal);\n  vNormal   = normal;\n  vLight    = normalize((viewMatrix * vec4(1.0, 2.0, 2.0, 0.0)).xyz);\n  vPosition = -center;\n\n  return center;\n}\n","float.encode":"/*\nFloat encoding technique by\nCarlos Scheidegger\nhttps://github.com/cscheid/lux/blob/master/src/shade/bits/encode_float.js\n\nConversion to GLSL by:\nhttp://concord-consortium.github.io/lab/experiments/webgl-gpgpu/script.js\n*/\n\nfloat shift_right(float v, float amt) { \n  v = floor(v) + 0.5; \n  return floor(v / exp2(amt)); \n}\n\nfloat shift_left(float v, float amt) { \n  return floor(v * exp2(amt) + 0.5); \n}\n\nfloat mask_last(float v, float bits) { \n  return mod(v, shift_left(1.0, bits)); \n}\n\nfloat extract_bits(float num, float from, float to) { \n  from = floor(from + 0.5); to = floor(to + 0.5); \n  return mask_last(shift_right(num, from), to - from); \n}\n\nvec4 encode_float(float val) { \n  if (val == 0.0) return vec4(0, 0, 0, 0); \n  float valuesign = val > 0.0 ? 0.0 : 1.0; \n  val = abs(val); \n  float exponent = floor(log2(val)); \n  float biased_exponent = exponent + 127.0; \n  float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0; \n  float t = biased_exponent / 2.0; \n  float last_bit_of_biased_exponent = fract(t) * 2.0; \n  float remaining_bits_of_biased_exponent = floor(t); \n  float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0; \n  float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0; \n  float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0; \n  float byte1 = (valuesign * 128.0 + remaining_bits_of_biased_exponent) / 255.0; \n  return vec4(byte4, byte3, byte2, byte1); \n}\n","float.index.pack":"uniform vec4 indexModulus;\n\nvec4 getSample(vec4 xyzw);\nvec4 getIndex(vec4 xyzw);\n\nvec4 floatPackIndex(vec4 xyzw) {\n  vec4 value = getSample(xyzw);\n  vec4 index = getIndex(xyzw);\n\n  vec4 offset = floor(index + .5) * indexModulus;\n  vec2 sum2 = offset.xy + offset.zw;\n  float sum = sum2.x + sum2.y;\n  return vec4(value.xyz, sum);\n}","float.stretch":"vec4 getSample(vec4 xyzw);\n\nfloat floatStretch(vec4 xyzw, float channelIndex) {\n  vec4 sample = getSample(xyzw);\n  vec2 xy = channelIndex > 1.5 ? sample.zw : sample.xy;\n  return mod(channelIndex, 2.0) > .5 ? xy.y : xy.x;\n}","fragment.clip.dashed":"varying float vClipStrokeWidth;\nvarying float vClipStrokeIndex;\nvarying vec3  vClipStrokeEven;\nvarying vec3  vClipStrokeOdd;\nvarying vec3  vClipStrokePosition;\n\nvoid clipStrokeFragment() {\n  bool odd = mod(vClipStrokeIndex, 2.0) >= 1.0;\n\n  vec3 tangent;\n  if (odd) {\n    tangent = vClipStrokeOdd;\n  }\n  else {\n    tangent = vClipStrokeEven;\n  }\n\n  float travel = dot(vClipStrokePosition, normalize(tangent)) / vClipStrokeWidth;\n  if (mod(travel, 16.0) > 8.0) {\n    discard;\n  }\n}\n","fragment.clip.dotted":"varying float vClipStrokeWidth;\nvarying float vClipStrokeIndex;\nvarying vec3  vClipStrokeEven;\nvarying vec3  vClipStrokeOdd;\nvarying vec3  vClipStrokePosition;\n\nvoid clipStrokeFragment() {\n  bool odd = mod(vClipStrokeIndex, 2.0) >= 1.0;\n\n  vec3 tangent;\n  if (odd) {\n    tangent = vClipStrokeOdd;\n  }\n  else {\n    tangent = vClipStrokeEven;\n  }\n\n  float travel = dot(vClipStrokePosition, normalize(tangent)) / vClipStrokeWidth;\n  if (mod(travel, 4.0) > 2.0) {\n    discard;\n  }\n}\n","fragment.clip.ends":"varying vec2 vClipEnds;\n\nvoid clipEndsFragment() {\n  if (vClipEnds.x < 0.0 || vClipEnds.y < 0.0) discard;\n}\n","fragment.clip.proximity":"varying float vClipProximity;\n\nvoid clipProximityFragment() {\n  if (vClipProximity >= 0.5) discard;\n}","fragment.color":"void setFragmentColor(vec4 color) {\n  gl_FragColor = color;\n}","fragment.map.rgba":"vec4 fragmentRGBA(vec4 rgba, vec4 stpq) {\n  return rgba;\n}","fragment.solid":"void setFragmentColor(vec4 color) {\n  if (color.a < 1.0) discard;\n  gl_FragColor = color;\n}","fragment.transparent":"void setFragmentColor(vec4 color) {\n  if (color.a >= 1.0) discard;\n  gl_FragColor = color;\n}","grid.position":"uniform vec4 gridPosition;\nuniform vec4 gridStep;\nuniform vec4 gridAxis;\n\nvec4 sampleData(vec2 xy);\n\nvec4 getGridPosition(vec4 xyzw) {\n  vec4 onAxis  = gridAxis * sampleData(vec2(xyzw.y, 0.0)).x;\n  vec4 offAxis = gridStep * xyzw.x + gridPosition;\n  return onAxis + offAxis;\n}\n","grow.position":"uniform float growScale;\nuniform vec4  growMask;\nuniform vec4  growAnchor;\n\nvec4 getSample(vec4 xyzw);\n\nvec4 getGrowSample(vec4 xyzw) {\n  vec4 anchor = xyzw * growMask + growAnchor;\n\n  vec4 position = getSample(xyzw);\n  vec4 center = getSample(anchor);\n\n  return mix(center, position, growScale);\n}","join.position":"uniform float joinStride;\nuniform float joinStrideInv;\n\nfloat getIndex(vec4 xyzw);\nvec4 getRest(vec4 xyzw);\nvec4 injectIndices(float a, float b);\n\nvec4 getJoinXYZW(vec4 xyzw) {\n\n  float a = getIndex(xyzw);\n  float b = a * joinStrideInv;\n\n  float integer  = floor(b);\n  float fraction = b - integer;\n  \n  return injectIndices(fraction * joinStride, integer) + getRest(xyzw);\n}\n","label.alpha":"varying float vPixelSize;\n\nvec4 getLabelAlphaColor(vec4 color, vec4 sample) {\n  float mask = clamp(sample.r * 1000.0, 0.0, 1.0);\n  float alpha = (sample.r - .5) * vPixelSize + .5;\n  float a = mask * alpha * color.a;\n  if (a <= 0.0) discard;\n  return vec4(color.xyz, a);\n}\n","label.map":"vec2 mapUV(vec4 uvwo, vec4 stpq) {\n  return uvwo.xy;\n}\n","label.outline":"uniform float outlineExpand;\nuniform float outlineStep;\nuniform vec3  outlineColor;\n\nvarying float vPixelSize;\n\nconst float PIXEL_STEP = 255.0 / 16.0;\n\nvec4 getLabelOutlineColor(vec4 color, vec4 sample) {\n  float ps = vPixelSize * PIXEL_STEP;\n  float os = outlineStep;\n\n  float sdf = sample.r - .5 + outlineExpand;\n  vec2  sdfs = vec2(sdf, sdf + os);\n  vec2  alpha = clamp(sdfs * ps + .5, 0.0, 1.0);\n\n  if (alpha.y <= 0.0) {\n    discard;\n  }\n\n  vec3 blend = color.xyz;\n  if (alpha.y > alpha.x) {\n    blend = sqrt(mix(outlineColor * outlineColor, blend * blend, alpha.x));\n  }\n  \n  return vec4(blend, alpha.y * color.a);\n}\n","layer.position":"uniform vec4 layerScale;\nuniform vec4 layerBias;\n\nvec4 layerPosition(vec4 position, inout vec4 stpq) {\n  return layerScale * position + layerBias;\n}\n","lerp.depth":"// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 lerpDepth(vec4 xyzw) {\n  float x = xyzw.z;\n  float i = floor(x);\n  float f = x - i;\n    \n  vec4 xyzw1 = vec4(xyzw.xy, i, xyzw.w);\n  vec4 xyzw2 = vec4(xyzw.xy, i + 1.0, xyzw.w);\n  \n  vec4 a = sampleData(xyzw1);\n  vec4 b = sampleData(xyzw2);\n\n  return mix(a, b, f);\n}\n","lerp.height":"// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 lerpHeight(vec4 xyzw) {\n  float x = xyzw.y;\n  float i = floor(x);\n  float f = x - i;\n    \n  vec4 xyzw1 = vec4(xyzw.x, i, xyzw.zw);\n  vec4 xyzw2 = vec4(xyzw.x, i + 1.0, xyzw.zw);\n  \n  vec4 a = sampleData(xyzw1);\n  vec4 b = sampleData(xyzw2);\n\n  return mix(a, b, f);\n}\n","lerp.items":"// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 lerpItems(vec4 xyzw) {\n  float x = xyzw.w;\n  float i = floor(x);\n  float f = x - i;\n    \n  vec4 xyzw1 = vec4(xyzw.xyz, i);\n  vec4 xyzw2 = vec4(xyzw.xyz, i + 1.0);\n  \n  vec4 a = sampleData(xyzw1);\n  vec4 b = sampleData(xyzw2);\n\n  return mix(a, b, f);\n}\n","lerp.width":"// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 lerpWidth(vec4 xyzw) {\n  float x = xyzw.x;\n  float i = floor(x);\n  float f = x - i;\n    \n  vec4 xyzw1 = vec4(i, xyzw.yzw);\n  vec4 xyzw2 = vec4(i + 1.0, xyzw.yzw);\n  \n  vec4 a = sampleData(xyzw1);\n  vec4 b = sampleData(xyzw2);\n\n  return mix(a, b, f);\n}\n","line.position":"// Units and calibration\nuniform float worldUnit;\nuniform float lineWidth;\nuniform float lineDepth;\nuniform float focusDepth;\n\n// General data index\nuniform vec4 geometryClip;\nattribute vec4 position4;\n\n// (Start/mid/end -1/0/1, top/bottom -1,1) \nattribute vec2 line;\n\n// 0...1 for round or bevel joins\n#ifdef LINE_JOIN_DETAIL\nattribute float joint;\n#else\nconst float joint = 0.0;\n#endif\n\n// Knock out excessively long line segments (e.g. for asymtpotes)\n#ifdef LINE_PROXIMITY\nuniform float lineProximity;\nvarying float vClipProximity;\n#endif\n\n// Ghetto line stroking (local only, not global)\n#ifdef LINE_STROKE\nvarying float vClipStrokeWidth;\nvarying float vClipStrokeIndex;\nvarying vec3  vClipStrokeEven;\nvarying vec3  vClipStrokeOdd;\nvarying vec3  vClipStrokePosition;\n#endif\n\n// External\nvec3 getPosition(vec4 xyzw, float canonical);\n\n// Clip line ends for arrows / decoration\n#ifdef LINE_CLIP\nuniform float clipRange;\nuniform vec2  clipStyle;\nuniform float clipSpace;\n\nattribute vec2 strip;\n\nvarying vec2 vClipEnds;\n\nvoid clipEnds(vec4 xyzw, vec3 center, vec3 pos) {\n\n  // Sample end of line strip\n  vec4 xyzwE = vec4(strip.y, xyzw.yzw);\n  vec3 end   = getPosition(xyzwE, 0.0);\n\n  // Sample start of line strip\n  vec4 xyzwS = vec4(strip.x, xyzw.yzw);\n  vec3 start = getPosition(xyzwS, 0.0);\n\n  // Measure length\n  vec3 diff = end - start;\n  float l = length(diff) * clipSpace;\n\n  // Arrow length (=2.5x radius)\n  float arrowSize = 1.25 * clipRange * lineWidth * worldUnit;\n\n  vClipEnds = vec2(1.0);\n\n  if (clipStyle.y > 0.0) {\n    // Depth blend end\n    float depth = focusDepth;\n    if (lineDepth < 1.0) {\n      float z = max(0.00001, -end.z);\n      depth = mix(z, focusDepth, lineDepth);\n    }\n    \n    // Absolute arrow length\n    float size = arrowSize * depth;\n\n    // Adjust clip range\n    // Approach linear scaling with cubic ease the smaller we get\n    float mini = clamp(1.0 - l / size * .333, 0.0, 1.0);\n    float scale = 1.0 - mini * mini * mini; \n    float invrange = 1.0 / (size * scale);\n  \n    // Clip end\n    diff = end - center;\n    if(diff == vec3(0.0))\n      vClipEnds.x = -1.0;\n    else {\n      diff = normalize(end - center);\n      float d = dot(end - pos, diff);\n      vClipEnds.x = d * invrange - 1.0;\n    }\n  }\n\n  if (clipStyle.x > 0.0) {\n    // Depth blend start\n    float depth = focusDepth;\n    if (lineDepth < 1.0) {\n      float z = max(0.00001, -start.z);\n      depth = mix(z, focusDepth, lineDepth);\n    }\n    \n    // Absolute arrow length\n    float size = arrowSize * depth;\n\n    // Adjust clip range\n    // Approach linear scaling with cubic ease the smaller we get\n    float mini = clamp(1.0 - l / size * .333, 0.0, 1.0);\n    float scale = 1.0 - mini * mini * mini; \n    float invrange = 1.0 / (size * scale);\n  \n    // Clip start \n    diff = center - start;\n    if(diff == vec3(0.0))\n      vClipEnds.y = -1.0;\n    else {\n      diff = normalize(center - start);\n      float d = dot(pos - start, diff);\n      vClipEnds.y = d * invrange - 1.0;\n    }\n  }\n\n\n}\n#endif\n\n// Adjust left/center/right to be inside near/far z range\nconst float epsilon = 1e-5;\nvoid fixCenter(inout vec3 left, inout vec3 center, inout vec3 right) {\n  if (center.z >= 0.0) {\n    if (left.z < 0.0) {\n      float d = (center.z + epsilon) / (center.z - left.z);\n      center = mix(center, left, d);\n    }\n    else if (right.z < 0.0) {\n      float d = (center.z + epsilon) / (center.z - right.z);\n      center = mix(center, right, d);\n    }\n  }\n\n  if (left.z >= 0.0) {\n    if (center.z < 0.0) {\n      float d = (left.z + epsilon) / (left.z - center.z);\n      left = mix(left, center, d);\n    }\n  }\n\n  if (right.z >= 0.0) {\n    if (center.z < 0.0) {\n      float d = (right.z + epsilon) / (right.z - center.z);\n      right = mix(right, center, d);\n    }\n  }\n}\n\n// Sample the source data in an edge-aware manner\nvoid getLineGeometry(vec4 xyzw, float edge, out vec3 left, out vec3 center, out vec3 right) {\n  vec4 delta = vec4(1.0, 0.0, 0.0, 0.0);\n\n  center =                 getPosition(xyzw, 1.0);\n  left   = (edge > -0.5) ? getPosition(xyzw - delta, 0.0) : center;\n  right  = (edge < 0.5)  ? getPosition(xyzw + delta, 0.0) : center;\n}\n\n// Calculate the position for a vertex along the line, including joins\nvec3 getLineJoin(float edge, bool odd, vec3 left, vec3 center, vec3 right, float width, float offset, float joint) {\n  vec2 join = vec2(1.0, 0.0);\n\n  fixCenter(left, center, right);\n\n  vec4 a = vec4(left.xy, right.xy);\n  vec4 b = a / vec4(left.zz, right.zz);\n\n  vec2 l = b.xy;\n  vec2 r = b.zw;\n  vec2 c = center.xy / center.z;\n\n  vec4 d = vec4(l, c) - vec4(c, r);\n  float l1 = dot(d.xy, d.xy);\n  float l2 = dot(d.zw, d.zw);\n\n  if (l1 + l2 > 0.0) {\n    \n    if (edge > 0.5 || l2 == 0.0) {\n      vec2 nl = normalize(d.xy);\n      vec2 tl = vec2(nl.y, -nl.x);\n\n#ifdef LINE_PROXIMITY\n      vClipProximity = 1.0;\n#endif\n\n#ifdef LINE_STROKE\n      vClipStrokeEven = vClipStrokeOdd = normalize(left - center);\n#endif\n      join = tl;\n    }\n    else if (edge < -0.5 || l1 == 0.0) {\n      vec2 nr = normalize(d.zw);\n      vec2 tr = vec2(nr.y, -nr.x);\n\n#ifdef LINE_PROXIMITY\n      vClipProximity = 1.0;\n#endif\n\n#ifdef LINE_STROKE\n      vClipStrokeEven = vClipStrokeOdd = normalize(center - right);\n#endif\n      join = tr;\n    }\n    else {\n      // Limit join stretch for tiny segments\n      float lmin2 = min(l1, l2) / (width * width);\n\n      // Hide line segment if ratio of leg lengths exceeds promixity threshold\n#ifdef LINE_PROXIMITY\n      float lr     = l1 / l2;\n      float rl     = l2 / l1;\n      float ratio  = max(lr, rl);\n      float thresh = lineProximity + 1.0;\n      vClipProximity = (ratio > thresh * thresh) ? 1.0 : 0.0;\n#endif\n\n      // Calculate normals/tangents\n      vec2 nl = normalize(d.xy);\n      vec2 nr = normalize(d.zw);\n\n      // Calculate tangents\n      vec2 tl = vec2(nl.y, -nl.x);\n      vec2 tr = vec2(nr.y, -nr.x);\n\n#ifdef LINE_PROXIMITY\n      // Mix tangents according to leg lengths\n      vec2 tc = normalize(mix(tl, tr, l1/(l1+l2)));\n#else\n      // Average tangent\n      vec2 tc = normalize(tl + tr);\n#endif\n    \n      // Miter join\n      float cosA   = dot(nl, tc);\n      float sinA   = max(0.1, abs(dot(tl, tc)));\n      float factor = cosA / sinA;\n      float scale  = sqrt(1.0 + min(lmin2, factor * factor));\n\n      // Stroke normals\n#ifdef LINE_STROKE\n      vec3 stroke1 = normalize(left - center);\n      vec3 stroke2 = normalize(center - right);\n\n      if (odd) {\n        vClipStrokeEven = stroke1;\n        vClipStrokeOdd  = stroke2;\n      }\n      else {\n        vClipStrokeEven = stroke2;\n        vClipStrokeOdd  = stroke1;\n      }\n#endif\n\n#ifdef LINE_JOIN_MITER\n      // Apply straight up miter\n      join = tc * scale;\n#endif\n\n#ifdef LINE_JOIN_ROUND\n      // Slerp bevel join into circular arc\n      float dotProduct = dot(nl, nr);\n      float angle = acos(dotProduct);\n      float sinT  = sin(angle);\n      join = (sin((1.0 - joint) * angle) * tl + sin(joint * angle) * tr) / sinT;\n#endif\n\n#ifdef LINE_JOIN_BEVEL\n      // Direct bevel join between two flat ends\n      float dotProduct = dot(nl, nr);\n      join = mix(tl, tr, joint);\n#endif\n\n#ifdef LINE_JOIN_DETAIL\n      // Check if on inside or outside of joint\n      float crossProduct = nl.x * nr.y - nl.y * nr.x;\n      if (offset * crossProduct < 0.0) {\n        // For near-180-degree bends, correct back to a miter to avoid discontinuities\n        float ratio = clamp(-dotProduct * 2.0 - 1.0, 0.0, 1.0);\n        // Otherwise collapse the inside vertices into one.\n        join = mix(tc * scale, join, ratio * ratio * ratio);\n      }\n#endif\n\n    }\n    return vec3(join, 0.0);\n  }\n  else {\n    return vec3(0.0);\n  }\n\n}\n\n// Calculate final line position\nvec3 getLinePosition() {\n  vec3 left, center, right, join;\n\n  // left/center/right\n  float edge = line.x;\n  // up/down\n  float offset = line.y;\n\n  // Clip data\n  vec4 p = min(geometryClip, position4);\n  edge += max(0.0, position4.x - geometryClip.x);\n\n  // Get position + adjacent neighbours\n  getLineGeometry(p, edge, left, center, right);\n\n#ifdef LINE_STROKE\n  // Set parameters for line stroke fragment shader\n  vClipStrokePosition = center;\n  vClipStrokeIndex = p.x;\n  bool odd = mod(p.x, 2.0) >= 1.0;\n#else\n  bool odd = true;\n#endif\n\n  // Divide line width up/down\n  float width = lineWidth * 0.5;\n\n  float depth = focusDepth;\n  if (lineDepth < 1.0) {\n    // Depth blending\n    float z = max(0.00001, -center.z);\n    depth = mix(z, focusDepth, lineDepth);\n  }\n  width *= depth;\n\n  // Convert to world units\n  width *= worldUnit;\n\n  // Calculate line join\n  join = getLineJoin(edge, odd, left, center, right, width, offset, joint);\n  vec3 pos = center + join * offset * width;\n\n#ifdef LINE_STROKE\n  vClipStrokeWidth = width;\n#endif\n\n#ifdef LINE_CLIP\n  clipEnds(p, center, pos);\n#endif\n\n  return pos;\n}\n","map.2d.data":"uniform vec2 dataResolution;\nuniform vec2 dataPointer;\n\nvec2 map2DData(vec2 xy) {\n  return (xy + dataPointer) * dataResolution;\n}\n","map.2d.data.wrap":"uniform vec2 dataResolution;\nuniform vec2 dataPointer;\n\nvec2 map2DData(vec2 xy) {\n  return fract((xy + dataPointer) * dataResolution);\n}\n","map.xyzw.2dv":"void mapXyzw2DV(vec4 xyzw, out vec2 xy, out float z) {\n  xy = xyzw.xy;\n  z  = xyzw.z;\n}\n\n","map.xyzw.align":"vec4 alignXYZW(vec4 xyzw) {\n  return floor(xyzw + .5);\n}\n\n","map.xyzw.texture":"uniform float textureItems;\nuniform float textureHeight;\n\nvec2 mapXyzwTexture(vec4 xyzw) {\n  \n  float x = xyzw.x;\n  float y = xyzw.y;\n  float z = xyzw.z;\n  float i = xyzw.w;\n  \n  return vec2(i, y) + vec2(x, z) * vec2(textureItems, textureHeight);\n}\n\n","mesh.fragment.color":"varying vec4 vColor;\n\nvec4 getColor() {\n  return vColor;\n}\n","mesh.fragment.map":"#ifdef POSITION_STPQ\nvarying vec4 vSTPQ;\n#endif\n#ifdef POSITION_U\nvarying float vU;\n#endif\n#ifdef POSITION_UV\nvarying vec2 vUV;\n#endif\n#ifdef POSITION_UVW\nvarying vec3 vUVW;\n#endif\n#ifdef POSITION_UVWO\nvarying vec4 vUVWO;\n#endif\n\nvec4 getSample(vec4 uvwo, vec4 stpq);\n\nvec4 getMapColor() {\n  #ifdef POSITION_STPQ\n  vec4 stpq = vSTPQ;\n  #else\n  vec4 stpq = vec4(0.0);\n  #endif\n\n  #ifdef POSITION_U\n  vec4 uvwo = vec4(vU, 0.0, 0.0, 0.0);\n  #endif\n  #ifdef POSITION_UV\n  vec4 uvwo = vec4(vUV, 0.0, 0.0);\n  #endif\n  #ifdef POSITION_UVW\n  vec4 uvwo = vec4(vUVW, 0.0);\n  #endif\n  #ifdef POSITION_UVWO\n  vec4 uvwo = vec4(vUVWO);\n  #endif\n\n  return getSample(uvwo, stpq);\n}\n","mesh.fragment.mask":"varying float vMask;\n\nfloat ease(float t) {\n  t = clamp(t, 0.0, 1.0);\n  return t * t * (3.0 - 2.0 * t);\n}\n\nvec4 maskColor() {\n  if (vMask <= 0.0) discard;\n  return vec4(vec3(1.0), ease(vMask));\n}\n","mesh.fragment.material":"#ifdef POSITION_STPQ\nvarying vec4 vSTPQ;\n#endif\n#ifdef POSITION_U\nvarying float vU;\n#endif\n#ifdef POSITION_UV\nvarying vec2 vUV;\n#endif\n#ifdef POSITION_UVW\nvarying vec3 vUVW;\n#endif\n#ifdef POSITION_UVWO\nvarying vec4 vUVWO;\n#endif\n\nvec4 getSample(vec4 rgba, vec4 stpq);\n\nvec4 getMaterialColor(vec4 rgba) {\n  vec4 stpq = vec4(0.0);\n\n  #ifdef POSITION_U\n  stpq.x = vU;\n  #endif\n  #ifdef POSITION_UV\n  stpq.xy = vUV;\n  #endif\n  #ifdef POSITION_UVW\n  stpq.xyz = vUVW;\n  #endif\n  #ifdef POSITION_UVWO\n  stpq = vUVWO;\n  #endif\n\n  #ifdef POSITION_STPQ\n  stpq = vSTPQ;\n  #endif\n\n  return getSample(rgba, stpq);\n}\n","mesh.fragment.shaded":"varying vec3 vNormal;\nvarying vec3 vLight;\nvarying vec3 vPosition;\n\nvec3 offSpecular(vec3 color) {\n  vec3 c = 1.0 - color;\n  return 1.0 - c * c;\n}\n\nvec4 getShadedColor(vec4 rgba) {\n  \n  vec3 color = rgba.xyz;\n  vec3 color2 = offSpecular(rgba.xyz);\n\n  vec3 normal = normalize(vNormal);\n  vec3 light = normalize(vLight);\n  vec3 position = normalize(vPosition);\n  \n  float side    = gl_FrontFacing ? -1.0 : 1.0;\n  float cosine  = side * dot(normal, light);\n  float diffuse = mix(max(0.0, cosine), .5 + .5 * cosine, .1);\n  \n  vec3  halfLight = normalize(light + position);\n\tfloat cosineHalf = max(0.0, side * dot(normal, halfLight));\n\tfloat specular = pow(cosineHalf, 16.0);\n\t\n\treturn vec4(color * (diffuse * .9 + .05) + .25 * color2 * specular, rgba.a);\n}\n","mesh.fragment.texture":"","mesh.gamma.in":"vec4 getGammaInColor(vec4 rgba) {\n  return vec4(rgba.rgb * rgba.rgb, rgba.a);\n}\n","mesh.gamma.out":"vec4 getGammaOutColor(vec4 rgba) {\n  return vec4(sqrt(rgba.rgb), rgba.a);\n}\n","mesh.map.uvwo":"vec4 mapUVWO(vec4 uvwo, vec4 stpq) {\n  return uvwo;\n}\n","mesh.position":"uniform vec4 geometryClip;\nattribute vec4 position4;\n\n// External\nvec3 getPosition(vec4 xyzw, float canonical);\n\nvec3 getMeshPosition() {\n  vec4 p = min(geometryClip, position4);\n  return getPosition(p, 1.0);\n}\n","mesh.vertex.color":"attribute vec4 position4;\nuniform vec4 geometryClip;\nvarying vec4 vColor;\n\n// External\nvec4 getSample(vec4 xyzw);\n\nvoid vertexColor() {\n  vec4 p = min(geometryClip, position4);\n  vColor = getSample(p);\n}\n","mesh.vertex.mask":"attribute vec4 position4;\nuniform vec4 geometryResolution;\nuniform vec4 geometryClip;\nvarying float vMask;\n\n// External\nfloat getSample(vec4 xyzw);\n\nvoid maskLevel() {\n  vec4 p = min(geometryClip, position4);\n  vMask = getSample(p * geometryResolution);\n}\n","mesh.vertex.position":"uniform vec4 geometryResolution;\n\n#ifdef POSITION_STPQ\nvarying vec4 vSTPQ;\n#endif\n#ifdef POSITION_U\nvarying float vU;\n#endif\n#ifdef POSITION_UV\nvarying vec2 vUV;\n#endif\n#ifdef POSITION_UVW\nvarying vec3 vUVW;\n#endif\n#ifdef POSITION_UVWO\nvarying vec4 vUVWO;\n#endif\n\n// External\nvec3 getPosition(vec4 xyzw, in vec4 stpqIn, out vec4 stpqOut);\n\nvec3 getMeshPosition(vec4 xyzw, float canonical) {\n  vec4 stpqOut, stpqIn = xyzw * geometryResolution;\n  vec3 xyz = getPosition(xyzw, stpqIn, stpqOut);\n\n  #ifdef POSITION_MAP\n  if (canonical > 0.5) {\n    #ifdef POSITION_STPQ\n    vSTPQ = stpqOut;\n    #endif\n    #ifdef POSITION_U\n    vU = stpqOut.x;\n    #endif\n    #ifdef POSITION_UV\n    vUV = stpqOut.xy;\n    #endif\n    #ifdef POSITION_UVW\n    vUVW = stpqOut.xyz;\n    #endif\n    #ifdef POSITION_UVWO\n    vUVWO = stpqOut;\n    #endif\n  }\n  #endif\n  return xyz;\n}\n","move.position":"uniform float transitionEnter;\nuniform float transitionExit;\nuniform vec4  transitionScale;\nuniform vec4  transitionBias;\nuniform float transitionSkew;\nuniform float transitionActive;\n\nuniform vec4  moveFrom;\nuniform vec4  moveTo;\n\nfloat ease(float t) {\n  t = clamp(t, 0.0, 1.0);\n  return 1.0 - (2.0 - t) * t;\n}\n\nvec4 getTransitionPosition(vec4 xyzw, inout vec4 stpq) {\n  if (transitionActive < 0.5) return xyzw;\n\n  float enter   = transitionEnter;\n  float exit    = transitionExit;\n  float skew    = transitionSkew;\n  vec4  scale   = transitionScale;\n  vec4  bias    = transitionBias;\n\n  float factor  = 1.0 + skew;\n  float offset  = dot(vec4(1.0), stpq * scale + bias);\n\n  float a1 = ease(enter * factor - offset);\n  float a2 = ease(exit  * factor + offset - skew);\n\n  return xyzw + a1 * moveFrom + a2 * moveTo;\n}","object.mask.default":"vec4 getMask(vec4 xyzw) {\n  return vec4(1.0);\n}","point.alpha.circle":"varying float vPixelSize;\n\nfloat getDiscAlpha(float mask) {\n  // Approximation: 1 - x*x is approximately linear around x = 1 with slope 2\n  return vPixelSize * (1.0 - mask);\n  //  return vPixelSize * 2.0 * (1.0 - sqrt(mask));\n}\n","point.alpha.circle.hollow":"varying float vPixelSize;\n\nfloat getDiscHollowAlpha(float mask) {\n  return vPixelSize * (0.5 - 2.0 * abs(sqrt(mask) - .75));\n}\n","point.alpha.generic":"varying float vPixelSize;\n\nfloat getGenericAlpha(float mask) {\n  return vPixelSize * 2.0 * (1.0 - mask);\n}\n","point.alpha.generic.hollow":"varying float vPixelSize;\n\nfloat getGenericHollowAlpha(float mask) {\n  return vPixelSize * (0.5 - 2.0 * abs(mask - .75));\n}\n","point.edge":"varying vec2 vSprite;\n\nfloat getSpriteMask(vec2 xy);\nfloat getSpriteAlpha(float mask);\n\nvoid setFragmentColorFill(vec4 color) {\n  float mask = getSpriteMask(vSprite);\n  if (mask > 1.0) {\n    discard;\n  }\n  float alpha = getSpriteAlpha(mask);\n  if (alpha >= 1.0) {\n    discard;\n  }\n  gl_FragColor = vec4(color.rgb, alpha * color.a);\n}\n","point.fill":"varying vec2 vSprite;\n\nfloat getSpriteMask(vec2 xy);\nfloat getSpriteAlpha(float mask);\n\nvoid setFragmentColorFill(vec4 color) {\n  float mask = getSpriteMask(vSprite);\n  if (mask > 1.0) {\n    discard;\n  }\n  float alpha = getSpriteAlpha(mask);\n  if (alpha < 1.0) {\n    discard;\n  }\n  gl_FragColor = color;\n}\n\n","point.mask.circle":"varying float vPixelSize;\n\nfloat getCircleMask(vec2 uv) {\n  return dot(uv, uv);\n}\n","point.mask.diamond":"varying float vPixelSize;\n\nfloat getDiamondMask(vec2 uv) {\n  vec2 a = abs(uv);\n  return a.x + a.y;\n}\n","point.mask.down":"varying float vPixelSize;\n\nfloat getTriangleDownMask(vec2 uv) {\n  uv.y += .25;\n  return max(uv.y, abs(uv.x) * .866 - uv.y * .5 + .6);\n}\n","point.mask.left":"varying float vPixelSize;\n\nfloat getTriangleLeftMask(vec2 uv) {\n  uv.x += .25;\n  return max(uv.x, abs(uv.y) * .866 - uv.x * .5 + .6);\n}\n","point.mask.right":"varying float vPixelSize;\n\nfloat getTriangleRightMask(vec2 uv) {\n  uv.x -= .25;\n  return max(-uv.x, abs(uv.y) * .866 + uv.x * .5 + .6);\n}\n","point.mask.square":"varying float vPixelSize;\n\nfloat getSquareMask(vec2 uv) {\n  vec2 a = abs(uv);\n  return max(a.x, a.y);\n}\n","point.mask.up":"varying float vPixelSize;\n\nfloat getTriangleUpMask(vec2 uv) {\n  uv.y -= .25;\n  return max(-uv.y, abs(uv.x) * .866 + uv.y * .5 + .6);\n}\n","point.position":"uniform float pointDepth;\n\nuniform float pixelUnit;\nuniform float renderScale;\nuniform float renderScaleInv;\nuniform float focusDepth;\n\nuniform vec4 geometryClip;\nattribute vec4 position4;\nattribute vec2 sprite;\n\nvarying vec2 vSprite;\nvarying float vPixelSize;\n\nconst float pointScale = POINT_SHAPE_SCALE;\n\n// External\nfloat getPointSize(vec4 xyzw);\nvec3 getPosition(vec4 xyzw, float canonical);\n\nvec3 getPointPosition() {\n  vec4 p = min(geometryClip, position4);\n  vec3 center = getPosition(p, 1.0);\n\n  // Depth blending\n  // TODO: orthographic camera\n  // Workaround: set depth = 0\n  float z = -center.z;\n  float depth = mix(z, focusDepth, pointDepth);\n  \n  // Match device/unit mapping \n  // Sprite goes from -1..1, width = 2.\n  float pointSize = getPointSize(p);\n  float size = pointScale * pointSize * pixelUnit * .5;\n  float depthSize = depth * size;\n  \n  // Pad sprite by half a pixel to make the anti-aliasing straddle the pixel edge\n  // Note: pixelsize measures radius\n  float pixelSize = .5 * (pointDepth > 0.0 ? depthSize / z : size);\n  float paddedSize = pixelSize + 0.5;\n  float padFactor = paddedSize / pixelSize;\n\n  vPixelSize = paddedSize;\n  vSprite    = sprite;\n\n  return center + vec3(sprite * depthSize * renderScaleInv * padFactor, 0.0);\n}\n","point.size.uniform":"uniform float pointSize;\n\nfloat getPointSize(vec4 xyzw) {\n  return pointSize;\n}","point.size.varying":"uniform float pointSize;\n\nvec4 getSample(vec4 xyzw);\n\nfloat getPointSize(vec4 xyzw) {\n  return pointSize * getSample(xyzw).x;\n}","polar.position":"uniform float polarBend;\nuniform float polarFocus;\nuniform float polarAspect;\nuniform float polarHelix;\n\nuniform mat4 viewMatrix;\n\nvec4 getPolarPosition(vec4 position, inout vec4 stpq) {\n  if (polarBend > 0.0) {\n\n    if (polarBend < 0.001) {\n      // Factor out large addition/subtraction of polarFocus\n      // to avoid numerical error\n      // sin(x) ~ x\n      // cos(x) ~ 1 - x * x / 2\n      vec2 pb = position.xy * polarBend;\n      float ppbbx = pb.x * pb.x;\n      return viewMatrix * vec4(\n        position.x * (1.0 - polarBend + (pb.y * polarAspect)),\n        position.y * (1.0 - .5 * ppbbx) - (.5 * ppbbx) * polarFocus / polarAspect,\n        position.z + position.x * polarHelix * polarBend,\n        1.0\n      );\n    }\n    else {\n      vec2 xy = position.xy * vec2(polarBend, polarAspect);\n      float radius = polarFocus + xy.y;\n      return viewMatrix * vec4(\n        sin(xy.x) * radius,\n        (cos(xy.x) * radius - polarFocus) / polarAspect,\n        position.z + position.x * polarHelix * polarBend,\n        1.0\n      );\n    }\n  }\n  else {\n    return viewMatrix * vec4(position.xyz, 1.0);\n  }\n}","project.position":"uniform float styleZBias;\nuniform float styleZIndex;\n\nvoid setPosition(vec3 position) {\n  vec4 pos = projectionMatrix * vec4(position, 1.0);\n\n  // Apply relative Z bias\n  float bias  = (1.0 - styleZBias / 32768.0);\n  pos.z *= bias;\n  \n  // Apply large scale Z index changes\n  if (styleZIndex > 0.0) {\n    float z = pos.z / pos.w;\n    pos.z = ((z + 1.0) / (styleZIndex + 1.0) - 1.0) * pos.w;\n  }\n  \n  gl_Position = pos;\n}","project.readback":"// This is three.js' global uniform, missing from fragment shaders.\nuniform mat4 projectionMatrix;\n\nvec4 readbackPosition(vec3 position, vec4 stpq) {\n  vec4 pos = projectionMatrix * vec4(position, 1.0);\n  vec3 final = pos.xyz / pos.w;\n  if (final.z < -1.0) {\n    return vec4(0.0, 0.0, 0.0, -1.0);\n  }\n  else {\n    return vec4(final, -position.z);\n  }\n}\n","raw.position.scale":"uniform vec4 geometryScale;\nattribute vec4 position4;\n\nvec4 getRawPositionScale() {\n  return geometryScale * position4;\n}\n","repeat.position":"uniform vec4 repeatModulus;\n\nvec4 getRepeatXYZW(vec4 xyzw) {\n  return mod(xyzw + .5, repeatModulus) - .5;\n}\n","resample.padding":"uniform vec4 resampleBias;\n\nvec4 resamplePadding(vec4 xyzw) {\n  return xyzw + resampleBias;\n}","resample.relative":"uniform vec4 resampleFactor;\n\nvec4 resampleRelative(vec4 xyzw) {\n  return xyzw * resampleFactor;\n}","reveal.mask":"uniform float transitionEnter;\nuniform float transitionExit;\nuniform vec4  transitionScale;\nuniform vec4  transitionBias;\nuniform float transitionSkew;\nuniform float transitionActive;\n\nfloat getTransitionSDFMask(vec4 stpq) {\n  if (transitionActive < 0.5) return 1.0;\n\n  float enter   = transitionEnter;\n  float exit    = transitionExit;\n  float skew    = transitionSkew;\n  vec4  scale   = transitionScale;\n  vec4  bias    = transitionBias;\n\n  float factor  = 1.0 + skew;\n  float offset  = dot(vec4(1.0), stpq * scale + bias);\n\n  vec2 d = vec2(enter, exit) * factor + vec2(-offset, offset - skew);\n  if (exit  == 1.0) return d.x;\n  if (enter == 1.0) return d.y;\n  return min(d.x, d.y);\n}","root.position":"vec3 getRootPosition(vec4 position, in vec4 stpqIn, out vec4 stpqOut) {\n  stpqOut = stpqIn; // avoid inout confusion\n  return position.xyz;\n}","sample.2d":"uniform sampler2D dataTexture;\n\nvec4 sample2D(vec2 uv) {\n  return texture2D(dataTexture, uv);\n}\n","scale.position":"uniform vec4 scaleAxis;\nuniform vec4 scaleOffset;\n\nvec4 sampleData(float x);\n\nvec4 getScalePosition(vec4 xyzw) {\n  return scaleAxis * sampleData(xyzw.x).x + scaleOffset;\n}\n","screen.map.stpq":"uniform vec4 remapSTPQScale;\n\nvec4 screenMapSTPQ(vec4 xyzw, out vec4 stpq) {\n  stpq = xyzw * remapSTPQScale;\n  return xyzw;\n}\n","screen.map.xy":"uniform vec2 remapUVScale;\n\nvec4 screenMapXY(vec4 uvwo, vec4 stpq) {\n  return vec4(floor(remapUVScale * uvwo.xy), 0.0, 0.0);\n}\n","screen.map.xyzw":"uniform vec2 remapUVScale;\nuniform vec2 remapModulus;\nuniform vec2 remapModulusInv;\n\nvec4 screenMapXYZW(vec4 uvwo, vec4 stpq) {\n  vec2 st = floor(remapUVScale * uvwo.xy);\n  vec2 xy = st * remapModulusInv;\n  vec2 ixy = floor(xy);\n  vec2 fxy = xy - ixy;\n  vec2 zw = fxy * remapModulus;\n  return vec4(ixy.x, zw.y, ixy.y, zw.x);\n}\n","screen.pass.uv":"vec2 screenPassUV(vec4 uvwo, vec4 stpq) {\n  return uvwo.xy;\n}\n","screen.position":"void setScreenPosition(vec4 position) {\n  gl_Position = vec4(position.xy * 2.0 - 1.0, 0.5, 1.0);\n}\n","slice.position":"uniform vec4 sliceOffset;\n\nvec4 getSliceOffset(vec4 xyzw) {\n  return xyzw + sliceOffset;\n}\n","spherical.position":"uniform float sphericalBend;\nuniform float sphericalFocus;\nuniform float sphericalAspectX;\nuniform float sphericalAspectY;\nuniform float sphericalScaleY;\n\nuniform mat4 viewMatrix;\n\nvec4 getSphericalPosition(vec4 position, inout vec4 stpq) {\n  if (sphericalBend > 0.0001) {\n\n    vec3 xyz = position.xyz * vec3(sphericalBend, sphericalBend / sphericalAspectY * sphericalScaleY, sphericalAspectX);\n    float radius = sphericalFocus + xyz.z;\n    float cosine = cos(xyz.y) * radius;\n\n    return viewMatrix * vec4(\n      sin(xyz.x) * cosine,\n      sin(xyz.y) * radius * sphericalAspectY,\n      (cos(xyz.x) * cosine - sphericalFocus) / sphericalAspectX,\n      1.0\n    );\n  }\n  else {\n    return viewMatrix * vec4(position.xyz, 1.0);\n  }\n}","split.position":"uniform float splitStride;\n\nvec2 getIndices(vec4 xyzw);\nvec4 getRest(vec4 xyzw);\nvec4 injectIndex(float v);\n\nvec4 getSplitXYZW(vec4 xyzw) {\n  vec2 uv = getIndices(xyzw);\n  float offset = uv.x + uv.y * splitStride;\n  return injectIndex(offset) + getRest(xyzw);\n}\n","spread.position":"uniform vec4 spreadOffset;\nuniform mat4 spreadMatrix;\n\n// External\nvec4 getSample(vec4 xyzw);\n\nvec4 getSpreadSample(vec4 xyzw) {\n  vec4 sample = getSample(xyzw);\n  return sample + spreadMatrix * (spreadOffset + xyzw);\n}\n","sprite.fragment":"varying vec2 vSprite;\n\nvec4 getSample(vec2 xy);\n\nvec4 getSpriteColor() {\n  return getSample(vSprite);\n}","sprite.position":"uniform vec2 spriteOffset;\nuniform float spriteScale;\nuniform float spriteDepth;\nuniform float spriteSnap;\n\nuniform vec2 renderOdd;\nuniform float renderScale;\nuniform float renderScaleInv;\nuniform float pixelUnit;\nuniform float focusDepth;\n\nuniform vec4 geometryClip;\nattribute vec4 position4;\nattribute vec2 sprite;\n\nvarying float vPixelSize;\n\n// External\nvec3 getPosition(vec4 xyzw, float canonical);\nvec4 getSprite(vec4 xyzw);\n\nvec3 getSpritePosition() {\n  // Clip points\n  vec4 p = min(geometryClip, position4);\n  float diff = length(position4 - p);\n  if (diff > 0.0) {\n    return vec3(0.0, 0.0, 1000.0);\n  }\n\n  // Make sprites\n  vec3 center = getPosition(p, 1.0);\n  vec4 atlas = getSprite(p);\n\n  // Sprite goes from -1..1, width = 2.\n  // -1..1 -> -0.5..0.5\n  vec2 halfSprite = sprite * .5;\n  vec2 halfFlipSprite = vec2(halfSprite.x, -halfSprite.y);\n\n#ifdef POSITION_UV\n  // Assign UVs\n  vUV = atlas.xy + atlas.zw * (halfFlipSprite + .5);\n#endif\n\n  // Depth blending\n  // TODO: orthographic camera\n  // Workaround: set depth = 0\n  float depth = focusDepth, z;\n  z = -center.z;\n  if (spriteDepth < 1.0) {\n    depth = mix(z, focusDepth, spriteDepth);\n  }\n  \n  // Match device/unit mapping \n  float size = pixelUnit * spriteScale;\n  float depthSize = depth * size;\n\n  // Calculate pixelSize for anti-aliasing\n  float pixelSize = (spriteDepth > 0.0 ? depthSize / z : size);\n  vPixelSize = pixelSize;\n\n  // Position sprite\n  vec2 atlasOdd = fract(atlas.zw / 2.0);\n  vec2 offset = (spriteOffset + halfSprite * atlas.zw) * depthSize;\n  if (spriteSnap > 0.5) {\n    // Snap to pixel (w/ epsilon shift to avoid jitter)\n    return vec3(((floor(center.xy / center.z * renderScale + 0.001) + renderOdd + atlasOdd) * center.z + offset) * renderScaleInv, center.z);\n  }\n  else {\n    // Place directly\n    return center + vec3(offset * renderScaleInv, 0.0);\n  }\n\n}\n","stereographic.position":"uniform float stereoBend;\n\nuniform mat4 viewMatrix;\n\nvec4 getStereoPosition(vec4 position, inout vec4 stpq) {\n  if (stereoBend > 0.0001) {\n\n    vec3 pos = position.xyz;\n    float r = length(pos);\n    float z = r + pos.z;\n    vec3 project = vec3(pos.xy / z, r);\n    \n    vec3 lerped = mix(pos, project, stereoBend);\n\n    return viewMatrix * vec4(lerped, 1.0);\n  }\n  else {\n    return viewMatrix * vec4(position.xyz, 1.0);\n  }\n}","stereographic4.position":"uniform float stereoBend;\nuniform vec4 basisScale;\nuniform vec4 basisOffset;\nuniform mat4 viewMatrix;\nuniform vec2 view4D;\n\nvec4 getStereographic4Position(vec4 position, inout vec4 stpq) {\n  \n  vec4 transformed;\n  if (stereoBend > 0.0001) {\n\n    float r = length(position);\n    float w = r + position.w;\n    vec4 project = vec4(position.xyz / w, r);\n    \n    transformed = mix(position, project, stereoBend);\n  }\n  else {\n    transformed = position;\n  }\n\n  vec4 pos4 = transformed * basisScale - basisOffset;\n  vec3 xyz = (viewMatrix * vec4(pos4.xyz, 1.0)).xyz;\n  return vec4(xyz, pos4.w * view4D.y + view4D.x);\n}\n","stpq.sample.2d":"varying vec2 vST;\n\nvec4 getSample(vec2 st);\n\nvec4 getSTSample() {\n  return getSample(vST);\n}\n","stpq.xyzw.2d":"varying vec2 vUV;\n\nvoid setRawUV(vec4 xyzw) {\n  vUV = xyzw.xy;\n}\n","strip.position.normal":"uniform vec4 geometryClip;\nattribute vec4 position4;\nattribute vec3 strip;\n\n// External\nvec3 getPosition(vec4 xyzw, float canonical);\n\nvarying vec3 vNormal;\nvarying vec3 vLight;\nvarying vec3 vPosition;\n\nvoid getStripGeometry(vec4 xyzw, vec3 strip, out vec3 pos, out vec3 normal) {\n  vec3 a, b, c;\n\n  a   = getPosition(xyzw, 1.0);\n  b   = getPosition(vec4(xyzw.xyz, strip.x), 0.0);\n  c   = getPosition(vec4(xyzw.xyz, strip.y), 0.0);\n\n  normal = normalize(cross(c - a, b - a)) * strip.z;\n  \n  pos = a;\n}\n\nvec3 getStripPositionNormal() {\n  vec3 center, normal;\n\n  vec4 p = min(geometryClip, position4);\n\n  getStripGeometry(p, strip, center, normal);\n  vNormal   = normal;\n  vLight    = normalize((viewMatrix * vec4(1.0, 2.0, 2.0, 0.0)).xyz);\n  vPosition = -center;\n\n  return center;\n}\n","style.color":"uniform vec3 styleColor;\nuniform float styleOpacity;\n\nvec4 getStyleColor() {\n  return vec4(styleColor, styleOpacity);\n}\n","subdivide.depth":"uniform float subdivideBevel;\n\n// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 subdivideDepth(vec4 xyzw) {\n  float x = xyzw.z;\n  float i = floor(x);\n  float f = x - i;\n\n  float minf = subdivideBevel * min(f, 1.0 - f);\n  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;\n\n  return sampleData(vec4(xyzw.xy, i + g, xyzw.w));\n}\n","subdivide.depth.lerp":"uniform float subdivideBevel;\n\n// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 subdivideDepthLerp(vec4 xyzw) {\n  float x = xyzw.z;\n  float i = floor(x);\n  float f = x - i;\n\n  float minf = subdivideBevel * min(f, 1.0 - f);\n  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;\n\n  vec4 xyzw1 = vec4(xyzw.xy, i, xyzw.w);\n  vec4 xyzw2 = vec4(xyzw.xy, i + 1.0, xyzw.w);\n  \n  vec4 a = sampleData(xyzw1);\n  vec4 b = sampleData(xyzw2);\n\n  return mix(a, b, g);\n}\n","subdivide.height":"uniform float subdivideBevel;\n\n// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 subdivideHeight(vec4 xyzw) {\n  float x = xyzw.y;\n  float i = floor(x);\n  float f = x - i;\n\n  float minf = subdivideBevel * min(f, 1.0 - f);\n  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;\n\n  return sampleData(vec4(xyzw.x, i + g, xyzw.zw));\n}\n","subdivide.height.lerp":"uniform float subdivideBevel;\n\n// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 subdivideHeightLerp(vec4 xyzw) {\n  float x = xyzw.y;\n  float i = floor(x);\n  float f = x - i;\n\n  float minf = subdivideBevel * min(f, 1.0 - f);\n  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;\n\n  vec4 xyzw1 = vec4(xyzw.x, i, xyzw.zw);\n  vec4 xyzw2 = vec4(xyzw.x, i + 1.0, xyzw.zw);\n  \n  vec4 a = sampleData(xyzw1);\n  vec4 b = sampleData(xyzw2);\n\n  return mix(a, b, g);\n}\n","subdivide.items":"uniform float subdivideBevel;\n\n// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 subdivideItems(vec4 xyzw) {\n  float x = xyzw.w;\n  float i = floor(x);\n  float f = x - i;\n\n  float minf = subdivideBevel * min(f, 1.0 - f);\n  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;\n\n  return sampleData(vec4(xyzw.xyz, i + g));\n}\n","subdivide.items.lerp":"uniform float subdivideBevel;\n\n// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 subdivideItemsLerp(vec4 xyzw) {\n  float x = xyzw.w;\n  float i = floor(x);\n  float f = x - i;\n\n  float minf = subdivideBevel * min(f, 1.0 - f);\n  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;\n\n  vec4 xyzw1 = vec4(xyzw.xyz, i);\n  vec4 xyzw2 = vec4(xyzw.xyz, i + 1.0);\n  \n  vec4 a = sampleData(xyzw1);\n  vec4 b = sampleData(xyzw2);\n\n  return mix(a, b, g);\n}\n","subdivide.width":"uniform float subdivideBevel;\n\n// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 subdivideWidth(vec4 xyzw) {\n  float x = xyzw.x;\n  float i = floor(x);\n  float f = x - i;\n\n  float minf = subdivideBevel * min(f, 1.0 - f);\n  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;\n\n  return sampleData(vec4(i + g, xyzw.yzw));\n}\n","subdivide.width.lerp":"uniform float subdivideBevel;\n\n// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 subdivideWidthLerp(vec4 xyzw) {\n  float x = xyzw.x;\n  float i = floor(x);\n  float f = x - i;\n\n  float minf = subdivideBevel * min(f, 1.0 - f);\n  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;\n\n  vec4 xyzw1 = vec4(i, xyzw.yzw);\n  vec4 xyzw2 = vec4(i + 1.0, xyzw.yzw);\n  \n  vec4 a = sampleData(xyzw1);\n  vec4 b = sampleData(xyzw2);\n\n  return mix(a, b, g);\n}\n","surface.mask.hollow":"attribute vec4 position4;\n\nfloat getSurfaceHollowMask(vec4 xyzw) {\n  vec4 df = abs(fract(position4) - .5);\n  vec2 df2 = min(df.xy, df.zw);\n  float df3 = min(df2.x, df2.y);\n  return df3;\n}","surface.position":"uniform vec4 geometryClip;\nuniform vec4 geometryResolution;\nuniform vec4 mapSize;\n\nattribute vec4 position4;\n\n// External\nvec3 getPosition(vec4 xyzw, float canonical);\n\nvec3 getSurfacePosition() {\n  vec4 p = min(geometryClip, position4);\n  vec3 xyz = getPosition(p, 1.0);\n\n  // Overwrite UVs\n#ifdef POSITION_UV\n#ifdef POSITION_UV_INT\n  vUV = -.5 + (position4.xy * geometryResolution.xy) * mapSize.xy;\n#else\n  vUV = position4.xy * geometryResolution.xy;\n#endif\n#endif\n\n  return xyz;\n}\n","surface.position.normal":"uniform vec4 mapSize;\nuniform vec4 geometryResolution;\nuniform vec4 geometryClip;\nattribute vec4 position4;\nattribute vec2 surface;\n\n// External\nvec3 getPosition(vec4 xyzw, float canonical);\n\nvoid getSurfaceGeometry(vec4 xyzw, float edgeX, float edgeY, out vec3 left, out vec3 center, out vec3 right, out vec3 up, out vec3 down) {\n  vec4 deltaX = vec4(1.0, 0.0, 0.0, 0.0);\n  vec4 deltaY = vec4(0.0, 1.0, 0.0, 0.0);\n\n  /*\n  // high quality, 5 tap\n  center =                  getPosition(xyzw, 1.0);\n  left   = (edgeX > -0.5) ? getPosition(xyzw - deltaX, 0.0) : center;\n  right  = (edgeX < 0.5)  ? getPosition(xyzw + deltaX, 0.0) : center;\n  down   = (edgeY > -0.5) ? getPosition(xyzw - deltaY, 0.0) : center;\n  up     = (edgeY < 0.5)  ? getPosition(xyzw + deltaY, 0.0) : center;\n  */\n  \n  // low quality, 3 tap\n  center =                  getPosition(xyzw, 1.0);\n  left   =                  center;\n  down   =                  center;\n  right  = (edgeX < 0.5)  ? getPosition(xyzw + deltaX, 0.0) : (2.0 * center - getPosition(xyzw - deltaX, 0.0));\n  up     = (edgeY < 0.5)  ? getPosition(xyzw + deltaY, 0.0) : (2.0 * center - getPosition(xyzw - deltaY, 0.0));\n}\n\nvec3 getSurfaceNormal(vec3 left, vec3 center, vec3 right, vec3 up, vec3 down) {\n  vec3 dx = right - left;\n  vec3 dy = up    - down;\n  vec3 n = cross(dy, dx);\n  if (length(n) > 0.0) {\n    return normalize(n);\n  }\n  return vec3(0.0, 1.0, 0.0);\n}\n\nvarying vec3 vNormal;\nvarying vec3 vLight;\nvarying vec3 vPosition;\n\nvec3 getSurfacePositionNormal() {\n  vec3 left, center, right, up, down;\n\n  vec4 p = min(geometryClip, position4);\n\n  getSurfaceGeometry(p, surface.x, surface.y, left, center, right, up, down);\n  vNormal   = getSurfaceNormal(left, center, right, up, down);\n  vLight    = normalize((viewMatrix * vec4(1.0, 2.0, 2.0, 0.0)).xyz); // hardcoded directional light\n  vPosition = -center;\n\n#ifdef POSITION_UV\n#ifdef POSITION_UV_INT\n  vUV = -.5 + (position4.xy * geometryResolution.xy) * mapSize.xy;\n#else\n  vUV = position4.xy * geometryResolution.xy;\n#endif\n#endif\n  \n  return center;\n}\n","ticks.position":"uniform float worldUnit;\nuniform float focusDepth;\nuniform float tickSize;\nuniform float tickEpsilon;\nuniform vec3  tickNormal;\nuniform vec2  tickStrip;\n\nvec4 getSample(vec4 xyzw);\n\nvec3 transformPosition(vec4 position, in vec4 stpqIn, out vec4 stpqOut);\n\nvec3 getTickPosition(vec4 xyzw, in vec4 stpqIn, out vec4 stpqOut) {\n  float epsilon = tickEpsilon;\n\n  // determine tick direction\n  float leftX  = max(tickStrip.x, xyzw.y - 1.0);\n  float rightX = min(tickStrip.y, xyzw.y + 1.0);\n  \n  vec4 left    = getSample(vec4(leftX,  xyzw.zw, 0.0));\n  vec4 right   = getSample(vec4(rightX, xyzw.zw, 0.0));\n  vec4 diff    = right - left;\n\n  vec3 normal  = cross(normalize(diff.xyz + vec3(diff.w)), tickNormal);\n  float bias   = max(0.0, 1.0 - length(normal) * 2.0);\n       normal  = mix(normal, tickNormal.yzx, bias * bias);\n  \n  // transform (point) and (point + delta)\n  vec4 center  = getSample(vec4(xyzw.yzw, 0.0));\n  vec4 delta   = vec4(normal, 0.0) * epsilon;\n\n  vec4 a = center;\n  vec4 b = center + delta;\n\n  vec4 _;\n  vec3 c = transformPosition(a, stpqIn, stpqOut);\n  vec3 d = transformPosition(b, stpqIn, _);\n  \n  // sample on either side to create line\n  float line = xyzw.x - .5;\n  vec3  mid  = c;\n  vec3  side = normalize(d - c);\n\n  return mid + side * line * tickSize * worldUnit * focusDepth;\n}\n","transform3.position":"uniform mat4 transformMatrix;\n\nvec4 transformPosition(vec4 position, inout vec4 stpq) {\n  return transformMatrix * vec4(position.xyz, 1.0);\n}\n","transform4.position":"uniform mat4 transformMatrix;\nuniform vec4 transformOffset;\n\nvec4 transformPosition(vec4 position, inout vec4 stpq) {\n  return transformMatrix * position + transformOffset;\n}\n","view.position":"// Implicit three.js uniform\n// uniform mat4 viewMatrix;\n\nvec4 getViewPosition(vec4 position, inout vec4 stpq) {\n  return (viewMatrix * vec4(position.xyz, 1.0));\n}\n"}},{}],2:[function(e,t,i){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";(function(e){"use strict";var t=typeof Uint8Array!=="undefined"?Uint8Array:Array;var i="+".charCodeAt(0);var n="/".charCodeAt(0);var a="0".charCodeAt(0);var o="a".charCodeAt(0);var s="A".charCodeAt(0);var h="-".charCodeAt(0);var l="_".charCodeAt(0);function u(e){var t=e.charCodeAt(0);if(t===i||t===h)return 62;if(t===n||t===l)return 63;if(t<a)return-1;if(t<a+10)return t-a+26+26;if(t<s+26)return t-s;if(t<o+26)return t-o+26}function c(e){var i,r,n,a,o,s;if(e.length%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var h=e.length;o="="===e.charAt(h-2)?2:"="===e.charAt(h-1)?1:0;s=new t(e.length*3/4-o);n=o>0?e.length-4:e.length;var l=0;function c(e){s[l++]=e}for(i=0,r=0;i<n;i+=4,r+=3){a=u(e.charAt(i))<<18|u(e.charAt(i+1))<<12|u(e.charAt(i+2))<<6|u(e.charAt(i+3));c((a&16711680)>>16);c((a&65280)>>8);c(a&255)}if(o===2){a=u(e.charAt(i))<<2|u(e.charAt(i+1))>>4;c(a&255)}else if(o===1){a=u(e.charAt(i))<<10|u(e.charAt(i+1))<<4|u(e.charAt(i+2))>>2;c(a>>8&255);c(a&255)}return s}function p(e){var t,i=e.length%3,n="",a,o;function s(e){return r.charAt(e)}function h(e){return s(e>>18&63)+s(e>>12&63)+s(e>>6&63)+s(e&63)}for(t=0,o=e.length-i;t<o;t+=3){a=(e[t]<<16)+(e[t+1]<<8)+e[t+2];n+=h(a)}switch(i){case 1:a=e[e.length-1];n+=s(a>>2);n+=s(a<<4&63);n+="==";break;case 2:a=(e[e.length-2]<<8)+e[e.length-1];n+=s(a>>10);n+=s(a>>4&63);n+=s(a<<2&63);n+="=";break}return n}e.toByteArray=c;e.fromByteArray=p})(typeof i==="undefined"?this.base64js={}:i)},{}],3:[function(e,t,i){var r=e("base64-js");var n=e("ieee754");i.Buffer=a;i.SlowBuffer=a;i.INSPECT_MAX_BYTES=50;a.poolSize=8192;a._useTypedArrays=function(){try{var e=new ArrayBuffer(0);var t=new Uint8Array(e);t.foo=function(){return 42};return 42===t.foo()&&typeof t.subarray==="function"}catch(e){return false}}();function a(e,t,i){if(!(this instanceof a))return new a(e,t,i);var r=typeof e;if(t==="base64"&&r==="string"){e=A(e);while(e.length%4!==0){e=e+"="}}var n;if(r==="number")n=P(e);else if(r==="string")n=a.byteLength(e,t);else if(r==="object")n=P(e.length);else throw new Error("First argument needs to be a number, array or string.");var o;if(a._useTypedArrays){o=a._augment(new Uint8Array(n))}else{o=this;o.length=n;o._isBuffer=true}var s;if(a._useTypedArrays&&typeof e.byteLength==="number"){o._set(e)}else if(O(e)){for(s=0;s<n;s++){if(a.isBuffer(e))o[s]=e.readUInt8(s);else o[s]=e[s]}}else if(r==="string"){o.write(e,0,t)}else if(r==="number"&&!a._useTypedArrays&&!i){for(s=0;s<n;s++){o[s]=0}}return o}a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};a.isBuffer=function(e){return!!(e!==null&&e!==undefined&&e._isBuffer)};a.byteLength=function(e,t){var i;e=e+"";switch(t||"utf8"){case"hex":i=e.length/2;break;case"utf8":case"utf-8":i=F(e).length;break;case"ascii":case"binary":case"raw":i=e.length;break;case"base64":i=N(e).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":i=e.length*2;break;default:throw new Error("Unknown encoding")}return i};a.concat=function(e,t){q(L(e),"Usage: Buffer.concat(list, [totalLength])\n"+"list should be an Array.");if(e.length===0){return new a(0)}else if(e.length===1){return e[0]}var i;if(typeof t!=="number"){t=0;for(i=0;i<e.length;i++){t+=e[i].length}}var r=new a(t);var n=0;for(i=0;i<e.length;i++){var o=e[i];o.copy(r,n);n+=o.length}return r};function o(e,t,i,r){i=Number(i)||0;var n=e.length-i;if(!r){r=n}else{r=Number(r);if(r>n){r=n}}var o=t.length;q(o%2===0,"Invalid hex string");if(r>o/2){r=o/2}for(var s=0;s<r;s++){var h=parseInt(t.substr(s*2,2),16);q(!isNaN(h),"Invalid hex string");e[i+s]=h}a._charsWritten=s*2;return s}function s(e,t,i,r){var n=a._charsWritten=V(F(t),e,i,r);return n}function h(e,t,i,r){var n=a._charsWritten=V(B(t),e,i,r);return n}function l(e,t,i,r){return h(e,t,i,r)}function u(e,t,i,r){var n=a._charsWritten=V(N(t),e,i,r);return n}function c(e,t,i,r){var n=a._charsWritten=V(U(t),e,i,r);return n}a.prototype.write=function(e,t,i,r){if(isFinite(t)){if(!isFinite(i)){r=i;i=undefined}}else{var n=r;r=t;t=i;i=n}t=Number(t)||0;var a=this.length-t;if(!i){i=a}else{i=Number(i);if(i>a){i=a}}r=String(r||"utf8").toLowerCase();var p;switch(r){case"hex":p=o(this,e,t,i);break;case"utf8":case"utf-8":p=s(this,e,t,i);break;case"ascii":p=h(this,e,t,i);break;case"binary":p=l(this,e,t,i);break;case"base64":p=u(this,e,t,i);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":p=c(this,e,t,i);break;default:throw new Error("Unknown encoding")}return p};a.prototype.toString=function(e,t,i){var r=this;e=String(e||"utf8").toLowerCase();t=Number(t)||0;i=i!==undefined?Number(i):i=r.length;if(i===t)return"";var n;switch(e){case"hex":n=g(r,t,i);break;case"utf8":case"utf-8":n=f(r,t,i);break;case"ascii":n=d(r,t,i);break;case"binary":n=m(r,t,i);break;case"base64":n=p(r,t,i);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":n=v(r,t,i);break;default:throw new Error("Unknown encoding")}return n};a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};a.prototype.copy=function(e,t,i,r){var n=this;if(!i)i=0;if(!r&&r!==0)r=this.length;if(!t)t=0;if(r===i)return;if(e.length===0||n.length===0)return;q(r>=i,"sourceEnd < sourceStart");q(t>=0&&t<e.length,"targetStart out of bounds");q(i>=0&&i<n.length,"sourceStart out of bounds");q(r>=0&&r<=n.length,"sourceEnd out of bounds");if(r>this.length)r=this.length;if(e.length-t<r-i)r=e.length-t+i;var o=r-i;if(o<100||!a._useTypedArrays){for(var s=0;s<o;s++)e[s+t]=this[s+i]}else{e._set(this.subarray(i,i+o),t)}};function p(e,t,i){if(t===0&&i===e.length){return r.fromByteArray(e)}else{return r.fromByteArray(e.slice(t,i))}}function f(e,t,i){var r="";var n="";i=Math.min(e.length,i);for(var a=t;a<i;a++){if(e[a]<=127){r+=I(n)+String.fromCharCode(e[a]);n=""}else{n+="%"+e[a].toString(16)}}return r+I(n)}function d(e,t,i){var r="";i=Math.min(e.length,i);for(var n=t;n<i;n++)r+=String.fromCharCode(e[n]);return r}function m(e,t,i){return d(e,t,i)}function g(e,t,i){var r=e.length;if(!t||t<0)t=0;if(!i||i<0||i>r)i=r;var n="";for(var a=t;a<i;a++){n+=D(e[a])}return n}function v(e,t,i){var r=e.slice(t,i);var n="";for(var a=0;a<r.length;a+=2){n+=String.fromCharCode(r[a]+r[a+1]*256)}return n}a.prototype.slice=function(e,t){var i=this.length;e=z(e,i,0);t=z(t,i,i);if(a._useTypedArrays){return a._augment(this.subarray(e,t))}else{var r=t-e;var n=new a(r,undefined,true);for(var o=0;o<r;o++){n[o]=this[o+e]}return n}};a.prototype.get=function(e){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(e)};a.prototype.set=function(e,t){console.log(".set() is deprecated. Access using array indexes instead.");return this.writeUInt8(e,t)};a.prototype.readUInt8=function(e,t){if(!t){q(e!==undefined&&e!==null,"missing offset");q(e<this.length,"Trying to read beyond buffer length")}if(e>=this.length)return;return this[e]};function y(e,t,i,r){if(!r){q(typeof i==="boolean","missing or invalid endian");q(t!==undefined&&t!==null,"missing offset");q(t+1<e.length,"Trying to read beyond buffer length")}var n=e.length;if(t>=n)return;var a;if(i){a=e[t];if(t+1<n)a|=e[t+1]<<8}else{a=e[t]<<8;if(t+1<n)a|=e[t+1]}return a}a.prototype.readUInt16LE=function(e,t){return y(this,e,true,t)};a.prototype.readUInt16BE=function(e,t){return y(this,e,false,t)};function E(e,t,i,r){if(!r){q(typeof i==="boolean","missing or invalid endian");q(t!==undefined&&t!==null,"missing offset");q(t+3<e.length,"Trying to read beyond buffer length")}var n=e.length;if(t>=n)return;var a;if(i){if(t+2<n)a=e[t+2]<<16;if(t+1<n)a|=e[t+1]<<8;a|=e[t];if(t+3<n)a=a+(e[t+3]<<24>>>0)}else{if(t+1<n)a=e[t+1]<<16;if(t+2<n)a|=e[t+2]<<8;if(t+3<n)a|=e[t+3];a=a+(e[t]<<24>>>0)}return a}a.prototype.readUInt32LE=function(e,t){return E(this,e,true,t)};a.prototype.readUInt32BE=function(e,t){return E(this,e,false,t)};a.prototype.readInt8=function(e,t){if(!t){q(e!==undefined&&e!==null,"missing offset");q(e<this.length,"Trying to read beyond buffer length")}if(e>=this.length)return;var i=this[e]&128;if(i)return(255-this[e]+1)*-1;else return this[e]};function w(e,t,i,r){if(!r){q(typeof i==="boolean","missing or invalid endian");q(t!==undefined&&t!==null,"missing offset");q(t+1<e.length,"Trying to read beyond buffer length")}var n=e.length;if(t>=n)return;var a=y(e,t,i,true);var o=a&32768;if(o)return(65535-a+1)*-1;else return a}a.prototype.readInt16LE=function(e,t){return w(this,e,true,t)};a.prototype.readInt16BE=function(e,t){return w(this,e,false,t)};function b(e,t,i,r){if(!r){q(typeof i==="boolean","missing or invalid endian");q(t!==undefined&&t!==null,"missing offset");q(t+3<e.length,"Trying to read beyond buffer length")}var n=e.length;if(t>=n)return;var a=E(e,t,i,true);var o=a&2147483648;if(o)return(4294967295-a+1)*-1;else return a}a.prototype.readInt32LE=function(e,t){return b(this,e,true,t)};a.prototype.readInt32BE=function(e,t){return b(this,e,false,t)};function _(e,t,i,r){if(!r){q(typeof i==="boolean","missing or invalid endian");q(t+3<e.length,"Trying to read beyond buffer length")}return n.read(e,t,i,23,4)}a.prototype.readFloatLE=function(e,t){return _(this,e,true,t)};a.prototype.readFloatBE=function(e,t){return _(this,e,false,t)};function x(e,t,i,r){if(!r){q(typeof i==="boolean","missing or invalid endian");q(t+7<e.length,"Trying to read beyond buffer length")}return n.read(e,t,i,52,8)}a.prototype.readDoubleLE=function(e,t){return x(this,e,true,t)};a.prototype.readDoubleBE=function(e,t){return x(this,e,false,t)};a.prototype.writeUInt8=function(e,t,i){if(!i){q(e!==undefined&&e!==null,"missing value");q(t!==undefined&&t!==null,"missing offset");q(t<this.length,"trying to write beyond buffer length");j(e,255)}if(t>=this.length)return;this[t]=e};function T(e,t,i,r,n){if(!n){q(t!==undefined&&t!==null,"missing value");q(typeof r==="boolean","missing or invalid endian");q(i!==undefined&&i!==null,"missing offset");q(i+1<e.length,"trying to write beyond buffer length");j(t,65535)}var a=e.length;if(i>=a)return;for(var o=0,s=Math.min(a-i,2);o<s;o++){e[i+o]=(t&255<<8*(r?o:1-o))>>>(r?o:1-o)*8}}a.prototype.writeUInt16LE=function(e,t,i){T(this,e,t,true,i)};a.prototype.writeUInt16BE=function(e,t,i){T(this,e,t,false,i)};function R(e,t,i,r,n){if(!n){q(t!==undefined&&t!==null,"missing value");q(typeof r==="boolean","missing or invalid endian");q(i!==undefined&&i!==null,"missing offset");q(i+3<e.length,"trying to write beyond buffer length");j(t,4294967295)}var a=e.length;if(i>=a)return;for(var o=0,s=Math.min(a-i,4);o<s;o++){e[i+o]=t>>>(r?o:3-o)*8&255}}a.prototype.writeUInt32LE=function(e,t,i){R(this,e,t,true,i)};a.prototype.writeUInt32BE=function(e,t,i){R(this,e,t,false,i)};a.prototype.writeInt8=function(e,t,i){if(!i){q(e!==undefined&&e!==null,"missing value");q(t!==undefined&&t!==null,"missing offset");q(t<this.length,"Trying to write beyond buffer length");G(e,127,-128)}if(t>=this.length)return;if(e>=0)this.writeUInt8(e,t,i);else this.writeUInt8(255+e+1,t,i)};function k(e,t,i,r,n){if(!n){q(t!==undefined&&t!==null,"missing value");q(typeof r==="boolean","missing or invalid endian");q(i!==undefined&&i!==null,"missing offset");q(i+1<e.length,"Trying to write beyond buffer length");G(t,32767,-32768)}var a=e.length;if(i>=a)return;if(t>=0)T(e,t,i,r,n);else T(e,65535+t+1,i,r,n)}a.prototype.writeInt16LE=function(e,t,i){k(this,e,t,true,i)};a.prototype.writeInt16BE=function(e,t,i){k(this,e,t,false,i)};function H(e,t,i,r,n){if(!n){q(t!==undefined&&t!==null,"missing value");q(typeof r==="boolean","missing or invalid endian");q(i!==undefined&&i!==null,"missing offset");q(i+3<e.length,"Trying to write beyond buffer length");G(t,2147483647,-2147483648)}var a=e.length;if(i>=a)return;if(t>=0)R(e,t,i,r,n);else R(e,4294967295+t+1,i,r,n)}a.prototype.writeInt32LE=function(e,t,i){H(this,e,t,true,i)};a.prototype.writeInt32BE=function(e,t,i){H(this,e,t,false,i)};function M(e,t,i,r,a){if(!a){q(t!==undefined&&t!==null,"missing value");q(typeof r==="boolean","missing or invalid endian");q(i!==undefined&&i!==null,"missing offset");q(i+3<e.length,"Trying to write beyond buffer length");W(t,3.4028234663852886e38,-3.4028234663852886e38)}var o=e.length;if(i>=o)return;n.write(e,t,i,r,23,4)}a.prototype.writeFloatLE=function(e,t,i){M(this,e,t,true,i)};a.prototype.writeFloatBE=function(e,t,i){M(this,e,t,false,i)};function S(e,t,i,r,a){if(!a){q(t!==undefined&&t!==null,"missing value");q(typeof r==="boolean","missing or invalid endian");q(i!==undefined&&i!==null,"missing offset");q(i+7<e.length,"Trying to write beyond buffer length");W(t,1.7976931348623157e308,-1.7976931348623157e308)}var o=e.length;if(i>=o)return;n.write(e,t,i,r,52,8)}a.prototype.writeDoubleLE=function(e,t,i){S(this,e,t,true,i)};a.prototype.writeDoubleBE=function(e,t,i){S(this,e,t,false,i)};a.prototype.fill=function(e,t,i){if(!e)e=0;if(!t)t=0;if(!i)i=this.length;if(typeof e==="string"){e=e.charCodeAt(0)}q(typeof e==="number"&&!isNaN(e),"value is not a number");q(i>=t,"end < start");if(i===t)return;if(this.length===0)return;q(t>=0&&t<this.length,"start out of bounds");q(i>=0&&i<=this.length,"end out of bounds");for(var r=t;r<i;r++){this[r]=e}};a.prototype.inspect=function(){var e=[];var t=this.length;for(var r=0;r<t;r++){e[r]=D(this[r]);if(r===i.INSPECT_MAX_BYTES){e[r+1]="...";break}}return"<Buffer "+e.join(" ")+">"};a.prototype.toArrayBuffer=function(){if(typeof Uint8Array!=="undefined"){if(a._useTypedArrays){return new a(this).buffer}else{var e=new Uint8Array(this.length);for(var t=0,i=e.length;t<i;t+=1)e[t]=this[t];return e.buffer}}else{throw new Error("Buffer.toArrayBuffer not supported in this browser")}};function A(e){if(e.trim)return e.trim();return e.replace(/^\s+|\s+$/g,"")}var C=a.prototype;a._augment=function(e){e._isBuffer=true;e._get=e.get;e._set=e.set;e.get=C.get;e.set=C.set;e.write=C.write;e.toString=C.toString;e.toLocaleString=C.toString;e.toJSON=C.toJSON;e.copy=C.copy;e.slice=C.slice;e.readUInt8=C.readUInt8;e.readUInt16LE=C.readUInt16LE;e.readUInt16BE=C.readUInt16BE;e.readUInt32LE=C.readUInt32LE;e.readUInt32BE=C.readUInt32BE;e.readInt8=C.readInt8;e.readInt16LE=C.readInt16LE;e.readInt16BE=C.readInt16BE;e.readInt32LE=C.readInt32LE;e.readInt32BE=C.readInt32BE;e.readFloatLE=C.readFloatLE;e.readFloatBE=C.readFloatBE;e.readDoubleLE=C.readDoubleLE;e.readDoubleBE=C.readDoubleBE;e.writeUInt8=C.writeUInt8;e.writeUInt16LE=C.writeUInt16LE;e.writeUInt16BE=C.writeUInt16BE;e.writeUInt32LE=C.writeUInt32LE;e.writeUInt32BE=C.writeUInt32BE;e.writeInt8=C.writeInt8;e.writeInt16LE=C.writeInt16LE;e.writeInt16BE=C.writeInt16BE;e.writeInt32LE=C.writeInt32LE;e.writeInt32BE=C.writeInt32BE;e.writeFloatLE=C.writeFloatLE;e.writeFloatBE=C.writeFloatBE;e.writeDoubleLE=C.writeDoubleLE;e.writeDoubleBE=C.writeDoubleBE;e.fill=C.fill;e.inspect=C.inspect;e.toArrayBuffer=C.toArrayBuffer;return e};function z(e,t,i){if(typeof e!=="number")return i;e=~~e;if(e>=t)return t;if(e>=0)return e;e+=t;if(e>=0)return e;return 0}function P(e){e=~~Math.ceil(+e);return e<0?0:e}function L(e){return(Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"})(e)}function O(e){return L(e)||a.isBuffer(e)||e&&typeof e==="object"&&typeof e.length==="number"}function D(e){if(e<16)return"0"+e.toString(16);return e.toString(16)}function F(e){var t=[];for(var i=0;i<e.length;i++){var r=e.charCodeAt(i);if(r<=127)t.push(e.charCodeAt(i));else{var n=i;if(r>=55296&&r<=57343)i++;var a=encodeURIComponent(e.slice(n,i+1)).substr(1).split("%");for(var o=0;o<a.length;o++)t.push(parseInt(a[o],16))}}return t}function B(e){var t=[];for(var i=0;i<e.length;i++){t.push(e.charCodeAt(i)&255)}return t}function U(e){var t,i,r;var n=[];for(var a=0;a<e.length;a++){t=e.charCodeAt(a);i=t>>8;r=t%256;n.push(r);n.push(i)}return n}function N(e){return r.toByteArray(e)}function V(e,t,i,r){var n;for(var a=0;a<r;a++){if(a+i>=t.length||a>=e.length)break;t[a+i]=e[a]}return a}function I(e){try{return decodeURIComponent(e)}catch(e){return String.fromCharCode(65533)}}function j(e,t){q(typeof e==="number","cannot write a non-number as a number");q(e>=0,"specified a negative value for writing an unsigned value");q(e<=t,"value is larger than maximum value for type");q(Math.floor(e)===e,"value has a fractional component")}function G(e,t,i){q(typeof e==="number","cannot write a non-number as a number");q(e<=t,"value larger than maximum allowed value");q(e>=i,"value smaller than minimum allowed value");q(Math.floor(e)===e,"value has a fractional component")}function W(e,t,i){q(typeof e==="number","cannot write a non-number as a number");q(e<=t,"value larger than maximum allowed value");q(e>=i,"value smaller than minimum allowed value")}function q(e,t){if(!e)throw new Error(t||"Failed assertion")}},{"base64-js":2,ieee754:8}],4:[function(e,t,i){t.exports=n;var r=e("./tokenizer");function n(e,t){return function(i){return s(i,a(e),t||R)}}function a(e){for(var t in e)if(o(e,t)){e[t]=Function("return function(node, attr) { return node."+e[t]+" }");e[t]=e[t]()}return e}function o(e,t){return e.hasOwnProperty(t)&&typeof e[t]==="string"}function s(e,t,i){var n=r(),a=true,o=[[]],s,u;u=o[0];s={"":y,">":E,"+":w,"~":b};n.on("data",c).end(e);function c(e){var t;if(e.type==="comma"){o.unshift(u=[]);return}if(e.type==="op"||e.type==="any-child"){u.unshift(s[e.data]);u.unshift(d());return}u[0]=u[0]||d();t=u[0];if(e.type==="!"){t.subject=o[0].subject=true;return}t.push(e.type==="class"?m(e.type,e.data):e.type==="attr"?g(e):e.type===":"||e.type==="::"?_(e):e.type==="*"?Boolean:v(e.type,e.data,i))}return f;function f(e,t){var i,r,n,a,s;n=e;s=[];for(var l=0,c=o.length;l<c;++l){u=o[l];i=h;r=u.length;e=n;a=[];for(var p=0;p<r;p+=2){e=i(e,u[p],a);if(!e){break}i=u[p+1]}if(p>=r){if(t){return true}f(!u.subject?[n]:a)}}if(t){return false}return!s.length?false:s.length===1?s[0]:s;function f(e){var t;while(e.length){t=e.shift();if(s.indexOf(t)===-1){s.push(t)}}}}function d(){e.bits=[];e.subject=false;e.push=function(t){e.bits.push(t)};return e;function e(t,i){for(var r=0,n=e.bits.length;r<n;++r){if(!e.bits[r](t)){return false}}if(e.subject){i.push(t)}return true}}function m(e,i){return function(r){var n=t[e](r);n=Array.isArray(n)?n:n?n.toString().split(/\s+/):[];return n.indexOf(i)>=0}}function g(e){return e.data.lhs?p(t.attr,e.data.lhs,e.data.cmp,e.data.rhs):p(t.attr,e.data)}function v(e,i,r){return function(n){return r(e,t[e](n),i)}}function y(e,i,r){do{e=t.parent(e)}while(e&&!i(e,r));return e}function E(e,i,r){e=t.parent(e);return e&&i(e,r)?e:null}function w(e,i,r){var n=t.parent(e),a=0,o;o=t.children(n);for(var s=0,h=o.length;s<h;++s){if(o[s]===e){a=s;break}}return o[a-1]&&i(o[a-1],r)?o[a-1]:null}function b(e,i,r){var n=t.parent(e),a;a=t.children(n);for(var o=0,s=a.length;o<s;++o){if(a[o]===e){return null}if(i(a[o],r)){return a[o]}}return null}function _(e){return l(t,e.data,i)}}function h(e,t,i){return t(e,i)?e:null}function l(e,t,i){switch(t){case"empty":return m(e);case"first-child":return f(e);case"last-child":return d(e);case"root":return g(e)}if(t.indexOf("contains")===0){return v(e,t.slice(9,-1))}if(t.indexOf("any")===0){return c(e,t.slice(4,-1),i)}if(t.indexOf("not")===0){return u(e,t.slice(4,-1),i)}if(t.indexOf("nth-child")===0){return y(e,t.slice(10,-1))}return function(){return false}}function u(e,t,i){var r=s(t,e,i);return n;function n(e){return!r(e,true)}}function c(e,t,i){var r=s(t,e,i);return r}function p(e,t,i,r){return function(n){var a=e(n,t);if(!i){return!!a}if(i.length===1){return a==r}if(a===void 0||a===null){return false}return E[i.charAt(0)](a,r)}}function f(e){return function(t){return e.children(e.parent(t))[0]===t}}function d(e){return function(t){var i=e.children(e.parent(t));return i[i.length-1]===t}}function m(e){return function(t){return e.children(t).length===0}}function g(e){return function(t){return!e.parent(t)}}function v(e,t){return function(i){return e.contents(i).indexOf(t)!==-1}}function y(e,t){var i=function(){return false};if(t=="odd"){t="2n+1"}else if(t=="even"){t="2n"}var r=/( ?([-|\+])?(\d*)n)? ?((\+|-)? ?(\d+))? ?/;var n=t.match(r);if(n){var a=0;if(n[1]){var o=n[2]!="-";a=parseInt(n[3]==""?1:n[3]);a=a*(o?1:-1)}var s=0;if(n[4]){s=parseInt(n[6]);var h=n[5]!="-";s=s*(h?1:-1)}if(a==0){if(s!=0){i=function(e,t){return e[s-1]===t}}}else{i=function(e,t){var i=[];var r=e.length;for(var n=1;n<=r;n++){var o=(n-s)%a==0;if(o){if(a>0){i.push(n)}else{if((n-s)/a>=0){i.push(n)}}}}for(var h=0;h<i.length;h++){if(e[i[h]-1]===t){return true}}return false}}}return function(t){var r=e.children(e.parent(t));return i(r,t)}}var E={$:w,"^":b,"*":_,"~":x,"|":T};function w(e,t){return e.slice(e.length-t.length)===t}function b(e,t){return e.slice(0,t.length)===t}function _(e,t){return e.indexOf(t)>-1}function x(e,t){return e.split(/\s+/).indexOf(t)>-1}function T(e,t){return e.split("-").indexOf(t)>-1}function R(e,t,i){return t===i}},{"./tokenizer":5}],5:[function(e,t,i){t.exports=w;var r=e("through");var n="pseudo-start",a="attr-start",o="any-child",s="attr-comp",h="attr-end",l="::",u=":",c="(ready)",p="op",f="class",d="comma",m="attr",g="!",v="tag",y="*",E="id";function w(){var e=false,t=[],i=c,w=[],b=0,_,x,T,R,k,H,M,S;return _=r(A,C);function A(e){w=w.concat(e.split(""));x=w.length;while(b<x&&(S=w[b++])){switch(i){case c:z();break;case o:F();break;case p:D();break;case a:N();break;case s:V();break;case h:I();break;case u:case l:B();break;case n:U();break;case E:case v:case f:j();break}}w=w.slice(b)}function C(e){if(arguments.length){A(e)}if(t.length){_.queue(G())}}function z(){switch(true){case"#"===S:i=E;break;case"."===S:i=f;break;case":"===S:i=u;break;case"["===S:i=a;break;case"!"===S:P();break;case"*"===S:L();break;case","===S:O();break;case/[>\+~]/.test(S):i=p;break;case/\s/.test(S):i=o;break;case/[\w\d\-_]/.test(S):i=v;--b;break}}function P(){i=g;t=["!"];_.queue(G());i=c}function L(){i=y;t=["*"];_.queue(G());i=c}function O(){i=d;t=[","];_.queue(G());i=c}function D(){if(/[>\+~]/.test(S)){return t.push(S)}if(/\s/.test(S)){return}_.queue(G());i=c;--b}function F(){if(/\s/.test(S)){return}if(/[>\+~]/.test(S)){return--b,i=p}_.queue(G());i=c;--b}function B(){H=i;j(true);if(i!==c){return}if(S==="("){k=t.join("");i=n;t.length=0;R=1;++b;return}i=u;_.queue(G());i=c}function U(){if(t.length===0&&!T){T=/['"]/.test(S)?S:null;if(T){return}}if(T){if(!e&&S===T){T=null;return}if(S==="\\"){e?t.push(S):e=true;return}e=false;t.push(S);return}t.push(S);if(S==="("){++R}else if(S===")"){--R}if(!R){t.pop();_.queue({type:H,data:k+"("+t.join("")+")"});i=c;k=H=M=null;t.length=0}return}function N(){j(true);if(i!==c){return}if(S==="]"){i=m;_.queue(G());i=c;return}k=t.join("");t.length=0;i=s}function V(){if(/[=~|$^*]/.test(S)){t.push(S)}if(t.length===2||S==="="){M=t.join("");t.length=0;i=h;T=null;return}}function I(){if(!t.length&&!T){T=/['"]/.test(S)?S:null;if(T){return}}if(T){if(!e&&S===T){T=null;return}if(S==="\\"){if(e){t.push(S)}e=!e;return}e=false;t.push(S);return}j(true);if(i!==c){return}_.queue({type:m,data:{lhs:k,rhs:t.join(""),cmp:M}});i=c;k=H=M=null;t.length=0;return}function j(r){if(/[^\d\w\-_]/.test(S)&&!e){if(S==="\\"){e=true}else{!r&&_.queue(G());i=c;--b}return}e=false;t.push(S)}function G(){var e=t.join("");t.length=0;return{type:i,data:e}}}},{through:18}],6:[function(e,t,i){function r(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}t.exports=r;r.EventEmitter=r;r.prototype._events=undefined;r.prototype._maxListeners=undefined;r.defaultMaxListeners=10;r.prototype.setMaxListeners=function(e){if(!a(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");this._maxListeners=e;return this};r.prototype.emit=function(e){var t,i,r,a,h,l;if(!this._events)this._events={};if(e==="error"){if(!this._events.error||o(this._events.error)&&!this._events.error.length){t=arguments[1];if(t instanceof Error){throw t}throw TypeError('Uncaught, unspecified "error" event.')}}i=this._events[e];if(s(i))return false;if(n(i)){switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:r=arguments.length;a=new Array(r-1);for(h=1;h<r;h++)a[h-1]=arguments[h];i.apply(this,a)}}else if(o(i)){r=arguments.length;a=new Array(r-1);for(h=1;h<r;h++)a[h-1]=arguments[h];l=i.slice();r=l.length;for(h=0;h<r;h++)l[h].apply(this,a)}return true};r.prototype.addListener=function(e,t){var i;if(!n(t))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",e,n(t.listener)?t.listener:t);if(!this._events[e])this._events[e]=t;else if(o(this._events[e]))this._events[e].push(t);else this._events[e]=[this._events[e],t];if(o(this._events[e])&&!this._events[e].warned){var i;if(!s(this._maxListeners)){i=this._maxListeners}else{i=r.defaultMaxListeners}if(i&&i>0&&this._events[e].length>i){this._events[e].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[e].length);if(typeof console.trace==="function"){console.trace()}}}return this};r.prototype.on=r.prototype.addListener;r.prototype.once=function(e,t){if(!n(t))throw TypeError("listener must be a function");var i=false;function r(){this.removeListener(e,r);if(!i){i=true;t.apply(this,arguments)}}r.listener=t;this.on(e,r);return this};r.prototype.removeListener=function(e,t){var i,r,a,s;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;i=this._events[e];a=i.length;r=-1;if(i===t||n(i.listener)&&i.listener===t){delete this._events[e];if(this._events.removeListener)this.emit("removeListener",e,t)}else if(o(i)){for(s=a;s-- >0;){if(i[s]===t||i[s].listener&&i[s].listener===t){r=s;break}}if(r<0)return this;if(i.length===1){i.length=0;delete this._events[e]}else{i.splice(r,1)}if(this._events.removeListener)this.emit("removeListener",e,t)}return this};r.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[e])delete this._events[e];return this}if(arguments.length===0){for(t in this._events){if(t==="removeListener")continue;this.removeAllListeners(t)}this.removeAllListeners("removeListener");this._events={};return this}i=this._events[e];if(n(i)){this.removeListener(e,i)}else{while(i.length)this.removeListener(e,i[i.length-1])}delete this._events[e];return this};r.prototype.listeners=function(e){var t;if(!this._events||!this._events[e])t=[];else if(n(this._events[e]))t=[this._events[e]];else t=this._events[e].slice();return t};r.listenerCount=function(e,t){var i;if(!e._events||!e._events[t])i=0;else if(n(e._events[t]))i=1;else i=e._events[t].length;return i};function n(e){return typeof e==="function"}function a(e){return typeof e==="number"}function o(e){return typeof e==="object"&&e!==null}function s(e){return e===void 0}},{}],7:[function(e,t,i){var r=e("buffer").Buffer;function n(e){if(e&&!r.isEncoding(e)){throw new Error("Unknown encoding: "+e)}}var a=i.StringDecoder=function(e){this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,"");n(e);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2;this.detectIncompleteChar=s;break;case"base64":this.surrogateSize=3;this.detectIncompleteChar=h;break;default:this.write=o;return}this.charBuffer=new r(6);this.charReceived=0;this.charLength=0};a.prototype.write=function(e){var t="";var i=0;while(this.charLength){var r=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;e.copy(this.charBuffer,this.charReceived,i,r);this.charReceived+=r-i;i=r;if(this.charReceived<this.charLength){return""}t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var n=t.charCodeAt(t.length-1);if(n>=55296&&n<=56319){this.charLength+=this.surrogateSize;t="";continue}this.charReceived=this.charLength=0;if(r==e.length)return t;e=e.slice(r,e.length);break}var a=this.detectIncompleteChar(e);var o=e.length;if(this.charLength){e.copy(this.charBuffer,0,e.length-a,o);this.charReceived=a;o-=a}t+=e.toString(this.encoding,0,o);var o=t.length-1;var n=t.charCodeAt(o);if(n>=55296&&n<=56319){var s=this.surrogateSize;this.charLength+=s;this.charReceived+=s;this.charBuffer.copy(this.charBuffer,s,0,s);this.charBuffer.write(t.charAt(t.length-1),this.encoding);return t.substring(0,o)}return t};a.prototype.detectIncompleteChar=function(e){var t=e.length>=3?3:e.length;for(;t>0;t--){var i=e[e.length-t];if(t==1&&i>>5==6){this.charLength=2;break}if(t<=2&&i>>4==14){this.charLength=3;break}if(t<=3&&i>>3==30){this.charLength=4;break}}return t};a.prototype.end=function(e){var t="";if(e&&e.length)t=this.write(e);if(this.charReceived){var i=this.charReceived;var r=this.charBuffer;var n=this.encoding;t+=r.slice(0,i).toString(n)}return t};function o(e){return e.toString(this.encoding)}function s(e){var t=this.charReceived=e.length%2;this.charLength=t?2:0;return t}function h(e){var t=this.charReceived=e.length%3;this.charLength=t?3:0;return t}},{buffer:3}],8:[function(e,t,i){i.read=function(e,t,i,r,n){var a,o;var s=n*8-r-1;var h=(1<<s)-1;var l=h>>1;var u=-7;var c=i?n-1:0;var p=i?-1:1;var f=e[t+c];c+=p;a=f&(1<<-u)-1;f>>=-u;u+=s;for(;u>0;a=a*256+e[t+c],c+=p,u-=8){}o=a&(1<<-u)-1;a>>=-u;u+=r;for(;u>0;o=o*256+e[t+c],c+=p,u-=8){}if(a===0){a=1-l}else if(a===h){return o?NaN:(f?-1:1)*Infinity}else{o=o+Math.pow(2,r);a=a-l}return(f?-1:1)*o*Math.pow(2,a-r)};i.write=function(e,t,i,r,n,a){var o,s,h;var l=a*8-n-1;var u=(1<<l)-1;var c=u>>1;var p=n===23?Math.pow(2,-24)-Math.pow(2,-77):0;var f=r?0:a-1;var d=r?1:-1;var m=t<0||t===0&&1/t<0?1:0;t=Math.abs(t);if(isNaN(t)||t===Infinity){s=isNaN(t)?1:0;o=u}else{o=Math.floor(Math.log(t)/Math.LN2);if(t*(h=Math.pow(2,-o))<1){o--;h*=2}if(o+c>=1){t+=p/h}else{t+=p*Math.pow(2,1-c)}if(t*h>=2){o++;h/=2}if(o+c>=u){s=0;o=u}else if(o+c>=1){s=(t*h-1)*Math.pow(2,n);o=o+c}else{s=t*Math.pow(2,c-1)*Math.pow(2,n);o=0}}for(;n>=8;e[i+f]=s&255,f+=d,s/=256,n-=8){}o=o<<n|s;l+=n;for(;l>0;e[i+f]=o&255,f+=d,o/=256,l-=8){}e[i+f-d]|=m*128}},{}],9:[function(e,t,i){if(typeof Object.create==="function"){t.exports=function e(t,i){t.super_=i;t.prototype=Object.create(i.prototype,{constructor:{value:t,enumerable:false,writable:true,configurable:true}})}}else{t.exports=function e(t,i){t.super_=i;var r=function(){};r.prototype=i.prototype;t.prototype=new r;t.prototype.constructor=t}}},{}],10:[function(e,t,i){var r=t.exports={};r.nextTick=function(){var e=typeof window!=="undefined"&&window.setImmediate;var t=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(e){return function(e){return window.setImmediate(e)}}if(t){var i=[];window.addEventListener("message",function(e){var t=e.source;if((t===window||t===null)&&e.data==="process-tick"){e.stopPropagation();if(i.length>0){var r=i.shift();r()}}},true);return function e(t){i.push(t);window.postMessage("process-tick","*")}}return function e(t){setTimeout(t,0)}}();r.title="browser";r.browser=true;r.env={};r.argv=[];function n(){}r.on=n;r.addListener=n;r.once=n;r.off=n;r.removeListener=n;r.removeAllListeners=n;r.emit=n;r.binding=function(e){throw new Error("process.binding is not supported")};r.cwd=function(){return"/"};r.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],11:[function(e,t,i){t.exports=s;var r=e("inherits");var n=e("process/browser.js").nextTick;var a=e("./readable.js");var o=e("./writable.js");r(s,a);s.prototype.write=o.prototype.write;s.prototype.end=o.prototype.end;s.prototype._write=o.prototype._write;function s(e){if(!(this instanceof s))return new s(e);a.call(this,e);o.call(this,e);if(e&&e.readable===false)this.readable=false;if(e&&e.writable===false)this.writable=false;this.allowHalfOpen=true;if(e&&e.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",h)}function h(){if(this.allowHalfOpen||this._writableState.ended)return;var e=this;n(function(){e.end()})}},{"./readable.js":15,"./writable.js":17,inherits:9,"process/browser.js":13}],12:[function(e,t,i){t.exports=a;var r=e("events").EventEmitter;var n=e("inherits");n(a,r);a.Readable=e("./readable.js");a.Writable=e("./writable.js");a.Duplex=e("./duplex.js");a.Transform=e("./transform.js");a.PassThrough=e("./passthrough.js");a.Stream=a;function a(){r.call(this)}a.prototype.pipe=function(e,t){var i=this;function n(t){if(e.writable){if(false===e.write(t)&&i.pause){i.pause()}}}i.on("data",n);function a(){if(i.readable&&i.resume){i.resume()}}e.on("drain",a);if(!e._isStdio&&(!t||t.end!==false)){i.on("end",s);i.on("close",h)}var o=false;function s(){if(o)return;o=true;e.end()}function h(){if(o)return;o=true;if(typeof e.destroy==="function")e.destroy()}function l(e){u();if(r.listenerCount(this,"error")===0){throw e}}i.on("error",l);e.on("error",l);function u(){i.removeListener("data",n);e.removeListener("drain",a);i.removeListener("end",s);i.removeListener("close",h);i.removeListener("error",l);e.removeListener("error",l);i.removeListener("end",u);i.removeListener("close",u);e.removeListener("close",u)}i.on("end",u);i.on("close",u);e.on("close",u);e.emit("pipe",i);return e}},{"./duplex.js":11,"./passthrough.js":14,"./readable.js":15,"./transform.js":16,"./writable.js":17,events:6,inherits:9}],13:[function(e,t,i){var r=t.exports={};r.nextTick=function(){var e=typeof window!=="undefined"&&window.setImmediate;var t=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(e){return function(e){return window.setImmediate(e)}}if(t){var i=[];window.addEventListener("message",function(e){var t=e.source;if((t===window||t===null)&&e.data==="process-tick"){e.stopPropagation();if(i.length>0){var r=i.shift();r()}}},true);return function e(t){i.push(t);window.postMessage("process-tick","*")}}return function e(t){setTimeout(t,0)}}();r.title="browser";r.browser=true;r.env={};r.argv=[];r.binding=function(e){throw new Error("process.binding is not supported")};r.cwd=function(){return"/"};r.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],14:[function(e,t,i){t.exports=a;var r=e("./transform.js");var n=e("inherits");n(a,r);function a(e){if(!(this instanceof a))return new a(e);r.call(this,e)}a.prototype._transform=function(e,t,i){i(null,e)}},{"./transform.js":16,inherits:9}],15:[function(e,t,i){(function(i){t.exports=u;u.ReadableState=l;var r=e("events").EventEmitter;var n=e("./index.js");var a=e("buffer").Buffer;var o=e("process/browser.js").nextTick;var s;var h=e("inherits");h(u,n);function l(t,i){t=t||{};var r=t.highWaterMark;this.highWaterMark=r||r===0?r:16*1024;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=false;this.ended=false;this.endEmitted=false;this.reading=false;this.calledRead=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.objectMode=!!t.objectMode;this.defaultEncoding=t.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(t.encoding){if(!s)s=e("string_decoder").StringDecoder;this.decoder=new s(t.encoding);this.encoding=t.encoding}}function u(e){if(!(this instanceof u))return new u(e);this._readableState=new l(e,this);this.readable=true;n.call(this)}u.prototype.push=function(e,t){var i=this._readableState;if(typeof e==="string"&&!i.objectMode){t=t||i.defaultEncoding;if(t!==i.encoding){e=new a(e,t);t=""}}return c(this,i,e,t,false)};u.prototype.unshift=function(e){var t=this._readableState;return c(this,t,e,"",true)};function c(e,t,i,r,n){var a=g(t,i);if(a){e.emit("error",a)}else if(i===null||i===undefined){t.reading=false;if(!t.ended)v(e,t)}else if(t.objectMode||i&&i.length>0){if(t.ended&&!n){var o=new Error("stream.push() after EOF");e.emit("error",o)}else if(t.endEmitted&&n){var o=new Error("stream.unshift() after end event");e.emit("error",o)}else{if(t.decoder&&!n&&!r)i=t.decoder.write(i);t.length+=t.objectMode?1:i.length;if(n){t.buffer.unshift(i)}else{t.reading=false;t.buffer.push(i)}if(t.needReadable)y(e);w(e,t)}}else if(!n){t.reading=false}return p(t)}function p(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||e.length===0)}u.prototype.setEncoding=function(t){if(!s)s=e("string_decoder").StringDecoder;this._readableState.decoder=new s(t);this._readableState.encoding=t};var f=8388608;function d(e){if(e>=f){e=f}else{e--;for(var t=1;t<32;t<<=1)e|=e>>t;e++}return e}function m(e,t){if(t.length===0&&t.ended)return 0;if(t.objectMode)return e===0?0:1;if(isNaN(e)||e===null){if(t.flowing&&t.buffer.length)return t.buffer[0].length;else return t.length}if(e<=0)return 0;if(e>t.highWaterMark)t.highWaterMark=d(e);if(e>t.length){if(!t.ended){t.needReadable=true;return 0}else return t.length}return e}u.prototype.read=function(e){var t=this._readableState;t.calledRead=true;var i=e;if(typeof e!=="number"||e>0)t.emittedReadable=false;if(e===0&&t.needReadable&&(t.length>=t.highWaterMark||t.ended)){y(this);return null}e=m(e,t);if(e===0&&t.ended){if(t.length===0)H(this);return null}var r=t.needReadable;if(t.length-e<=t.highWaterMark)r=true;if(t.ended||t.reading)r=false;if(r){t.reading=true;t.sync=true;if(t.length===0)t.needReadable=true;this._read(t.highWaterMark);t.sync=false}if(r&&!t.reading)e=m(i,t);var n;if(e>0)n=k(e,t);else n=null;if(n===null){t.needReadable=true;e=0}t.length-=e;if(t.length===0&&!t.ended)t.needReadable=true;if(t.ended&&!t.endEmitted&&t.length===0)H(this);return n};function g(e,t){var i=null;if(!a.isBuffer(t)&&"string"!==typeof t&&t!==null&&t!==undefined&&!e.objectMode&&!i){i=new TypeError("Invalid non-string/buffer chunk")}return i}function v(e,t){if(t.decoder&&!t.ended){var i=t.decoder.end();if(i&&i.length){t.buffer.push(i);t.length+=t.objectMode?1:i.length}}t.ended=true;if(t.length>0)y(e);else H(e)}function y(e){var t=e._readableState;t.needReadable=false;if(t.emittedReadable)return;t.emittedReadable=true;if(t.sync)o(function(){E(e)});else E(e)}function E(e){e.emit("readable")}function w(e,t){if(!t.readingMore){t.readingMore=true;o(function(){b(e,t)})}}function b(e,t){var i=t.length;while(!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark){e.read(0);if(i===t.length)break;else i=t.length}t.readingMore=false}u.prototype._read=function(e){this.emit("error",new Error("not implemented"))};u.prototype.pipe=function(e,t){var n=this;var a=this._readableState;switch(a.pipesCount){case 0:a.pipes=e;break;case 1:a.pipes=[a.pipes,e];break;default:a.pipes.push(e);break}a.pipesCount+=1;var s=(!t||t.end!==false)&&e!==i.stdout&&e!==i.stderr;var h=s?u:p;if(a.endEmitted)o(h);else n.once("end",h);e.on("unpipe",l);function l(e){if(e!==n)return;p()}function u(){e.end()}var c=_(n);e.on("drain",c);function p(){e.removeListener("close",m);e.removeListener("finish",g);e.removeListener("drain",c);e.removeListener("error",d);e.removeListener("unpipe",l);n.removeListener("end",u);n.removeListener("end",p);if(!e._writableState||e._writableState.needDrain)c()}var f=r.listenerCount(e,"error");function d(t){v();if(f===0&&r.listenerCount(e,"error")===0)e.emit("error",t)}e.once("error",d);function m(){e.removeListener("finish",g);v()}e.once("close",m);function g(){e.removeListener("close",m);v()}e.once("finish",g);function v(){n.unpipe(e)}e.emit("pipe",n);if(!a.flowing){this.on("readable",T);a.flowing=true;o(function(){x(n)})}return e};function _(e){return function(){var t=this;var i=e._readableState;i.awaitDrain--;if(i.awaitDrain===0)x(e)}}function x(e){var t=e._readableState;var i;t.awaitDrain=0;function n(e,r,n){var a=e.write(i);if(false===a){t.awaitDrain++}}while(t.pipesCount&&null!==(i=e.read())){if(t.pipesCount===1)n(t.pipes,0,null);else M(t.pipes,n);e.emit("data",i);if(t.awaitDrain>0)return}if(t.pipesCount===0){t.flowing=false;if(r.listenerCount(e,"data")>0)R(e);return}t.ranOut=true}function T(){if(this._readableState.ranOut){this._readableState.ranOut=false;x(this)}}u.prototype.unpipe=function(e){var t=this._readableState;if(t.pipesCount===0)return this;if(t.pipesCount===1){if(e&&e!==t.pipes)return this;if(!e)e=t.pipes;t.pipes=null;t.pipesCount=0;this.removeListener("readable",T);t.flowing=false;if(e)e.emit("unpipe",this);return this}if(!e){var i=t.pipes;var r=t.pipesCount;t.pipes=null;t.pipesCount=0;this.removeListener("readable",T);t.flowing=false;for(var n=0;n<r;n++)i[n].emit("unpipe",this);return this}var n=S(t.pipes,e);if(n===-1)return this;t.pipes.splice(n,1);t.pipesCount-=1;if(t.pipesCount===1)t.pipes=t.pipes[0];e.emit("unpipe",this);return this};u.prototype.on=function(e,t){var i=n.prototype.on.call(this,e,t);if(e==="data"&&!this._readableState.flowing)R(this);if(e==="readable"&&this.readable){var r=this._readableState;if(!r.readableListening){r.readableListening=true;r.emittedReadable=false;r.needReadable=true;if(!r.reading){this.read(0)}else if(r.length){y(this,r)}}}return i};u.prototype.addListener=u.prototype.on;u.prototype.resume=function(){R(this);this.read(0);this.emit("resume")};u.prototype.pause=function(){R(this,true);this.emit("pause")};function R(e,t){var i=e._readableState;if(i.flowing){throw new Error("Cannot switch to old mode now.")}var r=t||false;var a=false;e.readable=true;e.pipe=n.prototype.pipe;e.on=e.addListener=n.prototype.on;e.on("readable",function(){a=true;var t;while(!r&&null!==(t=e.read()))e.emit("data",t);if(t===null){a=false;e._readableState.needReadable=true}});e.pause=function(){r=true;this.emit("pause")};e.resume=function(){r=false;if(a)o(function(){e.emit("readable")});else this.read(0);this.emit("resume")};e.emit("readable")}u.prototype.wrap=function(e){var t=this._readableState;var i=false;var r=this;e.on("end",function(){if(t.decoder&&!t.ended){var e=t.decoder.end();if(e&&e.length)r.push(e)}r.push(null)});e.on("data",function(n){if(t.decoder)n=t.decoder.write(n);if(!n||!t.objectMode&&!n.length)return;var a=r.push(n);if(!a){i=true;e.pause()}});for(var n in e){if(typeof e[n]==="function"&&typeof this[n]==="undefined"){this[n]=function(t){return function(){return e[t].apply(e,arguments)}}(n)}}var a=["error","close","destroy","pause","resume"];M(a,function(t){e.on(t,function(e){return r.emit.apply(r,t,e)})});r._read=function(t){if(i){i=false;e.resume()}};return r};u._fromList=k;function k(e,t){var i=t.buffer;var r=t.length;var n=!!t.decoder;var o=!!t.objectMode;var s;if(i.length===0)return null;if(r===0)s=null;else if(o)s=i.shift();else if(!e||e>=r){if(n)s=i.join("");else s=a.concat(i,r);i.length=0}else{if(e<i[0].length){var h=i[0];s=h.slice(0,e);i[0]=h.slice(e)}else if(e===i[0].length){s=i.shift()}else{if(n)s="";else s=new a(e);var l=0;for(var u=0,c=i.length;u<c&&l<e;u++){var h=i[0];var p=Math.min(e-l,h.length);if(n)s+=h.slice(0,p);else h.copy(s,l,0,p);if(p<h.length)i[0]=h.slice(p);else i.shift();l+=p}}}return s}function H(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");if(!t.endEmitted&&t.calledRead){t.ended=true;o(function(){if(!t.endEmitted&&t.length===0){t.endEmitted=true;e.readable=false;e.emit("end")}})}}function M(e,t){for(var i=0,r=e.length;i<r;i++){t(e[i],i)}}function S(e,t){for(var i=0,r=e.length;i<r;i++){if(e[i]===t)return i}return-1}}).call(this,e("pBGvAp"))},{"./index.js":12,buffer:3,events:6,inherits:9,pBGvAp:10,"process/browser.js":13,string_decoder:7}],16:[function(e,t,i){t.exports=s;var r=e("./duplex.js");var n=e("inherits");n(s,r);function a(e,t){this.afterTransform=function(e,i){return o(t,e,i)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null}function o(e,t,i){var r=e._transformState;r.transforming=false;var n=r.writecb;if(!n)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null;r.writecb=null;if(i!==null&&i!==undefined)e.push(i);if(n)n(t);var a=e._readableState;a.reading=false;if(a.needReadable||a.length<a.highWaterMark){e._read(a.highWaterMark)}}function s(e){if(!(this instanceof s))return new s(e);r.call(this,e);var t=this._transformState=new a(e,this);var i=this;this._readableState.needReadable=true;this._readableState.sync=false;this.once("finish",function(){if("function"===typeof this._flush)this._flush(function(e){h(i,e)});else h(i)})}s.prototype.push=function(e,t){this._transformState.needTransform=false;return r.prototype.push.call(this,e,t)};s.prototype._transform=function(e,t,i){throw new Error("not implemented")};s.prototype._write=function(e,t,i){var r=this._transformState;r.writecb=i;r.writechunk=e;r.writeencoding=t;if(!r.transforming){var n=this._readableState;if(r.needTransform||n.needReadable||n.length<n.highWaterMark)this._read(n.highWaterMark)}};s.prototype._read=function(e){var t=this._transformState;if(t.writechunk&&t.writecb&&!t.transforming){t.transforming=true;this._transform(t.writechunk,t.writeencoding,t.afterTransform)}else{t.needTransform=true}};function h(e,t){if(t)return e.emit("error",t);var i=e._writableState;var r=e._readableState;var n=e._transformState;if(i.length)throw new Error("calling transform done when ws.length != 0");if(n.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}},{"./duplex.js":11,inherits:9}],17:[function(e,t,i){t.exports=c;c.WritableState=u;var r=typeof Uint8Array!=="undefined"?function(e){return e instanceof Uint8Array}:function(e){return e&&e.constructor&&e.constructor.name==="Uint8Array"};var n=typeof ArrayBuffer!=="undefined"?function(e){return e instanceof ArrayBuffer}:function(e){return e&&e.constructor&&e.constructor.name==="ArrayBuffer"};var a=e("inherits");var o=e("./index.js");var s=e("process/browser.js").nextTick;var h=e("buffer").Buffer;a(c,o);function l(e,t,i){this.chunk=e;this.encoding=t;this.callback=i}function u(e,t){e=e||{};var i=e.highWaterMark;this.highWaterMark=i||i===0?i:16*1024;this.objectMode=!!e.objectMode;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var r=e.decodeStrings===false;this.decodeStrings=!r;this.defaultEncoding=e.defaultEncoding||"utf8";this.length=0;this.writing=false;this.sync=true;this.bufferProcessing=false;this.onwrite=function(e){E(t,e)};this.writecb=null;this.writelen=0;this.buffer=[]}function c(e){if(!(this instanceof c)&&!(this instanceof o.Duplex))return new c(e);this._writableState=new u(e,this);this.writable=true;o.call(this)}c.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))};function p(e,t,i){var r=new Error("write after end");e.emit("error",r);s(function(){i(r)})}function f(e,t,i,r){var n=true;if(!h.isBuffer(i)&&"string"!==typeof i&&i!==null&&i!==undefined&&!t.objectMode){var a=new TypeError("Invalid non-string/buffer chunk");e.emit("error",a);s(function(){r(a)});n=false}return n}c.prototype.write=function(e,t,i){var a=this._writableState;var o=false;if(typeof t==="function"){i=t;t=null}if(!h.isBuffer(e)&&r(e))e=new h(e);if(n(e)&&typeof Uint8Array!=="undefined")e=new h(new Uint8Array(e));if(h.isBuffer(e))t="buffer";else if(!t)t=a.defaultEncoding;if(typeof i!=="function")i=function(){};if(a.ended)p(this,a,i);else if(f(this,a,e,i))o=m(this,a,e,t,i);return o};function d(e,t,i){if(!e.objectMode&&e.decodeStrings!==false&&typeof t==="string"){t=new h(t,i)}return t}function m(e,t,i,r,n){i=d(t,i,r);var a=t.objectMode?1:i.length;t.length+=a;var o=t.length<t.highWaterMark;t.needDrain=!o;if(t.writing)t.buffer.push(new l(i,r,n));else g(e,t,a,i,r,n);return o}function g(e,t,i,r,n,a){t.writelen=i;t.writecb=a;t.writing=true;t.sync=true;e._write(r,n,t.onwrite);t.sync=false}function v(e,t,i,r,n){if(i)s(function(){n(r)});else n(r);e.emit("error",r)}function y(e){e.writing=false;e.writecb=null;e.length-=e.writelen;e.writelen=0}function E(e,t){var i=e._writableState;var r=i.sync;var n=i.writecb;y(i);if(t)v(e,i,r,t,n);else{var a=x(e,i);if(!a&&!i.bufferProcessing&&i.buffer.length)_(e,i);if(r){s(function(){w(e,i,a,n)})}else{w(e,i,a,n)}}}function w(e,t,i,r){if(!i)b(e,t);r();if(i)T(e,t)}function b(e,t){if(t.length===0&&t.needDrain){t.needDrain=false;e.emit("drain")}}function _(e,t){t.bufferProcessing=true;for(var i=0;i<t.buffer.length;i++){var r=t.buffer[i];var n=r.chunk;var a=r.encoding;var o=r.callback;var s=t.objectMode?1:n.length;g(e,t,s,n,a,o);if(t.writing){i++;break}}t.bufferProcessing=false;if(i<t.buffer.length)t.buffer=t.buffer.slice(i);else t.buffer.length=0}c.prototype._write=function(e,t,i){i(new Error("not implemented"))};c.prototype.end=function(e,t,i){var r=this._writableState;if(typeof e==="function"){i=e;e=null;t=null}else if(typeof t==="function"){i=t;t=null}if(typeof e!=="undefined"&&e!==null)this.write(e,t);if(!r.ending&&!r.finished)R(this,r,i)};function x(e,t){return t.ending&&t.length===0&&!t.finished&&!t.writing}function T(e,t){var i=x(e,t);if(i){t.finished=true;e.emit("finish")}return i}function R(e,t,i){t.ending=true;T(e,t);if(i){if(t.finished)s(i);else e.once("finish",i)}t.ended=true}},{"./index.js":12,buffer:3,inherits:9,"process/browser.js":13}],18:[function(e,t,i){(function(r){var n=e("stream");i=t.exports=a;a.through=a;function a(e,t,i){e=e||function(e){this.queue(e)};t=t||function(){this.queue(null)};var a=false,o=false,s=[],h=false;var l=new n;l.readable=l.writable=true;l.paused=false;l.autoDestroy=!(i&&i.autoDestroy===false);l.write=function(t){e.call(this,t);return!l.paused};function u(){while(s.length&&!l.paused){var e=s.shift();if(null===e)return l.emit("end");else l.emit("data",e)}}l.queue=l.push=function(e){if(h)return l;if(e===null)h=true;s.push(e);u();return l};l.on("end",function(){l.readable=false;if(!l.writable&&l.autoDestroy)r.nextTick(function(){l.destroy()})});function c(){l.writable=false;t.call(l);if(!l.readable&&l.autoDestroy)l.destroy()}l.end=function(e){if(a)return;a=true;if(arguments.length)l.write(e);c();return l};l.destroy=function(){if(o)return;o=true;a=true;s.length=0;l.writable=l.readable=false;l.emit("close");return l};l.pause=function(){if(l.paused)return;l.paused=true;return l};l.resume=function(){if(l.paused){l.paused=false;l.emit("resume")}u();if(!l.paused)l.emit("drain");return l};return l}}).call(this,e("pBGvAp"))},{pBGvAp:10,stream:12}],19:[function(e,t,i){var r,n,a,o,s,h,l,u;n=e("./model");a=e("./overlay");o=e("./primitives");s=e("./render");h=e("./shaders");l=e("./stage");u=e("./util");r=function(){e.Namespace={Model:n,Overlay:a,Primitives:o,Render:s,Shaders:h,Stage:l,Util:u,DOM:u.VDOM};function e(e,t,i){var r;if(t==null){t=null}if(i==null){i=null}this.canvas=r=e.domElement;this.element=null;this.shaders=new h.Factory(h.Snippets);this.renderables=new s.Factory(s.Classes,e,this.shaders);this.overlays=new a.Factory(a.Classes,r);this.scene=this.renderables.make("scene",{scene:t});this.camera=this.defaultCamera=i!=null?i:new THREE.PerspectiveCamera;this.attributes=new n.Attributes(o.Types,this);this.primitives=new o.Factory(o.Types,this);this.root=this.primitives.make("root");this.model=new n.Model(this.root);this.guard=new n.Guard;this.controller=new l.Controller(this.model,this.primitives);this.animator=new l.Animator(this);this.api=new l.API(this);this.speed=1;this.time={now:+new Date/1e3,time:0,delta:0,clock:0,step:0}}e.prototype.init=function(){this.scene.inject();this.overlays.inject();return this};e.prototype.destroy=function(){this.scene.unject();this.overlays.unject();return this};e.prototype.resize=function(e){if(e==null){e={}}if(e.renderWidth==null){e.renderWidth=e.viewWidth!=null?e.viewWidth:e.viewWidth=1280}if(e.renderHeight==null){e.renderHeight=e.viewHeight!=null?e.viewHeight:e.viewHeight=720}if(e.pixelRatio==null){e.pixelRatio=e.renderWidth/Math.max(1e-6,e.viewWidth)}if(e.aspect==null){e.aspect=e.viewWidth/Math.max(1e-6,e.viewHeight)}this.root.controller.resize(e);return this};e.prototype.frame=function(e){this.pre(e);this.update();this.render();this.post();return this};e.prototype.pre=function(e){var t;if(!e){e={now:+new Date/1e3,time:0,delta:0,clock:0,step:0};e.delta=this.time.now!=null?e.now-this.time.now:0;if(e.delta>1){e.delta=1/60}e.step=e.delta*this.speed;e.time=this.time.time+e.delta;e.clock=this.time.clock+e.step}this.time=e;if(typeof(t=this.root.controller).pre==="function"){t.pre()}return this};e.prototype.update=function(){var e;this.animator.update();this.attributes.compute();this.guard.iterate({step:function(e){return function(){var t;t=e.attributes.digest();return t||(t=e.model.digest())}}(this),last:function(){return{attribute:this.attributes.getLastTrigger(),model:this.model.getLastTrigger()}}});if(typeof(e=this.root.controller).update==="function"){e.update()}this.camera=this.root.controller.getCamera();this.speed=this.root.controller.getSpeed();return this};e.prototype.render=function(){var e;if(typeof(e=this.root.controller).render==="function"){e.render()}this.scene.render();return this};e.prototype.post=function(){var e;if(typeof(e=this.root.controller).post==="function"){e.post()}return this};e.prototype.setWarmup=function(e){this.scene.warmup(e);return this};e.prototype.getPending=function(){return this.scene.pending.length};return e}();t.exports=r},{"./model":24,"./overlay":30,"./primitives":33,"./render":140,"./shaders":155,"./stage":160,"./util":166}],20:[function(e,t,i){var r,n,a,o,s;a=function(e){var t,i;i=THREE.Bootstrap(e);if(!i.fallback){if(!i.Time){i.install("time")}if(!i.MathBox){i.install(["mathbox","splash"])}}return(t=i.mathbox)!=null?t:i};window.=Math.PI;window.=*2;window.e=Math.E;window.MathBox=i;window.mathBox=i.mathBox=a;i.version="0.0.5";i.Context=r=e("./context");o=r.Namespace;for(n in o){s=o[n];i[n]=s}e("./splash");THREE.Bootstrap.registerPlugin("mathbox",{defaults:{init:true,warmup:2,inspect:true,splash:true},listen:["ready","pre","update","post","resize"],install:function(e){var t;t=false;this.first=true;return e.MathBox={init:function(i){return function(n){var a,o;if(t){return}t=true;o=(n!=null?n.scene:void 0)||i.options.scene||e.scene;a=(n!=null?n.camera:void 0)||i.options.camera||e.camera;i.context=new r(e.renderer,o,a);i.context.api.three=e.three=e;i.context.api.mathbox=e.mathbox=i.context.api;i.context.api.start=function(){return e.Loop.start()};i.context.api.stop=function(){return e.Loop.stop()};i.context.init();i.context.resize(e.Size);i.context.setWarmup(i.options.warmup);i.pending=0;i.warm=!i.options.warmup;console.log("MathBox",MathBox.version);return e.trigger({type:"mathbox/init",version:MathBox.version,context:i.context})}}(this),destroy:function(i){return function(){if(!t){return}t=false;e.trigger({type:"mathbox/destroy",context:i.context});i.context.destroy();delete e.mathbox;delete i.context.api.three;return delete i.context}}(this),object:function(e){return function(){var t;return(t=e.context)!=null?t.scene.root:void 0}}(this)}},uninstall:function(e){e.MathBox.destroy();return delete e.MathBox},ready:function(e,t){if(this.options.init){t.MathBox.init();return setTimeout(function(e){return function(){if(e.options.inspect){return e.inspect(t)}}}(this))}},inspect:function(e){this.context.api.inspect();if(!this.options.warmup){return this.info(e)}},info:function(e){var t,i;t=function(e){var t;t=[];while(e>=1e3){t.unshift(("000"+e%1e3).slice(-3));e=Math.floor(e/1e3)}t.unshift(e);return t.join(",")};i=e.renderer.info.render;return console.log("Geometry  ",t(i.faces)+" faces  ",t(i.vertices)+" vertices  ",t(i.calls)+" draw calls  ")},resize:function(e,t){var i;return(i=this.context)!=null?i.resize(t.Size):void 0},pre:function(e,t){var i;return(i=this.context)!=null?i.pre(t.Time):void 0},update:function(e,t){var i,r,n,a;if((r=this.context)!=null){r.update()}if((i=(n=this.context)!=null?n.camera:void 0)&&i!==t.camera){t.camera=i}t.Time.set({speed:this.context.speed});this.progress(this.context.getPending(),t);return(a=this.context)!=null?a.render():void 0},post:function(e,t){var i;return(i=this.context)!=null?i.post():void 0},progress:function(e,t){var i,r,n;if(!(e||this.pending)){return}r=Math.max(e+this.options.warmup,this.pending);i=r-e;n=r;t.trigger({type:"mathbox/progress",current:r-e,total:r});if(e===0){r=0}this.pending=r;if(i===n&&!this.warm){this.warm=true;if(this.options.inspect){return this.info(t)}}}})},{"./context":19,"./splash":156}],21:[function(e,t,i){var r,n,a;r=function(){function e(e,t){this.context=t;this.traits=e.Traits;this.types=e.Types;this.pending=[];this.bound=[];this.last=null}e.prototype.make=function(e){return{enum:typeof e["enum"]==="function"?e["enum"]():void 0,type:typeof e.uniform==="function"?e.uniform():void 0,value:e.make()}};e.prototype.apply=function(e,t){return new n(e,t,this)};e.prototype.bind=function(e){return this.bound.push(e)};e.prototype.unbind=function(e){var t;return this.bound=function(){var i,r,n,a;n=this.bound;a=[];for(i=0,r=n.length;i<r;i++){t=n[i];if(t!==e){a.push(t)}}return a}.call(this)};e.prototype.queue=function(e,t,i,r){this.lastObject=t;this.lastKey=i;this.lastValue=r;return this.pending.push(e)};e.prototype.invoke=function(e){return e(this.context.time.clock,this.context.time.step)};e.prototype.compute=function(){var e,t,i,r;if(this.bound.length){r=this.bound;for(t=0,i=r.length;t<i;t++){e=r[t];this.invoke(e)}}};e.prototype.digest=function(){var e,t,i,r,n;if(!this.pending.length){return false}n=[this.pending,[]],t=n[0],this.pending=n[1];for(i=0,r=t.length;i<r;i++){e=t[i];e()}return true};e.prototype.getTrait=function(e){return this.traits[e]};e.prototype.getLastTrigger=function(){return this.lastObject.toString()+" - "+this.lastKey+"=`"+this.lastValue+"`"};return e}();a=function(e){var t,i,r;i={};for(t in e){r=e[t];i[t]=r}return i};n=function(){function e(e,t,i){var r,n,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M,S,A,C,z,P,L,O,D,F,B,U,N,V,I,j,G,W,q,X,Y,Z,K,Q,J,$,ee,te,ie,re,ne;J=t.traits,I=t.props,T=t.finals,k=t.freeform;m=this;if(e.props!=null&&e.expr!=null&&e.orig!=null&&e.computed!=null&&e.attributes!=null){N=a(e.props);B=a(e.expr);U=e.orig();F=e.computed();if((j=e.attributes)!=null){j.dispose()}}R={};V={};L={};Y=function(e){var t;return(t=L[e])!=null?t:e};g=function(t,i){if(L[i]){throw new Error(e.toString()+" - Duplicate property `"+i+"`")}return L[i]=t};H=function(e){var t,i,r;return(t=(i=m[e])!=null?i.value:void 0)!=null?t:(r=m[Y(e)])!=null?r.value:void 0};W=function(t,i,r,a){var o,l,u,p,f;t=Y(t);if((o=m[t])==null){if(!k){throw new Error(e.toString()+" - Setting unknown property `"+t+"={"+i+"}`")}o=m[t]={short:t,type:null,last:null,value:null};ie[t]=function(e){return e}}if(!r){if(s[t]){throw new Error(e.toString()+" - Can't set bound property `"+t+"={"+i+"}`")}if(n[t]){throw new Error(e.toString()+" - Can't set computed property `"+t+"={"+i+"}`")}if(h[t]){throw new Error(e.toString()+" - Can't set final property `"+t+"={"+i+"}`")}}p=true;f=te(t,i,o.last,function(){p=false;return null});if(p){l=[f,o.value],o.value=l[0],o.last=l[1];u=o.short;R[u]=f;if(!r){V[u]=i}if(!(a||w(t,o.value,o.last))){c(t,i)}}return p};d=function(e,t,i){e=Y(e);W(e,t,true,i);return h[e]=true};x={};r={};o={};s={};n={};h={};u=function(t,a,l){var u,c;if(l==null){l=false}t=Y(t);if(typeof a!=="function"){throw new Error(e.toString()+" - Expression `"+t+"=>{"+x+"}` is not a function")}if(s[t]){throw new Error(e.toString()+" - Property `"+t+"=>{"+x+"}` is already bound")}if(n[t]){throw new Error(e.toString()+" - Property `"+t+"` is computed")}if(h[t]){throw new Error(e.toString()+" - Property `"+t+"` is final")}u=l?n:s;u[t]=a;c=m[t]!=null?m[t].short:t;if(!l){x[c]=a}o[t]=a;a=a.bind(e);r[t]=function(i,r){var n,o;if(n=(o=e.clock)!=null?o.getTime():void 0){i=n.clock;r=n.step}return e.set(t,a(i,r),true)};return i.bind(r[t])};$=function(e,t){var a;if(t==null){t=false}e=Y(e);a=t?n:s;if(!a[e]){return}i.unbind(r[e]);delete r[e];delete a[e];if(m[e]!=null){e=m[e].short}return delete x[e]};b=function(e,t){var i;e=Y(e);return(i=typeof o[e]==="function"?o[e](t,0):void 0)!=null?i:m[e].value};e.expr=x;e.props=R;e.evaluate=function(e,t){var i;if(e!=null){return b(e,t)}else{i={};for(e in I){i[e]=b(e,t)}return i}};e.get=function(e){if(e!=null){return H(e)}else{return R}};e.set=function(e,t,i,r){var n;if(typeof e==="string"){W(e,t,i,r)}else{r=i;i=t;n=e;for(e in n){t=n[e];W(e,t,i,r)}}};e.bind=function(e,t,i){var r;if(typeof e==="string"){u(e,t,i)}else{i=t;r=e;for(e in r){t=r[e];u(e,t,i)}}};e.unbind=function(e,t){var i;if(typeof e==="string"){$(e,t)}else{t=x;i=e;for(e in i){$(e,t)}}};e.attribute=function(e){if(e!=null){return m[Y(e)]}else{return m}};e.orig=function(e){if(e!=null){return V[Y(e)]}else{return a(V)}};e.computed=function(e){if(e!=null){return n[Y(e)]}else{return a(n)}};P={};ie={};E={};w=function(e,t,i){return E[e](t,i)};te=function(e,t,i,r){return ie[e](t,i,r)};e.validate=function(t,i){var r,n;t=Y(t);r=P[t];if(r!=null){n=r()}return n=te(t,i,n,function(){throw new Error(e.toString()+" - Invalid value `"+t+"={"+i+"}`")})};y=false;f={};K={};p={};Z={};M=function(e){return e.split(".")[0]};c=function(t,r){var n;if(!y){y=true;i.queue(v,e,t,r)}n=M(t);f[t]=true;return K[n]=true};_={type:"change",changed:null,touched:null};v=function(){var t,i,r;_.changed=f;_.touched=K;f=p;K=Z;p=_.changed;Z=_.touched;y=false;for(t in f){f[t]=false}for(t in K){K[t]=false}_.type="change";e.trigger(_);i=[];for(r in _.touched){_.type="change:"+r;i.push(e.trigger(_))}return i};q=function(e){var t,i;t=e.split(/\./g);i=t.pop();t.pop();t.unshift(i);return t.reduce(function(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)})};l=function(e,t){var i,r,n,a,o,s,h,l;o=[];for(r in t){h=t[r];r=[e,r].join(".");s=q(r);m[r]=i={T:h,ns:e,short:s,enum:typeof h["enum"]==="function"?h["enum"]():void 0,type:typeof h.uniform==="function"?h.uniform():void 0,last:h.make(),value:l=h.make()};g(r,s);R[s]=l;P[r]=h.make;ie[r]=(n=h.validate)!=null?n:function(e){return e};o.push(E[r]=(a=h.equals)!=null?a:function(e,t){return e===t})}return o};z=[];ne={};for(S=0,C=J.length;S<C;S++){Q=J[S];G=Q.split(":"),Q=G[0],D=G[1];O=D?[D,Q].join("."):Q;X=i.getTrait(Q);z.push(Q);if(X!=null){l(O,X)}}if(I!=null){for(D in I){X=I[D];l(D,X)}}ee=z.filter(function(e,t){return z.indexOf(e)===t});e.traits=ee;if(N!=null){e.set(N,true,true)}if(T!=null){for(A in T){re=T[A];d(A,re,true)}}if(U!=null){e.set(U,false,true)}if(F!=null){e.bind(F,true)}if(B!=null){e.bind(B,false)}this.dispose=function(){for(A in n){$(A,true)}for(A in s){$(A,false)}I={};delete e.attributes;delete e.get;return delete e.set};null}return e}();t.exports=r},{}],22:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;n=e("./node");r=function(e){a(t,e);function t(e,i,r,n,a,o){t.__super__.constructor.call(this,e,i,r,n,a,o);this.children=[];this.on("reindex",function(e){return function(t){var i,r,n,a,o;a=e.children;o=[];for(r=0,n=a.length;r<n;r++){i=a[r];o.push(i.trigger(t))}return o}}(this))}t.prototype.add=function(e){var t;if((t=e.parent)!=null){t.remove(e)}e._index(this.children.length,this);this.children.push(e);return e._added(this)};t.prototype.remove=function(e){var t,i,r,n,a,o;if((a=e.children)!=null?a.length:void 0){e.empty()}i=this.children.indexOf(e);if(i===-1){return}this.children.splice(i,1);e._index(null);e._removed(this);o=this.children;for(t=r=0,n=o.length;r<n;t=++r){e=o[t];if(t>=i){e._index(t)}}};t.prototype.empty=function(){var e,t,i,r;e=this.children.slice().reverse();for(t=0,i=e.length;t<i;t++){r=e[t];this.remove(r)}};return t}(n);t.exports=r},{"./node":26}],23:[function(e,t,i){var r;r=function(){function e(e){this.limit=e!=null?e:10}e.prototype.iterate=function(e){var t,i,r,n;n=e.step,t=e.last;i=this.limit;while(r=n()){if(!--i){console.warn("Last iteration",typeof t==="function"?t():void 0);throw new Error("Exceeded iteration limit.")}}return null};return e}();t.exports=r},{}],24:[function(e,t,i){i.Attributes=e("./attributes");i.Group=e("./group");i.Guard=e("./guard");i.Model=e("./model");i.Node=e("./node")},{"./attributes":21,"./group":22,"./guard":23,"./model":25,"./node":26}],25:[function(e,t,i){var r,n,a,o,s,h,l,u,c,p=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++){if(t in this&&this[t]===e)return t}return-1};u=e("cssauron");r="*";o=/^#([A-Za-z0-9_])$/;a=/^\.([A-Za-z0-9_]+)$/;h=/^\[([A-Za-z0-9_]+)\]$/;l=/^[A-Za-z0-9_]+$/;n=/^<([0-9]+|<*)$/;c=null;s=function(){function e(e){var t,i,r,n,a,o,s,h,l,p,f,d,m,g,v,y,E,w,b,_,x,T;this.root=e;this.root.model=this;this.root.root=this.root;this.ids={};this.classes={};this.traits={};this.types={};this.nodes=[];this.watchers=[];this.fire=false;this.lastNode=null;this.event={type:"update"};if(c==null){c=u({tag:"type",id:"id",class:"classes.join(' ')",parent:"parent",children:"children",attr:"traits.hash[attr]"})}t=function(e){return function(e){return h(e.node)}}(this);g=function(e){return function(e){return p(e.node)}}(this);this.root.on("add",t);this.root.on("remove",g);h=function(e){return function(e){n(e);s(e);o(e);e.on("change:node",T);T(null,e,true);return f(e)}}(this);p=function(e){return function(e){E(e);_(e);b(e);y(e.id,e);v(e.classes,e);e.off("change:node",T);return f(e)}}(this);m=function(e){return function(t){var i,r,n,a;n=e.watchers;for(i=0,r=n.length;i<r;i++){a=n[i];a.match=a.matcher(t)}return null}}(this);l=function(e){return function(t){var i,r,n,a,o;a=e.watchers;for(r=0,n=a.length;r<n;r++){o=a[r];i=o.fire||(o.fire=o.match!==o.matcher(t));if(i){e.lastNode=t}e.fire||(e.fire=i)}return null}}(this);f=function(e){return function(t){var i,r,n,a,o;a=e.watchers;for(r=0,n=a.length;r<n;r++){o=a[r];i=o.fire||(o.fire=o.matcher(t));if(i){e.lastNode=t}e.fire||(e.fire=i)}return null}}(this);this.digest=function(e){return function(){var t,i,r,n;if(!e.fire){return false}r=e.watchers.slice();for(t=0,i=r.length;t<i;t++){n=r[t];if(!n.fire){continue}n.fire=false;n.handler()}e.fire=false;return true}}(this);T=function(e){return function(e,t,n){var a,o,s,h,u,c,p,f;a=n||e.changed["node.id"];o=n||e.changed["node.classes"];c=false;if(a){h=t.get("node.id");if(h!==t.id){if(!n){m(t)}c=true;if(t.id!=null){y(t.id,t)}r(h,t)}}if(o){s=(p=t.get("node.classes"))!=null?p:[];u=s.join(",");if(u!==((f=t.classes)!=null?f.klass:void 0)){s=s.slice();if(!(n||c)){m(t)}c=true;if(t.classes!=null){v(t.classes,t)}i(s,t);t.classes=s;t.classes.klass=u}}if(!n&&c){l(t)}return null}}(this);a=function(e,t,i){var r,n,a,o,s;if(t==null){return}for(r=0,a=t.length;r<a;r++){n=t[r];o=(s=e[n])!=null?s:[];o.push(i);e[n]=o}return null};w=function(e,t,i){var r,n,a,o,s;if(t==null){return}for(r=0,o=t.length;r<o;r++){a=t[r];s=e[a];n=s.indexOf(i);if(n>=0){s.splice(n,1)}if(s.length===0){delete e[a]}}return null};d=function(e){var t,i,r,n,a;if(!(e.length>0)){return}t=e.hash={};a=[];for(i=0,n=e.length;i<n;i++){r=e[i];a.push(t[r]=true)}return a};x=function(e){return delete e.hash};r=function(e){return function(t,i){if(e.ids[t]){throw new Error("Duplicate node id `"+t+"`")}if(t!=null){e.ids[t]=[i]}return i.id=t!=null?t:i._id}}(this);y=function(e){return function(t,i){if(t!=null){delete e.ids[t]}return i.id=i._id}}(this);i=function(e){return function(t,i){a(e.classes,t,i);if(t!=null){return d(t)}}}(this);v=function(e){return function(t,i){w(e.classes,t,i);if(t!=null){return x(t)}}}(this);n=function(e){return function(t){return e.nodes.push(t)}}(this);E=function(e){return function(t){return e.nodes.splice(e.nodes.indexOf(t),1)}}(this);s=function(e){return function(t){return a(e.types,[t.type],t)}}(this);_=function(e){return function(t){return w(e.types,[t.type],t)}}(this);o=function(e){return function(t){a(e.traits,t.traits,t);return d(t.traits)}}(this);b=function(e){return function(t){w(e.traits,t.traits,t);return x(t.traits)}}(this);h(this.root);this.root.trigger({type:"added"})}e.prototype.filter=function(e,t){var i,r,n,a,o;n=this._matcher(t);o=[];for(i=0,r=e.length;i<r;i++){a=e[i];if(n(a)){o.push(a)}}return o};e.prototype.ancestry=function(e,t){var i,r,n,a,o;a=[];for(i=0,r=e.length;i<r;i++){n=e[i];o=n.parent;while(o!=null){if(p.call(t,o)>=0){a.push(n);break}o=o.parent}}return a};e.prototype.select=function(e,t){var i;i=this._select(e);if(t!=null){i=this.ancestry(i,t)}i.sort(function(e,t){return t.order-e.order});return i};e.prototype.watch=function(e,t){var i;t.unwatch=function(e){return function(){return e.unwatch(t)}}(this);t.watcher=i={selector:e,handler:t,matcher:this._matcher(e),match:false,fire:false};this.watchers.push(i);return this.select(e)};e.prototype.unwatch=function(e){var t;t=e.watcher;if(t==null){return}this.watchers.splice(this.watchers.indexOf(t),1);delete e.unwatch;return delete e.watcher};e.prototype._simplify=function(e){var t,i,s,u,c,p,f,d,m,g,v,y;e=e.replace(/^\s+/,"");e=e.replace(/\s+$/,"");s=t=e===r;if(!s){s=u=(p=e.match(o))!=null?p[1]:void 0}if(!s){s=c=(f=e.match(a))!=null?f[1]:void 0}if(!s){s=v=(d=e.match(h))!=null?d[1]:void 0}if(!s){s=y=(m=e.match(l))!=null?m[0]:void 0}if(!s){s=i=(g=e.match(n))!=null?g[0]:void 0}return[t,u,c,v,y,i]};e.prototype._matcher=function(e){var t,i,r,n,a,o,s;a=this._simplify(e),t=a[0],r=a[1],n=a[2],o=a[3],s=a[4],i=a[5];if(t){return function(e){return true}}if(r){return function(e){return e.id===r}}if(n){return function(e){var t,i;return(t=e.classes)!=null?(i=t.hash)!=null?i[n]:void 0:void 0}}if(o){return function(e){var t,i;return(t=e.traits)!=null?(i=t.hash)!=null?i[o]:void 0:void 0}}if(s){return function(e){return e.type===s}}if(i){throw"Auto-link matcher unsupported"}return c(e)};e.prototype._select=function(e){var t,i,r,n,a,o,s,h,l,u;n=this._simplify(e),t=n[0],i=n[1],r=n[2],l=n[3],u=n[4];if(t){return this.nodes}if(i){return(a=this.ids[i])!=null?a:[]}if(r){return(o=this.classes[r])!=null?o:[]}if(l){return(s=this.traits[l])!=null?s:[]}if(u){return(h=this.types[u])!=null?h:[]}return this.filter(this.nodes,e)};e.prototype.getRoot=function(){return this.root};e.prototype.getLastTrigger=function(){return this.lastNode.toString()};return e}();t.exports=s},{cssauron:4}],26:[function(e,t,i){var r,n,a,o;a=e("../util");o=0;n=function(){function e(e,t,i,r,n,a){this.type=e;this._id=(++o).toString();this.configure(n,a);this.parent=this.root=this.path=this.index=null;this.set(t,true,true);this.set(i,false,true);this.bind(r,false)}e.prototype.configure=function(e,t){var i,r,n,a,o,s,h,l,u,c,p,f;f=e.traits,n=e.props,i=e.finals,r=e.freeform;if(f==null){f=(a=(o=this._config)!=null?o.traits:void 0)!=null?a:[]}if(n==null){n=(s=(h=this._config)!=null?h.props:void 0)!=null?s:{}}if(i==null){i=(l=(u=this._config)!=null?u.finals:void 0)!=null?l:{}}if(r==null){r=(c=(p=this._config)!=null?p.freeform:void 0)!=null?c:false}this._config={traits:f,props:n,finals:i,freeform:r};return this.attributes=t.apply(this,this._config)};e.prototype.dispose=function(){this.attributes.dispose();return this.attributes=null};e.prototype._added=function(e){var t;this.parent=e;this.root=e.root;t={type:"add",node:this,parent:this.parent};if(this.root){this.root.trigger(t)}t.type="added";return this.trigger(t)};e.prototype._removed=function(){var e;e={type:"remove",node:this};if(this.root){this.root.trigger(e)}e.type="removed";this.trigger(e);return this.root=this.parent=null};e.prototype._index=function(e,t){var i,r;if(t==null){t=this.parent}this.index=e;this.path=i=e!=null?((r=t!=null?t.path:void 0)!=null?r:[]).concat([e]):null;this.order=i!=null?this._encode(i):Infinity;if(this.root!=null){return this.trigger({type:"reindex"})}};e.prototype._encode=function(e){var t,i,r,n,a,o,s,h,l,u,c;s=3;u=function(e){return s/(e+s)};l=function(e){return i+(t-i)*e};t=1+1/s;i=0;for(a=0,h=e.length;a<h;a++){o=e[a];r=u(o+1);n=u(o+2);c=[l(r),l(n)],t=c[0],i=c[1]}return t};e.prototype.toString=function(){var e,t,i,r,n,a,o;e=(r=this.id)!=null?r:this._id;o=(n=this.type)!=null?n:"node";i=o;i+="#"+e;if((a=this.classes)!=null?a.length:void 0){i+="."+this.classes.join(".")}if(this.children!=null){if(t=this.children.length){return"<"+i+">("+t+")</"+o+">"}else{return"<"+i+"></"+o+">"}}else{return"<"+i+" />"}};e.prototype.toMarkup=function(e,t){var i,r,n,o,s,h,l,u,c,p,f,d,m,g,v,y;if(e==null){e=null}if(t==null){t=""}if(e&&typeof e!=="function"){e=(f=(d=this.root)!=null?d.model._matcher(e):void 0)!=null?f:function(){return true}}v=(m=this.type)!=null?m:"node";s=this.expr;u={id:this._id};g=typeof this.orig==="function"?this.orig():void 0;for(h in g){y=g[h];u[h]=y}c=function(){var e;e=[];for(h in u){y=u[h];if(!this.expr[h]){e.push(a.Pretty.JSX.prop(h,y))}}return e}.call(this);s=function(){var e;e=[];for(h in s){y=s[h];e.push(a.Pretty.JSX.bind(h,y))}return e}();i=[""];if(c.length){i=i.concat(c)}if(s.length){i=i.concat(s)}i=i.join(" ");r=t;p=function(t){return function(){var i,n;if(!((n=t.children)!=null?n.length:void 0)){return""}return i=t.children.map(function(t){return t.toMarkup(e,r)}).filter(function(e){return e!=null&&e.length}).join("\n")}}(this);if(e&&!e(this)){return p()}if(this.children!=null){l="<"+v+i+">";o="</"+v+">";r=t+"  ";n=p();if(n.length){n="\n"+n+"\n"+t}if(n==null){n=""}return t+l+n+o}else{return t+"<"+v+i+" />"}};e.prototype.print=function(e,t){return a.Pretty.print(this.toMarkup(e),t)};return e}();r=e("../util/binder");r.apply(n.prototype);t.exports=n},{"../util":166,"../util/binder":162}],27:[function(e,t,i){var r;r={dom:e("./dom")};t.exports=r},{"./dom":28}],28:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("./overlay");a=e("../util").VDOM;r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.prototype.el=a.element;t.prototype.hint=a.hint;t.prototype.apply=a.apply;t.prototype.recycle=a.recycle;t.prototype.init=function(e){return this.last=null};t.prototype.dispose=function(){this.unmount();return t.__super__.dispose.apply(this,arguments)};t.prototype.mount=function(){var e;e=document.createElement("div");e.classList.add("mathbox-overlay");this.element.appendChild(e);return this.overlay=e};t.prototype.unmount=function(e){if(this.overlay.parentNode){this.element.removeChild(this.overlay)}return this.overlay=null};t.prototype.render=function(e){var t,i,r,n,a,o;if(!this.overlay){this.mount()}if((o=typeof e)==="string"||o==="number"){e=this.el("div",null,e)}if(e instanceof Array){e=this.el("div",null,e)}i=e.type==="div";t=this.last;n=this.overlay;r=i?n:n.childNodes[0];a=i?n.parentNode:n;if(!t&&r){t=this.el("div")}this.apply(e,t,r,a,0);this.last=e;if(t!=null){this.recycle(t)}};return t}(n);t.exports=r},{"../util":166,"./overlay":31}],29:[function(e,t,i){var r;r=function(){function e(e,t){var i;this.classes=e;this.canvas=t;i=document.createElement("div");i.classList.add("mathbox-overlays");this.div=i}e.prototype.inject=function(){var e;e=this.canvas.parentNode;if(!e){throw new Error("Canvas not inserted into document.")}return e.insertBefore(this.div,this.canvas)};e.prototype.unject=function(){var e;e=this.div.parentNode;return e.removeChild(this.div)};e.prototype.getTypes=function(){return Object.keys(this.classes)};e.prototype.make=function(e,t){return new this.classes[e](this.div,t)};return e}();t.exports=r},{}],30:[function(e,t,i){i.Factory=e("./factory");i.Classes=e("./classes");i.Overlay=e("./overlay")},{"./classes":27,"./factory":29,"./overlay":31}],31:[function(e,t,i){var r;r=function(){function e(e,t){this.element=e;if(typeof this.init==="function"){this.init(t)}}e.prototype.dispose=function(){};return e}();t.exports=r},{}],32:[function(e,t,i){var r,n;n=e("../util");r=function(){function e(e,t){this.context=t;this.classes=e.Classes;this.helpers=e.Helpers}e.prototype.getTypes=function(){return Object.keys(this.classes)};e.prototype.make=function(e,t,i){var r,n,a;if(t==null){t={}}if(i==null){i=null}r=this.classes[e];if(r==null){throw new Error("Unknown primitive class `"+e+"`")}n=new r.model(e,r.defaults,t,i,r,this.context.attributes);a=new r(n,this.context,this.helpers);return n};return e}();t.exports=r},{"../util":166}],33:[function(e,t,i){i.Factory=e("./factory");i.Primitive=e("./primitive");i.Types=e("./types")},{"./factory":32,"./primitive":34,"./types":63}],34:[function(e,t,i){var r,n,a,o=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++){if(t in this&&this[t]===e)return t}return-1};n=e("../model");a=function(){e.Node=n.Node;e.Group=n.Group;e.model=e.Node;e.defaults=null;e.traits=null;e.props=null;e.finals=null;e.freeform=false;function e(e,t,i){this.node=e;this._context=t;this._renderables=this._context.renderables;this._attributes=this._context.attributes;this._shaders=this._context.shaders;this._overlays=this._context.overlays;this._animator=this._context.animator;this._types=this._attributes.types;this.node.controller=this;this.node.on("added",function(e){return function(t){return e._added()}}(this));this.node.on("removed",function(e){return function(t){return e._removed()}}(this));this.node.on("change",function(e){return function(t){if(e._root){return e.change(t.changed,t.touched)}}}(this));this.reconfigure();this._get=this.node.get.bind(this.node);this._helpers=i(this,this.node.traits);this._handlers={inherit:{},listen:[],watch:[],compute:[]};this._root=this._parent=null;this.init()}e.prototype.is=function(e){return this.traits.hash[e]};e.prototype.init=function(){};e.prototype.make=function(){};e.prototype.made=function(){};e.prototype.unmake=function(e){};e.prototype.unmade=function(){};e.prototype.change=function(e,t,i){};e.prototype.refresh=function(){return this.change({},{},true)};e.prototype.rebuild=function(){if(this._root){this._removed(true);return this._added()}};e.prototype.reconfigure=function(e){if(e!=null){this.node.configure(e,this._attributes)}this.traits=this.node.traits;return this.props=this.node.props};e.prototype._added=function(){var e,t,i,r;this._parent=(t=this.node.parent)!=null?t.controller:void 0;this._root=(i=this.node.root)!=null?i.controller:void 0;this.node.clock=(r=this._inherit("clock"))!=null?r:this._root;try{try{this.make();this.refresh();return this.made()}catch(t){e=t;this.node.print("warn");console.error(e);throw e}}catch(t){e=t;try{return this._removed()}catch(e){}}};e.prototype._removed=function(e){if(e==null){e=false}this.unmake(e);this._unlisten();this._unattach();this._uncompute();this._root=null;this._parent=null;return this.unmade(e)};e.prototype._listen=function(e,t,i,r){var n,a,o;if(r==null){r=this}if(e instanceof Array){for(n=0,a=e.length;n<a;n++){o=e[n];return this.__listen(o,t,i,r)}}return this.__listen(e,t,i,r)};e.prototype.__listen=function(e,t,i,r){var n;if(r==null){r=this}if(typeof e==="string"){e=this._inherit(e)}if(e!=null){n=i.bind(r);n.node=this.node;e.on(t,n);this._handlers.listen.push([e,t,n])}return e};e.prototype._unlisten=function(){var e,t,i,r,n,a,o;if(!this._handlers.listen.length){return}n=this._handlers.listen;for(t=0,i=n.length;t<i;t++){a=n[t],r=a[0],o=a[1],e=a[2];r.off(o,e)}return this._handlers.listen=[]};e.prototype._inherit=function(e){var t,i;t=this._handlers.inherit[e];if(t!==void 0){return t}return this._handlers.inherit[e]=(i=this._parent)!=null?i._find(e!=null?e:null):void 0};e.prototype._find=function(e){var t;if(this.is(e)){return this}return(t=this._parent)!=null?t._find(e):void 0};e.prototype._uninherit=function(){return this._handlers.inherit={}};e.prototype._attach=function(e,t,i,r,a,s,h){var l,u,c,p,f;if(r==null){r=this}if(a==null){a=this}if(s==null){s=false}if(h==null){h=false}l=function(e){if(e!=null&&o.call(e.traits,t)>=0){return e}};c=function(e){return e!=null?e.controller:void 0};u=function(e){var t,i,r,n;if(e==null){return e}r=[];for(t=0,i=e.length;t<i;t++){n=e[t];if(n instanceof Array){r=r.concat(n)}else{r.push(n)}}return r};f=function(e){return function(o){var c,p,d,m,g,v,y,E;if(typeof o==="object"){d=o;if(d!=null?d._up:void 0){o=h?d._targets:[d[0]];return o}if(d instanceof Array){o=h?u(d.map(f)):f(d[0]);return o}if(d instanceof n.Node){return[d]}}else if(typeof o==="string"&&o[0]==="<"){c=0;if(p=o.match(/^<([0-9])+$/)){c=+p[1]-1}if(o.match(/^<+$/)){c=+o.length-1}m=[];v=a.node;while(v){g=v.parent;if(!g){break}v=g.children[v.index-1];if(!(v||m.length)){v=g}d=null;if(l(v)){d=v}if(d!=null&&c--<=0){m.push(d)}if(!h&&m.length){return m}}if(h&&m.length){return m}}else if(typeof o==="string"){E=i.bind(r);e._handlers.watch.push(E);y=e._root.watch(o,E);if(!h){if(l(y[0])){d=y[0]}if(d!=null){return[d]}}else{m=y.filter(l);if(m.length){return m}}}if(!s){console.warn(e.node.toMarkup());throw new Error(e.node.toString()+" - Could not find "+t+" `"+o+"`")}if(h){return[]}else{return null}}}(this);p=u(f(e));if(h){if(p!=null){return p.map(c)}else{return null}}else{if(p!=null){return c(p[0])}else{return null}}};e.prototype._unattach=function(){var e,t,i,r;if(!this._handlers.watch.length){return}i=this._handlers.watch;for(e=0,t=i.length;e<t;e++){r=i[e];if(r!=null){r.unwatch()}}return this._handlers.watch=[]};e.prototype._compute=function(e,t){this._handlers.compute.push(e);return this.node.bind(e,t,true)};e.prototype._uncompute=function(){var e,t,i,r;if(!this._handlers.compute.length){return}r=this._handlers.compute;for(e=0,i=r.length;e<i;e++){t=r[e];this.node.unbind(t,true)}return this._handlers.compute=[]};return e}();r=e("../util/binder");r.apply(a.prototype);t.exports=a},{"../model":24,"../util/binder":162}],35:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;n=e("./parent");r=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","object","entity","visible","active"];t.prototype.make=function(){this._helpers.visible.make();return this._helpers.active.make()};t.prototype.unmake=function(){this._helpers.visible.unmake();return this._helpers.active.unmake()};return t}(n);t.exports=r},{"./parent":37}],36:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty,s=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++){if(t in this&&this[t]===e)return t}return-1};n=e("./parent");r=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind"];t.prototype.make=function(){return this._helpers.bind.make([{to:"inherit.source",trait:"node"}])};t.prototype.unmake=function(){return this._helpers.bind.unmake()};t.prototype._find=function(e){if(this.bind.source&&s.call(this.props.traits,e)>=0){return this.bind.source._inherit(e)}return t.__super__._find.apply(this,arguments)};return t}(n);t.exports=r},{"./parent":37}],37:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;n=e("../../primitive");r=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.model=n.Group;t.traits=["node"];return t}(n);t.exports=r},{"../../primitive":34}],38:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("./parent");a=e("../../../util");n=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","root","clock","scene","vertex","unit"];t.prototype.init=function(){this.size=null;this.cameraEvent={type:"root.camera"};this.preEvent={type:"root.pre"};this.updateEvent={type:"root.update"};this.renderEvent={type:"root.render"};this.postEvent={type:"root.post"};this.clockEvent={type:"clock.tick"};return this.camera=null};t.prototype.make=function(){return this._helpers.unit.make()};t.prototype.unmake=function(){return this._helpers.unit.unmake()};t.prototype.change=function(e,t,i){if(e["root.camera"]||i){this._unattach();this._attach(this.props.camera,"camera",this.setCamera,this,this,true);return this.setCamera()}};t.prototype.adopt=function(e){var t,i,r,n,a;n=e.renders;a=[];for(t=0,i=n.length;t<i;t++){r=n[t];a.push(this._context.scene.add(r))}return a};t.prototype.unadopt=function(e){var t,i,r,n,a;n=e.renders;a=[];for(t=0,i=n.length;t<i;t++){r=n[t];a.push(this._context.scene.remove(r))}return a};t.prototype.select=function(e){return this.node.model.select(e)};t.prototype.watch=function(e,t){return this.node.model.watch(e,t)};t.prototype.unwatch=function(e){return this.node.model.unwatch(e)};t.prototype.resize=function(e){this.size=e;return this.trigger({type:"root.resize",size:e})};t.prototype.getSize=function(){return this.size};t.prototype.getSpeed=function(){return this.props.speed};t.prototype.getUnit=function(){return this._helpers.unit.get()};t.prototype.getUnitUniforms=function(){return this._helpers.unit.uniforms()};t.prototype.pre=function(){this.getCamera().updateProjectionMatrix();this.trigger(this.clockEvent);return this.trigger(this.preEvent)};t.prototype.update=function(){return this.trigger(this.updateEvent)};t.prototype.render=function(){return this.trigger(this.renderEvent)};t.prototype.post=function(){return this.trigger(this.postEvent)};t.prototype.setCamera=function(){var e,t;e=(t=this.select(this.props.camera)[0])!=null?t.controller:void 0;if(this.camera!==e){this.camera=e;return this.trigger({type:"root.camera"})}};t.prototype.getCamera=function(){var e,t;return(e=(t=this.camera)!=null?t.getCamera():void 0)!=null?e:this._context.defaultCamera};t.prototype.getTime=function(){return this._context.time};t.prototype.vertex=function(e,t){if(t===2){return e.pipe("view.position")}if(t===3){return e.pipe("root.position")}return e};return t}(r);t.exports=n},{"../../../util":166,"./parent":37}],39:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("../../primitive");a=e("../../../util");n=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","source","index"];t.prototype.made=function(){return this.trigger({type:"source.rebuild"})};t.prototype.indexShader=function(e){return e.pipe(a.GLSL.identity("vec4"))};t.prototype.sourceShader=function(e){return e.pipe(a.GLSL.identity("vec4"))};t.prototype.getDimensions=function(){return{items:1,width:1,height:1,depth:1}};t.prototype.getActiveDimensions=function(){return this.getDimensions()};t.prototype.getIndexDimensions=function(){return this.getActiveDimensions()};t.prototype.getFutureDimensions=function(){return this.getActiveDimensions()};return t}(r);t.exports=n},{"../../../util":166,"../../primitive":34}],40:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("./parent");a=e("../../../util");n=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","unit"];t.prototype.make=function(){return this._helpers.unit.make()};t.prototype.unmake=function(){return this._helpers.unit.unmake()};t.prototype.getUnit=function(){return this._helpers.unit.get()};t.prototype.getUnitUniforms=function(){return this._helpers.unit.uniforms()};return t}(r);t.exports=n},{"../../../util":166,"./parent":37}],41:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("../../primitive");a=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","camera"];t.prototype.init=function(){};t.prototype.make=function(){var e;e=this._context.defaultCamera;this.camera=this.props.proxy?e:e.clone();this.euler=new THREE.Euler;return this.quat=new THREE.Quaternion};t.prototype.unmake=function(){};t.prototype.getCamera=function(){return this.camera};t.prototype.change=function(e,t,i){var r,n,o,s,h,l,u,c;if(e["camera.position"]||e["camera.quaternion"]||e["camera.rotation"]||e["camera.lookAt"]||e["camera.up"]||e["camera.fov"]||i){l=this.props,s=l.position,h=l.quaternion,u=l.rotation,o=l.lookAt,c=l.up,n=l.fov,r=l.aspect;if(s!=null){this.camera.position.copy(s)}if(h!=null||u!=null||o!=null){if(o!=null){this.camera.lookAt(o)}else{this.camera.quaternion.set(0,0,0,1)}if(u!=null){this.euler.setFromVector3(u,a.Three.swizzleToEulerOrder(this.props.eulerOrder));this.quat.setFromEuler(this.euler);this.camera.quaternion.multiply(this.quat)}if(h!=null){this.camera.quaternion.multiply(h)}}if(n!=null&&this.camera.fov!=null){this.camera.fov=n}if(c!=null){this.camera.up.copy(c)}return this.camera.updateMatrix()}};return t}(n);t.exports=r},{"../../../util":166,"../../primitive":34}],42:[function(e,t,i){var r;r={axis:e("./draw/axis"),face:e("./draw/face"),grid:e("./draw/grid"),line:e("./draw/line"),point:e("./draw/point"),strip:e("./draw/strip"),surface:e("./draw/surface"),ticks:e("./draw/ticks"),vector:e("./draw/vector"),view:e("./view/view"),cartesian:e("./view/cartesian"),cartesian4:e("./view/cartesian4"),polar:e("./view/polar"),spherical:e("./view/spherical"),stereographic:e("./view/stereographic"),stereographic4:e("./view/stereographic4"),transform:e("./transform/transform3"),transform4:e("./transform/transform4"),vertex:e("./transform/vertex"),fragment:e("./transform/fragment"),layer:e("./transform/layer"),mask:e("./transform/mask"),array:e("./data/array"),interval:e("./data/interval"),matrix:e("./data/matrix"),area:e("./data/area"),voxel:e("./data/voxel"),volume:e("./data/volume"),scale:e("./data/scale"),image:e("./data/image"),html:e("./overlay/html"),dom:e("./overlay/dom"),text:e("./text/text"),format:e("./text/format"),label:e("./text/label"),retext:e("./text/retext"),clamp:e("./operator/clamp"),grow:e("./operator/grow"),join:e("./operator/join"),lerp:e("./operator/lerp"),memo:e("./operator/memo"),readback:e("./operator/readback"),resample:e("./operator/resample"),repeat:e("./operator/repeat"),swizzle:e("./operator/swizzle"),spread:e("./operator/spread"),split:e("./operator/split"),slice:e("./operator/slice"),subdivide:e("./operator/subdivide"),transpose:e("./operator/transpose"),group:e("./base/group"),inherit:e("./base/inherit"),root:e("./base/root"),unit:e("./base/unit"),shader:e("./shader/shader"),camera:e("./camera/camera"),rtt:e("./rtt/rtt"),compose:e("./rtt/compose"),clock:e("./time/clock"),now:e("./time/now"),move:e("./present/move"),play:e("./present/play"),present:e("./present/present"),reveal:e("./present/reveal"),slide:e("./present/slide"),step:e("./present/step")};t.exports=r},{"./base/group":35,"./base/inherit":36,"./base/root":38,"./base/unit":40,"./camera/camera":41,"./data/area":43,"./data/array":44,"./data/image":47,"./data/interval":48,"./data/matrix":49,"./data/scale":50,"./data/volume":51,"./data/voxel":52,"./draw/axis":53,"./draw/face":54,"./draw/grid":55,"./draw/line":56,"./draw/point":57,"./draw/strip":58,"./draw/surface":59,"./draw/ticks":60,"./draw/vector":61,"./operator/clamp":64,"./operator/grow":65,"./operator/join":66,"./operator/lerp":67,"./operator/memo":68,"./operator/readback":70,"./operator/repeat":71,"./operator/resample":72,"./operator/slice":73,"./operator/split":74,"./operator/spread":75,"./operator/subdivide":76,"./operator/swizzle":77,"./operator/transpose":78,"./overlay/dom":79,"./overlay/html":80,"./present/move":81,"./present/play":82,"./present/present":83,"./present/reveal":84,"./present/slide":85,"./present/step":86,"./rtt/compose":89,"./rtt/rtt":90,"./shader/shader":91,"./text/format":92,"./text/label":93,"./text/retext":94,"./text/text":95,"./time/clock":96,"./time/now":97,"./transform/fragment":99,"./transform/layer":100,"./transform/mask":101,"./transform/transform3":103,"./transform/transform4":104,"./transform/vertex":105,"./view/cartesian":107,"./view/cartesian4":108,"./view/polar":109,"./view/spherical":110,"./view/stereographic":111,"./view/stereographic4":112,"./view/view":113}],43:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("./matrix");a=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","buffer","active","data","source","index","matrix","texture","raw","span:x","span:y","area","sampler:x","sampler:y"];t.prototype.updateSpan=function(){var e,t,i,r,n,a,o,s,h,l,u,c,p;i=this.props.axes;p=this.props.width;r=this.props.height;e=this.props.centeredX;t=this.props.centeredY;o=this.props.paddingX;s=this.props.paddingY;h=this._helpers.span.get("x.",i[0]);l=this._helpers.span.get("y.",i[1]);this.aX=h.x;this.aY=l.x;u=h.y-h.x;c=l.y-l.x;p+=o*2;r+=s*2;if(e){n=1/Math.max(1,p);this.aX+=u*n/2}else{n=1/Math.max(1,p-1)}if(t){a=1/Math.max(1,r);this.aY+=c*a/2}else{a=1/Math.max(1,r-1)}this.bX=u*n;this.bY=c*a;this.aX+=o*this.bX;return this.aY+=s*this.bY};t.prototype.callback=function(e){this.updateSpan();if(this.last===e){return this._callback}this.last=e;if(e.length<=5){return this._callback=function(t){return function(i,r,n){var a,o;a=t.aX+t.bX*r;o=t.aY+t.bY*n;return e(i,a,o,r,n)}}(this)}else{return this._callback=function(t){return function(i,r,n){var a,o;a=t.aX+t.bX*r;o=t.aY+t.bY*n;return e(i,a,o,r,n,t.bufferClock,t.bufferStep)}}(this)}};t.prototype.make=function(){t.__super__.make.apply(this,arguments);this._helpers.span.make();return this._listen(this,"span.range",this.updateSpan)};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);return this._helpers.span.unmake()};return t}(n);t.exports=r},{"../../../util":166,"./matrix":49}],44:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("./buffer");a=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","buffer","active","data","source","index","array","texture","raw"];t.prototype.init=function(){this.buffer=this.spec=null;this.space={width:0,history:0};this.used={width:0};this.storage="arrayBuffer";this.passthrough=function(e,t){return e(t,0,0,0)};return t.__super__.init.apply(this,arguments)};t.prototype.sourceShader=function(e){var t;t=this.getDimensions();this.alignShader(t,e);return this.buffer.shader(e)};t.prototype.getDimensions=function(){return{items:this.items,width:this.space.width,height:this.space.history,depth:1}};t.prototype.getActiveDimensions=function(){return{items:this.items,width:this.used.width,height:this.buffer.getFilled(),depth:1}};t.prototype.getFutureDimensions=function(){return{items:this.items,width:this.used.width,height:this.space.history,depth:1}};t.prototype.getRawDimensions=function(){return{items:this.items,width:space.width,height:1,depth:1}};t.prototype.make=function(){var e,i,r,n,o,s,h,l,u,c,p,f,d,m;t.__super__.make.apply(this,arguments);h=(l=this.minFilter)!=null?l:this.props.minFilter;s=(u=this.magFilter)!=null?u:this.props.magFilter;d=(c=this.type)!=null?c:this.props.type;m=this.props.width;n=this.props.history;p=this.props.bufferWidth;e=this.props.channels;o=this.props.items;r=this.spec={channels:e,items:o,width:m};this.items=r.items;this.channels=r.channels;i=this.props.data;r=a.Data.getDimensions(i,r);f=this.space;f.width=Math.max(p,r.width||1);f.history=n;return this.buffer=this._renderables.make(this.storage,{width:f.width,history:f.history,channels:e,items:o,minFilter:h,magFilter:s,type:d})};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);if(this.buffer){this.buffer.dispose();return this.buffer=this.spec=null}};t.prototype.change=function(e,t,i){var r;if(t["texture"]||e["history.history"]||e["buffer.channels"]||e["buffer.items"]||e["array.bufferWidth"]){return this.rebuild()}if(!this.buffer){return}if(e["array.width"]){r=this.props.width;if(r>this.space.width){return this.rebuild()}}if(e["data.map"]||e["data.data"]||e["data.resolve"]||e["data.expr"]||i){return this.buffer.setCallback(this.emitter())}};t.prototype.callback=function(e){if(e.length<=2){return e}else{return function(t){return function(i,r){return e(i,r,t.bufferClock,t.bufferStep)}}(this)}};t.prototype.update=function(){var e,t,i,r,n,o;if(!this.buffer){return}e=this.props.data;r=this,n=r.space,o=r.used;i=o.width;t=this.buffer.getFilled();this.syncBuffer(function(t){return function(i){var r,s,h;if(e!=null){s=a.Data.getDimensions(e,t.spec);if(s.width>n.width){i();return t.rebuild()}o.width=s.width;t.buffer.setActive(o.width);if(typeof(r=t.buffer.callback).rebind==="function"){r.rebind(e)}return t.buffer.update()}else{h=t.spec.width||1;t.buffer.setActive(h);h=t.buffer.update();return o.width=h}}}(this));if(o.width!==i||t!==this.buffer.getFilled()){return this.trigger({type:"source.resize"})}};return t}(n);t.exports=r},{"../../../util":166,"./buffer":45}],45:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("./data");a=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","buffer","active","data","source","index","texture"];t.prototype.init=function(){this.bufferSlack=0;this.bufferFrames=0;this.bufferTime=0;this.bufferDelta=0;this.bufferClock=0;this.bufferStep=0;return t.__super__.init.apply(this,arguments)};t.prototype.make=function(){t.__super__.make.apply(this,arguments);return this.clockParent=this._inherit("clock")};t.prototype.unmake=function(){return t.__super__.unmake.apply(this,arguments)};t.prototype.rawBuffer=function(){return this.buffer};t.prototype.emitter=function(){var e,i,r;r=this.props,e=r.channels,i=r.items;return t.__super__.emitter.call(this,e,i)};t.prototype.change=function(e,t,i){var r;if(e["buffer.fps"]||i){r=this.props.fps;return this.bufferSlack=r?.5/r:0}};t.prototype.syncBuffer=function(e){var t,i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b;if(!this.buffer){return}d=this.props,c=d.live,n=d.fps,s=d.hurry,u=d.limit,f=d.realtime,p=d.observe;r=this.buffer.getFilled();if(!(!r||c)){return}b=this.clockParent.getTime();if(n!=null){v=this.bufferSlack;y=b.step/b.delta;i=f?b.delta:b.step;a=1/n;E=f&&p?y*a:a;this.bufferSlack=Math.min(u/n,v+i);this.bufferDelta=i;this.bufferStep=E;o=Math.min(s,Math.floor(v*n));if(!r){o=Math.max(1,o)}w=false;t=function(){return w=true};g=[];for(h=l=0,m=o;0<=m?l<m:l>m;h=0<=m?++l:--l){this.bufferTime+=i;this.bufferClock+=E;if(w){break}e(t,this.bufferFrames++,h,o);g.push(this.bufferSlack-=a)}return g}else{this.bufferTime=b.time;this.bufferDelta=b.delta;this.bufferClock=b.clock;this.bufferStep=b.step;return e(function(){},this.bufferFrames++,0,1)}};t.prototype.alignShader=function(e,t){var i,r,n,a,o,s;s=this.props,n=s.minFilter,r=s.magFilter,i=s.aligned;a=e.items>1&&e.width>1||e.height>1&&e.depth>1;if(i||!a){return}o=n===this.node.attributes["texture.minFilter"]["enum"].nearest&&r===this.node.attributes["texture.magFilter"]["enum"].nearest;if(!o){console.warn(this.node.toString()+" - Cannot use linear min/magFilter with 3D/4D sampling")}return t.pipe("map.xyzw.align")};return t}(n);t.exports=r},{"../../../util":166,"./data":46}],46:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("../base/source");a=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","data","source","index","entity","active"];t.prototype.init=function(){this.dataEmitter=null;return this.dataSizes=null};t.prototype.emitter=function(e,t){var i,r,n,o,s,h,l,u;r=this.props.data;i=this.props.bind;o=this.props.expr;if(r!=null){s=this.dataSizes;l=a.Data.getSizes(r);if(!s||s.length!==l.length){u=a.Data.getThunk(r);this.dataEmitter=this.callback(a.Data.makeEmitter(u,t,e));this.dataSizes=l}n=this.dataEmitter}else if(typeof h!=="undefined"&&h!==null){h=this._inherit("resolve");n=this.callback(h.callback(i))}else if(o!=null){n=this.callback(o)}else{n=this.callback(this.passthrough)}return n};t.prototype.callback=function(e){return e!=null?e:function(){}};t.prototype.update=function(){};t.prototype.make=function(){this._helpers.active.make();this.first=true;return this._listen("root","root.update",function(e){return function(){if(e.isActive||e.first){e.update()}return e.first=false}}(this))};t.prototype.unmake=function(){this._helpers.active.unmake();this.dataEmitter=null;return this.dataSizes=null};return t}(n);t.exports=r},{"../../../util":166,"../base/source":39}],47:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("../base/source");a=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","source","index","texture","image","rawtex"];t.prototype.init=function(){this.width=this.height=this.texture=this.uniforms=null;return this.myTexture=false};t.prototype.sourceShader=function(e){e.pipe;e.pipe(a.GLSL.truncateVec(4,2));e.pipe("map.2d.data",this.uniforms);return e.pipe("sample.2d",this.uniforms)};t.prototype.imageShader=function(e){return e.pipe("sample.2d",this.uniforms)};t.prototype.getDimensions=function(){return{items:1,width:this.width,height:this.height,depth:1}};t.prototype.make=function(){var e;e=this._attributes.types;return this.uniforms={dataTexture:{type:"t",value:null},dataResolution:this._attributes.make(e.vec2()),dataPointer:this._attributes.make(e.vec2())}};t.prototype.unmake=function(){if(this.myTexture){this.texture.dispose()}this.width=this.height=this.texture=null;delete this.uniforms;return this.myTexture=false};t.prototype.change=function(e,t,i){var r,n,a,o,s,h,l,u;if(i){return this.updateTex()}u=(n=(a=this.props.width)!=null?a:(o=this.props.image)!=null?o.naturalWidth:void 0)!=null?n:1;r=(s=(h=this.props.height)!=null?h:(l=this.props.image)!=null?l.naturalHeight:void 0)!=null?s:1;if(this.width!==u||this.height!==r){return this.rebuild()}if(t["image"]){return this.updateTex()}};t.prototype.updateTex=function(){var e,t,i,r,n,a,o,s,h,l,u,c;this.width=(r=(n=this.props.width)!=null?n:(a=this.props.image)!=null?a.naturalWidth:void 0)!=null?r:1;this.height=(o=(s=this.props.height)!=null?s:(h=this.props.image)!=null?h.naturalHeight:void 0)!=null?o:1;e=this.props.image;c=this.props.texture;this.needFlip=false;i=(l=this.props.minFilter)!=null?l:THREE.LinearFilter;t=(u=this.props.magFilter)!=null?u:THREE.LinearFilter;if(this.myTexture){this.texture.dispose();this.myTexture=false}if(c==null&&e==null){c=new THREE.DataTexture(new Uint8Array(this.width*this.height*4),this.width,this.height,THREE.RGBAFormat,THREE.FloatType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,t,i,1);c.generateMipmaps=false;c.flipY=false;c.needsUpdate=true;this.myTexture=true}if(e!=null){c=new THREE.Texture(e,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,t,i,THREE.RGBAFormat,THREE.FloatType);c.generateMipmaps=false;c.unpackAlignment=1;c.flipY=false;c.needsUpdate=true;this.myTexture=true;this.needFlip=true}this.texture=c;this.uniforms.dataTexture.value=this.texture;if(this.needFlip){this.uniforms.dataResolution.value.set(1/this.width,-1/this.height);return this.uniforms.dataPointer.value.set(.5,-this.height+.5)}else{this.uniforms.dataResolution.value.set(1/this.width,1/this.height);return this.uniforms.dataPointer.value.set(.5,.5)}};return t}(n);t.exports=r},{"../../../util":166,"../base/source":39}],48:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;a=e("./array");n=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","buffer","active","data","source","index","texture","array","span","interval","sampler","raw"];t.prototype.updateSpan=function(){var e,t,i,r,n,a,o;t=this.props.axis;o=this.props.width;e=this.props.centered;r=this.props.padding;n=this._helpers.span.get("",t);o+=r*2;this.a=n.x;a=n.y-n.x;if(e){i=1/Math.max(1,o);this.a+=a*i/2}else{i=1/Math.max(1,o-1)}this.b=a*i;return this.a+=r*this.b};t.prototype.callback=function(e){this.updateSpan();if(this.last===e){return this._callback}this.last=e;if(e.length<=3){return this._callback=function(t){return function(i,r){var n;n=t.a+t.b*r;return e(i,n,r)}}(this)}else{return this._callback=function(t){return function(i,r){var n;n=t.a+t.b*r;return e(i,n,r,t.bufferClock,t.bufferStep)}}(this)}};t.prototype.make=function(){t.__super__.make.apply(this,arguments);this._helpers.span.make();return this._listen(this,"span.range",this.updateSpan)};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);return this._helpers.span.unmake()};return t}(a);t.exports=r},{"../../../util":166,"./array":44}],49:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("./buffer");a=e("../../../util");n=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","buffer","active","data","source","index","texture","matrix","raw"];t.prototype.init=function(){this.buffer=this.spec=null;this.space={width:0,height:0,history:0};this.used={width:0,height:0};this.storage="matrixBuffer";this.passthrough=function(e,t,i){return e(t,i,0,0)};return t.__super__.init.apply(this,arguments)};t.prototype.sourceShader=function(e){var t;t=this.getDimensions();this.alignShader(t,e);return this.buffer.shader(e)};t.prototype.getDimensions=function(){return{items:this.items,width:this.space.width,height:this.space.height,depth:this.space.history}};t.prototype.getActiveDimensions=function(){return{items:this.items,width:this.used.width,height:this.used.height,depth:this.buffer.getFilled()}};t.prototype.getFutureDimensions=function(){return{items:this.items,width:this.used.width,height:this.used.height,depth:this.space.history}};t.prototype.getRawDimensions=function(){return{items:this.items,width:this.space.width,height:this.space.height,depth:1}};t.prototype.make=function(){var e,i,r,n,o,s,h,l,u,c,p,f,d,m,g,v;t.__super__.make.apply(this,arguments);l=(u=this.minFilter)!=null?u:this.props.minFilter;h=(c=this.magFilter)!=null?c:this.props.magFilter;g=(p=this.type)!=null?p:this.props.type;v=this.props.width;n=this.props.height;o=this.props.history;f=this.props.bufferWidth;d=this.props.bufferHeight;e=this.props.channels;s=this.props.items;r=this.spec={channels:e,items:s,width:v,height:n};this.items=r.items;this.channels=r.channels;i=this.props.data;r=a.Data.getDimensions(i,r);m=this.space;m.width=Math.max(f,r.width||1);m.height=Math.max(d,r.height||1);m.history=o;return this.buffer=this._renderables.make(this.storage,{width:m.width,height:m.height,history:m.history,channels:e,items:s,minFilter:l,magFilter:h,type:g})};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);if(this.buffer){this.buffer.dispose();return this.buffer=this.spec=null}};t.prototype.change=function(e,t,i){var r,n;if(t["texture"]||e["matrix.history"]||e["buffer.channels"]||e["buffer.items"]||e["matrix.bufferWidth"]||e["matrix.bufferHeight"]){return this.rebuild()}if(!this.buffer){return}if(e["matrix.width"]){n=this.props.width;if(n>this.space.width){return this.rebuild()}}if(e["matrix.height"]){r=this.props.height;if(r>this.space.height){return this.rebuild()}}if(e["data.map"]||e["data.data"]||e["data.resolve"]||e["data.expr"]||i){return this.buffer.setCallback(this.emitter())}};t.prototype.callback=function(e){if(e.length<=3){return e}else{return function(t){return function(i,r,n){return e(i,r,n,t.bufferClock,t.bufferStep)}}(this)}};t.prototype.update=function(){var e,t,i,r,n,o,s;if(!this.buffer){return}e=this.props.data;r=this,n=r.space,o=r.used;s=o.width;i=o.height;t=this.buffer.getFilled();this.syncBuffer(function(t){return function(i){var r,s,h,l,u,c;if(e!=null){h=a.Data.getDimensions(e,t.spec);if(h.width>n.width||h.height>n.height){i();return t.rebuild()}o.width=h.width;o.height=h.height;t.buffer.setActive(o.width,o.height);if(typeof(s=t.buffer.callback).rebind==="function"){s.rebind(e)}return t.buffer.update()}else{c=t.spec.width||1;l=t.spec.height||1;t.buffer.setActive(c,l);u=t.buffer.update();o.width=r=c;o.height=Math.ceil(u/r);if(o.height===1){return o.width=u}}}}(this));if(o.width!==s||o.height!==i||t!==this.buffer.getFilled()){return this.trigger({type:"source.resize"})}};return t}(r);t.exports=n},{"../../../util":166,"./buffer":45}],50:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("../base/source");a=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","source","index","interval","span","scale","raw","origin"];t.prototype.init=function(){return this.used=this.space=this.scaleAxis=this.sampler=null};t.prototype.rawBuffer=function(){return this.buffer};t.prototype.sourceShader=function(e){return e.pipe(this.sampler)};t.prototype.getDimensions=function(){return{items:1,width:this.space,height:1,depth:1}};t.prototype.getActiveDimensions=function(){return{items:1,width:this.used,height:this.buffer.getFilled(),depth:1}};t.prototype.getRawDimensions=function(){return this.getDimensions()};t.prototype.make=function(){var e,t,i;this.space=i=this._helpers.scale.divide("");this.buffer=this._renderables.make("dataBuffer",{width:i,channels:1,items:1});t={scaleAxis:this._attributes.make(this._types.vec4()),scaleOffset:this._attributes.make(this._types.vec4())};this.scaleAxis=t.scaleAxis.value;this.scaleOffset=t.scaleOffset.value;e=this.sampler=this._shaders.shader();e.require(this.buffer.shader(this._shaders.shader(),1));e.pipe("scale.position",t);this._helpers.span.make();return this._listen(this,"span.range",this.updateRanges)};t.prototype.unmake=function(){this.scaleAxis=null;return this._helpers.span.unmake()};t.prototype.change=function(e,t,i){if(e["scale.divide"]){return this.rebuild()}if(t["view"]||t["interval"]||t["span"]||t["scale"]||i){return this.updateRanges()}};t.prototype.updateRanges=function(){var e,t,i,r,n,o,s,h;h=this.used;o=this.props,e=o.axis,r=o.origin;n=this._helpers.span.get("",e);i=n.x;t=n.y;s=this._helpers.scale.generate("",this.buffer,i,t);a.Axis.setDimension(this.scaleAxis,e);a.Axis.setOrigin(this.scaleOffset,e,r);this.used=s.length;if(this.used!==h){return this.trigger({type:"source.resize"})}};return t}(n);t.exports=r},{"../../../util":166,"../base/source":39}],51:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;a=e("./voxel");r=e("../../../util");n=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","buffer","active","data","source","index","texture","voxel","span:x","span:y","span:z","volume","sampler:x","sampler:y","sampler:z","raw"];t.prototype.updateSpan=function(){var e,t,i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y;n=this.props.axes;y=this.props.width;a=this.props.height;r=this.props.depth;e=this.props.centeredX;t=this.props.centeredY;i=this.props.centeredZ;l=this.props.paddingX;u=this.props.paddingY;c=this.props.paddingZ;p=this._helpers.span.get("x.",n[0]);f=this._helpers.span.get("y.",n[1]);d=this._helpers.span.get("z.",n[2]);this.aX=p.x;this.aY=f.x;this.aZ=d.x;m=p.y-p.x;g=f.y-f.x;v=d.y-d.x;y+=l*2;a+=u*2;r+=c*2;if(e){o=1/Math.max(1,y);this.aX+=m*o/2}else{o=1/Math.max(1,y-1)}if(t){s=1/Math.max(1,a);this.aY+=g*s/2}else{s=1/Math.max(1,a-1)}if(i){h=1/Math.max(1,r);this.aZ+=v*h/2}else{h=1/Math.max(1,r-1)}this.bX=m*o;this.bY=g*s;this.bZ=v*h;this.aX+=this.bX*l;this.aY+=this.bY*u;return this.aZ+=this.bZ*u};t.prototype.callback=function(e){this.updateSpan();if(this.last===e){return this._callback}this.last=e;if(e.length<=7){return this._callback=function(t){return function(i,r,n,a){var o,s,h;o=t.aX+t.bX*r;s=t.aY+t.bY*n;h=t.aZ+t.bZ*a;return e(i,o,s,h,r,n,a)}}(this)}else{return this._callback=function(t){return function(i,r,n,a){var o,s,h;o=t.aX+t.bX*r;s=t.aY+t.bY*n;h=t.aZ+t.bZ*a;return e(i,o,s,h,r,n,a,t.bufferClock,t.bufferStep)}}(this)}};t.prototype.make=function(){t.__super__.make.apply(this,arguments);this._helpers.span.make();return this._listen(this,"span.range",this.updateSpan)};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);return this._helpers.span.unmake()};return t}(a);t.exports=n},{"../../../util":166,"./voxel":52}],52:[function(e,t,i){var r,n,a,o=function(e,t){return function(){return e.apply(t,arguments)}},s=function(e,t){for(var i in t){if(h.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},h={}.hasOwnProperty;r=e("./buffer");n=e("../../../util");a=function(e){s(t,e);function t(){this.update=o(this.update,this);return t.__super__.constructor.apply(this,arguments)}t.traits=["node","buffer","active","data","source","index","texture","voxel","raw"];t.prototype.init=function(){this.buffer=this.spec=null;this.space={width:0,height:0,depth:0};this.used={width:0,height:0,depth:0};this.storage="voxelBuffer";this.passthrough=function(e,t,i,r){return e(t,i,r,0)};return t.__super__.init.apply(this,arguments)};t.prototype.sourceShader=function(e){var t;t=this.getDimensions();this.alignShader(t,e);return this.buffer.shader(e)};t.prototype.getDimensions=function(){return{items:this.items,width:this.space.width,height:this.space.height,depth:this.space.depth}};t.prototype.getActiveDimensions=function(){return{items:this.items,width:this.used.width,height:this.used.height,depth:this.used.depth*this.buffer.getFilled()}};t.prototype.getRawDimensions=function(){return this.getDimensions()};t.prototype.make=function(){var e,i,r,a,o,s,h,l,u,c,p,f,d,m,g,v,y;t.__super__.make.apply(this,arguments);l=(u=this.minFilter)!=null?u:this.props.minFilter;h=(c=this.magFilter)!=null?c:this.props.magFilter;v=(p=this.type)!=null?p:this.props.type;y=this.props.width;o=this.props.height;r=this.props.depth;f=this.props.bufferWidth;d=this.props.bufferHeight;m=this.props.bufferDepth;e=this.props.channels;s=this.props.items;a=this.spec={channels:e,items:s,width:y,height:o,depth:r};this.items=a.items;this.channels=a.channels;i=this.props.data;a=n.Data.getDimensions(i,a);g=this.space;g.width=Math.max(f,a.width||1);g.height=Math.max(d,a.height||1);g.depth=Math.max(m,a.depth||1);return this.buffer=this._renderables.make(this.storage,{width:g.width,height:g.height,depth:g.depth,channels:e,items:s,minFilter:l,magFilter:h,type:v})};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);if(this.buffer){this.buffer.dispose();return this.buffer=this.spec=null}};t.prototype.change=function(e,t,i){var r,n,a;if(t["texture"]||e["buffer.channels"]||e["buffer.items"]||e["voxel.bufferWidth"]||e["voxel.bufferHeight"]||e["voxel.bufferDepth"]){return this.rebuild()}if(!this.buffer){return}if(e["voxel.width"]){a=this.props.width;if(a>this.space.width){return this.rebuild()}}if(e["voxel.height"]){n=this.props.height;if(n>this.space.height){return this.rebuild()}}if(e["voxel.depth"]){r=this.props.depth;if(r>this.space.depth){return this.rebuild()}}if(e["data.map"]||e["data.data"]||e["data.resolve"]||e["data.expr"]||i){return this.buffer.setCallback(this.emitter())}};t.prototype.callback=function(e){if(e.length<=4){return e}else{return function(t){return function(i,r,n,a){return e(i,r,n,a,t.bufferClock,t.bufferStep)}}(this)}};t.prototype.update=function(){var e,t,i,r,a,o,s,h;if(!this.buffer){return}t=this.props.data;a=this,o=a.space,s=a.used;h=s.width;r=s.height;e=s.depth;i=this.buffer.getFilled();this.syncBuffer(function(e){return function(i){var r,a,h,l,u,c,p,f;if(t!=null){u=n.Data.getDimensions(t,e.spec);if(u.width>o.width||u.height>o.height||u.depth>o.depth){i();return e.rebuild()}s.width=u.width;s.height=u.height;s.depth=u.depth;e.buffer.setActive(s.width,s.height,s.depth);if(typeof(h=e.buffer.callback).rebind==="function"){h.rebind(t)}return e.buffer.update()}else{f=e.spec.width||1;c=e.spec.height||1;l=e.spec.depth||1;e.buffer.setActive(f,c,l);p=e.buffer.update();s.width=a=f;s.height=r=c;s.depth=Math.ceil(p/a/r);if(s.depth===1){s.height=Math.ceil(p/a);if(s.height===1){return s.width=p}}}}}(this));if(s.width!==h||s.height!==r||s.depth!==e||i!==this.buffer.getFilled()){return this.trigger({type:"source.resize"})}};return t}(r);t.exports=a},{"../../../util":166,"./buffer":45}],53:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("../../primitive");a=e("../../../util");r=function(e){o(t,e);t.traits=["node","object","visible","style","line","axis","span","interval","arrow","position","origin","shade"];t.defaults={end:true,zBias:-1};function t(e,i,r){t.__super__.constructor.call(this,e,i,r);this.axisPosition=this.axisStep=this.resolution=this.line=this.arrows=null}t.prototype.make=function(){var e,t,i,r,n,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b;c={axisPosition:this._attributes.make(this._types.vec4()),axisStep:this._attributes.make(this._types.vec4())};this.axisPosition=c.axisPosition.value;this.axisStep=c.axisStep.value;u=this._shaders.shader();u.pipe("axis.position",c);u=this._helpers.position.pipeline(u);y=this._helpers.style.uniforms();s=this._helpers.line.uniforms();e=this._helpers.arrow.uniforms();b=this._inherit("unit").getUnitUniforms();r=this.props.detail;m=r+1;this.resolution=1/r;p=this.props,g=p.start,n=p.end;f=this.props,v=f.stroke,o=f.join;h=this._helpers.object.mask();l=this._helpers.shade.pipeline()||false;d=this.props,i=d.crossed,t=d.axis;if(!i&&h!=null&&t>1){E=["x000","y000","z000","w000"][t];h=this._helpers.position.swizzle(h,E)}w=a.JS.merge(e,s,y,b);this.line=this._renderables.make("line",{uniforms:w,samples:m,position:u,clip:g||n,stroke:v,join:o,mask:h,material:l});this.arrows=[];if(g){this.arrows.push(this._renderables.make("arrow",{uniforms:w,flip:true,samples:m,position:u,mask:h,material:l}))}if(n){this.arrows.push(this._renderables.make("arrow",{uniforms:w,samples:m,position:u,mask:h,material:l}))}this._helpers.visible.make();this._helpers.object.make(this.arrows.concat([this.line]));this._helpers.span.make();return this._listen(this,"span.range",this.updateRanges)};t.prototype.unmake=function(){this._helpers.visible.unmake();this._helpers.object.unmake();return this._helpers.span.unmake()};t.prototype.change=function(e,t,i){if(e["axis.detail"]||e["line.stroke"]||e["line.join"]||e["axis.crossed"]||e["interval.axis"]&&this.props.crossed){return this.rebuild()}if(t["interval"]||t["span"]||t["view"]||i){return this.updateRanges()}};t.prototype.updateRanges=function(){var e,t,i,r,n,o;o=this.props,e=o.axis,r=o.origin;n=this._helpers.span.get("",e);i=n.x;t=n.y;a.Axis.setDimension(this.axisPosition,e).multiplyScalar(i);a.Axis.setDimension(this.axisStep,e).multiplyScalar((t-i)*this.resolution);return a.Axis.addOrigin(this.axisPosition,e,r)};return t}(n);t.exports=r},{"../../../util":166,"../../primitive":34}],54:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("../../primitive");a=e("../../../util");r=function(e){o(t,e);t.traits=["node","object","visible","style","line","mesh","face","geometry","position","bind","shade"];function t(e,i,r){t.__super__.constructor.call(this,e,i,r);this.face=null}t.prototype.resize=function(){var e,t,i,r,n,a;if(this.bind.points==null){return}t=this.bind.points.getActiveDimensions();r=t.items,a=t.width,i=t.height,e=t.depth;if(this.face){this.face.geometry.clip(a,i,e,r)}if(this.line){this.line.geometry.clip(r,a,i,e)}if(this.bind.map!=null){n=this.bind.map.getActiveDimensions();if(this.face){return this.face.geometry.map(n.width,n.height,n.depth,n.items)}}};t.prototype.make=function(){var e,t,i,r,n,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k;this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"},{to:"mesh.map",trait:"source"}]);if(this.bind.points==null){return}g=this.bind.points.sourceShader(this._shaders.shader());g=this._helpers.position.pipeline(g);b=this._helpers.style.uniforms();c=this._helpers.line.uniforms();T=this._inherit("unit").getUnitUniforms();k={};k.styleZBias=this._attributes.make(this._types.number());this.wireZBias=k.styleZBias;i=this.bind.points.getDimensions();s=i.items,R=i.width,o=i.height,t=i.depth;v=this.props,l=v.line,E=v.shaded,n=v.fill,w=v.stroke,h=v.join;if(this.bind.colors){e=this._shaders.shader();this.bind.colors.sourceShader(e)}f=this._helpers.object.mask();p=this._helpers.shade.map((y=this.bind.map)!=null?y.sourceShader(this._shaders.shader()):void 0);d=this._helpers.shade.pipeline();r=d||E;u=d||false;m=[];if(l){_=this._shaders.shader();_.pipe(a.GLSL.swizzleVec4("yzwx"));_.pipe(g);x=a.JS.merge(T,c,b,k);this.line=this._renderables.make("line",{uniforms:x,samples:s,strips:R,ribbons:o,layers:t,position:_,color:e,stroke:w,join:h,material:u,mask:f,closed:true});m.push(this.line)}if(n){x=a.JS.merge(T,b,{});this.face=this._renderables.make("face",{uniforms:x,width:R,height:o,depth:t,items:s,position:g,color:e,material:r,mask:f,map:p});m.push(this.face)}this._helpers.visible.make();return this._helpers.object.make(m)};t.prototype.made=function(){return this.resize()};t.prototype.unmake=function(){this._helpers.bind.unmake();this._helpers.visible.unmake();this._helpers.object.unmake();return this.face=this.line=null};t.prototype.change=function(e,t,i){var r,n,a,o;if(e["geometry.points"]||t["mesh"]){return this.rebuild()}if(e["style.zBias"]||e["mesh.lineBias"]||i){a=this.props,r=a.fill,o=a.zBias,n=a.lineBias;return this.wireZBias.value=o+(r?n:0)}};return t}(n);t.exports=r},{"../../../util":166,"../../primitive":34}],55:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("../../primitive");a=e("../../../util");r=function(e){o(t,e);t.traits=["node","object","visible","style","line","grid","area","position","origin","shade","axis:x","axis:y","scale:x","scale:y","span:x","span:y"];t.defaults={width:1,zBias:-2};function t(e,i,r){t.__super__.constructor.call(this,e,i,r);this.axes=null}t.prototype.make=function(){var e,t,i,r,n,o,s,h,l,u,c,p,f;h=this._helpers.object.mask();l=this._helpers.shade.pipeline()||false;t=function(e){return function(t,i,n){var o,s,u,c,f,d,m,g,v,y,E,w,b,_;s=e._get(t+"axis.detail");v=s+1;g=1/s;y=e._helpers.scale.divide(i);o=e._renderables.make("dataBuffer",{width:y,channels:1});m={gridPosition:e._attributes.make(e._types.vec4()),gridStep:e._attributes.make(e._types.vec4()),gridAxis:e._attributes.make(e._types.vec4())};_={gridPosition:m.gridPosition.value,gridStep:m.gridStep.value,gridAxis:m.gridAxis.value};f=d=e._shaders.shader();if(n!=null&&h!=null){h=e._helpers.position.swizzle(h,n)}f.require(o.shader(e._shaders.shader(),2));f.pipe("grid.position",m);d=e._helpers.position.pipeline(f);E=e._helpers.style.uniforms();c=e._helpers.line.uniforms();b=e._inherit("unit").getUnitUniforms();w=a.JS.merge(c,E,b);u=e._renderables.make("line",{uniforms:w,samples:v,strips:y,position:d,stroke:p,join:r,mask:h,material:l});return{first:t,second:i,resolution:g,samples:v,line:u,buffer:o,values:_}}}(this);u=this.props,n=u.lineX,o=u.lineY,i=u.crossed,e=u.axes;f=["0000","x000","y000","z000","w000"][e[1]];c=this.props,p=c.stroke,r=c.join;this.axes=[];n&&this.axes.push(t("x.","y.",null));o&&this.axes.push(t("y.","x.",i?null:f));s=function(){var e,i,r,n;r=this.axes;n=[];for(e=0,i=r.length;e<i;e++){t=r[e];n.push(t.line)}return n}.call(this);this._helpers.visible.make();this._helpers.object.make(s);this._helpers.span.make();return this._listen(this,"span.range",this.updateRanges)};t.prototype.unmake=function(){var e,t,i,r;this._helpers.visible.unmake();this._helpers.object.unmake();this._helpers.span.unmake();r=this.axes;for(t=0,i=r.length;t<i;t++){e=r[t];e.buffer.dispose()}return this.axes=null};t.prototype.change=function(e,t,i){if(e["x.axis.detail"]||e["y.axis.detail"]||e["x.axis.factor"]||e["y.axis.factor"]||e["grid.lineX"]||e["grid.lineY"]||e["line.stroke"]||e["line.join"]||e["grid.crossed"]||e["grid.axes"]&&this.props.crossed){return this.rebuild()}if(t["x"]||t["y"]||t["area"]||t["grid"]||t["view"]||i){return this.updateRanges()}};t.prototype.updateRanges=function(){var e,t,i,r,n,o,s,h,l;t=function(t){return function(i,r,o,s,h){var l,u,c,p,f,d,m,g,v,y,E;u=h.first,v=h.second,m=h.resolution,g=h.samples,c=h.line,l=h.buffer,E=h.values;f=o.x;p=o.y;a.Axis.setDimension(E.gridPosition,i).multiplyScalar(f);a.Axis.setDimension(E.gridStep,i).multiplyScalar((p-f)*m);a.Axis.addOrigin(E.gridPosition,e,n);f=s.x;p=s.y;y=t._helpers.scale.generate(v,l,f,p);a.Axis.setDimension(E.gridAxis,r);d=y.length;return c.geometry.clip(g,d,1,1)}}(this);h=this.props,e=h.axes,n=h.origin;o=this._helpers.span.get("x.",e[0]);s=this._helpers.span.get("y.",e[1]);l=this.props,i=l.lineX,r=l.lineY;if(i){t(e[0],e[1],o,s,this.axes[0])}if(r){return t(e[1],e[0],s,o,this.axes[+i])}};return t}(n);t.exports=r},{"../../../util":166,"../../primitive":34}],56:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("../../primitive");a=e("../../../util");r=function(e){o(t,e);t.traits=["node","object","visible","style","line","arrow","geometry","position","bind","shade"];function t(e,i,r){t.__super__.constructor.call(this,e,i,r);this.line=this.arrows=null}t.prototype.resize=function(){var e,t,i,r,n,a,o,s,h,l;if(this.bind.points==null){return}t=this.bind.points.getActiveDimensions();h=t.width;l=t.height;s=t.depth;r=t.items;this.line.geometry.clip(h,l,s,r);a=this.arrows;o=[];for(i=0,n=a.length;i<n;i++){e=a[i];o.push(e.geometry.clip(h,l,s,r))}return o};t.prototype.make=function(){var e,t,i,r,n,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b;this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"}]);if(this.bind.points==null){return}u=this._shaders.shader();u=this.bind.points.sourceShader(u);u=this._helpers.position.pipeline(u);E=this._helpers.style.uniforms();s=this._helpers.line.uniforms();e=this._helpers.arrow.uniforms();b=this._inherit("unit").getUnitUniforms();p=this.props,g=p.start,r=p.end;f=this.props,y=f.stroke,n=f.join,c=f.proximity;this.proximity=c;i=this.bind.points.getDimensions();m=i.width;v=i.height;d=i.depth;o=i.items;if(this.bind.colors){t=this._shaders.shader();this.bind.colors.sourceShader(t)}h=this._helpers.object.mask();l=this._helpers.shade.pipeline()||false;w=a.JS.merge(e,s,E,b);this.line=this._renderables.make("line",{uniforms:w,samples:m,strips:v,ribbons:d,layers:o,position:u,color:t,clip:g||r,stroke:y,join:n,proximity:c,mask:h,material:l});this.arrows=[];if(g){this.arrows.push(this._renderables.make("arrow",{uniforms:w,flip:true,samples:m,strips:v,ribbons:d,layers:o,position:u,color:t,mask:h,material:l}))}if(r){this.arrows.push(this._renderables.make("arrow",{uniforms:w,samples:m,strips:v,ribbons:d,layers:o,position:u,color:t,mask:h,material:l}))}this._helpers.visible.make();return this._helpers.object.make(this.arrows.concat([this.line]))};t.prototype.made=function(){return this.resize()};t.prototype.unmake=function(){this._helpers.bind.unmake();this._helpers.visible.unmake();this._helpers.object.unmake();return this.line=this.arrows=null};t.prototype.change=function(e,t,i){if(e["geometry.points"]||e["line.stroke"]||e["line.join"]||e["arrow.start"]||e["arrow.end"]){return this.rebuild()}if(e["line.proximity"]){if(this.proximity!=null!==(this.props.proximity!=null)){return this.rebuild()}}};return t}(n);t.exports=r},{"../../../util":166,"../../primitive":34}],57:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("../../primitive");a=e("../../../util");r=function(e){o(t,e);t.traits=["node","object","visible","style","point","geometry","position","bind","shade"];function t(e,i,r){t.__super__.constructor.call(this,e,i,r);this.point=null}t.prototype.resize=function(){var e,t,i,r,n;if(this.bind.points==null){return}t=this.bind.points.getActiveDimensions();r=t.items,n=t.width,i=t.height,e=t.depth;return this.point.geometry.clip(n,i,e,r)};t.prototype.make=function(){var e,t,i,r,n,o,s,h,l,u,c,p,f,d,m,g,v;this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"},{to:"point.sizes",trait:"source"}]);if(this.bind.points==null){return}c=this._shaders.shader();c=this.bind.points.sourceShader(c);c=this._helpers.position.pipeline(c);i=this.bind.points.getDimensions();o=i.items,v=i.width,n=i.height,t=i.depth;d=this._helpers.style.uniforms();u=this._helpers.point.uniforms();g=this._inherit("unit").getUnitUniforms();if(this.bind.colors){e=this._shaders.shader();this.bind.colors.sourceShader(e)}if(this.bind.sizes){f=this._shaders.shader();this.bind.sizes.sourceShader(f)}s=this._helpers.object.mask();h=this._helpers.shade.pipeline()||false;p=this.props.shape;r=this.props.fill;l=this.props.optical;m=a.JS.merge(g,u,d);this.point=this._renderables.make("point",{uniforms:m,width:v,height:n,depth:t,items:o,position:c,color:e,size:f,shape:p,optical:l,fill:r,mask:s,material:h});this._helpers.visible.make();return this._helpers.object.make([this.point])};t.prototype.made=function(){return this.resize()};t.prototype.unmake=function(){this._helpers.bind.unmake();this._helpers.visible.unmake();this._helpers.object.unmake();return this.point=null};t.prototype.change=function(e,t,i){if(e["geometry.points"]||e["point.shape"]||e["point.fill"]){return this.rebuild()}};return t}(n);t.exports=r},{"../../../util":166,"../../primitive":34}],58:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("../../primitive");a=e("../../../util");n=function(e){o(t,e);t.traits=["node","object","visible","style","line","mesh","strip","geometry","position","bind","shade"];function t(e,i,r){t.__super__.constructor.call(this,e,i,r);this.strip=null}t.prototype.resize=function(){var e,t,i,r,n,a;if(this.bind.points==null){return}t=this.bind.points.getActiveDimensions();r=t.items,a=t.width,i=t.height,e=t.depth;if(this.strip){this.strip.geometry.clip(a,i,e,r)}if(this.line){this.line.geometry.clip(r,a,i,e)}if(this.bind.map!=null){n=this.bind.map.getActiveDimensions();if(this.strip){return this.strip.geometry.map(n.width,n.height,n.depth,n.items)}}};t.prototype.make=function(){var e,t,i,r,n,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k;this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"},{to:"mesh.map",trait:"source"}]);if(this.bind.points==null){return}g=this._shaders.shader();g=this.bind.points.sourceShader(g);g=this._helpers.position.pipeline(g);b=this._helpers.style.uniforms();c=this._helpers.line.uniforms();T=this._inherit("unit").getUnitUniforms();l=this.props.line;E=this.props.shaded;n=this.props.fill;k={};k.styleZBias=this._attributes.make(this._types.number());this.wireZBias=k.styleZBias;i=this.bind.points.getDimensions();s=i.items,R=i.width,o=i.height,t=i.depth;v=this.props,l=v.line,E=v.shaded,n=v.fill,w=v.stroke,h=v.join;if(this.bind.colors){e=this._shaders.shader();e=this.bind.colors.sourceShader(e)}f=this._helpers.object.mask();p=this._helpers.shade.map((y=this.bind.map)!=null?y.sourceShader(this._shaders.shader()):void 0);d=this._helpers.shade.pipeline();r=d||E;u=d||false;m=[];if(l){_=this._shaders.shader();_.pipe(a.GLSL.swizzleVec4("yzwx"));_.pipe(g);x=a.JS.merge(T,c,b,k);this.line=this._renderables.make("line",{uniforms:x,samples:s,strips:R,ribbons:o,layers:t,position:_,color:e,stroke:w,join:h,mask:f,material:u});m.push(this.line)}if(n){x=a.JS.merge(b,{});this.strip=this._renderables.make("strip",{uniforms:x,width:R,height:o,depth:t,items:s,position:g,color:e,material:r});m.push(this.strip)}this._helpers.visible.make();return this._helpers.object.make(m)};t.prototype.made=function(){return this.resize()};t.prototype.unmake=function(){this._helpers.bind.unmake();this._helpers.visible.unmake();this._helpers.object.unmake();return this.strip=null};t.prototype.change=function(e,t,i){var r,n,a,o;if(e["geometry.points"]||t["mesh"]){return this.rebuild()}if(e["style.zBias"]||e["mesh.lineBias"]||i){a=this.props,r=a.fill,o=a.zBias,n=a.lineBias;return this.wireZBias.value=o+(r?n:0)}};return t}(r);t.exports=n},{"../../../util":166,"../../primitive":34}],59:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("../../primitive");a=e("../../../util");n=function(e){o(t,e);t.traits=["node","object","visible","style","line","mesh","geometry","surface","position","grid","bind","shade"];t.defaults={lineX:false,lineY:false};function t(e,i,r){t.__super__.constructor.call(this,e,i,r);this.lineX=this.lineY=this.surface=null}t.prototype.resize=function(){var e,t,i,r,n,a;if(this.bind.points==null){return}t=this.bind.points.getActiveDimensions();a=t.width,i=t.height,e=t.depth,r=t.items;if(this.surface){this.surface.geometry.clip(a,i,e,r)}if(this.lineX){this.lineX.geometry.clip(a,i,e,r)}if(this.lineY){this.lineY.geometry.clip(i,a,e,r)}if(this.bind.map!=null){n=this.bind.map.getActiveDimensions();if(this.surface){return this.surface.geometry.map(n.width,n.height,n.depth,n.items)}}};t.prototype.make=function(){var e,t,i,r,n,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M,S,A,C,z,P,L,O;this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"},{to:"mesh.map",trait:"source"}]);if(this.bind.points==null){return}w=this._shaders.shader();w=this.bind.points.sourceShader(w);w=this._helpers.position.pipeline(w);H=this._helpers.style.uniforms();L=this._helpers.style.uniforms();f=this._helpers.line.uniforms();M=this._helpers.surface.uniforms();z=this._inherit("unit").getUnitUniforms();L.styleColor=this._attributes.make(this._types.color());L.styleZBias=this._attributes.make(this._types.number());this.wireColor=L.styleColor.value;this.wireZBias=L.styleZBias;o=this.bind.points.getDimensions();P=o.width,l=o.height,n=o.depth,u=o.items;_=this.props,R=_.shaded,h=_.fill,d=_.lineX,m=_.lineY,e=_.closedX,t=_.closedY,k=_.stroke,c=_.join,b=_.proximity,r=_.crossed;E=[];this.proximity=b;if(this.bind.colors){i=this._shaders.shader();this.bind.colors.sourceShader(i)}v=this._helpers.object.mask();g=this._helpers.shade.map((x=this.bind.map)!=null?x.sourceShader(this._shaders.shader()):void 0);y=this._helpers.shade.pipeline();s=y||R;p=y||false;T=this._helpers.position,S=T.swizzle,A=T.swizzle2;C=a.JS.merge(z,f,H,L);O=d||m?-50:0;if(d){this.lineX=this._renderables.make("line",{uniforms:C,samples:P,strips:l,ribbons:n,layers:u,position:w,color:i,zUnits:-O,stroke:k,join:c,mask:v,material:p,proximity:b,closed:e||closed});E.push(this.lineX)}if(m){this.lineY=this._renderables.make("line",{uniforms:C,samples:l,strips:P,ribbons:n,layers:u,position:A(w,"yxzw","yxzw"),color:S(i,"yxzw"),zUnits:-O,stroke:k,join:c,mask:S(v,r?"xyzw":"yxzw"),material:p,proximity:b,closed:t||closed});E.push(this.lineY)}if(h){C=a.JS.merge(z,M,H);this.surface=this._renderables.make("surface",{uniforms:C,width:P,height:l,surfaces:n,layers:u,position:w,color:i,zUnits:O,stroke:k,material:s,mask:v,map:g,intUV:true,closedX:e||closed,closedY:t||closed});E.push(this.surface)}this._helpers.visible.make();return this._helpers.object.make(E)};t.prototype.made=function(){return this.resize()};t.prototype.unmake=function(){this._helpers.bind.unmake();this._helpers.visible.unmake();this._helpers.object.unmake();return this.lineX=this.lineY=this.surface=null};t.prototype.change=function(e,t,i){var r,n,a,o,s;if(e["geometry.points"]||e["mesh.shaded"]||e["mesh.fill"]||e["line.stroke"]||e["line.join"]||t["grid"]){return this.rebuild()}if(e["style.color"]||e["style.zBias"]||e["mesh.fill"]||e["mesh.lineBias"]||i){o=this.props,n=o.fill,r=o.color,s=o.zBias,a=o.lineBias;this.wireZBias.value=s+(n?a:0);this.wireColor.copy(r)}if(e["line.proximity"]){if(this.proximity!=null!==(this.props.proximity!=null)){return this.rebuild()}}};return t}(r);t.exports=n},{"../../../util":166,"../../primitive":34}],60:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("../../primitive");a=e("../../../util");n=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","object","visible","style","line","ticks","geometry","position","bind","shade"];t.prototype.init=function(){return this.tickStrip=this.line=null};t.prototype.resize=function(){var e,t,i,r,n;if(this.bind.points==null){return}t=this.bind.points.getActiveDimensions();e=+(t.items>0);n=t.width*e;r=t.height*e;i=t.depth*e;this.line.geometry.clip(2,n,r,i);return this.tickStrip.set(0,n-1)};t.prototype.make=function(){var e,t,i,r,n,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w;this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"}]);if(this.bind.points==null){return}g=this._helpers.style.uniforms();n=this._helpers.line.uniforms();w=this._inherit("unit").getUnitUniforms();E=a.JS.merge(n,g,w);u={tickEpsilon:this.node.attributes["ticks.epsilon"],tickSize:this.node.attributes["ticks.size"],tickNormal:this.node.attributes["ticks.normal"],tickStrip:this._attributes.make(this._types.vec2(0,0)),worldUnit:E.worldUnit,focusDepth:E.focusDepth};this.tickStrip=u.tickStrip.value;h=l=this._shaders.shader();h.require(this.bind.points.sourceShader(this._shaders.shader()));h.require(this._helpers.position.pipeline(this._shaders.shader()));h.pipe("ticks.position",u);c=this.props,m=c.stroke,i=c.join;t=this.bind.points.getDimensions();d=t.width;f=t.height;r=t.depth;if(this.bind.colors){e=this._shaders.shader();this.bind.colors.sourceShader(e)}o=this._helpers.object.mask();s=this._helpers.shade.pipeline()||false;p=this._helpers.position,v=p.swizzle,y=p.swizzle2;this.line=this._renderables.make("line",{uniforms:E,samples:2,strips:d,ribbons:f,layers:r,position:l,color:e,stroke:m,join:i,mask:v(o,"yzwx"),material:s});this._helpers.visible.make();return this._helpers.object.make([this.line])};t.prototype.made=function(){return this.resize()};t.prototype.unmake=function(){this.line=null;this._helpers.visible.unmake();return this._helpers.object.unmake()};t.prototype.change=function(e,t,i){if(e["geometry.points"]||e["line.stroke"]||e["line.join"]){return this.rebuild()}};return t}(r);t.exports=n},{"../../../util":166,"../../primitive":34}],61:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("../../primitive");n=e("../../../util");a=function(e){o(t,e);t.traits=["node","object","visible","style","line","arrow","geometry","position","bind","shade"];function t(e,i,r){t.__super__.constructor.call(this,e,i,r);this.line=this.arrows=null}t.prototype.resize=function(){var e,t,i,r,n,a,o,s,h,l;if(this.bind.points==null){return}t=this.bind.points.getActiveDimensions();h=t.items;l=t.width;s=t.height;r=t.depth;this.line.geometry.clip(h,l,s,r);a=this.arrows;o=[];for(i=0,n=a.length;i<n;i++){e=a[i];o.push(e.geometry.clip(h,l,s,r))}return o};t.prototype.make=function(){var e,t,i,r,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T;this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"}]);if(this.bind.points==null){return}u=this._shaders.shader();this.bind.points.sourceShader(u);this._helpers.position.pipeline(u);w=this._helpers.style.uniforms();s=this._helpers.line.uniforms();e=this._helpers.arrow.uniforms();T=this._inherit("unit").getUnitUniforms();p=this.props,v=p.start,r=p.end;f=this.props,E=f.stroke,a=f.join,c=f.proximity;this.proximity=c;i=this.bind.points.getDimensions();g=i.items;y=i.width;m=i.height;o=i.depth;if(this.bind.colors){t=this._shaders.shader();this.bind.colors.sourceShader(t)}h=this._helpers.object.mask();l=this._helpers.shade.pipeline()||false;d=this._helpers.position,b=d.swizzle,_=d.swizzle2;u=_(u,"yzwx","yzwx");t=b(t,"yzwx");h=b(h,"yzwx");l=b(l,"yzwx");x=n.JS.merge(e,s,w,T);this.line=this._renderables.make("line",{uniforms:x,samples:g,ribbons:m,strips:y,layers:o,position:u,color:t,clip:v||r,stroke:E,join:a,proximity:c,mask:h,material:l});this.arrows=[];if(v){this.arrows.push(this._renderables.make("arrow",{uniforms:x,flip:true,samples:g,ribbons:m,strips:y,layers:o,position:u,color:t,mask:h,material:l}))}if(r){this.arrows.push(this._renderables.make("arrow",{uniforms:x,samples:g,ribbons:m,strips:y,layers:o,position:u,color:t,mask:h,material:l}))}this._helpers.visible.make();return this._helpers.object.make(this.arrows.concat([this.line]))};t.prototype.made=function(){return this.resize()};t.prototype.unmake=function(){this._helpers.bind.unmake();this._helpers.visible.unmake();this._helpers.object.unmake();return this.line=this.arrows=null};t.prototype.change=function(e,t,i){if(e["geometry.points"]||e["line.stroke"]||e["line.join"]||e["arrow.start"]||e["arrow.end"]){return this.rebuild()}if(e["line.proximity"]){if(this.proximity!=null!==(this.props.proximity!=null)){return this.rebuild()}}};return t}(r);t.exports=a},{"../../../util":166,"../../primitive":34}],62:[function(e,t,i){var r,n,a,o=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++){if(t in this&&this[t]===e)return t}return-1};r=e("../../util");n=e("./view/view");a={bind:{make:function(e){var t,i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y;if(this.bind==null){this.bind={}}if(this.bound==null){this.bound=[]}for(r=0,o=e.length;r<o;r++){f=e[r];g=f.to,v=f.trait,u=f.optional,y=f.unique,h=f.multiple,t=f.callback;if(t==null){t=this.rebuild}l=g.split(/\./g).pop();p=this._get(g);d=null;if(p!=null){m=this;i=false;while(!i){m=d=this._attach(p,v,t,this,m,u,h);n=y&&(d==null||this.bound.indexOf(d)<0);i=h||u||!y||n}}if(d!=null){if(this.resize!=null){this._listen(d,"source.resize",this.resize)}if(t){this._listen(d,"source.rebuild",t)}if(h){for(a=0,s=d.length;a<s;a++){c=d[a];this.bound.push(c)}}else{this.bound.push(d)}}this.bind[l]=d}return null},unmake:function(){if(!this.bind){return}delete this.bind;return delete this.bound}},span:{make:function(){this.spanView=this._inherit("view");return this._listen("view","view.range",function(e){return function(){return e.trigger({type:"span.range"})}}(this))},unmake:function(){return delete this.spanView},get:function(){var e;e=new THREE.Vector2(-1,1);return function(t,i){var r,n,a;r=this._get(t+"span.range");if(r!=null){return r}return(n=(a=this.spanView)!=null?a.axis(i):void 0)!=null?n:e}}()},scale:{divide:function(e){var t,i;t=this._get(e+"scale.divide");i=this._get(e+"scale.factor");return Math.round(t*2.5/i)},generate:function(e,t,i,n){var a,o,s,h,l,u,c,p,f,d;l=this._get(e+"scale.mode");o=this._get(e+"scale.divide");f=this._get(e+"scale.unit");a=this._get(e+"scale.base");h=this._get(e+"scale.factor");c=this._get(e+"scale.start");s=this._get(e+"scale.end");d=this._get(e+"scale.zero");u=this._get(e+"scale.nice");p=r.Ticks.make(l,i,n,o,f,a,h,c,s,d,u);t.copy(p);return p}},style:{uniforms:function(){return{styleColor:this.node.attributes["style.color"],styleOpacity:this.node.attributes["style.opacity"],styleZBias:this.node.attributes["style.zBias"],styleZIndex:this.node.attributes["style.zIndex"]}}},arrow:{uniforms:function(){var e,t,i,r,n;r=this.props.start;e=this.props.end;i=this._attributes.make(this._types.number(1.25/(r+e)));n=this._attributes.make(this._types.vec2(+r,+e));t=this.node.attributes["arrow.size"];return{clipStyle:n,clipRange:t,clipSpace:i,arrowSpace:i,arrowSize:t}}},point:{uniforms:function(){return{pointSize:this.node.attributes["point.size"],pointDepth:this.node.attributes["point.depth"]}}},line:{uniforms:function(){return{lineWidth:this.node.attributes["line.width"],lineDepth:this.node.attributes["line.depth"],lineProximity:this.node.attributes["line.proximity"]}}},surface:{uniforms:function(){return{}}},shade:{pipeline:function(e){var t,i,r;if(!this._inherit("fragment")){return e}if(e==null){e=this._shaders.shader()}for(i=t=0;t<=2;i=++t){e=(r=this._inherit("fragment"))!=null?r.fragment(e,i):void 0}e.pipe("fragment.map.rgba");return e},map:function(e){if(!e){return e}return e=this._shaders.shader().pipe("mesh.map.uvwo").pipe(e)}},position:{pipeline:function(e){var t,i,r;if(!this._inherit("vertex")){return e}if(e==null){e=this._shaders.shader()}for(i=t=0;t<=3;i=++t){e=(r=this._inherit("vertex"))!=null?r.vertex(e,i):void 0}return e},swizzle:function(e,t){if(e){return this._shaders.shader().pipe(r.GLSL.swizzleVec4(t)).pipe(e)}},swizzle2:function(e,t,i){if(e){return this._shaders.shader().split().pipe(r.GLSL.swizzleVec4(t)).next().pipe(r.GLSL.swizzleVec4(i)).join().pipe(e)}}},visible:{make:function(){var e,t,i,r;e={type:"visible.change"};i=null;this.setVisible=function(e){if(e!=null){i=e}return t()};t=function(t){return function(){var n,a,o;n=t.isVisible;o=(a=i!=null?i:t._get("object.visible"))!=null?a:true;if(typeof r!=="undefined"&&r!==null){o&&(o=r.isVisible)}t.isVisible=o;if(n!==t.isVisible){return t.trigger(e)}}}(this);r=this._inherit("visible");if(r){this._listen(r,"visible.change",t)}if(this.is("object")){this._listen(this.node,"change:object",t)}return t()},unmake:function(){return delete this.isVisible}},active:{make:function(){var e,t,i,r;i={type:"active.change"};e=null;this.setActive=function(t){if(t!=null){e=t}return r()};r=function(r){return function(){var n,a,o;n=r.isActive;o=(a=e!=null?e:r._get("entity.active"))!=null?a:true;if(typeof t!=="undefined"&&t!==null){o&&(o=t.isActive)}r.isActive=o;if(n!==r.isActive){return r.trigger(i)}}}(this);t=this._inherit("active");if(t){this._listen(t,"active.change",r)}if(this.is("entity")){this._listen(this.node,"change:entity",r)}return r()},unmake:function(){return delete this.isActive}},object:{make:function(e){var t,i,r,n,a,s,h,l,u,c,p,f,d,m;this.objects=e!=null?e:[];this.renders=this.objects.reduce(function(e,t){return e.concat(t.renders)},[]);h=this._inherit("scene");c=t=f=null;i=o.call(this.traits,"style")>=0;c=1;t=THREE.NormalBlending;m=true;d=true;if(i){c=this.props.opacity;t=this.props.blending;f=this.props.zOrder;m=this.props.zWrite;d=this.props.zTest}l=function(e){return function(i){var r,n;r=i.changed;n=null;if(r["style.opacity"]){n=c=e.props.opacity}if(r["style.blending"]){n=t=e.props.blending}if(r["style.zOrder"]){n=f=e.props.zOrder}if(r["style.zWrite"]){n=m=e.props.zWrite}if(r["style.zTest"]){n=d=e.props.zTest}if(n!=null){return u()}}}(this);n=null;u=function(e){return function(){var r,n,a,o,s,h,l,u,p,g,v,y,E,w,b,_;u=f!=null?-f:e.node.order;_=((p=e.isVisible)!=null?p:true)&&c>0;if(_){if(i){g=e.objects;E=[];for(r=0,o=g.length;r<o;r++){l=g[r];l.show(c<1,t,u);E.push(l.depth(m,d))}return E}else{v=e.objects;w=[];for(n=0,s=v.length;n<s;n++){l=v[n];w.push(l.show(true,t,u))}return w}}else{y=e.objects;b=[];for(a=0,h=y.length;a<h;a++){l=y[a];b.push(l.hide())}return b}}}(this);this._listen(this.node,"change:style",l);this._listen(this.node,"reindex",u);this._listen(this,"visible.change",u);p=this.objects;for(r=0,a=p.length;r<a;r++){s=p[r];h.adopt(s)}return u()},unmake:function(e){var t,i,r,n,a,o,s,h,l;if(e==null){e=true}if(!this.objects){return}o=this._inherit("scene");s=this.objects;for(t=0,r=s.length;t<r;t++){a=s[t];o.unadopt(a)}if(e){h=this.objects;l=[];for(i=0,n=h.length;i<n;i++){a=h[i];l.push(a.dispose())}return l}},mask:function(){var e,t;if(!(e=this._inherit("mask"))){return}return t=e.mask(t)}},unit:{make:function(){var e,t,i,r,n,a,o,s,h,l,u,c,p,f,d,m,g;g=Math.PI;this.unitUniforms={renderScaleInv:l=this._attributes.make(this._types.number(1)),renderScale:h=this._attributes.make(this._types.number(1)),renderAspect:a=this._attributes.make(this._types.number(1)),renderWidth:u=this._attributes.make(this._types.number(0)),renderHeight:o=this._attributes.make(this._types.number(0)),viewWidth:d=this._attributes.make(this._types.number(0)),viewHeight:f=this._attributes.make(this._types.number(0)),pixelRatio:r=this._attributes.make(this._types.number(1)),pixelUnit:n=this._attributes.make(this._types.number(1)),worldUnit:m=this._attributes.make(this._types.number(1)),focusDepth:t=this._attributes.make(this._types.number(1)),renderOdd:s=this._attributes.make(this._types.vec2())};p=new THREE.Vector3;e=new THREE.Vector3;i=function(i){return function(){var v,y,E,w,b,_,x,T,R,k,H,M,S,A;if((S=typeof c!=="undefined"&&c!==null?c.getSize():void 0)==null){return}g=Math.PI;M=i.props.scale;w=i.props.fov;E=(k=i.props.focus)!=null?k:i.inherit("unit").props.focus;_=M===null;T=1;if(v=typeof c!=="undefined"&&c!==null?c.getCamera():void 0){x=v.projectionMatrix;p.set(0,-.5,1).applyProjection(x);e.set(0,.5,1).applyProjection(x);p.sub(e);T=p.y}y=S.renderHeight/S.viewHeight;b=w!=null?T*Math.tan(w*g/360):1;R=_?y:S.renderHeight/M*b;H=S.renderHeight*T/2;A=R/H;d.value=S.viewWidth;f.value=S.viewHeight;u.value=S.renderWidth;o.value=S.renderHeight;a.value=S.aspect;h.value=H;l.value=1/H;r.value=y;n.value=R;m.value=A;t.value=E;return s.value.set(S.renderWidth%2,S.renderHeight%2).multiplyScalar(.5)}}(this);c=this.is("root")?this:this._inherit("root");this._listen(c,"root.update",i);return i()},unmake:function(){return delete this.unitUniforms},get:function(){var e,t,i,r;i={};t=this.unitUniforms;for(e in t){r=t[e];i[e]=r.value}return i},uniforms:function(){return this.unitUniforms}}};t.exports=function(e,t){var i,r,n,o,s,h,l;i={};for(r=0,o=t.length;r<o;r++){l=t[r];if(!(h=a[l])){continue}i[l]={};for(n in h){s=h[n];i[l][n]=s.bind(e)}}return i}},{"../../util":166,"./view/view":113}],63:[function(e,t,i){var r;r=e("../../model");i.Classes=e("./classes");i.Types=e("./types");i.Traits=e("./traits");i.Helpers=e("./helpers")},{"../../model":24,"./classes":42,"./helpers":62,"./traits":98,"./types":106}],64:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;n=e("./operator");r=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","operator","source","index","clamp"];t.prototype.indexShader=function(e){e.pipe(this.operator);return t.__super__.indexShader.call(this,e)};t.prototype.sourceShader=function(e){e.pipe(this.operator);return t.__super__.sourceShader.call(this,e)};t.prototype.make=function(){var e,i;t.__super__.make.apply(this,arguments);if(this.bind.source==null){return}i={clampLimit:this._attributes.make(this._types.vec4())};this.clampLimit=i.clampLimit;e=this._shaders.shader();e.pipe("clamp.position",i);return this.operator=e};t.prototype.unmake=function(){return t.__super__.unmake.apply(this,arguments)};t.prototype.resize=function(){var e;if(this.bind.source!=null){e=this.bind.source.getActiveDimensions();this.clampLimit.value.set(e.width-1,e.height-1,e.depth-1,e.items-1)}return t.__super__.resize.apply(this,arguments)};t.prototype.change=function(e,t,i){if(t["operator"]||t["clamp"]){return this.rebuild()}};return t}(n);t.exports=r},{"./operator":69}],65:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;n=e("./operator");r=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","operator","source","index","grow"];t.prototype.sourceShader=function(e){return e.pipe(this.operator)};t.prototype.make=function(){var e,i;t.__super__.make.apply(this,arguments);if(this.bind.source==null){return}i={growScale:this.node.attributes["grow.scale"],growMask:this._attributes.make(this._types.vec4()),growAnchor:this._attributes.make(this._types.vec4())};this.growMask=i.growMask.value;this.growAnchor=i.growAnchor.value;e=this._shaders.shader();e.require(this.bind.source.sourceShader(this._shaders.shader()));e.pipe("grow.position",i);return this.operator=e};t.prototype.unmake=function(){return t.__super__.unmake.apply(this,arguments)};t.prototype.resize=function(){this.update();return t.__super__.resize.apply(this,arguments)};t.prototype.update=function(){var e,t,i,r,n,a,o,s,h;t=this.bind.source.getFutureDimensions();s=["width","height","depth","items"];o=function(e,t){return((e||1)-1)*(.5-t*.5)};h=[];for(i=r=0,a=s.length;r<a;i=++r){n=s[i];e=this.props[n];this.growMask.setComponent(i,+(e==null));h.push(this.growAnchor.setComponent(i,e!=null?o(t[n],e):0))}return h};t.prototype.change=function(e,t,i){if(t["operator"]){return this.rebuild()}if(t["grow"]){return this.update()}};return t}(n);t.exports=r},{"./operator":69}],66:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("./operator");a=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","operator","source","index","join"];t.prototype.indexShader=function(e){e.pipe(this.operator);return t.__super__.indexShader.call(this,e)};t.prototype.sourceShader=function(e){e.pipe(this.operator);return t.__super__.sourceShader.call(this,e)};t.prototype.getDimensions=function(){return this._resample(this.bind.source.getDimensions())};t.prototype.getActiveDimensions=function(){return this._resample(this.bind.source.getActiveDimensions())};t.prototype.getFutureDimensions=function(){return this._resample(this.bind.source.getFutureDimensions())};t.prototype.getIndexDimensions=function(){return this._resample(this.bind.source.getIndexDimensions())};t.prototype._resample=function(e){var t,i,r,n,a,o,s,h,l,u,c,p,f,d,m,g;u=this.order;t=this.axis;p=this.overlap;h=this.length;g=this.stride;o=["width","height","depth","items"];l=u.map(function(e){return o[e-1]});n=u.indexOf(t);m=function(){var t,r,n;n=[];for(t=0,r=l.length;t<r;t++){i=l[t];n.push(e[i])}return n}();f=((d=m[n+1])!=null?d:1)*g;m.splice(n,2,f);m=m.slice(0,3);m.push(1);c={};for(r=a=0,s=l.length;a<s;r=++a){i=l[r];c[i]=m[r]}return c};t.prototype.make=function(){var e,i,r,n,o,s,h,l,u,c,p,f,d;t.__super__.make.apply(this,arguments);if(this.bind.source==null){return}h=this.props.order;e=this.props.axis;l=this.props.overlap;u=h.join("");if(e==null){e=h[0]}r=u.indexOf(e);c=u.replace(e,"00").substring(0,4);n=[null,"width","height","depth","items"];s=n[e];i=this.bind.source.getDimensions();o=i[s];l=Math.min(o-1,l);p=o-l;d={joinStride:this._attributes.make(this._types.number(p)),joinStrideInv:this._attributes.make(this._types.number(1/p))};f=this._shaders.shader();f.require(a.GLSL.swizzleVec4(e,1));f.require(a.GLSL.swizzleVec4(c,4));f.require(a.GLSL.injectVec4([r,r+1]));f.pipe("join.position",d);f.pipe(a.GLSL.invertSwizzleVec4(h));this.operator=f;this.order=h;this.axis=e;this.overlap=l;this.length=o;return this.stride=p};t.prototype.unmake=function(){return t.__super__.unmake.apply(this,arguments)};t.prototype.change=function(e,t,i){if(t["join"]||t["operator"]){return this.rebuild()}};return t}(n);t.exports=r},{"../../../util":166,"./operator":69}],67:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("./operator");a=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","operator","source","index","lerp","sampler:x","sampler:y","sampler:z","sampler:w"];t.prototype.indexShader=function(e){e.pipe(this.indexer);return t.__super__.indexShader.call(this,e)};t.prototype.sourceShader=function(e){return e.pipe(this.operator)};t.prototype.getDimensions=function(){return this._resample(this.bind.source.getDimensions())};t.prototype.getActiveDimensions=function(){return this._resample(this.bind.source.getActiveDimensions())};t.prototype.getFutureDimensions=function(){return this._resample(this.bind.source.getFutureDimensions())};t.prototype.getIndexDimensions=function(){return this._resample(this.bind.source.getIndexDimensions())};t.prototype._resample=function(e){var t,i,r;r=this.resampled;t=this.centered;i=this.padding;if(this.relativeSize){if(!t.items){e.items--}if(!t.width){e.width--}if(!t.height){e.height--}if(!t.depth){e.depth--}if(r.items!=null){e.items*=r.items}if(r.width!=null){e.width*=r.width}if(r.height!=null){e.height*=r.height}if(r.depth!=null){e.depth*=r.depth}if(!t.items){e.items++}if(!t.width){e.width++}if(!t.height){e.height++}if(!t.depth){e.depth++}e.items-=i.items*2;e.width-=i.width*2;e.height-=i.height*2;e.depth-=i.depth*2}else{if(r.items!=null){e.items=r.items}if(r.width!=null){e.width=r.width}if(r.height!=null){e.height=r.height}if(r.depth!=null){e.depth=r.depth}}e.items=Math.max(0,Math.floor(e.items));e.width=Math.max(0,Math.floor(e.width));e.height=Math.max(0,Math.floor(e.height));e.depth=Math.max(0,Math.floor(e.depth));return e};t.prototype.make=function(){var e,i,r,n,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R;t.__super__.make.apply(this,arguments);if(this.bind.source==null){return}g=this.props,_=g.size,l=g.items,R=g.width,n=g.height,r=g.depth;E=_===this.node.attributes["lerp.size"]["enum"].relative;this.resampled={};if(l!=null){this.resampled.items=l}if(R!=null){this.resampled.width=R}if(n!=null){this.resampled.height=n}if(r!=null){this.resampled.depth=r}this.centered={};this.centered.items=this.props.centeredW;this.centered.width=this.props.centeredX;this.centered.height=this.props.centeredY;this.centered.depth=this.props.centeredZ;this.padding={};this.padding.items=this.props.paddingW;this.padding.width=this.props.paddingX;this.padding.height=this.props.paddingY;this.padding.depth=this.props.paddingZ;m=this._shaders.shader();h=this._shaders.shader();x={resampleFactor:this._attributes.make(this._types.vec4(0,0,0,0)),resampleBias:this._attributes.make(this._types.vec4(0,0,0,0))};this.resampleFactor=x.resampleFactor;this.resampleBias=x.resampleBias;w=l!=null||R!=null||n!=null||r!=null;m.pipe("resample.padding",x);T=[];e=false;v=["width","height","depth","items"];for(o=u=0,f=v.length;u<f;o=++u){p=v[o];i=this.centered[p];e||(e=i);T[o]=i?"0.5":"0.0"}if(e&&w){T="vec4("+T+")";m.pipe(a.GLSL.binaryOperator(4,"+",vec4));h.pipe(a.GLSL.binaryOperator(4,"+",vec4))}if(w){m.pipe("resample.relative",x);h.pipe("resample.relative",x)}else{m.pipe(a.GLSL.identity("vec4"));h.pipe(a.GLSL.identity("vec4"))}if(e&&w){m.pipe(a.GLSL.binaryOperator(4,"-",T));h.pipe(a.GLSL.binaryOperator(4,"-",T))}b=this.bind.source.sourceShader(this._shaders.shader());y=["width","height","depth","items"];for(o=c=0,d=y.length;c<d;o=++c){p=y[o];s="lerp."+p;if(this.props[p]!=null){b=this._shaders.shader().require(b);b.pipe(s,x)}}m.pipe(b);this.operator=m;this.indexer=h;return this.relativeSize=E};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);return this.operator=null};t.prototype.resize=function(){var e,i,r,n,a,o,s,h,l,u,c,p,f,d,m;if(this.bind.source==null){return}o=this.bind.source.getActiveDimensions();m=this.getActiveDimensions();e=function(e){return function(t){var i,r,n;i=e.centered[t];r=e.padding[t];m[t]+=r*2;n=i?o[t]/Math.max(1,m[t]):Math.max(1,o[t]-1)/Math.max(1,m[t]-1);return[n,r]}}(this);h=e("width"),d=h[0],a=h[1];l=e("height"),p=l[0],r=l[1];u=e("depth"),s=u[0],i=u[1];c=e("items"),f=c[0],n=c[1];this.resampleFactor.value.set(d,p,s,f);this.resampleBias.value.set(a,r,i,n);return t.__super__.resize.apply(this,arguments)};t.prototype.change=function(e,t,i){if(t["operator"]||t["lerp"]||t["sampler"]){return this.rebuild()}};return t}(n);t.exports=r},{"../../../util":166,"./operator":69}],68:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("./operator");a=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","active","operator","source","index","texture","memo"];t.prototype.sourceShader=function(e){return this.memo.shaderAbsolute(e,1)};t.prototype.make=function(){var e,i,r,n,a,o,s,h,l,u;t.__super__.make.apply(this,arguments);if(this.bind.source==null){return}this._helpers.active.make();this._listen("root","root.update",function(e){return function(){if(e.isActive){return e.update()}}}(this));h=this.props,o=h.minFilter,a=h.magFilter,l=h.type;i=this.bind.source.getDimensions();n=i.items,u=i.width,r=i.height,e=i.depth;this.memo=this._renderables.make("memo",{items:n,width:u,height:r,depth:e,minFilter:o,magFilter:a,type:l});s=this._shaders.shader();this.bind.source.sourceShader(s);this.compose=this._renderables.make("memoScreen",{map:s,items:n,width:u,height:r,depth:e});this.memo.adopt(this.compose);this.objects=[this.compose];return this.renders=this.compose.renders};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);if(this.bind.source!=null){this._helpers.active.unmake();this.memo.unadopt(this.compose);this.memo.dispose();return this.memo=this.compose=null}};t.prototype.update=function(){var e;return(e=this.memo)!=null?e.render():void 0};t.prototype.resize=function(){var e,i,r,n;if(this.bind.source==null){return}i=this.bind.source.getActiveDimensions();n=i.width,r=i.height,e=i.depth;this.compose.cover(n,r,e);return t.__super__.resize.apply(this,arguments)};t.prototype.change=function(e,t,i){if(t["texture"]||t["operator"]){return this.rebuild()}};return t}(n);t.exports=r},{"../../../util":166,"./operator":69}],69:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;n=e("../base/source");r=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","operator","source","index"];t.prototype.indexShader=function(e){var t;return(t=this.bind.source)!=null?typeof t.indexShader==="function"?t.indexShader(e):void 0:void 0};t.prototype.sourceShader=function(e){var t;return(t=this.bind.source)!=null?typeof t.sourceShader==="function"?t.sourceShader(e):void 0:void 0};t.prototype.getDimensions=function(){return this.bind.source.getDimensions()};t.prototype.getFutureDimensions=function(){return this.bind.source.getFutureDimensions()};t.prototype.getActiveDimensions=function(){return this.bind.source.getActiveDimensions()};t.prototype.getIndexDimensions=function(){return this.bind.source.getIndexDimensions()};t.prototype.init=function(){return this.sourceSpec=[{to:"operator.source",trait:"source"}]};t.prototype.make=function(){t.__super__.make.apply(this,arguments);return this._helpers.bind.make(this.sourceSpec)};t.prototype.made=function(){this.resize();return t.__super__.made.apply(this,arguments)};t.prototype.unmake=function(){return this._helpers.bind.unmake()};t.prototype.resize=function(e){return this.trigger({type:"source.resize"})};return t}(n);t.exports=r},{"../base/source":39}],70:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("../../primitive");a=e("../../../util");n=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","operator","readback","entity","active"];t.finals={channels:4};t.prototype.init=function(){this.emitter=this.root=null;return this.active={}};t.prototype.make=function(){var e,i,r,n,a,o,s,h,l,u;t.__super__.make.apply(this,arguments);this._compute("readback.data",function(e){return function(){var t;return(t=e.readback)!=null?t.data:void 0}}(this));this._compute("readback.items",function(e){return function(){var t;return(t=e.readback)!=null?t.items:void 0}}(this));this._compute("readback.width",function(e){return function(){var t;return(t=e.readback)!=null?t.width:void 0}}(this));this._compute("readback.height",function(e){return function(){var t;return(t=e.readback)!=null?t.height:void 0}}(this));this._compute("readback.depth",function(e){return function(){var t;return(t=e.readback)!=null?t.depth:void 0}}(this));this._helpers.bind.make([{to:"operator.source",trait:"source"}]);if(this.bind.source==null){return}o=this.props,l=o.type,e=o.channels,r=o.expr;this.root=this._inherit("root");this._listen("root","root.update",this.update);s=this.bind.source.getDimensions(),a=s.items,u=s.width,n=s.height,i=s.depth;h=this.bind.source.sourceShader(this._shaders.shader());this.readback=this._renderables.make("readback",{map:h,items:a,width:u,height:n,depth:i,channels:e,type:l});if(r!=null){this.readback.setCallback(r)}return this._helpers.active.make()};t.prototype.unmake=function(){if(this.readback!=null){this.readback.dispose();this.readback=null;this.root=null;this.emitter=null;this.active={}}this._helpers.active.unmake();return this._helpers.bind.unmake()};t.prototype.update=function(){var e;if(this.readback==null){return}if(this.isActive){this.readback.update((e=this.root)!=null?e.getCamera():void 0);this.readback.post();if(this.props.expr!=null){return this.readback.iterate()}}};t.prototype.resize=function(){var e,t,i,r,n,a,o,s;if(this.readback==null){return}r=this.bind.source.getActiveDimensions(),i=r.items,s=r.width,t=r.height,e=r.depth;this.readback.setActive(i,s,t,e);this.strideI=n=i;this.strideJ=a=n*s;return this.strideK=o=a*t};t.prototype.change=function(e,t,i){if(e["readback.type"]){return this.rebuild()}if(e["readback.expr"]&&this.readback){return this.readback.setCallback(this.props.expr)}};return t}(r);t.exports=n},{"../../../util":166,"../../primitive":34}],71:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;r=e("./operator");n=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","operator","source","index","repeat"];t.prototype.indexShader=function(e){e.pipe(this.operator);return t.__super__.indexShader.call(this,e)};t.prototype.sourceShader=function(e){e.pipe(this.operator);return t.__super__.sourceShader.call(this,e)};t.prototype.getDimensions=function(){return this._resample(this.bind.source.getDimensions())};t.prototype.getActiveDimensions=function(){return this._resample(this.bind.source.getActiveDimensions())};t.prototype.getFutureDimensions=function(){return this._resample(this.bind.source.getFutureDimensions())};t.prototype.getIndexDimensions=function(){return this._resample(this.bind.source.getIndexDimensions())};t.prototype._resample=function(e){var t;t=this.resample;return{items:t.items*e.items,width:t.width*e.width,height:t.height*e.height,depth:t.depth*e.depth}};t.prototype.make=function(){var e,i;t.__super__.make.apply(this,arguments);if(this.bind.source==null){return}this.resample={};i={repeatModulus:this._attributes.make(this._types.vec4())};this.repeatModulus=i.repeatModulus;e=this._shaders.shader();e.pipe("repeat.position",i);return this.operator=e};t.prototype.unmake=function(){return t.__super__.unmake.apply(this,arguments)};t.prototype.resize=function(){var e;if(this.bind.source!=null){e=this.bind.source.getActiveDimensions();this.repeatModulus.value.set(e.width,e.height,e.depth,e.items)}return t.__super__.resize.apply(this,arguments)};t.prototype.change=function(e,t,i){var r,n,a,o,s;if(t["operator"]||t["repeat"]){return this.rebuild()}if(i){o=["items","width","height","depth"];s=[];for(r=0,a=o.length;r<a;r++){n=o[r];s.push(this.resample[n]=this.props[n])}return s}};return t}(r);t.exports=n},{"./operator":69}],72:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("./operator");a=e("../../../util");n=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","operator","source","index","resample","sampler:x","sampler:y","sampler:z","sampler:w","include"];t.prototype.indexShader=function(e){e.pipe(this.indexer);return t.__super__.indexShader.call(this,e)};t.prototype.sourceShader=function(e){return e.pipe(this.operator)};t.prototype.getDimensions=function(){return this._resample(this.bind.source.getDimensions())};t.prototype.getActiveDimensions=function(){return this._resample(this.bind.source.getActiveDimensions())};t.prototype.getFutureDimensions=function(){return this._resample(this.bind.source.getFutureDimensions())};t.prototype.getIndexDimensions=function(){return this._resample(this.bind.source.getIndexDimensions())};t.prototype._resample=function(e){var t,i,r;r=this.resampled;t=this.centered;i=this.padding;if(this.relativeSize){if(!t.items){e.items--}if(!t.width){e.width--}if(!t.height){e.height--}if(!t.depth){e.depth--}if(r.items!=null){e.items*=r.items}if(r.width!=null){e.width*=r.width}if(r.height!=null){e.height*=r.height}if(r.depth!=null){e.depth*=r.depth}if(!t.items){e.items++}if(!t.width){e.width++}if(!t.height){e.height++}if(!t.depth){e.depth++}e.items-=i.items*2;e.width-=i.width*2;e.height-=i.height*2;e.depth-=i.depth*2}else{if(r.items!=null){e.items=r.items}if(r.width!=null){e.width=r.width}if(r.height!=null){e.height=r.height}if(r.depth!=null){e.depth=r.depth}}e.items=Math.max(0,Math.floor(e.items));e.width=Math.max(0,Math.floor(e.width));e.height=Math.max(0,Math.floor(e.height));e.depth=Math.max(0,Math.floor(e.depth));return e};t.prototype.make=function(){var e,i,r,n,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H;t.__super__.make.apply(this,arguments);if(this.bind.source==null){return}this._helpers.bind.make([{to:"include.shader",trait:"shader",optional:true}]);m=this.props,l=m.indices,r=m.channels;_=this.bind.shader;g=this.props,b=g.sample,x=g.size,u=g.items,H=g.width,o=g.height,n=g.depth;y=b===this.node.attributes["resample.sample"]["enum"].relative;E=x===this.node.attributes["resample.size"]["enum"].relative;this.resampled={};if(u!=null){this.resampled.items=u}if(H!=null){this.resampled.width=H}if(o!=null){this.resampled.height=o}if(n!=null){this.resampled.depth=n}this.centered={};this.centered.items=this.props.centeredW;this.centered.width=this.props.centeredX;this.centered.height=this.props.centeredY;this.centered.depth=this.props.centeredZ;this.padding={};this.padding.items=this.props.paddingW;this.padding.width=this.props.paddingX;this.padding.height=this.props.paddingY;this.padding.depth=this.props.paddingZ;d=this._shaders.shader();h=this._shaders.shader();T=[null,this._types.number,this._types.vec2,this._types.vec3,this._types.vec4][l];R={dataSize:this._attributes.make(T(0,0,0,0)),dataResolution:this._attributes.make(T(0,0,0,0)),targetSize:this._attributes.make(T(0,0,0,0)),targetResolution:this._attributes.make(T(0,0,0,0)),resampleFactor:this._attributes.make(this._types.vec4(0,0,0,0)),resampleBias:this._attributes.make(this._types.vec4(0,0,0,0))};this.dataResolution=R.dataResolution;this.dataSize=R.dataSize;this.targetResolution=R.targetResolution;this.targetSize=R.targetSize;this.resampleFactor=R.resampleFactor;this.resampleBias=R.resampleBias;w=u!=null||H!=null||o!=null||n!=null;d.pipe("resample.padding",R);k=[];e=false;v=["width","height","depth","items"];for(s=c=0,f=v.length;c<f;s=++c){p=v[s];i=this.centered[p];e||(e=i);k[s]=i?"0.5":"0.0"}if(e){k="vec4("+k+")";d.pipe(a.GLSL.binaryOperator(4,"+",vec4));if(w){h.pipe(a.GLSL.binaryOperator(4,"+",vec4))}}if(y){if(w){d.pipe("resample.relative",R);h.pipe("resample.relative",R)}else{h.pipe(a.GLSL.identity("vec4"))}}if(_!=null){if(l!==4){d.pipe(a.GLSL.truncateVec(4,l))}d.callback();if(l!==4){d.pipe(a.GLSL.extendVec(l,4))}if(e){d.pipe(a.GLSL.binaryOperator(4,"-",k))}d.pipe(this.bind.source.sourceShader(this._shaders.shader()));if(r!==4){d.pipe(a.GLSL.truncateVec(4,r))}d.join();if(this.bind.shader!=null){d.pipe(this.bind.shader.shaderBind(R))}if(r!==4){d.pipe(a.GLSL.extendVec(r,4))}}else{if(e){d.pipe(a.GLSL.binaryOperator(4,"-",k))}d.pipe(this.bind.source.sourceShader(this._shaders.shader()))}if(e&&w){h.pipe(a.GLSL.binaryOperator(4,"-",k))}this.operator=d;this.indexer=h;this.indices=l;this.relativeSample=y;return this.relativeSize=E};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);return this.operator=null};t.prototype.resize=function(){var e,i,r,n,a,o,s,h,l,u,c,p,f,d,m;if(this.bind.source==null){return}o=this.bind.source.getActiveDimensions();m=this.getActiveDimensions();e=function(e){return function(t){var i,r,n;i=e.centered[t];r=e.padding[t];m[t]+=r*2;n=i?o[t]/Math.max(1,m[t]):Math.max(1,o[t]-1)/Math.max(1,m[t]-1);return[n,r]}}(this);h=e("width"),d=h[0],a=h[1];l=e("height"),p=l[0],r=l[1];u=e("depth"),s=u[0],i=u[1];c=e("items"),f=c[0],n=c[1];if(this.indices===1){this.dataResolution.value=1/o.width;this.targetResolution.value=1/m.width;this.dataSize.value=o.width;this.targetSize.value=m.width}else{this.dataResolution.value.set(1/o.width,1/o.height,1/o.depth,1/o.items);this.targetResolution.value.set(1/m.width,1/m.height,1/m.depth,1/m.items);this.dataSize.value.set(o.width,o.height,o.depth,o.items);this.targetSize.value.set(m.width,m.height,m.depth,m.items)}this.resampleFactor.value.set(d,p,s,f);this.resampleBias.value.set(a,r,i,n);return t.__super__.resize.apply(this,arguments)};t.prototype.change=function(e,t,i){if(t["operator"]||t["resample"]||t["sampler"]||t["include"]){return this.rebuild()}};return t}(r);t.exports=n},{"../../../util":166,"./operator":69}],73:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("./operator");a=e("../../../util");n=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","operator","source","index","slice"];t.prototype.getDimensions=function(){return this._resample(this.bind.source.getDimensions())};t.prototype.getActiveDimensions=function(){return this._resample(this.bind.source.getActiveDimensions())};t.prototype.getFutureDimensions=function(){return this._resample(this.bind.source.getFutureDimensions())};t.prototype.getIndexDimensions=function(){return this._resample(this.bind.source.getIndexDimensions())};t.prototype.sourceShader=function(e){e.pipe("slice.position",this.uniforms);return this.bind.source.sourceShader(e)};t.prototype._resolve=function(e,t){var i,r,n,a,o;a=this.props[e];i=t[e];if(a==null){return[0,i]}n=function(e,t){if(e<0){return t+e}else{return e}};o=n(Math.round(a.x),i);r=n(Math.round(a.y),i);r=Math.max(o,r);return[o,r-o]};t.prototype._resample=function(e){e.width=this._resolve("width",e)[1];e.height=this._resolve("height",e)[1];e.depth=this._resolve("depth",e)[1];e.items=this._resolve("items",e)[1];return e};t.prototype.make=function(){t.__super__.make.apply(this,arguments);if(this.bind.source==null){return}return this.uniforms={sliceOffset:this._attributes.make(this._types.vec4())}};t.prototype.unmake=function(){return t.__super__.unmake.apply(this,arguments)};t.prototype.resize=function(){var e;if(this.bind.source==null){return}e=this.bind.source.getActiveDimensions();this.uniforms.sliceOffset.value.set(this._resolve("width",e)[0],this._resolve("height",e)[0],this._resolve("depth",e)[0],this._resolve("items",e)[0]);return t.__super__.resize.apply(this,arguments)};t.prototype.change=function(e,t,i){if(t["operator"]){return this.rebuild()}if(t["slice"]){return this.resize()}};return t}(r);t.exports=n},{"../../../util":166,"./operator":69}],74:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("./operator");a=e("../../../util");n=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","operator","source","index","split"];t.prototype.indexShader=function(e){e.pipe(this.operator);return t.__super__.indexShader.call(this,e)};t.prototype.sourceShader=function(e){e.pipe(this.operator);return t.__super__.sourceShader.call(this,e)};t.prototype.getDimensions=function(){return this._resample(this.bind.source.getDimensions())};t.prototype.getActiveDimensions=function(){return this._resample(this.bind.source.getActiveDimensions())};t.prototype.getFutureDimensions=function(){return this._resample(this.bind.source.getFutureDimensions())};t.prototype.getIndexDimensions=function(){return this._resample(this.bind.source.getIndexDimensions())};t.prototype._resample=function(e){var t,i,r,n,a,o,s,h,l,u,c,p,f,d,m;u=this.order;t=this.axis;p=this.overlap;h=this.length;m=this.stride;o=["width","height","depth","items"];l=u.map(function(e){return o[e-1]});n=u.indexOf(t);d=function(){var t,r,n;n=[];for(t=0,r=l.length;t<r;t++){i=l[t];n.push(e[i])}return n}();f=Math.floor((d[n]-p)/m);d.splice(n,1,h,f);d=d.slice(0,4);c={};for(r=a=0,s=l.length;a<s;r=++a){i=l[r];c[i]=d[r]}return c};t.prototype.make=function(){var e,i,r,n,o,s,h,l,u,c,p,f;t.__super__.make.apply(this,arguments);if(this.bind.source==null){return}n=this.props.order;e=this.props.axis;o=this.props.overlap;r=this.props.length;s=n.join("");if(e==null){e=n[0]}i=s.indexOf(e);u=s[i]+((h=s[i+1])!=null?h:0);l=s.replace(u[1],"").replace(u[0],"0")+"0";o=Math.min(r-1,o);c=r-o;f={splitStride:this._attributes.make(this._types.number(c))};p=this._shaders.shader();p.require(a.GLSL.swizzleVec4(u,2));p.require(a.GLSL.swizzleVec4(l,4));p.require(a.GLSL.injectVec4(i));p.pipe("split.position",f);p.pipe(a.GLSL.invertSwizzleVec4(n));this.operator=p;this.order=n;this.axis=e;this.overlap=o;this.length=r;return this.stride=c};t.prototype.unmake=function(){return t.__super__.unmake.apply(this,arguments)};t.prototype.change=function(e,t,i){if(e["split.axis"]||e["split.order"]||t["operator"]){return this.rebuild()}};return t}(r);t.exports=n},{"../../../util":166,"./operator":69}],75:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;r=e("./operator");n=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","operator","source","index","spread"];t.prototype.sourceShader=function(e){return e.pipe(this.operator)};t.prototype.make=function(){var e,i;t.__super__.make.apply(this,arguments);if(this.bind.source==null){return}i={spreadMatrix:this._attributes.make(this._types.mat4()),spreadOffset:this._attributes.make(this._types.vec4())};this.spreadMatrix=i.spreadMatrix;this.spreadOffset=i.spreadOffset;e=this._shaders.shader();e.require(this.bind.source.sourceShader(this._shaders.shader()));e.pipe("spread.position",i);return this.operator=e};t.prototype.unmake=function(){return t.__super__.unmake.apply(this,arguments)};t.prototype.resize=function(){this.update();return t.__super__.resize.apply(this,arguments)};t.prototype.update=function(){var e,t,i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E;r=this.bind.source.getFutureDimensions();c=this.spreadMatrix.value;n=c.elements;f=["width","height","depth","items"];e=["alignWidth","alignHeight","alignDepth","alignItems"];v=this.props.unit;y=this.node.attributes["spread.unit"]["enum"];u=function(){switch(v){case y.relative:return function(e,t,i,a){return n[t*4+i]=a/Math.max(1,r[e]-1)};case y.absolute:return function(e,t,i,r){return n[t*4+i]=r}}}();m=[];for(a=o=0,l=f.length;o<l;a=++o){h=f[a];g=this.props[h];t=this.props[e[a]];if(g!=null){i=(d=r[h])!=null?d:1;p=-(i-1)*(.5-t*.5)}else{p=0}this.spreadOffset.value.setComponent(a,p);m.push(function(){var e,t,i;i=[];for(s=e=0;e<=3;s=++e){E=(t=g!=null?g.getComponent(s):void 0)!=null?t:0;i.push(n[a*4+s]=u(h,a,s,E))}return i}())}return m};t.prototype.change=function(e,t,i){if(t["operator"]){return this.rebuild()}if(t["spread"]){return this.update()}};return t}(r);t.exports=n},{"./operator":69}],76:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("./operator");a=e("../../../util");n=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","operator","source","index","subdivide"];t.prototype.indexShader=function(e){e.pipe(this.indexer);return t.__super__.indexShader.call(this,e)};t.prototype.sourceShader=function(e){return e.pipe(this.operator)};t.prototype.getDimensions=function(){return this._resample(this.bind.source.getDimensions())};t.prototype.getActiveDimensions=function(){return this._resample(this.bind.source.getActiveDimensions())};t.prototype.getFutureDimensions=function(){return this._resample(this.bind.source.getFutureDimensions())};t.prototype.getIndexDimensions=function(){return this._resample(this.bind.source.getIndexDimensions())};t.prototype._resample=function(e){var t;t=this.resampled;e.items--;e.width--;e.height--;e.depth--;if(t.items!=null){e.items*=t.items}if(t.width!=null){e.width*=t.width}if(t.height!=null){e.height*=t.height}if(t.depth!=null){e.depth*=t.depth}e.items++;e.width++;e.height++;e.depth++;return e};t.prototype.make=function(){var e,i,r,n,o,s,h,l,u,c,p,f,d,m,g,v,y,E;t.__super__.make.apply(this,arguments);if(this.bind.source==null){return}f=this.props,v=f.size,s=f.items,E=f.width,i=f.height,e=f.depth,c=f.lerp;this.resampled={};if(s!=null){this.resampled.items=s}if(E!=null){this.resampled.width=E}if(i!=null){this.resampled.height=i}if(e!=null){this.resampled.depth=e}p=this._shaders.shader();o=this._shaders.shader();y={resampleFactor:this._attributes.make(this._types.vec4(0,0,0,0)),subdivideBevel:this.node.attributes["subdivide.bevel"]};this.resampleFactor=y.resampleFactor;this.resampleBias=y.resampleBias;m=s!=null||E!=null||i!=null||e!=null;if(m){p.pipe("resample.relative",y);o.pipe("resample.relative",y)}else{p.pipe(a.GLSL.identity("vec4"));o.pipe(a.GLSL.identity("vec4"))}g=this.bind.source.sourceShader(this._shaders.shader());c=c?".lerp":"";d=["width","height","depth","items"];for(r=h=0,u=d.length;h<u;r=++h){l=d[r];n="subdivide."+l+c;if(this.props[l]!=null){g=this._shaders.shader().require(g);g.pipe(n,y)}}p.pipe(g);this.operator=p;return this.indexer=o};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);return this.operator=null};t.prototype.resize=function(){var e,i,r,n,a,o,s;if(this.bind.source==null){return}i=this.bind.source.getActiveDimensions();s=this.getActiveDimensions();e=function(e){return Math.max(1,i[e]-1)/Math.max(1,s[e]-1)};o=e("width");n=e("height");r=e("depth");a=e("items");this.resampleFactor.value.set(o,n,r,a);return t.__super__.resize.apply(this,arguments)};t.prototype.change=function(e,t,i){if(t["operator"]||t["subdivide"]){return this.rebuild()}};return t}(r);t.exports=n},{"../../../util":166,"./operator":69}],77:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("./operator");a=e("../../../util");n=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","operator","source","index","swizzle"];t.prototype.sourceShader=function(e){e=t.__super__.sourceShader.call(this,e);if(this.swizzler){e.pipe(this.swizzler)}return e};t.prototype.make=function(){var e;t.__super__.make.apply(this,arguments);if(this.bind.source==null){return}e=this.props.order;if(e.join()!=="1234"){return this.swizzler=a.GLSL.swizzleVec4(e,4)}};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);return this.swizzler=null};t.prototype.change=function(e,t,i){if(t["swizzle"]||t["operator"]){return this.rebuild()}};return t}(r);t.exports=n},{"../../../util":166,"./operator":69}],78:[function(e,t,i){var r,n,a,o,s=function(e,t){for(var i in t){if(h.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},h={}.hasOwnProperty;r=e("./operator");a=e("../../../util");o={1:"width",2:"height",3:"depth",4:"items"};n=function(e){s(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","operator","source","index","transpose"];t.prototype.indexShader=function(e){if(this.swizzler){e.pipe(this.swizzler)}return t.__super__.indexShader.call(this,e)};t.prototype.sourceShader=function(e){if(this.swizzler){e.pipe(this.swizzler)}return t.__super__.sourceShader.call(this,e)};t.prototype.getDimensions=function(){return this._remap(this.transpose,this.bind.source.getDimensions())};t.prototype.getActiveDimensions=function(){return this._remap(this.transpose,this.bind.source.getActiveDimensions())};t.prototype.getFutureDimensions=function(){return this._remap(this.transpose,this.bind.source.getFutureDimensions())};t.prototype.getIndexDimensions=function(){return this._remap(this.transpose,this.bind.source.getIndexDimensions())};t.prototype._remap=function(e,t){var i,r,n,a,s,h;a={};for(r=n=0;n<=3;r=++n){i=o[r+1];h=o[e[r]];a[i]=(s=t[h])!=null?s:1}return a};t.prototype.make=function(){var e;t.__super__.make.apply(this,arguments);if(this.bind.source==null){return}e=this.props.order;if(e.join()!=="1234"){this.swizzler=a.GLSL.invertSwizzleVec4(e)}this.transpose=e;return this.trigger({type:"source.rebuild"})};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);return this.swizzler=null};t.prototype.change=function(e,t,i){if(t["transpose"]||t["operator"]){return this.rebuild()}};return t}(r);t.exports=n},{"../../../util":166,"./operator":69}],79:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("../../primitive");a=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","object","visible","overlay","dom","attach","position"];t.prototype.init=function(){this.emitter=this.root=null;return this.active={}};t.prototype.make=function(){var e,i,r,n,a,o,s,h,l;t.__super__.make.apply(this,arguments);this._helpers.bind.make([{to:"dom.html",trait:"html"},{to:"dom.points",trait:"source"}]);if(!(this.bind.points!=null&&this.bind.html!=null)){return}this.root=this._inherit("root");this._listen("root","root.update",this.update);this._listen("root","root.post",this.post);o=this.bind.points.getDimensions();r=this.bind.html.getDimensions();a=Math.min(o.items,r.items);l=Math.min(o.width,r.width);i=Math.min(o.height,r.height);e=Math.min(o.depth,r.depth);s=this.bind.points.sourceShader(this._shaders.shader());s=this._helpers.position.pipeline(s);h=this._shaders.shader({globals:["projectionMatrix"]});h.pipe("project.readback");s.pipe(h);n=this._shaders.shader();this.readback=this._renderables.make("readback",{map:s,indexer:n,items:a,width:l,height:i,depth:e,channels:4,stpq:true});this.dom=this._overlays.make("dom");this.dom.hint(a*l*i*e*2);this.readback.setCallback(this.emitter=this.callback(this.bind.html.nodes()));return this._helpers.visible.make()};t.prototype.unmake=function(){if(this.readback!=null){this.readback.dispose();this.dom.dispose();this.readback=this.dom=null;this.root=null;this.emitter=null;this.active={}}this._helpers.bind.unmake();return this._helpers.visible.unmake()};t.prototype.update=function(){var e;if(this.readback==null){return}if(this.props.visible){this.readback.update((e=this.root)!=null?e.getCamera():void 0);this.readback.post();return this.readback.iterate()}};t.prototype.post=function(){if(this.readback==null){return}return this.dom.render(this.isVisible?this.emitter.nodes():[])};t.prototype.callback=function(e){var t,i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x;w=this._inherit("unit").getUnitUniforms();b=w.viewWidth;h=w.viewHeight;t=this.node.attributes["dom.attributes"];d=this.node.attributes["dom.size"];x=this.node.attributes["dom.zoom"];r=this.node.attributes["dom.color"];p=this.node.attributes["dom.outline"];f=this.node.attributes["dom.pointerEvents"];c=this.node.attributes["overlay.opacity"];_=this.node.attributes["overlay.zIndex"];u=this.node.attributes["attach.offset"];a=this.node.attributes["attach.depth"];m=this.node.attributes["attach.snap"];o=this.dom.el;l=[];E=null;i=null;g=v=y=0;n="";s=function(r,n,s,p,f,d,w,_){var T,R,k,H,M,S,A,C,z,P,L,O,D,F,B,U;S=_+g*f+v*d+y*w;k=e[S];H=p<0;A=1/p;M=1+(A-1)*a.value;D=H?0:M;C=+u.value.x*D;z=+u.value.y*D;B=(r+1)*b.value*.5+C;U=(n-1)*h.value*.5+z;B/=x.value;U/=x.value;if(m.value){B=Math.round(B);U=Math.round(U)}R=Math.min(.999,H?0:c.value);P={className:i,style:{transform:"translate3d("+B+"px, "+-U+"px, "+(1-p)+"px) translate(-50%, -50%) scale("+D+","+D+")",opacity:R}};for(w in E){F=E[w];P.style[w]=F}T=t.value;if(T!=null){O=T.style;for(w in T){F=T[w];if(w!=="style"&&w!=="className"){P[w]=F}}if(O!=null){for(w in O){F=O[w];P.style[w]=F}}}P.className+=" "+((L=T!=null?T.className:void 0)!=null?L:"mathbox-label");return l.push(o("div",P,k))};s.reset=function(e){return function(){var t,a,o;l=[];o=[e.strideI,e.strideJ,e.strideK],g=o[0],v=o[1],y=o[2];t=r.value;a=function(e){return Math.floor(e*255)};n=t?"rgb("+[a(t.x),a(t.y),a(t.z)]+")":"";i="mathbox-outline-"+Math.round(p.value);E={};if(t){E.color=n}E.fontSize=d.value+"px";if(x.value!==1){E.zoom=x.value}if(_.value>0){E.zIndex=_.value}if(f.value){return E.pointerEvents="auto"}}}(this);s.nodes=function(){return l};return s};t.prototype.resize=function(){var e,t,i,r,n,a,o,s,h;if(this.readback==null){return}n=this.bind.points.getActiveDimensions();i=this.bind.html.getActiveDimensions();r=Math.min(n.items,i.items);h=Math.min(n.width,i.width);t=Math.min(n.height,i.height);e=Math.min(n.depth,i.depth);this.readback.setActive(r,h,t,e);this.strideI=a=i.items;this.strideJ=o=a*i.width;return this.strideK=s=o*i.height};t.prototype.change=function(e,t,i){if(e["dom.html"]||e["dom.points"]){return this.rebuild()}};return t}(n);t.exports=r},{"../../../util":166,"../../primitive":34}],80:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;a=e("../data/voxel");n=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","buffer","active","data","voxel","html"];t.finals={channels:1};t.prototype.init=function(){t.__super__.init.apply(this,arguments);return this.storage="pushBuffer"};t.prototype.make=function(){var e,i,r,n,a;t.__super__.make.apply(this,arguments);n=this.getDimensions(),r=n.items,a=n.width,i=n.height,e=n.depth;this.dom=this._overlays.make("dom");return this.dom.hint(r*a*i*e)};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);if(this.dom!=null){this.dom.dispose();return this.dom=null}};t.prototype.update=function(){return t.__super__.update.apply(this,arguments)};t.prototype.change=function(e,i,r){if(i["html"]){return this.rebuild()}return t.__super__.change.call(this,e,i,r)};t.prototype.nodes=function(){return this.buffer.read()};t.prototype.callback=function(e){var t;t=this.dom.el;if(e.length<=6){return function(i,r,n,a,o){return e(i,t,r,n,a,o)}}else{return function(i){return function(r,n,a,o,s){return e(r,t,n,a,o,s,i.bufferClock,i.bufferStep)}}(this)}};return t}(a);t.exports=r},{"../../../util":166,"../data/voxel":52}],81:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;n=e("./transition");r=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","transition","vertex","move","visible","active"];t.prototype.make=function(){var e,i,r;t.__super__.make.apply(this,arguments);i={moveFrom:this.node.attributes["move.from"],moveTo:this.node.attributes["move.to"]};for(e in i){r=i[e];this.uniforms[e]=r}};t.prototype.vertex=function(e,t){var i,r;if(t===this.props.pass){e.pipe("move.position",this.uniforms)}return(i=(r=this._inherit("vertex"))!=null?r.vertex(e,t):void 0)!=null?i:e};return t}(n);t.exports=r},{"./transition":88}],82:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;n=e("./track");r=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","track","trigger","play","bind"];t.prototype.init=function(){t.__super__.init.apply(this,arguments);this.skew=null;this.start=null;return this.done=false};t.prototype.reset=function(e){if(e==null){e=true}this.skew=e?0:null;this.start=null;return this.done=false};t.prototype.make=function(){var e;t.__super__.make.apply(this,arguments);this._listen("slide","slide.step",function(e){return function(t){var i;i=e.props.trigger;if(i!=null&&t.index===i){return e.reset()}if(i!=null&&t.index===0){return e.reset(false)}}}(this));if(!this.props.trigger||this._inherit("slide")==null){this.reset()}this._listen("root","root.post",this.post);e=this._inherit("clock");return this._listen(e,"clock.tick",function(t){return function(){var i,r,n,a,o,s,h,l,u,c,p,f;u=t.props,n=u.from,f=u.to,c=u.speed,s=u.pace,i=u.delay,l=u.realtime;p=e.getTime();if(t.skew!=null){a=l?p.time:p.clock;r=l?p.delta:p.step;h=c/s;if(t.start==null){t.start=a}t.skew+=r*(h-1);o=Math.max(0,a-t.start+t.skew-i*h);if(t.props.loop){o=o%(f-n)}t.playhead=Math.min(f,n+o)}else{t.playhead=0}return t.update()}}(this))};t.prototype.update=function(){return t.__super__.update.apply(this,arguments)};t.prototype.post=function(){if(this.skew!=null&&this.playhead===this.props.to&&!this.props.loop&&!this.done){return this.node.trigger({type:"play.done"})}};t.prototype.change=function(e,i,r){if(e["trigger.trigger"]||e["play.realtime"]){return this.rebuild()}return t.__super__.change.call(this,e,i,r)};return t}(n);t.exports=r},{"./track":87}],83:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("../base/parent");a=e("../../../util");n=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","present"];t.prototype.init=function(){};t.prototype.make=function(){this.nodes=[];this.steps=[];this.length=0;this.last=[];this.index=0;this.dirty=[];this._listen("root","root.update",this.update);return this._compute("present.length",function(e){return function(){return e.length}}(this))};t.prototype.adopt=function(e){var t;t=e.node;if(this.nodes.indexOf(e)<0){this.nodes.push(t)}return this.dirty.push(e)};t.prototype.unadopt=function(e){var t;t=e.node;this.nodes=this.nodes.filter(function(t){return t!==e});return this.dirty.push(e)};t.prototype.update=function(){var e,t,i,r,n;if(!this.dirty.length){return}r=this.dirty;for(t=0,i=r.length;t<i;t++){e=r[t];this.slideReset(e)}n=this.process(this.nodes),this.steps=n[0],this.indices=n[1];this.length=this.steps.length;this.index=null;this.go(this.props.index);return this.dirty=[]};t.prototype.slideLatch=function(e,t,i){return e.slideLatch(t,i)};t.prototype.slideStep=function(e,t,i){return e.slideStep(this.mapIndex(e,t),i)};t.prototype.slideRelease=function(e,t){return e.slideRelease()};t.prototype.slideReset=function(e){return e.slideReset()};t.prototype.mapIndex=function(e,t){return t-this.indices[e.node._id]};t.prototype.process=function(e){var t,i,r,n,a,o,s,h,l,u,c,p;l=function(e){var t,i,r,n;n=[];for(i=0,r=e.length;i<r;i++){t=e[i];n.push(s(t).filter(a))}return n};p=function(e){return function(t){var i,r,n;n=[];while(t&&(r=[e(t),t],t=r[0],i=r[1],r)){n.push(i)}return n}};s=p(function(e){if(e.parent.traits.hash.present){return null}else{return e.parent}});a=function(t){return e.indexOf(t)>=0};n=function(e,t){var i,r,n,a,o,s;i=e.length;r=t.length;n=i-r;if(n!==0){return false}n=Math.min(i,r);for(a=o=s=n-1;s<=0?o<0:o>0;a=s<=0?++o:--o){if(e[a]!==t[a]){return false}}return true};o=function(e){return e.sort(function(e,t){var i,r,n,a,o,s,h,l,u,c;i=e.length;r=t.length;n=Math.min(i,r);for(s=h=1,c=n;1<=c?h<=c:h>=c;s=1<=c?++h:--h){l=e[i-s];u=t[r-s];a=l.props.order;o=u.props.order;if(a!=null||o!=null){if(a!=null&&o!=null&&(n=a-o)!==0){return n}if(a!=null){return-1}if(o!=null){return 1}}if(u.order!==l.order){return u.order-l.order}}n=i-r;if(n!==0){return n}return 0})};u=function(e){var t,i,r,n,a,o;a=[];t=[];for(i=0,r=e.length;i<r;i++){o=e[i];((n=o[0]).props.steps!=null?a:t).push(o)}return[a,t]};i=function(e){var i,n,a,o,s,h,l,u,c,p,f,d;c=e[0],i=e[1];u=100;a={};d=[];p=function(e,t){var i,r,n,o,s,h,l,c,p,f,m,g;p=(h=e[0]).props;l=e[1];c=l!=null?a[l._id]:0;i=t;r=p.from!=null?c+p.from:i-p.early;g=p.to!=null?c+p.to:i+p.steps+p.late;r=Math.max(0,r);g=Math.min(u,g);if(a[s=h._id]==null){a[s]=r}for(n=o=f=r,m=g;f<=m?o<m:o>m;n=f<=m?++o:--o){d[n]=(d[n]!=null?d[n]:d[n]=[]).concat(e)}return p.steps};n=0;for(o=0,h=c.length;o<h;o++){f=c[o];n+=p(f,n)}for(s=0,l=i.length;s<l;s++){f=i[s];p(f,0)}d=function(){var e,i,n;n=[];for(e=0,i=d.length;e<i;e++){f=d[e];n.push(r(t(f)))}return n}();return[d,a]};t=function(e){var t,i,r,n,a;if(e){a=[];for(t=i=0,r=e.length;i<r;t=++i){n=e[t];if(e.indexOf(n)===t){a.push(n)}}return a}else{return[]}};r=function(e){return e.sort(function(e,t){return e.order-t.order})};h=l(e);c=o(h);return i(u(c))};t.prototype.go=function(e){var t,i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M,S,A,C,z,P,L,O;e=Math.max(0,Math.min(this.length+1,+e||0));l=this.last;t=(k=this.steps[e-1])!=null?k:[];L=this.props.directed?e-this.index:1;this.index=e;n=function(){var e,i,r;r=[];for(e=0,i=t.length;e<i;e++){b=t[e];if(this.last.indexOf(b)<0){r.push(b)}}return r}.call(this);a=function(){var e,i,r,n;r=this.last;n=[];for(e=0,i=r.length;e<i;e++){b=r[e];if(t.indexOf(b)<0){n.push(b)}}return n}.call(this);P=function(){var e,i,r;r=[];for(e=0,i=t.length;e<i;e++){b=t[e];if(n.indexOf(b)<0&&a.indexOf(b)<0){r.push(b)}}return r}();i=function(e){return e.sort(function(e,t){return e.order-t.order})};r=function(e){return e.sort(function(e,t){return t.order-e.order})};O=function(e){return e.toString()};H=i(n);for(o=0,u=H.length;o<u;o++){b=H[o];this.slideLatch(b.controller,true,L)}M=i(P);for(s=0,c=M.length;s<c;s++){b=M[s];this.slideLatch(b.controller,null,L)}S=i(a);for(h=0,p=S.length;h<p;h++){b=S[h];this.slideLatch(b.controller,false,L)}for(E=0,f=n.length;E<f;E++){b=n[E];this.slideStep(b.controller,e,L)}for(w=0,d=P.length;w<d;w++){b=P[w];this.slideStep(b.controller,e,L)}for(_=0,m=a.length;_<m;_++){b=a[_];this.slideStep(b.controller,e,L)}A=r(n);for(x=0,g=A.length;x<g;x++){b=A[x];this.slideRelease(b.controller)}C=r(P);for(T=0,v=C.length;T<v;T++){b=C[T];this.slideRelease(b.controller)}z=r(a);for(R=0,y=z.length;R<y;R++){b=z[R];this.slideRelease(b.controller)}this.last=t};t.prototype.change=function(e,t,i){if(e["present.index"]||i){return this.go(this.props.index)}};return t}(r);t.exports=n},{"../../../util":166,"../base/parent":37}],84:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("./transition");a=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","transition","mask","visible","active"];t.prototype.mask=function(e){var t,i,r;if(e){r=this._shaders.shader();r.pipe(a.GLSL.identity("vec4"));r.fan();r.pipe(e,this.uniforms);r.next();r.pipe("reveal.mask",this.uniforms);r.end();r.pipe("float combine(float a, float b) { return min(a, b); }")}else{r=this._shaders.shader();r.pipe("reveal.mask",this.uniforms)}return(t=(i=this._inherit("mask"))!=null?i.mask(r):void 0)!=null?t:r};return t}(n);t.exports=r},{"../../../util":166,"./transition":88}],85:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;r=e("../base/parent");n=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","slide","visible","active"];t.prototype.make=function(){this._helpers.visible.make();this._helpers.active.make();if(!this._inherit("present")){throw new Error(this.node.toString()+" must be placed inside <present></present>")}return this._inherit("present").adopt(this)};t.prototype.unmake=function(){this._helpers.visible.unmake();this._helpers.active.unmake();return this._inherit("present")(unadopt(this))};t.prototype.change=function(e,t,i){if(e["slide.early"]||e["slide.late"]||e["slide.steps"]||e["slide.from"]||e["slide.to"]){return this.rebuild()}};t.prototype.slideLatch=function(e,t){this.trigger({type:"transition.latch",step:t});if(e!=null){return this._instant(e)}};t.prototype.slideStep=function(e,t){return this.trigger({type:"slide.step",index:e,step:t})};t.prototype.slideRelease=function(){return this.trigger({type:"transition.release"})};t.prototype.slideReset=function(){this._instant(false);return this.trigger({type:"slide.reset"})};t.prototype._instant=function(e){this.setVisible(e);return this.setActive(e)};return t}(r);t.exports=n},{"../base/parent":37}],86:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;n=e("./track");r=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","track","step","trigger","bind"];t.prototype.make=function(){var e,i,r,n,a;t.__super__.make.apply(this,arguments);e=this._inherit("clock");if(this.actualIndex==null){this.actualIndex=null}this.animateIndex=this._animator.make(this._types.number(0),{clock:e,realtime:this.props.realtime,step:function(e){return function(t){return e.actualIndex=t}}(this)});if(this.lastIndex==null){this.lastIndex=null}this.animateStep=this._animator.make(this._types.number(0),{clock:e,realtime:this.props.realtime,step:function(e){return function(t){e.playhead=t;return e.update()}}(this)});this.stops=(r=this.props.stops)!=null?r:function(){a=[];for(var e=0,t=this.script.length;0<=t?e<t:e>t;0<=t?e++:e--){a.push(e)}return a}.apply(this);this._listen("slide","slide.reset",function(e){return function(t){return e.lastIndex=null}}(this));return this._listen("slide","slide.step",function(e){return function(t){var i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x;f=e.props,i=f.delay,r=f.duration,c=f.pace,E=f.speed,p=f.playback,g=f.rewind,v=f.skip,x=f.trigger;s=Math.max(0,Math.min(e.stops.length-1,t.index-x));o=e.playhead;_=e.stops[s];if(e.lastIndex==null&&x){e.lastIndex=s;e.animateStep.set(_);e.animateIndex.set(s);return}l=(d=(m=e.actualIndex)!=null?m:e.lastIndex)!=null?d:0;w=s-l;y=e.stops.slice(Math.min(l,s),Math.max(l,s));a=0;l=y.shift();for(h=0,u=y.length;h<u;h++){b=y[h];if(l===b){a++}l=b}e.lastIndex=s;n=E*(t.step>=0?1:g);n*=v?Math.max(1,Math.abs(w)-a):1;r+=Math.abs(_-o)*c/n;if(o!==_){e.animateIndex.immediate(s,{delay:i,duration:r,ease:p});return e.animateStep.immediate(_,{delay:i,duration:r,ease:p})}}}(this))};t.prototype.made=function(){return this.update()};t.prototype.unmake=function(){this.animateIndex.dispose();this.animateStep.dispose();this.animateIndex=this.animateStep=null;return t.__super__.unmake.apply(this,arguments)};t.prototype.change=function(e,i,r){if(e["step.stops"]||e["step.realtime"]){return this.rebuild()}return t.__super__.change.call(this,e,i,r)};return t}(n);t.exports=r},{"./track":87}],87:[function(e,t,i){var r,n,a,o,s=function(e,t){for(var i in t){if(h.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},h={}.hasOwnProperty;n=e("../../primitive");r=e("../../../util").Ease;o=function(e){var t,i,r;i={};for(t in e){r=e[t];if(r instanceof Array){i[t]=r.slice()}else if(r!=null&&typeof r==="object"){i[t]=o(r)}else{i[t]=r}}return i};a=function(e){s(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","track","seek","bind"];t.prototype.init=function(){this.handlers={};this.script=null;this.values=null;this.playhead=0;this.velocity=null;this.section=null;return this.expr=null};t.prototype.make=function(){var e,t,i;this._helpers.bind.make([{to:"track.target",trait:"node",callback:null}]);i=this.props.script;e=this.bind.target.node;this.targetNode=e;return t=this._process(e,i),this.script=t[0],this.values=t[1],this.start=t[2],this.end=t[3],t};t.prototype.unmake=function(){this.unbindExpr();this._helpers.bind.unmake();this.script=this.values=this.start=this.end=this.section=this.expr=null;return this.playhead=0};t.prototype.bindExpr=function(e){var t;this.unbindExpr();this.expr=e;this.targetNode.bind(e,true);t=this.targetNode.clock;return this._attributes.bind(this.measure=function(){var e;e=null;return function(i){return function(){var r;r=t.getTime().step;if(e!=null){i.velocity=(i.playhead-e)/r}return e=i.playhead}}(this)}())};t.prototype.unbindExpr=function(){if(this.expr!=null){this.targetNode.unbind(this.expr,true)}if(this.measure!=null){this._attributes.unbind(this.measure)}return this.expr=this.measure=null};t.prototype._process=function(e,t){var i,r,n,a,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_;if(t instanceof Array){y={};for(r=n=0,u=t.length;n<u;r=++n){w=t[r];y[r]=w}t=y}y=[];for(s in t){w=t[s];if(w==null){w=[]}if(w instanceof Array){w={key:+s,props:w[0]!=null?o(w[0]):{},expr:w[1]!=null?o(w[1]):{}}}else{if(w.key==null&&!w.props&&!w.expr){w={props:o(w)}}else{w=o(w)}w.key=w.key!=null?+w.key:+s;if(w.props==null){w.props={}}if(w.expr==null){w.expr={}}}y.push(w)}t=y;if(!t.length){return[[],{},0,0]}t.sort(function(e,t){return e.key-t.key});E=t[0].key;i=t[t.length-1].key;for(s in t){w=t[s];if(typeof l!=="undefined"&&l!==null){l.next=w}l=w}l.next=l;t=y;f={};_={};for(s in t){w=t[s];d=w.props;for(a in d){b=d[a];f[a]=true}}for(s in t){w=t[s];m=w.expr;for(a in m){b=m[a];f[a]=true}}for(a in f){f[a]=e.get(a)}try{for(a in f){_[a]=[e.attribute(a).T.make(),e.attribute(a).T.make(),e.attribute(a).T.make()]}}catch(t){console.warn(this.node.toMarkup());p=this.node.toString()+" - Target "+e+" has no `"+a+"` property";throw new Error(p)}v=[];for(h=0,c=t.length;h<c;h++){w=t[h];for(a in f){b=f[a];b=e.validate(a,(g=w.props[a])!=null?g:b);f[a]=w.props[a]=b;if(w.expr[a]!=null&&typeof w.expr[a]!=="function"){console.warn(this.node.toMarkup());p=this.node.toString()+" - Expression `"+w.expr[a]+"` on property `"+a+"` is not a function";throw new Error(p)}}v.push(w)}return[v,_,E,i]};t.prototype.update=function(){var e,t,i,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w;d=this,f=d.playhead,g=d.script;m=this.props,t=m.ease,y=m.seek;p=this.targetNode;if(y!=null){f=y}if(g.length){o=function(){var e,t,i,r,n;i=g[0];for(e=t=0,r=g.length;t<r;e=++t){n=g[e];if(n.key>f){break}i=n}return i};v=this.section;if(!v||f<v.key||f>v.next.key){v=o(g,f)}if(v===this.section){return}this.section=v;s=v;w=v.next;E=s.key;n=w.key;i=function(){switch(t){case"linear":case 0:return r.clamp;case"cosine":case 1:return r.cosine;case"binary":case 2:return r.binary;case"hold":case 3:return r.hold;default:return r.cosine}}();e=p.clock;l=function(t){return function(i){var r;if(t.velocity==null){return t.playhead}r=e.getTime();return t.playhead+t.velocity*(i-r.time)}}(this);h=function(){var e;e=1/Math.max(1e-4,n-E);return function(t){return i((l(t)-E)*e,0,1)}}();c=function(e){return function(t){var i,r,n,a,o,l,u,c;n=s.expr[t];l=w.expr[t];a=s.props[t];u=w.props[t];o=function(){console.warn(p.toMarkup());throw new Error(this.node.toString()+" - Invalid expression result on track `"+t+"`")};r=p.attribute(t);c=e.values[t];i=e._animator;if(n&&l){return function(e,t,a){return function(t,a){var s,u;e[0]=s=r.T.validate(n(t,a),e[0],o);e[1]=u=r.T.validate(l(t,a),e[1],o);return e[2]=i.lerp(r.T,s,u,h(t),e[2])}}(c,s,w)}else if(n){return function(e,t,a){return function(t,a){var s;e[0]=s=r.T.validate(n(t,a),e[0],o);return e[1]=i.lerp(r.T,s,u,h(t),e[1])}}(c,s,w)}else if(l){return function(e,t,n){return function(t,n){var s;e[0]=s=r.T.validate(l(t,n),e[0],o);return e[1]=i.lerp(r.T,a,s,h(t),e[1])}}(c,s,w)}else{return function(e,t,n){return function(t,n){return e[0]=i.lerp(r.T,a,u,h(t),e[0])}}(c,s,w)}}}(this);a={};for(u in s.expr){if(a[u]==null){a[u]=c(u)}}for(u in w.expr){if(a[u]==null){a[u]=c(u)}}for(u in s.props){if(a[u]==null){a[u]=c(u)}}for(u in w.props){if(a[u]==null){a[u]=c(u)}}return this.bindExpr(a)}};t.prototype.change=function(e,t,i){if(e["track.target"]||e["track.script"]||e["track.mode"]){return this.rebuild()}if(e["seek.seek"]||i){return this.update()}};return t}(n);t.exports=a},{"../../../util":166,"../../primitive":34}],88:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("../base/parent");a=e("../../../util");n=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","transition","transform","mask","visible","active"];t.prototype.init=function(){this.animate=null;this.uniforms=null;this.state={isVisible:true,isActive:true,enter:1,exit:1};this.latched=null;return this.locked=null};t.prototype.make=function(){var e,t,i;this.uniforms={transitionFrom:this._attributes.make(this._types.vec4()),transitionTo:this._attributes.make(this._types.vec4()),transitionActive:this._attributes.make(this._types.bool()),transitionScale:this._attributes.make(this._types.vec4()),transitionBias:this._attributes.make(this._types.vec4()),transitionEnter:this._attributes.make(this._types.number()),transitionExit:this._attributes.make(this._types.number()),transitionSkew:this._attributes.make(this._types.number())};t=this._inherit("slide");i=this._inherit("visible");e=this._inherit("active");this._listen(t,"transition.latch",function(e){return function(t){return e.latch(t.step)}}(this));this._listen(t,"transition.release",function(e){return function(){return e.release()}}(this));this._listen(i,"visible.change",function(e){return function(){return e.update(e.state.isVisible=i.isVisible)}}(this));this._listen(e,"active.change",function(t){return function(){return t.update(t.state.isActive=e.isActive)}}(this));this.animate=this._animator.make(this._types.vec2(1,1),{step:function(e){return function(t){e.state.enter=t.x;e.state.exit=t.y;return e.update()}}(this),complete:function(e){return function(t){return e.complete(t)}}(this)});return this.move=this.props.from!=null||this.props.to!=null};t.prototype.unmake=function(){return this.animate.dispose()};t.prototype.latch=function(e){var t,i,r,n,a,o;this.locked=null;this.latched=n={isVisible:this.state.isVisible,isActive:this.state.isActive,step:e};o=this.isVisible;if(!o){r=n.step>=0;a=r?[0,1]:[1,0],t=a[0],i=a[1];return this.animate.set(t,i)}};t.prototype.release=function(){var e,t,i,r,n,a,o,s,h,l,u,c,p,f,d;l=this.latched;f=this.state;this.latched=null;if(l.isVisible!==f.isVisible){h=l.step>=0;d=f.isVisible;u=d?[1,1]:h?[1,0]:[0,1],o=u[0],s=u[1];c=this.props,r=c.duration,n=c.durationEnter,a=c.durationExit;if(n==null){n=r}if(a==null){a=r}r=d*n+!d*a;p=this.props,e=p.delay,t=p.delayEnter,i=p.delayExit;if(t==null){t=e}if(i==null){i=e}e=d*t+!d*i;this.animate.immediate({x:o,y:s},{duration:r,delay:e,ease:"linear"});this.locked={isVisible:true,isActive:l.isActive||f.isActive}}return this.update()};t.prototype.complete=function(e){if(!e){return}this.locked=null;return this.update()};t.prototype.update=function(){var e,t,i,r,n,a,o,s;if(this.latched!=null){return}a=this.props,t=a.enter,i=a.exit;if(t==null){t=this.state.enter}if(i==null){i=this.state.exit}r=t*i;s=r>0;n=r<1;this.uniforms.transitionEnter.value=t;this.uniforms.transitionExit.value=i;this.uniforms.transitionActive.value=n;if(s){s=!!this.state.isVisible}if(this.locked!=null){s=this.locked.isVisible}if(this.isVisible!==s){this.isVisible=s;this.trigger({type:"visible.change"})}e=!!(this.state.isActive||((o=this.locked)!=null?o.isActive:void 0));if(this.isActive!==e){this.isActive=e;return this.trigger({type:"active.change"})}};t.prototype.change=function(e,t,i){var r,n,a,o,s,h,l,u,c;if(e["transition.enter"]||e["transition.exit"]||i){this.update()}if(e["transition.stagger"]||i){s=this.props.stagger;n=s.x<0;a=s.y<0;o=s.z<0;r=s.w<0;l=Math.abs(s.x);u=Math.abs(s.y);c=Math.abs(s.z);h=Math.abs(s.w);this.uniforms.transitionSkew.value=l+u+c+h;this.uniforms.transitionScale.value.set((1-n*2)*l,(1-a*2)*u,(1-o*2)*c,(1-r*2)*h);return this.uniforms.transitionBias.value.set(n*l,a*u,o*c,r*h)}};return t}(r);t.exports=n},{"../../../util":166,"../base/parent":37}],89:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("../../primitive");a=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","object","visible","operator","style","compose"];t.defaults={zWrite:false,zTest:false,color:"#ffffff"};t.prototype.init=function(){return this.compose=null};t.prototype.resize=function(){var e,t,i,r,n;if(!(this.compose&&this.bind.source)){return}t=this.bind.source.getActiveDimensions();n=t.width;i=t.height;e=t.depth;r=t.items;return this.remapUVScale.set(n,i)};t.prototype.make=function(){var e,t,i,r;this._helpers.bind.make([{to:"operator.source",trait:"source"}]);if(this.bind.source==null){return}r={remapUVScale:this._attributes.make(this._types.vec2())};this.remapUVScale=r.remapUVScale.value;i=this._shaders.shader();e=this.props.alpha;if(this.bind.source.is("image")){i.pipe("screen.pass.uv",r);i=this.bind.source.imageShader(i)}else{i.pipe("screen.map.xy",r);i=this.bind.source.sourceShader(i)}if(!e){i.pipe("color.opaque")}t=this._helpers.style.uniforms();this.compose=this._renderables.make("screen",{map:i,uniforms:t,linear:true});this._helpers.visible.make();return this._helpers.object.make([this.compose])};t.prototype.made=function(){return this.resize()};t.prototype.unmake=function(){this._helpers.bind.unmake();this._helpers.visible.unmake();return this._helpers.object.unmake()};t.prototype.change=function(e,t,i){if(e["operator.source"]||e["compose.alpha"]){return this.rebuild()}};return t}(n);t.exports=r},{"../../../util":166,"../../primitive":34}],90:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("../base/parent");a=e("../../../util");n=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","root","scene","vertex","texture","rtt","source","index","image"];t.defaults={minFilter:"linear",magFilter:"linear",type:"unsignedByte"};t.prototype.init=function(){return this.rtt=this.scene=this.camera=this.width=this.height=this.history=this.rootSize=this.size=null};t.prototype.indexShader=function(e){return e};t.prototype.imageShader=function(e){return this.rtt.shaderRelative(e)};t.prototype.sourceShader=function(e){return this.rtt.shaderAbsolute(e,this.history)};t.prototype.getDimensions=function(){return{items:1,width:this.width,height:this.height,depth:this.history}};t.prototype.getActiveDimensions=function(){return this.getDimensions()};t.prototype.make=function(){var e,t,i,r,n,a,o,s,h,l,u,c,p,f,d;this.parentRoot=this._inherit("root");this.rootSize=this.parentRoot.getSize();this._listen(this.parentRoot,"root.pre",this.pre);this._listen(this.parentRoot,"root.update",this.update);this._listen(this.parentRoot,"root.render",this.render);this._listen(this.parentRoot,"root.post",this.post);this._listen(this.parentRoot,"root.camera",this.setCamera);this._listen(this.parentRoot,"root.resize",function(e){return this.resize(e.size)});if(this.rootSize==null){return}o=this.props,a=o.minFilter,n=o.magFilter,u=o.type;s=this.props,f=s.width,t=s.height,r=s.history,l=s.size;h=l===this.node.attributes["rtt.size"]["enum"].relative;d=h?this.rootSize.renderWidth:1;i=h?this.rootSize.renderHeight:1;this.width=Math.round(f!=null?f*d:this.rootSize.renderWidth);this.height=Math.round(t!=null?t*i:this.rootSize.renderHeight);this.history=r;this.aspect=e=this.width/this.height;if(this.scene==null){this.scene=this._renderables.make("scene")}this.rtt=this._renderables.make("renderToTexture",{scene:this.scene,camera:this._context.defaultCamera,width:this.width,height:this.height,frames:this.history,minFilter:a,magFilter:n,type:u});e=f||t?e:this.rootSize.aspect;p=f!=null?f:this.rootSize.viewWidth;c=t!=null?t:this.rootSize.viewHeight;return this.size={renderWidth:this.width,renderHeight:this.height,aspect:e,viewWidth:p,viewHeight:c,pixelRatio:this.height/c}};t.prototype.made=function(){this.trigger({type:"source.rebuild"});if(this.size){return this.trigger({type:"root.resize",size:this.size})}};t.prototype.unmake=function(e){if(this.rtt==null){return}this.rtt.dispose();if(!e){this.scene.dispose()}return this.rtt=this.width=this.height=this.history=null};t.prototype.change=function(e,t,i){if(t["texture"]||e["rtt.width"]||e["rtt.height"]){return this.rebuild()}if(e["root.camera"]||i){this._unattach();this._attach(this.props.camera,"camera",this.setCamera,this,this,true);return this.setCamera()}};t.prototype.adopt=function(e){var t,i,r,n,a;n=e.renders;a=[];for(t=0,i=n.length;t<i;t++){r=n[t];a.push(this.scene.add(r))}return a};t.prototype.unadopt=function(e){var t,i,r,n,a;n=e.renders;a=[];for(t=0,i=n.length;t<i;t++){r=n[t];a.push(this.scene.remove(r))}return a};t.prototype.resize=function(e){var t,i,r,n;this.rootSize=e;i=this.props,n=i.width,t=i.height,e=i.size;r=e===this.node.attributes["rtt.size"]["enum"].relative;if(!this.rtt||n==null||t==null||r){return this.rebuild()}};t.prototype.select=function(e){return this._root.node.model.select(e,[this.node])};t.prototype.watch=function(e,t){return this._root.node.model.watch(e,t)};t.prototype.unwatch=function(e){return this._root.node.model.unwatch(e)};t.prototype.pre=function(e){return this.trigger(e)};t.prototype.update=function(e){var t;if((t=this.getOwnCamera())!=null){t.aspect=this.aspect||1;t.updateProjectionMatrix()}return this.trigger(e)};t.prototype.render=function(e){var t;this.trigger(e);return(t=this.rtt)!=null?t.render(this.getCamera()):void 0};t.prototype.post=function(e){return this.trigger(e)};t.prototype.setCamera=function(){var e,t;e=(t=this.select(this.props.camera)[0])!=null?t.controller:void 0;if(this.camera!==e){this.camera=e;this.rtt.camera=this.getCamera();return this.trigger({type:"root.camera"})}else if(!this.camera){return this.trigger({type:"root.camera"})}};t.prototype.getOwnCamera=function(){var e;return(e=this.camera)!=null?e.getCamera():void 0};t.prototype.getCamera=function(){var e;return(e=this.getOwnCamera())!=null?e:this._inherit("root").getCamera()};t.prototype.vertex=function(e,t){if(t===2){return e.pipe("view.position")}if(t===3){return e.pipe("root.position")}return e};return t}(r);t.exports=n},{"../../../util":166,"../base/parent":37}],91:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("../../primitive");a=e("../../../util");n=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","shader"];t.freeform=true;t.prototype.init=function(){return this.shader=null};t.prototype.make=function(){var e,t,i,r,n,a,o,s,h,l,u,c;o=this.props,r=o.language,e=o.code;if(r!=="glsl"){throw new Error("GLSL required")}this._helpers.bind.make([{to:"shader.sources",trait:"source",multiple:true}]);h=this._shaders.fetch(e);u=this._types;c={};a=function(e){return function(e){var t;switch(e){case"i":return u.int();case"f":return u.number();case"v2":return u.vec2();case"v3":return u.vec3();case"v4":return u.vec4();case"m3":return u.mat3();case"m4":return u.mat4();case"t":return u.object();default:t=e.split("");if(t.pop()==="v"){return u.array(a(t.join("")))}else{return null}}}}(this);s=h._signatures.uniform;for(i=0,n=s.length;i<n;i++){t=s[i];if(l=a(t.type)){c[t.name]=l}}return this.reconfigure({props:{uniform:c}})};t.prototype.made=function(){return this.trigger({type:"source.rebuild"})};t.prototype.unmake=function(){return this.shader=null};t.prototype.change=function(e,t,i){if(e["shader.uniforms"]||e["shader.code"]||e["shader.language"]){return this.rebuild()}};t.prototype.shaderBind=function(e){var t,i,r,n,a,o,s,h,l,u,c,p,f;if(e==null){e={}}s=this.props,n=s.language,t=s.code;h=this.node.attributes;for(r in h){f=h[r];if(f.type!=null&&f.short!=null&&f.ns==="uniform"){if(e[o=f.short]==null){e[o]=f}}}if((p=this.props.uniforms)!=null){for(r in p){f=p[r];e[r]=f}}u=this._shaders.shader();if(this.bind.sources!=null){l=this.bind.sources;for(i=0,a=l.length;i<a;i++){c=l[i];u.require(c.sourceShader(this._shaders.shader()))}}return u.pipe(t,e)};return t}(r);t.exports=n},{"../../../util":166,"../../primitive":34}],92:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("../operator/operator");a=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","operator","texture","text","format","font"];t.defaults={minFilter:"linear",magFilter:"linear"};t.prototype.init=function(){t.__super__.init.apply(this,arguments);this.atlas=this.buffer=this.used=this.time=null;return this.filled=false};t.prototype.sourceShader=function(e){return this.buffer.shader(e)};t.prototype.textShader=function(e){return this.atlas.shader(e)};t.prototype.textIsSDF=function(){return this.props.sdf>0};t.prototype.textHeight=function(){return this.props.detail};t.prototype.make=function(){var e,t,i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v;this._helpers.bind.make([{to:"operator.source",trait:"raw"}]);u=this.props,l=u.minFilter,h=u.magFilter,d=u.type;c=this.props,a=c.font,f=c.style,m=c.variant,g=c.weight,i=c.detail,p=c.sdf;this.atlas=this._renderables.make("textAtlas",{font:a,size:i,style:f,variant:m,weight:g,outline:p,minFilter:l,magFilter:h,type:d});l=THREE.NearestFilter;h=THREE.NearestFilter;d=THREE.FloatType;r=this.bind.source.getDimensions();s=r.items,v=r.width,o=r.height,t=r.depth;this.buffer=this._renderables.make("voxelBuffer",{width:v,height:o,depth:t,channels:4,items:s,minFilter:l,magFilter:h,type:d});e=this.atlas;n=this.buffer.streamer.emit;this.buffer.streamer.emit=function(t){return e.map(t,n)};this.clockParent=this._inherit("clock");return this._listen("root","root.update",this.update)};t.prototype.made=function(){t.__super__.made.apply(this,arguments);return this.resize()};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);if(this.buffer){this.buffer.dispose();this.buffer=null}if(this.atlas){this.atlas.dispose();return this.atlas=null}};t.prototype.update=function(){var e,t,i;t=this.bind.source.rawBuffer();e=this.buffer;if(this.filled&&!this.props.live||!this.through){return}this.time=this.clockParent.getTime();i=this.used;this.atlas.begin();this.used=this.through();this.buffer.write(this.used);this.atlas.end();this.filled=true;if(i!==this.used){return this.trigger({type:"source.resize"})}};t.prototype.change=function(e,t,i){var r,n,a,o,s,h;if(t["font"]){return this.rebuild()}if(e["format.expr"]||e["format.digits"]||e["format.data"]||i){h=this.props,n=h.digits,a=h.expr,r=h.data;if(a==null){if(r!=null){a=function(e,t,i,n,a){return r[a]}}else{a=function(e){return e}}}o=a.length;if(n!=null){a=function(e){return function(t,i,r,a,o,s,h,l,u,c){return+e(t,i,r,a,o,s,h,l,u,c).toPrecision(n)}}(a)}if(o>8){s=function(e){return function(t,i,r,n,o,s,h,l,u,c,p){return t(a(i,r,n,o,s,h,l,u,e.time.clock,e.time.step))}}(this)}else{s=function(e){return function(e,t,i,r,n,o,s,h,l){return e(a(t,i,r,n,o,s,h,l))}}(this)}return this.through=this.bind.source.rawBuffer().through(s,this.buffer)}};return t}(n);t.exports=r},{"../../../util":166,"../operator/operator":69}],93:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("../../primitive");a=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","object","visible","style","label","attach","geometry","position"];t.prototype.make=function(){var e,i,r,n,o,s,h,l,u,c,p,f,d,m,g,v,y,E;t.__super__.make.apply(this,arguments);this._helpers.bind.make([{to:"label.text",trait:"text"},{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"}]);if(this.bind.points==null){return}if(this.bind.text==null){return}u=this.bind.points.getDimensions();m=this.bind.text.getDimensions();g=this.bind.text.textIsSDF();o=Math.min(u.items,m.items);E=Math.min(u.width,m.width);n=Math.min(u.height,m.height);r=Math.min(u.depth,m.depth);c=this.bind.points.sourceShader(this._shaders.shader());c=this._helpers.position.pipeline(c);f=this.bind.text.sourceShader(this._shaders.shader());h=this._shaders.shader().pipe("label.map");h.pipe(this.bind.text.textShader(this._shaders.shader()));s={spriteDepth:this.node.attributes["attach.depth"],spriteOffset:this.node.attributes["attach.offset"],spriteSnap:this.node.attributes["attach.snap"],spriteScale:this._attributes.make(this._types.number()),outlineStep:this._attributes.make(this._types.number()),outlineExpand:this._attributes.make(this._types.number()),outlineColor:this.node.attributes["label.background"]};this.spriteScale=s.spriteScale;this.outlineStep=s.outlineStep;this.outlineExpand=s.outlineExpand;p=g?"label.outline":"label.alpha";i=this._shaders.shader().pipe(p,s);if(this.bind.colors){e=this._shaders.shader();this.bind.colors.sourceShader(e)}l=this._helpers.object.mask();d=this._helpers.style.uniforms();y=this._inherit("unit").getUnitUniforms();v=a.JS.merge(y,d,s);this.sprite=this._renderables.make("sprite",{uniforms:v,width:E,height:n,depth:r,items:o,position:c,sprite:f,map:h,combine:i,color:e,mask:l,linear:true});this._helpers.visible.make();return this._helpers.object.make([this.sprite])};t.prototype.unmake=function(){this._helpers.bind.unmake();this._helpers.visible.unmake();this._helpers.object.unmake();return this.sprite=null};t.prototype.resize=function(){var e,t,i,r,n,a;r=this.bind.points.getActiveDimensions();n=this.bind.text.getActiveDimensions();i=Math.min(r.items,n.items);a=Math.min(r.width,n.width);t=Math.min(r.height,n.height);e=Math.min(r.depth,n.depth);return this.sprite.geometry.clip(a,t,e,i)};t.prototype.change=function(e,t,i){var r,n,a,o,s;if(t["geometry"]||e["label.text"]){return this.rebuild()}if(this.bind.points==null){return}s=this.props.size;a=this.props.outline;r=this.props.expand;n=this.bind.text.textHeight();o=s/n;this.outlineExpand.value=r/o*16/255;this.outlineStep.value=a/o*16/255;return this.spriteScale.value=o};return t}(n);t.exports=r},{"../../../util":166,"../../primitive":34}],94:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("../operator/resample");a=e("../../../util");n=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","bind","operator","resample","sampler:x","sampler:y","sampler:z","sampler:w","include","text"];t.prototype.init=function(){return this.sourceSpec=[{to:"operator.source",trait:"text"}]};t.prototype.textShader=function(e){return this.bind.source.textShader(e)};t.prototype.textIsSDF=function(){var e;return((e=this.bind.source)!=null?e.props.sdf:void 0)>0};t.prototype.textHeight=function(){var e;return(e=this.bind.source)!=null?e.props.detail:void 0};return t}(r);t.exports=n},{"../../../util":166,"../operator/resample":72}],95:[function(e,t,i){var r,n,a,o,s=function(e,t){for(var i in t){if(h.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},h={}.hasOwnProperty;r=e("../data/buffer");o=e("../data/voxel");a=e("../../../util");n=function(e){s(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","buffer","active","data","texture","voxel","text","font"];t.defaults={minFilter:"linear",magFilter:"linear"};t.finals={channels:1};t.prototype.init=function(){t.__super__.init.apply(this,arguments);return this.atlas=null};t.prototype.textShader=function(e){return this.atlas.shader(e)};t.prototype.textIsSDF=function(){return this.props.sdf>0};t.prototype.textHeight=function(){return this.props.detail};t.prototype.make=function(){var e,t,i,n,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M;d=this.props,f=d.minFilter,p=d.magFilter,R=d.type;m=this.props,l=m.font,T=m.style,k=m.variant,H=m.weight,o=m.detail,_=m.sdf;this.atlas=this._renderables.make("textAtlas",{font:l,size:o,style:T,variant:k,weight:H,outline:_,minFilter:f,magFilter:p,type:R});this.minFilter=THREE.NearestFilter;this.magFilter=THREE.NearestFilter;this.type=THREE.FloatType;r.prototype.make.call(this);f=(g=this.minFilter)!=null?g:this.props.minFilter;p=(v=this.magFilter)!=null?v:this.props.magFilter;R=(y=this.type)!=null?y:this.props.type;M=this.props.width;u=this.props.height;n=this.props.depth;E=this.props.bufferWidth;w=this.props.bufferHeight;b=this.props.bufferDepth;t=this.props.channels;c=this.props.items;s=this.spec={channels:t,items:c,width:M,height:u,depth:n};this.items=s.items;this.channels=s.channels;i=this.props.data;s=a.Data.getDimensions(i,s);x=this.space;x.width=Math.max(E,s.width||1);x.height=Math.max(w,s.height||1);x.depth=Math.max(b,s.depth||1);this.buffer=this._renderables.make(this.storage,{width:x.width,height:x.height,depth:x.depth,channels:4,items:c,minFilter:f,magFilter:p,type:R});e=this.atlas;h=this.buffer.streamer.emit;return this.buffer.streamer.emit=function(t){return e.map(t,h)}};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);if(this.atlas){this.atlas.dispose();return this.atlas=null}};t.prototype.update=function(){this.atlas.begin();t.__super__.update.apply(this,arguments);return this.atlas.end()};t.prototype.change=function(e,i,r){if(i["font"]){return this.rebuild()}return t.__super__.change.call(this,e,i,r)};return t}(o);t.exports=n},{"../../../util":166,"../data/buffer":45,"../data/voxel":52}],96:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;n=e("../base/parent");r=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","clock","seek","play"];t.prototype.init=function(){this.skew=0;this.last=0;return this.time={now:+new Date/1e3,time:0,delta:0,clock:0,step:0}};t.prototype.make=function(){return this._listen("clock","clock.tick",this.tick)};t.prototype.reset=function(){return this.skew=0};t.prototype.tick=function(e){var t,i,r,n,a,o,s,h,l,u,c,p,f;l=this.props,n=l.from,f=l.to,c=l.speed,u=l.seek,a=l.pace,i=l.delay,h=l.realtime;o=this._inherit("clock").getTime();p=h?o.time:o.clock;r=h?o.delta:o.step;s=c/a;this.skew+=r*(s-1);if(this.last>p){this.skew=0}this.time.now=o.now+this.skew;this.time.time=o.time;this.time.delta=o.delta;t=u!=null?u:o.clock+this.skew;this.time.clock=Math.min(f,n+Math.max(0,t-i*s));this.time.step=r*s;this.last=p;return this.trigger(e)};t.prototype.getTime=function(){return this.time};return t}(n);t.exports=r},{"../base/parent":37}],97:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;n=e("../base/parent");r=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","clock","now"];t.prototype.init=function(){var e;this.now=e=+new Date/1e3;this.skew=0;return this.time={now:e,time:0,delta:0,clock:0,step:0}};t.prototype.make=function(){this.clockParent=this._inherit("clock");return this._listen("clock","clock.tick",this.tick)};t.prototype.unmake=function(){return this.clockParent=null};t.prototype.change=function(e,t,i){if(e["date.now"]){return this.skew=0}};t.prototype.tick=function(e){var t,i,r,n,a,o,s;n=this.props,t=n.now,o=n.seek,i=n.pace,s=n.speed;r=this.clockParent.getTime();this.skew+=r.step*i/s;if(o!=null){this.skew=o}this.time.now=this.time.time=this.time.clock=((a=this.props.now)!=null?a:this.now)+this.skew;this.time.delta=this.time.step=r.delta;return this.trigger(e)};t.prototype.getTime=function(){return this.time};return t}(n);t.exports=r},{"../base/parent":37}],98:[function(e,t,i){var r,n;n=e("./types");r={node:{id:n.nullable(n.string()),classes:n.classes()},entity:{active:n.bool(true)},object:{visible:n.bool(true)},unit:{scale:n.nullable(n.number()),fov:n.nullable(n.number()),focus:n.nullable(n.number(1),true)},span:{range:n.nullable(n.vec2(-1,1))},view:{range:n.array(n.vec2(-1,1),4)},view3:{position:n.vec3(),quaternion:n.quat(),rotation:n.vec3(),scale:n.vec3(1,1,1),eulerOrder:n.swizzle("xyz")},view4:{position:n.vec4(),scale:n.vec4(1,1,1,1)},layer:{depth:n.number(1),fit:n.fit("y")},vertex:{pass:n.vertexPass()},fragment:{pass:n.fragmentPass(),gamma:n.bool(false)},transform3:{position:n.vec3(),quaternion:n.quat(),rotation:n.vec3(),eulerOrder:n.swizzle("xyz"),scale:n.vec3(1,1,1),matrix:n.mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},transform4:{position:n.vec4(),scale:n.vec4(1,1,1,1),matrix:n.mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},camera:{proxy:n.bool(false),position:n.nullable(n.vec3()),quaternion:n.nullable(n.quat()),rotation:n.nullable(n.vec3()),lookAt:n.nullable(n.vec3()),up:n.nullable(n.vec3()),eulerOrder:n.swizzle("xyz"),fov:n.nullable(n.number(1))},polar:{bend:n.number(1),helix:n.number(0)},spherical:{bend:n.number(1)},stereographic:{bend:n.number(1)},interval:{axis:n.axis()},area:{axes:n.swizzle([1,2],2)},volume:{axes:n.swizzle([1,2,3],3)},origin:{origin:n.vec4()},scale:{divide:n.number(10),unit:n.number(1),base:n.number(10),mode:n.scale(),start:n.bool(true),end:n.bool(true),zero:n.bool(true),factor:n.positive(n.number(1)),nice:n.bool(true)},grid:{lineX:n.bool(true),lineY:n.bool(true),crossed:n.bool(false),closedX:n.bool(false),closedY:n.bool(false)},axis:{detail:n.int(1),crossed:n.bool(false)},rawtex:{width:n.nullable(n.positive(n.int(1),true)),height:n.nullable(n.positive(n.int(1),true)),image:n.nullable(n.object()),texture:n.nullable(n.object())},data:{data:n.nullable(n.data()),expr:n.nullable(n.emitter()),bind:n.nullable(n.func()),live:n.bool(true)},buffer:{channels:n["enum"](4,[1,2,3,4]),items:n.int(1),fps:n.nullable(n.int(60)),hurry:n.int(5),limit:n.int(60),realtime:n.bool(false),observe:n.bool(false),aligned:n.bool(false)},sampler:{centered:n.bool(false),padding:n.number(0)},array:{width:n.nullable(n.positive(n.int(1),true)),bufferWidth:n.int(1),history:n.int(1)},matrix:{width:n.nullable(n.positive(n.int(1),true)),height:n.nullable(n.positive(n.int(1),true)),history:n.int(1),bufferWidth:n.int(1),bufferHeight:n.int(1)},voxel:{width:n.nullable(n.positive(n.int(1),true)),height:n.nullable(n.positive(n.int(1),true)),depth:n.nullable(n.positive(n.int(1),true)),bufferWidth:n.int(1),bufferHeight:n.int(1),bufferDepth:n.int(1)},resolve:{expr:n.nullable(n.func()),items:n.int(1)},style:{opacity:n.positive(n.number(1)),color:n.color(),blending:n.blending(),zWrite:n.bool(true),zTest:n.bool(true),zIndex:n.positive(n.round()),zBias:n.number(0),zOrder:n.nullable(n.int())},geometry:{points:n.select(),colors:n.nullable(n.select())},point:{size:n.positive(n.number(4)),sizes:n.nullable(n.select()),shape:n.shape(),optical:n.bool(true),fill:n.bool(true),depth:n.number(1)},line:{width:n.positive(n.number(2)),depth:n.positive(n.number(1)),join:n.join(),stroke:n.stroke(),proximity:n.nullable(n.number(Infinity)),closed:n.bool(false)},mesh:{fill:n.bool(true),shaded:n.bool(false),map:n.nullable(n.select()),lineBias:n.number(5)},strip:{line:n.bool(false)},face:{line:n.bool(false)},arrow:{size:n.number(3),start:n.bool(false),end:n.bool(false)},ticks:{normal:n.vec3(0,0,1),size:n.positive(n.number(10)),epsilon:n.positive(n.number(.001))},attach:{offset:n.vec2(0,-20),snap:n.bool(false),depth:n.number(0)},format:{digits:n.nullable(n.positive(n.number(3))),data:n.nullable(n.data()),expr:n.nullable(n.func()),live:n.bool(true)},font:{font:n.font("sans-serif"),style:n.string(),variant:n.string(),weight:n.string(),detail:n.number(24),sdf:n.number(5)},label:{text:n.select(),size:n.number(16),outline:n.number(2),expand:n.number(0),background:n.color(1,1,1)},overlay:{opacity:n.number(1),zIndex:n.positive(n.round(0))},dom:{points:n.select(),html:n.select(),size:n.number(16),outline:n.number(2),zoom:n.number(1),color:n.nullable(n.color()),attributes:n.nullable(n.object()),pointerEvents:n.bool(false)},texture:{minFilter:n.filter("nearest"),magFilter:n.filter("nearest"),type:n.type("float")},shader:{sources:n.nullable(n.select()),language:n.string("glsl"),code:n.string(),uniforms:n.nullable(n.object())},include:{shader:n.select()},operator:{source:n.select()},spread:{unit:n.mapping(),items:n.nullable(n.vec4()),width:n.nullable(n.vec4()),height:n.nullable(n.vec4()),depth:n.nullable(n.vec4()),alignItems:n.anchor(),alignWidth:n.anchor(),alignHeight:n.anchor(),alignDepth:n.anchor()},grow:{scale:n.number(1),items:n.nullable(n.anchor()),width:n.nullable(n.anchor()),height:n.nullable(n.anchor()),depth:n.nullable(n.anchor())},split:{order:n.transpose("wxyz"),axis:n.nullable(n.axis()),length:n.int(1),overlap:n.int(0)},join:{order:n.transpose("wxyz"),axis:n.nullable(n.axis()),overlap:n.int(0)},swizzle:{order:n.swizzle()},transpose:{order:n.transpose()},repeat:{items:n.number(1),width:n.number(1),height:n.number(1),depth:n.number(1)},slice:{items:n.nullable(n.vec2()),width:n.nullable(n.vec2()),height:n.nullable(n.vec2()),depth:n.nullable(n.vec2())},lerp:{size:n.mapping("absolute"),items:n.nullable(n.number()),width:n.nullable(n.number()),height:n.nullable(n.number()),depth:n.nullable(n.number())},subdivide:{items:n.nullable(n.positive(n.int(),true)),width:n.nullable(n.positive(n.int(),true)),height:n.nullable(n.positive(n.int(),true)),depth:n.nullable(n.positive(n.int(),true)),bevel:n.number(1),lerp:n.bool(true)},resample:{indices:n.number(4),channels:n.number(4),sample:n.mapping(),size:n.mapping("absolute"),items:n.nullable(n.number()),width:n.nullable(n.number()),height:n.nullable(n.number()),depth:n.nullable(n.number())},readback:{type:n.type("float"),expr:n.nullable(n.func()),data:n.data(),channels:n["enum"](4,[1,2,3,4]),items:n.nullable(n.int()),width:n.nullable(n.int()),height:n.nullable(n.int()),depth:n.nullable(n.int())},root:{speed:n.number(1),camera:n.select("[camera]")},inherit:{source:n.select(),traits:n.array(n.string())},rtt:{size:n.mapping("absolute"),width:n.nullable(n.number()),height:n.nullable(n.number()),history:n.int(1)},compose:{alpha:n.bool(false)},present:{index:n.int(1),directed:n.bool(true),length:n.number(0)},slide:{order:n.nullable(n.int(0)),steps:n.number(1),early:n.int(0),late:n.int(0),from:n.nullable(n.int(0)),to:n.nullable(n.int(1))},transition:{stagger:n.vec4(),enter:n.nullable(n.number(1)),exit:n.nullable(n.number(1)),delay:n.number(0),delayEnter:n.nullable(n.number(0)),delayExit:n.nullable(n.number(0)),duration:n.number(.3),durationEnter:n.nullable(n.number(0)),durationExit:n.nullable(n.number(0))},move:{from:n.vec4(),to:n.vec4()},seek:{seek:n.nullable(n.number(0))},track:{target:n.select(),script:n.object({}),ease:n.ease("cosine")},trigger:{trigger:n.nullable(n.int(1),true)},step:{playback:n.ease("linear"),stops:n.nullable(n.array(n.number())),delay:n.number(0),duration:n.number(.3),pace:n.number(0),speed:n.number(1),rewind:n.number(2),skip:n.bool(true),realtime:n.bool(false)},play:{delay:n.number(0),pace:n.number(1),speed:n.number(1),from:n.number(0),to:n.number(Infinity),realtime:n.bool(false),loop:n.bool(false)},now:{now:n.nullable(n.timestamp()),seek:n.nullable(n.number(0)),pace:n.number(1),speed:n.number(1)}};t.exports=r},{"./types":106}],99:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;n=e("./transform");r=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","include","fragment","bind"];t.prototype.make=function(){return this._helpers.bind.make([{to:"include.shader",trait:"shader",optional:true}])};t.prototype.unmake=function(){return this._helpers.bind.unmake()};t.prototype.change=function(e,t,i){if(t["include"]||e["fragment.gamma"]){return this.rebuild()}};t.prototype.fragment=function(e,i){if(this.bind.shader!=null){if(i===this.props.pass){if(this.props.gamma){e.pipe("mesh.gamma.out")}e.pipe(this.bind.shader.shaderBind());e.split();if(this.props.gamma){e.pipe("mesh.gamma.in")}e.pass()}}return t.__super__.fragment.call(this,e,i)};return t}(n);t.exports=r},{"./transform":102}],100:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("./transform");a=Math.PI;r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","vertex","layer"];t.prototype.make=function(){this._listen("root","root.resize",this.update);return this.uniforms={layerScale:this._attributes.make(this._types.vec4()),layerBias:this._attributes.make(this._types.vec4())}};t.prototype.update=function(){var e,t,i,r,n,o,s,h,l,u,c,p;i=this._inherit("root").getCamera();p=this._inherit("root").getSize();t=(h=i.aspect)!=null?h:1;o=(l=i.fov)!=null?l:1;s=Math.tan(o*a/360);e=this.node.attributes["layer.fit"]["enum"];u=this.props,n=u.fit,r=u.depth,c=u.scale;switch(n){case e.contain:n=t>1?e.y:e.x;break;case e.cover:n=t>1?e.x:e.y}switch(n){case e.x:this.uniforms.layerScale.value.set(s*t,s*t);break;case e.y:this.uniforms.layerScale.value.set(s,s)}return this.uniforms.layerBias.value.set(0,0,-r,0)};t.prototype.change=function(e,t,i){if(e["layer.fit"]||e["layer.depth"]||i){return this.update()}};t.prototype.vertex=function(e,t){if(t===2){return e.pipe("layer.position",this.uniforms)}if(t===3){return e.pipe("root.position")}return e};return t}(n);t.exports=r},{"./transform":102}],101:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;n=e("../base/parent");r=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","include","mask","bind"];t.prototype.make=function(){return this._helpers.bind.make([{to:"include.shader",trait:"shader",optional:true}])};t.prototype.unmake=function(){return this._helpers.bind.unmake()};t.prototype.change=function(e,t,i){if(t["include"]){return this.rebuild()}};t.prototype.mask=function(e){var t,i,r;if(this.bind.shader!=null){if(e){r=this._shaders.shader();r.pipe(Util.GLSL.identity("vec4"));r.fan();r.pipe(e);r.next();r.pipe(this.bind.shader.shaderBind());r.end();r.pipe("float combine(float a, float b) { return min(a, b); }")}else{r=this._shaders.shader();r.pipe(this.bind.shader.shaderBind())}}else{r=e}return(t=(i=this._inherit("mask"))!=null?i.mask(r):void 0)!=null?t:r};return t}(n);t.exports=r},{"../base/parent":37}],102:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;r=e("../base/parent");n=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","vertex","fragment"];t.prototype.vertex=function(e,t){var i,r;return(i=(r=this._inherit("vertex"))!=null?r.vertex(e,t):void 0)!=null?i:e};t.prototype.fragment=function(e,t){var i,r;return(i=(r=this._inherit("fragment"))!=null?r.fragment(e,t):void 0)!=null?i:e};return t}(r);t.exports=n},{"../base/parent":37}],103:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("./transform");a=e("../../../util");n=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","vertex","transform3"];t.prototype.make=function(){this.uniforms={transformMatrix:this._attributes.make(this._types.mat4())};return this.composer=a.Three.transformComposer()};t.prototype.unmake=function(){return delete this.uniforms};t.prototype.change=function(e,t,i){var r,n,a,o,s,h;if(e["transform3.pass"]){return this.rebuild()}if(!(t["transform3"]||i)){return}a=this.props.position;o=this.props.quaternion;s=this.props.rotation;h=this.props.scale;n=this.props.matrix;r=this.props.eulerOrder;return this.uniforms.transformMatrix.value=this.composer(a,s,o,h,n,r)};t.prototype.vertex=function(e,i){if(i===this.props.pass){e.pipe("transform3.position",this.uniforms)}return t.__super__.vertex.call(this,e,i)};return t}(r);t.exports=n},{"../../../util":166,"./transform":102}],104:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;r=e("./transform");n=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","vertex","transform4"];t.prototype.make=function(){this.uniforms={transformMatrix:this._attributes.make(this._types.mat4()),transformOffset:this.node.attributes["transform4.position"]};return this.transformMatrix=this.uniforms.transformMatrix.value};t.prototype.unmake=function(){return delete this.uniforms};t.prototype.change=function(e,t,i){var r,n,a;if(e["transform4.pass"]){return this.rebuild()}if(!(t["transform4"]||i)){return}n=this.props.scale;r=this.props.matrix;a=this.transformMatrix;a.copy(r);return a.scale(n)};t.prototype.vertex=function(e,i){if(i===this.props.pass){e.pipe("transform4.position",this.uniforms)}return t.__super__.vertex.call(this,e,i)};return t}(r);t.exports=n},{"./transform":102}],105:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;r=e("./transform");n=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","include","vertex","bind"];t.prototype.make=function(){return this._helpers.bind.make([{to:"include.shader",trait:"shader",optional:true}])};t.prototype.unmake=function(){return this._helpers.bind.unmake()};t.prototype.change=function(e,t,i){if(t["include"]){return this.rebuild()}};t.prototype.vertex=function(e,i){if(this.bind.shader!=null){if(i===this.props.pass){e.pipe(this.bind.shader.shaderBind())}}return t.__super__.vertex.call(this,e,i)};return t}(r);t.exports=n},{"./transform":102}],106:[function(e,t,i){var r,n,a,o=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++){if(t in this&&this[t]===e)return t}return-1};n=e("../../util");r={array:function(e,t,i){var r,n;if(i==null){i=null}r=e.lerp?function(t,i,r,n){var a,o,s,h;s=Math.min(t.length,i.length);for(a=o=0,h=s;0<=h?o<h:o>h;a=0<=h?++o:--o){r[a]=e.lerp(t[a],i[a],r[a],n)}return r}:void 0;n=e.op?function(t,i,r,n){var a,o,s,h;s=Math.min(t.length,i.length);for(a=o=0,h=s;0<=h?o<h:o>h;a=0<=h?++o:--o){r[a]=e.op(t[a],i[a],r[a],n)}return r}:void 0;if(i!=null&&!(i instanceof Array)){i=[i]}return{uniform:function(){if(e.uniform){return e.uniform()+"v"}else{return void 0}},make:function(){var r,n,a,o;if(i!=null){return i.slice()}if(!t){return[]}o=[];for(r=n=0,a=t;0<=a?n<a:n>a;r=0<=a?++n:--n){o.push(e.make())}return o},validate:function(i,r,n){var a,o,s,h,l,u;if(!(i instanceof Array)){i=[i]}h=r.length=t?t:i.length;for(a=s=0,l=h;0<=l?s<l:s>l;a=0<=l?++s:--s){o=(u=i[a])!=null?u:e.make();r[a]=e.validate(o,r[a],n)}return r},equals:function(t,i){var r,n,a,o,s,h;r=t.length;n=i.length;if(r!==n){return false}s=Math.min(r,n);for(a=o=0,h=s;0<=h?o<h:o>h;a=0<=h?++o:--o){if(!(typeof e.equals==="function"?e.equals(t[a],i[a]):void 0)){return false}}return true},lerp:r,op:n,clone:function(t){var i,r,n,a;n=[];for(i=0,r=t.length;i<r;i++){a=t[i];n.push(e.clone(a))}return n}}},letters:function(e,t,i){var n,a,o,s,h;if(i==null){i=null}if(i!=null){if(i===""+i){i=i.split("")}for(a=o=0,s=i.length;o<s;a=++o){h=i[a];i[a]=e.validate(h,h)}}n=r.array(e,t,i);return{uniform:function(){return n.uniform()},make:function(){return n.make()},validate:function(e,t,i){if(e===""+e){e=e.split("")}return n.validate(e,t,i)},equals:function(e,t){return n.equals(e,t)},clone:n.clone}},nullable:function(e,t){var i,r,n,a;if(t==null){t=false}a=t?e.make():null;i=e.emitter?function(t,i){if(i==null){return t}if(t==null){return i}return e.emitter(t,i)}:void 0;r=e.lerp?function(t,i,r,n){if(t===null||i===null){if(n<.5){return t}else{return i}}if(r==null){r=e.make()}a=e.lerp(t,i,r,n);return r}:void 0;n=e.op?function(t,i,r,n){if(t===null||i===null){return null}if(r==null){r=e.make()}a=e.op(t,i,r,n);return a}:void 0;return{make:function(){return a},validate:function(t,i,r){if(t===null){return t}if(i===null){i=e.make()}return e.validate(t,i,r)},uniform:function(){return typeof e.uniform==="function"?e.uniform():void 0},equals:function(t,i){var r,n,a;r=t===null;n=i===null;if(r&&n){return true}if(r^n){return false}return(a=typeof e.equals==="function"?e.equals(t,i):void 0)!=null?a:t===i},lerp:r,op:n,emitter:i}},enum:function(e,t,i){var r,n,a,o,s,h,l;if(t==null){t=[]}if(i==null){i={}}r=0;l={};for(n=0,o=t.length;n<o;n++){a=t[n];if(a!==+a){if(i[a]==null){i[a]=r++}}}for(h=0,s=t.length;h<s;h++){a=t[h];if(a===+a){l[a]=a}}for(a in i){r=i[a];l[r]=true}if(l[e]==null){e=i[e]}return{enum:function(){return i},make:function(){return e},validate:function(e,t,r){var n;n=l[e]?e:i[e];if(n!=null){return n}return r()}}},enumber:function(e,t,i){var n;if(i==null){i={}}n=r["enum"](e,t,i);return{enum:n["enum"],uniform:function(){return"f"},make:function(){var t;return(t=n.make())!=null?t:+e},validate:function(e,t,i){if(e===+e){return e}return n.validate(e,t,i)},op:function(e,t,i,r){return r(e,t)}}},select:function(e){if(e==null){e="<"}e;return{make:function(){return e},validate:function(e,t,i){if(typeof e==="string"){return e}if(typeof e==="object"){return e}return i()}}},bool:function(e){e=!!e;return{uniform:function(){return"f"},make:function(){return e},validate:function(e,t,i){return!!e}}},int:function(e){if(e==null){e=0}e=+Math.round(e);return{uniform:function(){return"i"},make:function(){return e},validate:function(e,t,i){var r;if(e!==(r=+e)){return i()}return Math.round(r)||0},op:function(e,t,i,r){return r(e,t)}}},round:function(e){if(e==null){e=0}e=+Math.round(e);return{uniform:function(){return"f"},make:function(){return e},validate:function(e,t,i){var r;if(e!==(r=+e)){return i()}return Math.round(r)||0},op:function(e,t,i,r){return r(e,t)}}},number:function(e){if(e==null){e=0}return{uniform:function(){return"f"},make:function(){return+e},validate:function(e,t,i){var r;if(e!==(r=+e)){return i()}return r||0},op:function(e,t,i,r){return r(e,t)}}},positive:function(e,t){if(t==null){t=false}return{uniform:e.uniform,make:e.make,validate:function(i,r,n){i=e.validate(i,r,n);if(i<0||t&&i<=0){return n()}return i},op:function(e,t,i,r){return r(e,t)}}},string:function(e){if(e==null){e=""}return{make:function(){return""+e},validate:function(e,t,i){var r;if(e!==(r=""+e)){return i()}return r}}},func:function(){return{make:function(){return function(){}},validate:function(e,t,i){if(typeof e==="function"){return e}return i()}}},emitter:function(){return{make:function(){return function(e){return e(1,1,1,1)}},validate:function(e,t,i){if(typeof e==="function"){return e}return i()},emitter:function(e,t){return n.Data.getLerpEmitter(e,t)}}},object:function(e){return{make:function(){return e!=null?e:{}},validate:function(e,t,i){if(typeof e==="object"){return e}return i()},clone:function(e){return JSON.parse(JSON.stringify(e))}}},timestamp:function(e){if(e==null){e=null}if(typeof e==="string"){e=Date.parse(e)}return{uniform:function(){return"f"},make:function(){return e!=null?e:+new Date},validate:function(e,t,i){var r;e=Date.parse(e);if(e!==(r=+e)){return i()}return e},op:function(e,t,i,r){return r(e,t)}}},vec2:function(e,t){var i;if(e==null){e=0}if(t==null){t=0}i=[e,t];return{uniform:function(){return"v2"},make:function(){return new THREE.Vector2(e,t)},validate:function(r,n,a){var o,s,h,l;if(r===+r){r=[r]}if(r instanceof THREE.Vector2){n.copy(r)}else if(r instanceof Array){r=r.concat(i.slice(r.length));n.set.apply(n,r)}else if(r!=null){h=(o=r.x)!=null?o:e;l=(s=r.y)!=null?s:t;n.set(h,l)}else{return a()}return n},equals:function(e,t){return e.x===t.x&&e.y===t.y},op:function(e,t,i,r){i.x=r(e.x,t.x);i.y=r(e.y,t.y);return i}}},ivec2:function(e,t){var i,n;if(e==null){e=0}if(t==null){t=0}n=r.vec2(e,t);i=n.validate;n.validate=function(e,t,r){i(e,t,r);t.x=Math.round(t.x);t.y=Math.round(t.y);return t};return n},vec3:function(e,t,i){var r;if(e==null){e=0}if(t==null){t=0}if(i==null){i=0}r=[e,t,i];return{uniform:function(){return"v3"},make:function(){return new THREE.Vector3(e,t,i)},validate:function(n,a,o){var s,h,l,u,c,p;if(n===+n){n=[n]}if(n instanceof THREE.Vector3){a.copy(n)}else if(n instanceof Array){n=n.concat(r.slice(n.length));a.set.apply(a,n)}else if(n!=null){u=(s=n.x)!=null?s:e;c=(h=n.y)!=null?h:t;p=(l=n.z)!=null?l:i;a.set(u,c,p)}else{return o()}return a},equals:function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z},op:function(e,t,i,r){i.x=r(e.x,t.x);i.y=r(e.y,t.y);i.z=r(e.z,t.z);return i}}},ivec3:function(e,t,i){var n,a;if(e==null){e=0}if(t==null){t=0}if(i==null){i=0}a=r.vec3(e,t,i);n=a.validate;a.validate=function(e,t){n(e,t,invalid);t.x=Math.round(t.x);t.y=Math.round(t.y);t.z=Math.round(t.z);return t};return a},vec4:function(e,t,i,r){var n;if(e==null){e=0}if(t==null){t=0}if(i==null){i=0}if(r==null){r=0}n=[e,t,i,r];return{uniform:function(){return"v4"},make:function(){return new THREE.Vector4(e,t,i,r)},validate:function(a,o,s){var h,l,u,c,p,f,d,m;if(a===+a){a=[a]}if(a instanceof THREE.Vector4){o.copy(a)}else if(a instanceof Array){a=a.concat(n.slice(a.length));o.set.apply(o,a)}else if(a!=null){f=(h=a.x)!=null?h:e;d=(l=a.y)!=null?l:t;m=(u=a.z)!=null?u:i;p=(c=a.w)!=null?c:r;o.set(f,d,m,p)}else{return s()}return o},equals:function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},op:function(e,t,i,r){i.x=r(e.x,t.x);i.y=r(e.y,t.y);i.z=r(e.z,t.z);i.w=r(e.w,t.w);return i}}},ivec4:function(e,t,i,n){var a,o;if(e==null){e=0}if(t==null){t=0}if(i==null){i=0}if(n==null){n=0}o=r.vec4(e,t,i,n);a=o.validate;o.validate=function(e,t){a(e,t,invalid);t.x=Math.round(t.x);t.y=Math.round(t.y);t.z=Math.round(t.z);t.w=Math.round(t.w);return t};return o},mat3:function(e,t,i,r,n,a,o,s,h){var l;if(e==null){e=1}if(t==null){t=0}if(i==null){i=0}if(r==null){r=0}if(n==null){n=1}if(a==null){a=0}if(o==null){o=0}if(s==null){s=0}if(h==null){h=1}l=[e,t,i,r,n,a,o,s,h];return{uniform:function(){return"m4"},make:function(){var l;l=new THREE.Matrix3;l.set(e,t,i,r,n,a,o,s,h);return l},validate:function(e,t,i){if(e instanceof THREE.Matrix3){t.copy(e)}else if(e instanceof Array){e=e.concat(l.slice(e.length));t.set.apply(t,e)}else{return i()}return t}}},mat4:function(e,t,i,r,n,a,o,s,h,l,u,c,p,f,d,m){var g;if(e==null){e=1}if(t==null){t=0}if(i==null){i=0}if(r==null){r=0}if(n==null){n=0}if(a==null){a=1}if(o==null){o=0}if(s==null){s=0}if(h==null){h=0}if(l==null){l=0}if(u==null){u=1}if(c==null){c=0}if(p==null){p=0}if(f==null){f=0}if(d==null){d=0}if(m==null){m=1}g=[e,t,i,r,n,a,o,s,h,l,u,c,p,f,d,m];return{uniform:function(){return"m4"},make:function(){var g;g=new THREE.Matrix4;g.set(e,t,i,r,n,a,o,s,h,l,u,c,p,f,d,m);return g},validate:function(e,t,i){if(e instanceof THREE.Matrix4){t.copy(e)}else if(e instanceof Array){e=e.concat(g.slice(e.length));t.set.apply(t,e)}else{return i()}return t}}},quat:function(e,t,i,n){var a;if(e==null){e=0}if(t==null){t=0}if(i==null){i=0}if(n==null){n=1}a=r.vec4(e,t,i,n);return{uniform:function(){return"v4"},make:function(){return new THREE.Quaternion},validate:function(e,t,i){if(e instanceof THREE.Quaternion){t.copy(e)}else{t=a.validate(e,t,i)}t.normalize();return t},equals:function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},op:function(e,t,i,r){i.x=r(e.x,t.x);i.y=r(e.y,t.y);i.z=r(e.z,t.z);i.w=r(e.w,t.w);i.normalize();return i},lerp:function(e,t,i,r){THREE.Quaternion.slerp(e,t,i,r);return i}}},color:function(e,t,i){var r;if(e==null){e=.5}if(t==null){t=.5}if(i==null){i=.5}r=[e,t,i];return{uniform:function(){return"c"},make:function(){return new THREE.Color(e,t,i)},validate:function(n,a,o){var s,h,l,u,c,p;if(n===""+n){n=(new THREE.Color).setStyle(n)}else if(n===+n){n=new THREE.Color(n)}if(n instanceof THREE.Color){a.copy(n)}else if(n instanceof Array){n=n.concat(r.slice(n.length));a.setRGB.apply(a,n)}else if(n!=null){p=(l=n.r)!=null?l:e;h=(u=n.g)!=null?u:t;s=(c=n.b)!=null?c:i;a.set(p,h,s)}else{return o()}return a},equals:function(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b},op:function(e,t,i,r){i.r=r(e.r,t.r);i.g=r(e.g,t.g);i.b=r(e.b,t.b);return i}}},axis:function(e,t){var i,r,n;if(e==null){e=1}if(t==null){t=false}i={x:1,y:2,z:3,w:4,W:1,H:2,D:3,I:4,zero:0,null:0,width:1,height:2,depth:3,items:4};r=t?[0,1,2,3,4]:[1,2,3,4];if((n=i[e])!=null){e=n}return{make:function(){return e},validate:function(e,t,a){var s;if((n=i[e])!=null){e=n}e=(s=Math.round(e))!=null?s:0;if(o.call(r,e)>=0){return e}return a()}}},transpose:function(e){var t,i;if(e==null){e=[1,2,3,4]}i=r.letters(r.axis(null,false),0,e);t=r.letters(r.axis(null,false),4,e);return{make:function(){return t.make()},validate:function(e,r,n){var a,o,s,h,l;h=[1,2,3,4];i.validate(e,h,n);if(h.length<4){s=[1,2,3,4].filter(function(e){return h.indexOf(e)===-1});h=h.concat(s)}l=function(){var e,t,i;i=[];for(a=e=0,t=h.length;e<t;a=++e){o=h[a];i.push(h.indexOf(o)===a)}return i}();if(l.indexOf(false)<0){return t.validate(h,r,n)}return n()},equals:t.equals,clone:t.clone}},swizzle:function(e,t){var i,n;if(e==null){e=[1,2,3,4]}if(t==null){t=null}if(t==null){t=e.length}e=e.slice(0,t);n=r.letters(r.axis(null,false),0,e);i=r.letters(r.axis(null,true),t,e);return{make:function(){return i.make()},validate:function(r,a,o){var s;s=e.slice();n.validate(r,s,o);if(s.length<t){s=s.concat([0,0,0,0]).slice(0,t)}return i.validate(s,a,o)},equals:i.equals,clone:i.clone}},classes:function(){var e;e=r.array(r.string());return{make:function(){return e.make()},validate:function(t,i,r){if(t===""+t){t=t.split(" ")}t=t.filter(function(e){return!!e.length});return e.validate(t,i,r)},equals:e.equals,clone:e.clone}},blending:function(e){var t;if(e==null){e="normal"}t=["no","normal","add","subtract","multiply","custom"];return r["enum"](e,t)},filter:function(e){var t;if(e==null){e="nearest"}t={nearest:THREE.NearestFilter,nearestMipMapNearest:THREE.NearestMipMapNearestFilter,nearestMipMapLinear:THREE.NearestMipMapLinearFilter,linear:THREE.LinearFilter,linearMipMapNearest:THREE.LinearMipMapNearestFilter,linearMipmapLinear:THREE.LinearMipMapLinearFilter};return r["enum"](e,[],t)},type:function(e){var t;if(e==null){e="unsignedByte"}t={unsignedByte:THREE.UnsignedByteType,byte:THREE.ByteType,short:THREE.ShortType,unsignedShort:THREE.UnsignedShortType,int:THREE.IntType,unsignedInt:THREE.UnsignedIntType,float:THREE.FloatType};return r["enum"](e,[],t)},scale:function(e){var t;if(e==null){e="linear"}t=["linear","log"];return r["enum"](e,t)},mapping:function(e){var t;if(e==null){e="relative"}t=["relative","absolute"];return r["enum"](e,t)},indexing:function(e){var t;if(e==null){e="original"}t=["original","final"];return r["enum"](e,t)},shape:function(e){var t;if(e==null){e="circle"}t=["circle","square","diamond","up","down","left","right"];return r["enum"](e,t)},join:function(e){var t;if(e==null){e="miter"}t=["miter","round","bevel"];return r["enum"](e,t)},stroke:function(e){var t;if(e==null){e="solid"}t=["solid","dotted","dashed"];return r["enum"](e,t)},vertexPass:function(e){var t;if(e==null){e="view"}t=["data","view","world","eye"];return r["enum"](e,t)},fragmentPass:function(e){var t;if(e==null){e="light"}t=["color","light","rgba"];return r["enum"](e,t)},ease:function(e){var t;if(e==null){e="linear"}t=["linear","cosine","binary","hold"];return r["enum"](e,t)},fit:function(e){var t;if(e==null){e="contain"}t=["x","y","contain","cover"];return r["enum"](e,t)},anchor:function(e){var t;if(e==null){e="middle"}t={first:1,middle:0,last:-1};return r.enumber(e,[],t)},transitionState:function(e){var t;if(e==null){e="enter"}t={enter:-1,visible:0,exit:1};return r.enumber(e,[],t)},font:function(e){var t,i;if(e==null){e="sans-serif"}t=n.JS.parseQuoted;if(!(e instanceof Array)){e=t(e)}i=r.array(r.string(),0,e);return{make:function(){return i.make()},validate:function(e,r,n){try{if(!(e instanceof Array)){e=t(e)}}catch(e){return n()}e=e.filter(function(e){return!!e.length});return i.validate(e,r,n)},equals:i.equals,clone:i.clone}},data:function(e){if(e==null){e=[]}return{make:function(){return[]},validate:function(e,t,i){if(e instanceof Array){return e}else if((e!=null?e.length:void 0)!=null){return e}else{return i()}},emitter:function(e,t){return n.Data.getLerpThunk(e,t)}}}};a=function(e){var t,i;for(t in e){i=e[t];e[t]=function(e){return function(){var t;t=e.apply(e,arguments);if(t.validate==null){t.validate=function(e){return e!=null}}if(t.equals==null){t.equals=function(e,t){return e===t}}if(t.clone==null){t.clone=function(e){var t;return(t=e!=null?typeof e.clone==="function"?e.clone():void 0:void 0)!=null?t:e}}return t}}(i)}return e};t.exports=a(r)},{"../../util":166}],107:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;a=e("./view");n=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","object","visible","view","view3","vertex"];t.prototype.make=function(){t.__super__.make.apply(this,arguments);this.uniforms={viewMatrix:this._attributes.make(this._types.mat4())};this.viewMatrix=this.uniforms.viewMatrix.value;return this.composer=n.Three.transformComposer()};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);delete this.viewMatrix;delete this.objectMatrix;return delete this.uniforms};t.prototype.change=function(e,t,i){var r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y;if(!(t["view"]||t["view3"]||i)){return}h=this.props.position;c=this.props.scale;l=this.props.quaternion;u=this.props.rotation;s=this.props.range;o=this.props.eulerOrder;g=s[0].x;v=s[1].x;y=s[2].x;r=s[0].y-g||1;n=s[1].y-v||1;a=s[2].y-y||1;p=c.x;f=c.y;d=c.z;this.viewMatrix.set(2/r,0,0,-(2*g+r)/r,0,2/n,0,-(2*v+n)/n,0,0,2/a,-(2*y+a)/a,0,0,0,1);m=this.composer(h,u,l,c,null,o);this.viewMatrix.multiplyMatrices(m,this.viewMatrix);if(e["view.range"]){return this.trigger({type:"view.range"})}};t.prototype.vertex=function(e,i){if(i===1){e.pipe("cartesian.position",this.uniforms)}return t.__super__.vertex.call(this,e,i)};return t}(a);t.exports=r},{"../../../util":166,"./view":113}],108:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;n=e("./view");r=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","object","visible","view","view4","vertex"];t.prototype.make=function(){t.__super__.make.apply(this,arguments);this.uniforms={basisOffset:this._attributes.make(this._types.vec4()),basisScale:this._attributes.make(this._types.vec4())};this.basisScale=this.uniforms.basisScale.value;return this.basisOffset=this.uniforms.basisOffset.value};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);delete this.basisScale;delete this.basisOffset;return delete this.uniforms};t.prototype.change=function(e,t,i){var r,n,a,o,s,h,l,u,c,p,f,d;if(!(t["view"]||t["view4"]||i)){return}l=this.props.position;u=this.props.scale;s=this.props.range;p=s[0].x;f=s[1].x;d=s[2].x;c=s[3].x;n=s[0].y-p||1;a=s[1].y-f||1;o=s[2].y-d||1;r=s[3].y-c||1;h=function(e,t){e.x*=t.x;e.y*=t.y;e.z*=t.z;return e.w*=t.w};this.basisScale.set(2/n,2/a,2/o,2/r);this.basisOffset.set(-(2*p+n)/n,-(2*f+a)/a,-(2*d+o)/o,-(2*c+r)/r);h(this.basisScale,u);h(this.basisOffset,u);this.basisOffset.add(l);if(e["view.range"]){return this.trigger({type:"view.range"})}};t.prototype.vertex=function(e,i){if(i===1){e.pipe("cartesian4.position",this.uniforms)}return t.__super__.vertex.call(this,e,i)};return t}(n);t.exports=r},{"./view":113}],109:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;a=e("./view");n=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","object","visible","view","view3","polar","vertex"];t.prototype.make=function(){var e;t.__super__.make.apply(this,arguments);e=this._attributes.types;this.uniforms={polarBend:this.node.attributes["polar.bend"],polarHelix:this.node.attributes["polar.helix"],polarFocus:this._attributes.make(e.number()),polarAspect:this._attributes.make(e.number()),viewMatrix:this._attributes.make(e.mat4())};this.viewMatrix=this.uniforms.viewMatrix.value;this.composer=n.Three.transformComposer();return this.aspect=1};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);delete this.viewMatrix;delete this.objectMatrix;delete this.aspect;return delete this.uniforms};t.prototype.change=function(e,t,i){var r,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M,S;if(!(t["view"]||t["view3"]||t["polar"]||i)){return}this.helix=d=this.props.helix;this.bend=o=this.props.bend;this.focus=p=o>0?1/o-1:0;g=this.props.position;w=this.props.scale;v=this.props.quaternion;y=this.props.rotation;f=this.props.range;u=this.props.eulerOrder;H=f[0].x;M=f[1].x;S=f[2].x;s=f[0].y-H||1;h=f[1].y-M||1;l=f[2].y-S||1;x=w.x;T=w.y;R=w.z;m=s>0?1:-1;E=n.Axis.recenterAxis(M,h,o),M=E[0],h=E[1];r=Math.abs(h);c=s+(r*m-s)*o;b=c/x;_=h/T;this.aspect=a=Math.abs(b/_);this.uniforms.polarFocus.value=p;this.uniforms.polarAspect.value=a;this.viewMatrix.set(2/c,0,0,-(2*H+s)/s,0,2/h,0,-(2*M+h)/h,0,0,2/l,-(2*S+l)/l,0,0,0,1);k=this.composer(g,y,v,w,null,u);this.viewMatrix.multiplyMatrices(k,this.viewMatrix);if(e["view.range"]||t["polar"]){return this.trigger({type:"view.range"})}};t.prototype.vertex=function(e,i){if(i===1){e.pipe("polar.position",this.uniforms)}return t.__super__.vertex.call(this,e,i)};t.prototype.axis=function(e){var t,i,r;r=this.props.range[e-1];i=r.x;t=r.y;if(e===2&&this.bend>0){t=Math.max(Math.abs(t),Math.abs(i));i=Math.max(-this.focus/this.aspect,i)}return new THREE.Vector2(i,t)};return t}(a);t.exports=r},{"../../../util":166,"./view":113}],110:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;a=e("./view");n=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","object","visible","view","view3","spherical","vertex"];t.prototype.make=function(){var e;t.__super__.make.apply(this,arguments);e=this._attributes.types;this.uniforms={sphericalBend:this.node.attributes["spherical.bend"],sphericalFocus:this._attributes.make(this._types.number()),sphericalAspectX:this._attributes.make(this._types.number()),sphericalAspectY:this._attributes.make(this._types.number()),sphericalScaleY:this._attributes.make(this._types.number()),viewMatrix:this._attributes.make(this._types.mat4())};this.viewMatrix=this.uniforms.viewMatrix.value;this.composer=n.Three.transformComposer();this.aspectX=1;return this.aspectY=1};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);delete this.viewMatrix;delete this.objectMatrix;delete this.aspectX;delete this.aspectY;return delete this.uniforms};t.prototype.change=function(e,t,i){var r,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M,S,A,C,z,P,L,O;if(!(t["view"]||t["view3"]||t["spherical"]||i)){return}this.bend=h=this.props.bend;this.focus=m=h>0?1/h-1:0;E=this.props.position;T=this.props.scale;w=this.props.quaternion;b=this.props.rotation;g=this.props.range;p=this.props.eulerOrder;P=g[0].x;L=g[1].x;O=g[2].x;l=g[0].y-P||1;u=g[1].y-L||1;c=g[2].y-O||1;S=T.x;A=T.y;C=T.z;_=n.Axis.recenterAxis(L,u,h),L=_[0],u=_[1];x=n.Axis.recenterAxis(O,c,h),O=x[0],c=x[1];v=l>0?1:-1;y=u>0?1:-1;r=Math.abs(c);f=l+(r*v-l)*h;d=u+(r*y-u)*h;k=f/S;H=d/A;M=c/C;this.aspectX=a=Math.abs(k/M);this.aspectY=o=Math.abs(H/M/a);s=u/l*S/A*2;this.scaleY=R=Math.min(o/h,1+(s-1)*h);this.uniforms.sphericalBend.value=h;this.uniforms.sphericalFocus.value=m;this.uniforms.sphericalAspectX.value=a;this.uniforms.sphericalAspectY.value=o;this.uniforms.sphericalScaleY.value=R;this.viewMatrix.set(2/f,0,0,-(2*P+l)/l,0,2/d,0,-(2*L+u)/u,0,0,2/c,-(2*O+c)/c,0,0,0,1);z=this.composer(E,b,w,T,null,p);this.viewMatrix.multiplyMatrices(z,this.viewMatrix);if(e["view.range"]||t["spherical"]){return this.trigger({type:"view.range"})}};t.prototype.vertex=function(e,i){if(i===1){e.pipe("spherical.position",this.uniforms)}return t.__super__.vertex.call(this,e,i)};t.prototype.axis=function(e){var t,i,r;r=this.props.range[e-1];i=r.x;t=r.y;if(e===3&&this.bend>0){t=Math.max(Math.abs(t),Math.abs(i));i=Math.max(-this.focus/this.aspectX+.001,i)}return new THREE.Vector2(i,t)};return t}(a);t.exports=r},{"../../../util":166,"./view":113}],111:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;a=e("./view");n=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","object","visible","view","view3","stereographic","vertex"];t.prototype.make=function(){var e;t.__super__.make.apply(this,arguments);e=this._attributes.types;this.uniforms={stereoBend:this.node.attributes["stereographic.bend"],viewMatrix:this._attributes.make(this._types.mat4())};this.viewMatrix=this.uniforms.viewMatrix.value;return this.composer=n.Three.transformComposer()};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);delete this.viewMatrix;delete this.rotationMatrix;return delete this.uniforms};t.prototype.change=function(e,t,i){var r,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b;if(!(t["view"]||t["view3"]||t["stereographic"]||i)){return}this.bend=r=this.props.bend;u=this.props.position;d=this.props.scale;c=this.props.quaternion;p=this.props.rotation;l=this.props.range;h=this.props.eulerOrder;E=l[0].x;w=l[1].x;b=l[2].x;a=l[0].y-E||1;o=l[1].y-w||1;s=l[2].y-b||1;m=d.x;g=d.y;v=d.z;f=n.Axis.recenterAxis(b,s,r,1),b=f[0],s=f[1];this.uniforms.stereoBend.value=r;this.viewMatrix.set(2/a,0,0,-(2*E+a)/a,0,2/o,0,-(2*w+o)/o,0,0,2/s,-(2*b+s)/s,0,0,0,1);y=this.composer(u,p,c,d,null,h);this.viewMatrix.multiplyMatrices(y,this.viewMatrix);if(e["view.range"]||t["stereographic"]){return this.trigger({type:"view.range"})}};t.prototype.vertex=function(e,i){if(i===1){e.pipe("stereographic.position",this.uniforms)}return t.__super__.vertex.call(this,e,i)};return t}(a);t.exports=r},{"../../../util":166,"./view":113}],112:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;a=e("./view");n=e("../../../util");r=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","object","visible","view","view4","stereographic","vertex"];t.prototype.make=function(){t.__super__.make.apply(this,arguments);this.uniforms={basisOffset:this._attributes.make(this._types.vec4()),basisScale:this._attributes.make(this._types.vec4()),stereoBend:this.node.attributes["stereographic.bend"]};this.basisScale=this.uniforms.basisScale.value;return this.basisOffset=this.uniforms.basisOffset.value};t.prototype.unmake=function(){t.__super__.unmake.apply(this,arguments);delete this.basisScale;delete this.basisOffset;return delete this.uniforms};t.prototype.change=function(e,t,i){var r,a,o,s,h,l,u,c,p,f,d,m,g,v;if(!(t["view"]||t["view4"]||t["stereographic"]||i)){return}this.bend=r=this.props.bend;c=this.props.position;f=this.props.scale;l=this.props.range;m=l[0].x;g=l[1].x;v=l[2].x;d=l[3].x;o=l[0].y-m||1;s=l[1].y-g||1;h=l[2].y-v||1;a=l[3].y-d||1;u=function(e,t){e.x*=t.x;e.y*=t.y;e.z*=t.z;return e.w*=t.w};p=n.Axis.recenterAxis(d,a,r,1),d=p[0],a=p[1];this.basisScale.set(2/o,2/s,2/h,2/a);this.basisOffset.set(-(2*m+o)/o,-(2*g+s)/s,-(2*v+h)/h,-(2*d+a)/a);u(this.basisScale,f);u(this.basisOffset,f);this.basisOffset.add(c);if(e["view.range"]||t["stereographic"]){return this.trigger({type:"view.range"})}};t.prototype.vertex=function(e,i){if(i===1){e.pipe("stereographic4.position",this.uniforms)}return t.__super__.vertex.call(this,e,i)};return t}(a);t.exports=r},{"../../../util":166,"./view":113}],113:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;r=e("../transform/transform");n=function(e){a(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.traits=["node","object","visible","view","vertex"];t.prototype.make=function(){return this._helpers.visible.make()};t.prototype.unmake=function(){return this._helpers.visible.unmake()};t.prototype.axis=function(e){return this.props.range[e-1]};return t}(r);t.exports=n},{"../transform/transform":102}],114:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("./databuffer");a=e("../../util");r=function(e){o(t,e);function t(e,i,r){this.width=r.width||1;this.history=r.history||1;this.samples=this.width;this.wrap=this.history>1;r.width=this.width;r.height=this.history;r.depth=1;t.__super__.constructor.call(this,e,i,r)}t.prototype.build=function(e){t.__super__.build.apply(this,arguments);this.index=0;this.pad=0;return this.streamer=this.generate(this.data)};t.prototype.setActive=function(e){return this.pad=Math.max(0,this.width-e)};t.prototype.fill=function(){var e,t,i,r,n,a,o,s,h;e=this.callback;if(typeof e.reset==="function"){e.reset()}o=this.streamer,r=o.emit,h=o.skip,t=o.count,i=o.done,s=o.reset;s();a=this.samples-this.pad;n=0;while(!i()&&n<a&&e(r,n++)!==false){true}return Math.floor(t()/this.items)};t.prototype.write=function(e){if(e==null){e=this.samples}e*=this.items;this.texture.write(this.data,0,this.index,e,1);this.dataPointer.set(.5,this.index+.5);this.index=(this.index+this.history-1)%this.history;return this.filled=Math.min(this.history,this.filled+1)};t.prototype.through=function(e,t){var i,r,n,o,s,h,l,u;l=u=this.streamer,i=l.consume,r=l.done;o=(n=t.streamer).emit;s=0;h=function(){return i(function(t,i,r,n){return e(o,t,i,r,n,s)})};h=a.Data.repeatCall(h,this.items);return function(e){return function(){var t;u.reset();n.reset();t=e.samples-e.pad;s=0;while(!r()&&s<t){h();s++}return u.count()}}(this)};return t}(n);t.exports=r},{"../../util":166,"./databuffer":117}],115:[function(e,t,i){var r,n,a,o,s,h,l=function(e,t){for(var i in t){if(u.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},u={}.hasOwnProperty;o=e("../renderable");h=e("../../util");a=e("./texture/datatexture");n=e("./texture/backedtexture");r=function(e){l(t,e);function t(e,i,r){if(this.width==null){this.width=r.width||512}if(this.height==null){this.height=r.height||512}if(this.channels==null){this.channels=r.channels||4}if(this.backed==null){this.backed=r.backed||false}this.samples=this.width*this.height;t.__super__.constructor.call(this,e,i);this.build(r)}t.prototype.shader=function(e){e.pipe("map.2d.data",this.uniforms);e.pipe("sample.2d",this.uniforms);if(this.channels<4){e.pipe(h.GLSL.swizzleVec4(["0000","x000","xw00","xyz0"][this.channels]))}return e};t.prototype.build=function(e){var t;this.klass=t=this.backed?n:a;this.texture=new t(this.gl,this.width,this.height,this.channels,e);this.uniforms={dataPointer:{type:"v2",value:new THREE.Vector2(0,0)}};this._adopt(this.texture.uniforms);return this.reset()};t.prototype.reset=function(){this.rows=[];return this.bottom=0};t.prototype.resize=function(e,t){if(!this.backed){throw new Error("Cannot resize unbacked texture atlas")}if(e>2048&&t>2048){console.warn("Giant text atlas "+e+"x"+t+".")}else{console.info("Resizing text atlas "+e+"x"+t+".")}this.texture.resize(e,t);this.width=e;this.height=t;return this.samples=e*t};t.prototype.collapse=function(e){var t,i,r;r=this.rows;r.splice(r.indexOf(e),1);this.bottom=(t=(i=r[r.length-1])!=null?i.bottom:void 0)!=null?t:0;if(this.last===e){return this.last=null}};t.prototype.allocate=function(e,t,i,r){var n,a,o,h,l,u,c,p,f,d,m,g;g=this.width;o=this.height;p=i*2;if(t>g){this.resize(g*2,o*2);this.last=null;return this.allocate(e,t,i,r)}d=this.last;if(d!=null){if(d.height>=i&&d.height<p&&d.width+t<=g){d.append(e,t,i,r);return}}n=0;l=-1;m=0;f=this.rows;for(h=u=0,c=f.length;u<c;h=++u){d=f[h];a=d.top-n;if(a>=i&&l<0){l=h;m=n}n=d.bottom;if(d.height>=i&&d.height<p&&d.width+t<=g){d.append(e,t,i,r);this.last=d;return}}if(l>=0){d=new s(m,i);this.rows.splice(l,0,d)}else{m=n;n+=i;if(n>=o){this.resize(g*2,o*2);this.last=null;return this.allocate(e,t,i,r)}d=new s(m,i);this.rows.push(d);this.bottom=n}d.append(e,t,i,r);this.last=d};t.prototype.read=function(){return this.texture.textureObject};t.prototype.write=function(e,t,i,r,n){return this.texture.write(e,t,i,r,n)};t.prototype.dispose=function(){this.texture.dispose();this.data=null;return t.__super__.dispose.apply(this,arguments)};return t}(o);s=function(){function e(e,t){this.top=e;this.bottom=e+t;this.width=0;this.height=t;this.alive=0;this.keys=[]}e.prototype.append=function(e,t,i,r){var n,a;n=this.width;a=this.top;this.alive++;this.width+=t;this.keys.push(e);return r(this,n,a)};return e}();t.exports=r},{"../../util":166,"../renderable":152,"./texture/backedtexture":124,"./texture/datatexture":125}],116:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("../renderable");a=e("../../util");r=function(e){o(t,e);function t(e,i,r){if(this.items==null){this.items=r.items||1}if(this.samples==null){this.samples=r.samples||1}if(this.channels==null){this.channels=r.channels||4}if(this.callback==null){this.callback=r.callback||function(){}}t.__super__.constructor.call(this,e,i)}t.prototype.dispose=function(){return t.__super__.dispose.apply(this,arguments)};t.prototype.update=function(){var e;e=this.fill();this.write(e);return e};t.prototype.setActive=function(e,t,i,r){};t.prototype.setCallback=function(e){this.callback=e};t.prototype.write=function(){};t.prototype.fill=function(){};t.prototype.generate=function(e){return a.Data.getStreamer(e,this.samples,this.channels,this.items)};return t}(n);t.exports=r},{"../../util":166,"../renderable":152}],117:[function(e,t,i){var r,n,a,o,s=function(e,t){for(var i in t){if(h.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},h={}.hasOwnProperty;r=e("./buffer");a=e("./texture/datatexture");o=e("../../util");n=function(e){s(t,e);function t(e,i,r){this.width=r.width||1;this.height=r.height||1;this.depth=r.depth||1;if(this.samples==null){this.samples=this.width*this.height*this.depth}t.__super__.constructor.call(this,e,i,r);this.build(r)}t.prototype.shader=function(e,t){var i;if(t==null){t=4}if(this.items>1||this.depth>1){if(t!==4){e.pipe(o.GLSL.extendVec(t,4))}e.pipe("map.xyzw.texture",this.uniforms)}else{if(t!==2){e.pipe(o.GLSL.truncateVec(t,2))}}i=this.wrap?".wrap":"";e.pipe("map.2d.data"+i,this.uniforms);e.pipe("sample.2d",this.uniforms);if(this.channels<4){e.pipe(o.GLSL.swizzleVec4(["0000","x000","xw00","xyz0"][this.channels]))}return e};t.prototype.build=function(e){this.data=new Float32Array(this.samples*this.channels*this.items);this.texture=new a(this.gl,this.items*this.width,this.height*this.depth,this.channels,e);this.filled=0;this.used=0;this._adopt(this.texture.uniforms);this._adopt({dataPointer:{type:"v2",value:new THREE.Vector2},textureItems:{type:"f",value:this.items},textureHeight:{type:"f",value:this.height}});this.dataPointer=this.uniforms.dataPointer.value;return this.streamer=this.generate(this.data)};t.prototype.dispose=function(){this.data=null;this.texture.dispose();return t.__super__.dispose.apply(this,arguments)};t.prototype.getFilled=function(){return this.filled};t.prototype.setCallback=function(e){this.callback=e;return this.filled=0};t.prototype.copy=function(e){var t,i,r,n,a;n=Math.min(e.length,this.samples*this.channels*this.items);t=this.data;for(i=r=0,a=n;0<=a?r<a:r>a;i=0<=a?++r:--r){t[i]=e[i]}return this.write(Math.ceil(n/this.channels/this.items))};t.prototype.write=function(e){var t,i;if(e==null){e=this.samples}t=e/this.width;e*=this.items;i=t<1?e:this.items*this.width;t=Math.ceil(t);this.texture.write(this.data,0,0,i,t);this.dataPointer.set(.5,.5);this.filled=1;return this.used=e};t.prototype.through=function(e,t){var i,r,n,a,s,h,l,u;l=u=this.streamer,i=l.consume,r=l.done;a=(n=t.streamer).emit;s=0;h=function(){return i(function(t,i,r,n){return e(a,t,i,r,n,s)})};h=o.Data.repeatCall(h,this.items);return function(e){return function(){var t;u.reset();n.reset();t=e.used;s=0;while(!r()&&s<t){h();s++}return u.count()}}(this)};return t}(r);t.exports=n},{"../../util":166,"./buffer":116,"./texture/datatexture":125}],118:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("./databuffer");a=e("../../util");n=function(e){o(t,e);function t(e,i,r){this.width=r.width||1;this.height=r.height||1;this.history=r.history||1;this.samples=this.width*this.height;this.wrap=this.history>1;r.depth=this.history;t.__super__.constructor.call(this,e,i,r)}t.prototype.build=function(e){t.__super__.build.apply(this,arguments);this.index=0;this.pad={x:0,y:0};return this.streamer=this.generate(this.data)};t.prototype.getFilled=function(){return this.filled};t.prototype.setActive=function(e,t){var i;return i=[Math.max(0,this.width-e),Math.max(0,this.height-t)],this.pad.x=i[0],this.pad.y=i[1],i};t.prototype.fill=function(){var e,t,i,r,n,a,o,s,h,l,u,c,p,f;e=this.callback;if(typeof e.reset==="function"){e.reset()}u=this.streamer,r=u.emit,f=u.skip,t=u.count,i=u.done,p=u.reset;p();h=this.width;l=this.pad.x;s=this.samples-this.pad.y*h;n=a=o=0;if(l){while(!i()&&o<s){o++;c=e(r,n,a);if(++n===h-l){f(l);n=0;a++}if(c===false){break}}}else{while(!i()&&o<s){o++;c=e(r,n,a);if(++n===h){n=0;a++}if(c===false){break}}}return Math.floor(t()/this.items)};t.prototype.write=function(e){var t,i;if(e==null){e=this.samples}e*=this.items;i=this.width*this.items;t=Math.ceil(e/i);this.texture.write(this.data,0,this.index*this.height,i,t);this.dataPointer.set(.5,this.index*this.height+.5);this.index=(this.index+this.history-1)%this.history;return this.filled=Math.min(this.history,this.filled+1)};t.prototype.through=function(e,t){var i,r,n,o,s,h,l,u,c;u=c=this.streamer,i=u.consume,r=u.done;o=(n=t.streamer).emit;s=h=0;l=function(){return i(function(t,i,r,n){return e(o,t,i,r,n,s,h)})};l=a.Data.repeatCall(l,this.items);return function(e){return function(){var t,i,a,o;c.reset();n.reset();a=e.width;o=e.pad.x;i=e.samples-e.pad.y*a;s=h=t=0;if(o){while(!r()&&t<i){t++;l();if(++s===a-o){skip(o);s=0;h++}}}else{while(!r()&&t<i){t++;l();if(++s===a){s=0;h++}}}return c.count()}}(this)};return t}(r);t.exports=n},{"../../util":166,"./databuffer":117}],119:[function(e,t,i){var r,n,a,o,s=function(e,t){for(var i in t){if(h.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},h={}.hasOwnProperty;a=e("../renderable");n=e("./rendertotexture");o=e("../../util");r=function(e){s(t,e);function t(e,i,r){if(this.items==null){this.items=r.items||1}if(this.channels==null){this.channels=r.channels||4}if(this.width==null){this.width=r.width||1}if(this.height==null){this.height=r.height||1}if(this.depth==null){this.depth=r.depth||1}r.format=THREE.RGBAFormat;r.width=this._width=this.items*this.width;r.height=this._height=this.height*this.depth;r.frames=1;delete r.items;delete r.depth;delete r.channels;t.__super__.constructor.call(this,e,i,r);this._adopt({textureItems:{type:"f",value:this.items},textureHeight:{type:"f",value:this.height}})}t.prototype.shaderAbsolute=function(e){if(e==null){e=this.shaders.shader()}e.pipe("map.xyzw.texture",this.uniforms);return t.__super__.shaderAbsolute.call(this,e,1,2)};return t}(n);t.exports=r},{"../../util":166,"../renderable":152,"./rendertotexture":122}],120:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("./buffer");a=e("../../util");n=function(e){o(t,e);function t(e,i,r){this.width=r.width||1;this.height=r.height||1;this.depth=r.depth||1;if(this.samples==null){this.samples=this.width*this.height*this.depth}t.__super__.constructor.call(this,e,i,r);this.build(r)}t.prototype.build=function(e){this.data=[];this.data.length=this.samples;this.filled=0;this.pad={x:0,y:0,z:0};return this.streamer=this.generate(this.data)};t.prototype.dispose=function(){this.data=null;return t.__super__.dispose.apply(this,arguments)};t.prototype.getFilled=function(){return this.filled};t.prototype.setActive=function(e,t,i){var r;return r=[this.width-e,this.height-t,this.depth-i],this.pad.x=r[0],this.pad.y=r[1],this.pad.z=r[2],r};t.prototype.read=function(){return this.data};t.prototype.copy=function(e){var t,i,r,n,a,o;r=Math.min(e.length,this.samples);t=this.data;o=[];for(i=n=0,a=r;0<=a?n<a:n>a;i=0<=a?++n:--n){o.push(t[i]=e[i])}return o};t.prototype.fill=function(){var e,t,i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v;e=this.callback;if(typeof e.reset==="function"){e.reset()}d=this.streamer,r=d.emit,v=d.skip,t=d.count,i=d.done,g=d.reset;g();u=this.width;l=this.height;c=this.depth;p=this.pad.x;f=this.pad.y;h=this.samples-this.pad.z*u*l;n=a=o=s=0;if(p>0||f>0){while(!i()&&s<h){s++;m=e(r,n,a,o);if(++n===u-p){v(p);n=0;if(++a===l-f){v(u*f);a=0;o++}}if(m===false){break}}}else{while(!i()&&s<h){s++;m=e(r,n,a,o);if(++n===u){n=0;if(++a===l){a=0;o++}}if(m===false){break}}}this.filled=1;return t()};return t}(r);t.exports=n},{"../../util":166,"./buffer":116}],121:[function(e,t,i){var r,n,a,o,s,h,l=function(e,t){for(var i in t){if(u.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},u={}.hasOwnProperty;s=e("../renderable");r=e("./buffer");n=e("./memo");a=e("../meshes/memoscreen");h=e("../../util");o=function(e){l(t,e);function t(e,i,r){if(this.items==null){this.items=r.items||1}if(this.channels==null){this.channels=r.channels||4}if(this.width==null){this.width=r.width||1}if(this.height==null){this.height=r.height||1}if(this.depth==null){this.depth=r.depth||1}if(this.type==null){this.type=r.type||THREE.FloatType}if(this.stpq==null){this.stpq=r.stpq||false}this.isFloat=this.type===THREE.FloatType;this.active=this.sampled=this.rect=this.pad=null;t.__super__.constructor.call(this,e,i);this.build(r)}t.prototype.build=function(e){var t,i,r,o,s,l,u,c,p,f,d,m,g,v,y;p=e.map;l=e.indexer;u=l!=null&&!l.empty();f=this,c=f.items,y=f.width,s=f.height,i=f.depth,m=f.stpq;d=p;if(u){this._adopt({indexModulus:{type:"v4",value:new THREE.Vector4(c,c*y,c*y*s,1)}});d=this.shaders.shader();d.require(p);d.require(l);d.pipe("float.index.pack",this.uniforms)}if(this.isFloat&&this.channels>1){this.floatMemo=new n(this.renderer,this.shaders,{items:c,channels:4,width:y,height:s,depth:i,history:0,type:THREE.FloatType});this.floatCompose=new a(this.renderer,this.shaders,{map:d,items:c,width:y,height:s,depth:i,stpq:m});this.floatMemo.adopt(this.floatCompose);m=false;d=this.shaders.shader();this.floatMemo.shaderAbsolute(d)}if(this.isFloat){g=this.channels;t=4}else{g=1;t=this.channels}if(g>1){r=this.shaders.shader();r.pipe(h.GLSL.mapByte2FloatOffset(g));r.require(d);r.pipe("float.stretch");r.pipe("float.encode");d=r}else if(this.isFloat){r=this.shaders.shader();r.pipe(d);r.pipe(h.GLSL.truncateVec4(4,1));r.pipe("float.encode");d=r}this.byteMemo=new n(this.renderer,this.shaders,{items:c*g,channels:4,width:y,height:s,depth:i,history:0,type:THREE.UnsignedByteType});this.byteCompose=new a(this.renderer,this.shaders,{map:d,items:c*g,width:y,height:s,depth:i,stpq:m});this.byteMemo.adopt(this.byteCompose);v=c*y*g;o=s*i;this.samples=this.width*this.height*this.depth;this.bytes=new Uint8Array(v*o*4);if(this.isFloat){this.floats=new Float32Array(this.bytes.buffer)}this.data=this.isFloat?this.floats:this.bytes;this.streamer=this.generate(this.data);this.active={items:0,width:0,height:0,depth:0};this.sampled={items:0,width:0,height:0,depth:0};this.rect={w:0,h:0};this.pad={x:0,y:0,z:0,w:0};this.stretch=g;this.isIndexed=u;return this.setActive(c,y,s,i)};t.prototype.generate=function(e){return h.Data.getStreamer(e,this.samples,4,this.items)};t.prototype.setActive=function(e,t,i,r){var n,a,o,s,h,l,u,c;if(!(e!==this.active.items||t!==this.active.width||i!==this.active.height||r!==this.active.depth)){return}a=[e,t,i,r],this.active.items=a[0],this.active.width=a[1],this.active.height=a[2],this.active.depth=a[3];if((o=this.floatCompose)!=null){o.cover(t,i,r)}if((s=this.byteCompose)!=null){s.cover(t*this.stretch,i,r)}e=this.items;t=this.active.width;i=this.depth===1?this.active.height:this.height;r=this.active.depth;c=e*t*this.stretch;n=i*r;h=[e,t,i,r],this.sampled.items=h[0],this.sampled.width=h[1],this.sampled.height=h[2],this.sampled.depth=h[3];l=[c,n],this.rect.w=l[0],this.rect.h=l[1];return u=[this.sampled.width-this.active.width,this.sampled.height-this.active.height,this.sampled.depth-this.active.depth,this.sampled.items-this.active.items],this.pad.x=u[0],this.pad.y=u[1],this.pad.z=u[2],this.pad.w=u[3],u};t.prototype.update=function(e){var t,i;if((t=this.floatMemo)!=null){t.render(e)}return(i=this.byteMemo)!=null?i.render(e):void 0};t.prototype.post=function(){this.renderer.setRenderTarget(this.byteMemo.target.reads[0]);return this.gl.readPixels(0,0,this.rect.w,this.rect.h,gl.RGBA,gl.UNSIGNED_BYTE,this.bytes)};t.prototype.readFloat=function(e){var t;return(t=this.floatMemo)!=null?t.read(e):void 0};t.prototype.readByte=function(e){var t;return(t=this.byteMemo)!=null?t.read(e):void 0};t.prototype.setCallback=function(e){return this.emitter=this.callback(e)};t.prototype.callback=function(e){var t,i,r,n,a;if(!this.isIndexed){return e}r=this.width;i=this.height;n=this.depth;a=this.items;t=function(t,n,o,s){var h,l,u,c,p;h=s;p=h%a;h=(h-p)/a;l=h%r;h=(h-l)/r;u=h%i;h=(h-u)/i;c=h;return e(t,n,o,s,l,u,c,p)};t.reset=function(){return typeof e.reset==="function"?e.reset():void 0};return t};t.prototype.iterate=function(){var e,t,i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b;n=this.emitter;if(typeof n.reset==="function"){n.reset()}y=this.streamer,t=y.consume,b=y.skip,i=y.count,r=y.done,w=y.reset;w();c=this.sampled.width|0;u=this.sampled.height|0;p=this.sampled.depth|0;f=this.sampled.items|0;m=this.pad.x|0;g=this.pad.y|0;v=this.pad.z|0;d=this.pad.w|0;l=c*u*f*(p-v);if(!this.isIndexed){e=n;n=function(t,i,r,n){return e(t,i,r,n,a,o,s,h)}}a=o=s=h=u=0;while(!r()&&u<l){u++;E=t(n);if(++h===f-d){b(m);h=0;if(++a===c-m){b(f*m);a=0;if(++o===u-g){b(f*c*g);o=0;s++}}}if(E===false){break}}return Math.floor(i()/f)};t.prototype.dispose=function(){var e,t,i,r,n,a;if((e=this.floatMemo)!=null){e.unadopt(this.floatCompose)}if((t=this.floatMemo)!=null){t.dispose()}if((i=this.floatCompose)!=null){i.dispose()}if((r=this.byteMemo)!=null){r.unadopt(this.byteCompose)}if((n=this.byteMemo)!=null){n.dispose()}if((a=this.byteCompose)!=null){a.dispose()}return this.floatMemo=this.byteMemo=this.floatCompose=this.byteCompose=null};return t}(s);t.exports=o},{"../../util":166,"../meshes/memoscreen":146,"../renderable":152,"./buffer":116,"./memo":119}],122:[function(e,t,i){var r,n,a,o,s=function(e,t){for(var i in t){if(h.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},h={}.hasOwnProperty;a=e("../renderable");r=e("./texture/rendertarget");o=e("../../util");n=function(e){s(t,e);function t(e,i,r){var n;this.scene=(n=r.scene)!=null?n:new THREE.Scene;this.camera=r.camera;t.__super__.constructor.call(this,e,i);this.build(r)}t.prototype.shaderRelative=function(e){if(e==null){e=this.shaders.shader()}return e.pipe("sample.2d",this.uniforms)};t.prototype.shaderAbsolute=function(e,t,i){var r;if(t==null){t=1}if(i==null){i=4}if(e==null){e=this.shaders.shader()}if(t<=1){if(i>2){e.pipe(o.GLSL.truncateVec(i,2))}e.pipe("map.2d.data",this.uniforms);return e.pipe("sample.2d",this.uniforms)}else{r=o.GLSL.sample2DArray(Math.min(t,this.target.frames));if(i<4){e.pipe(o.GLSL.extendVec(i,4))}e.pipe("map.xyzw.2dv");e.split();e.pipe("map.2d.data",this.uniforms);e.pass();return e.pipe(r,this.uniforms)}};t.prototype.build=function(e){var t;if(!this.camera){this.camera=new THREE.PerspectiveCamera;this.camera.position.set(0,0,3);this.camera.lookAt(new THREE.Vector3)}if(typeof(t=this.scene).inject==="function"){t.inject()}this.target=new r(this.gl,e.width,e.height,e.frames,e);this.target.warmup(function(e){return function(t){return e.renderer.setRenderTarget(t)}}(this));this.renderer.setRenderTarget(null);this._adopt(this.target.uniforms);this._adopt({dataPointer:{type:"v2",value:new THREE.Vector2(.5,.5)}});return this.filled=0};t.prototype.adopt=function(e){var t,i,r,n,a;n=e.renders;a=[];for(t=0,i=n.length;t<i;t++){r=n[t];a.push(this.scene.add(r))}return a};t.prototype.unadopt=function(e){var t,i,r,n,a;n=e.renders;a=[];for(t=0,i=n.length;t<i;t++){r=n[t];a.push(this.scene.remove(r))}return a};t.prototype.render=function(e){var t;if(e==null){e=this.camera}this.renderer.render((t=this.scene.scene)!=null?t:this.scene,e,this.target.write);this.target.cycle();if(this.filled<this.target.frames){return this.filled++}};t.prototype.read=function(e){if(e==null){e=0}return this.target.reads[Math.abs(e)]};t.prototype.getFrames=function(){return this.target.frames};t.prototype.getFilled=function(){return this.filled};t.prototype.dispose=function(){var e;if(typeof(e=this.scene).unject==="function"){e.unject()}this.scene=this.camera=null;this.target.dispose();return t.__super__.dispose.apply(this,arguments)};return t}(a);t.exports=n},{"../../util":166,"../renderable":152,"./texture/rendertarget":126}],123:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("./atlas");n=512/16;a=function(e){o(t,e);function t(e,i,r){var n,a,o,s,h,l,u;this.font=(n=r.font)!=null?n:["sans-serif"];this.size=r.size||24;this.style=(a=r.style)!=null?a:"normal";this.variant=(o=r.variant)!=null?o:"normal";this.weight=(s=r.weight)!=null?s:"normal";this.outline=(h=+((l=r.outline)!=null?l:5))!=null?h:0;r.width||(r.width=256);r.height||(r.height=256);r.type=THREE.UnsignedByteType;r.channels=1;r.backed=true;this.gamma=1;if(typeof navigator!=="undefined"){u=navigator.userAgent;if(u.match(/Chrome/)&&u.match(/OS X/)){this.gamma=.5}}this.scratchW=this.scratchH=0;t.__super__.constructor.call(this,e,i,r)}t.prototype.build=function(e){var i,r,a,o,s,h,l,u,c,p,f,d,m;t.__super__.build.call(this,e);c=16;c=this.size;c+=4+2*Math.min(1,this.outline);p=n*c;i=document.createElement("canvas");i.width=p;i.height=c;f=function(e){return'"'+e.replace(/(['"\\])/g,"\\$1")+'"'};s=this.font.map(f).join(", ");a=i.getContext("2d");a.font=this.style+" "+this.variant+" "+this.weight+" "+this.size+"px "+this.font;a.fillStyle="#FF0000";a.textAlign="left";a.textBaseline="bottom";a.lineJoin="round";r=[];o=this.outline*3;for(l=u=0,d=o;0<=d?u<d:u>d;l=0<=d?++u:--u){h=("00"+Math.max(0,-l*8+128-!l*8).toString(16)).slice(-2);r.push("#"+h+h+h)}m=new Uint8Array(p*c*2);this.canvas=i;this.context=a;this.lineHeight=c;this.maxWidth=p;this.colors=r;this.scratch=m;this._allocate=this.allocate.bind(this);return this._write=this.write.bind(this)};t.prototype.reset=function(){t.__super__.reset.apply(this,arguments);return this.mapped={}};t.prototype.begin=function(){var e,t,i,r,n;i=this.rows;r=[];for(e=0,t=i.length;e<t;e++){n=i[e];r.push(n.alive=0)}return r};t.prototype.end=function(){var e,t,i,r,n,a,o,s,h;a=this.mapped;o=this.rows.slice();for(e=0,r=o.length;e<r;e++){h=o[e];if(!(h.alive===0)){continue}s=h.keys;for(i=0,n=s.length;i<n;i++){t=s[i];delete a[t]}this.collapse(h)}};t.prototype.map=function(e,t){var i,r,n,a,o,s,h;o=this.mapped;r=o[e];if(r!=null){r.row.alive++;return t(r.x,r.y,r.w,r.h)}this.draw(e);n=this.scratch;s=this.scratchW;a=this.scratchH;i=this._allocate;h=this._write;return i(e,s,a,function(i,r,l){o[e]={x:r,y:l,w:s,h:a,row:i};h(n,r,l,s,a);return t(r,l,s,a)})};t.prototype.draw=function(e){var t,i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R;x=this.width;l=this.lineHeight;E=this.outline;a=this.context;s=this.scratch;v=this.maxWidth;n=this.colors;T=E+1;R=Math.round(l*1.05-1);m=a.measureText(e);x=Math.min(v,Math.ceil(m.width+2*T+1));a.clearRect(0,0,x,l);if(this.outline===0){a.fillText(e,T,R);o=(c=a.getImageData(0,0,x,l)).data;p=3;for(u=f=0,w=o.length/4;0<=w?f<w:f>w;u=0<=w?++f:--f){s[u]=o[p];p+=4}this.scratchW=x;return this.scratchH=l}else{a.globalCompositeOperation="source-over";for(u=d=b=E+1;b<=1?d<=1:d>=1;u=b<=1?++d:--d){p=u>1?u*2-2:u;a.strokeStyle=n[p-1];a.lineWidth=p;a.strokeText(e,T,R)}a.globalCompositeOperation="multiply";a.fillText(e,T,R);o=(c=a.getImageData(0,0,x,l)).data;p=0;h=this.gamma;for(u=y=0,_=o.length/4;0<=_?y<_:y>_;u=0<=_?++y:--y){t=o[p];g=t?o[p+1]/t:1;if(h===.5){g=Math.sqrt(g)}g=Math.min(1,Math.max(0,g));i=256-t;r=i+(t-i)*g;s[u]=Math.max(0,Math.min(255,r+2));p+=4}this.scratchW=x;return this.scratchH=l}};return t}(r);t.exports=a},{"./atlas":115}],124:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;a=e("../../../util");n=e("./datatexture");r=function(e){o(t,e);function t(e,i,r,n,a){t.__super__.constructor.call(this,e,i,r,n,a);this.data=new this.ctor(this.n)}t.prototype.resize=function(e,t){var i,r,n,a;r=this.data;a=this.width;n=this.height;this.width=e;this.height=t;this.n=e*t*this.channels;this.data=new this.ctor(this.n);i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture);i.pixelStorei(i.UNPACK_ALIGNMENT,1);i.texImage2D(i.TEXTURE_2D,0,this.format,e,t,0,this.format,this.type,this.data);this.uniforms.dataResolution.value.set(1/e,1/t);return this.write(r,0,0,a,n)};t.prototype.write=function(e,i,r,n,a){var o,s,h,l,u,c,p,f,d,m,g,v;f=this.width;s=this.data;o=this.channels;h=0;if(f===n&&i===0){l=r*n*o;c=n*a*o;while(h<c){s[l++]=e[h++]}}else{p=f*o;d=n*o;m=i*o;v=r;g=r+a;while(v<g){u=0;l=m+v*p;while(u++<d){s[l++]=e[h++]}v++}}return t.__super__.write.call(this,e,i,r,n,a)};t.prototype.dispose=function(){this.data=null;return t.__super__.dispose.apply(this,arguments)};return t}(n);t.exports=r},{"../../../util":166,"./datatexture":125}],125:[function(e,t,i){var r,n;n=e("../../../util");r=function(){function e(e,t,i,r,a){var o,s,h,l,u,c,p;this.gl=e;this.width=t;this.height=i;this.channels=r;this.n=this.width*this.height*this.channels;o=this.gl;h=(l=a.minFilter)!=null?l:THREE.NearestFilter;s=(u=a.magFilter)!=null?u:THREE.NearestFilter;p=(c=a.type)!=null?c:THREE.FloatType;this.minFilter=n.Three.paramToGL(o,h);this.magFilter=n.Three.paramToGL(o,s);this.type=n.Three.paramToGL(o,p);this.ctor=n.Three.paramToArrayStorage(p);this.build(a)}e.prototype.build=function(e){var t;t=this.gl;this.texture=t.createTexture();this.format=[null,t.LUMINANCE,t.LUMINANCE_ALPHA,t.RGB,t.RGBA][this.channels];this.format3=[null,THREE.LuminanceFormat,THREE.LuminanceAlphaFormat,THREE.RGBFormat,THREE.RGBAFormat][this.channels];t.bindTexture(t.TEXTURE_2D,this.texture);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this.minFilter);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this.magFilter);this.data=new this.ctor(this.n);t.pixelStorei(t.UNPACK_ALIGNMENT,1);t.texImage2D(t.TEXTURE_2D,0,this.format,this.width,this.height,0,this.format,this.type,this.data);this.textureObject=new THREE.Texture(new Image,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,e.minFilter,e.magFilter);this.textureObject.__webglInit=true;this.textureObject.__webglTexture=this.texture;this.textureObject.format=this.format3;this.textureObject.type=THREE.FloatType;this.textureObject.unpackAlignment=1;this.textureObject.flipY=false;this.textureObject.generateMipmaps=false;return this.uniforms={dataResolution:{type:"v2",value:new THREE.Vector2(1/this.width,1/this.height)},dataTexture:{type:"t",value:this.textureObject}}};e.prototype.write=function(e,t,i,r,n){var a;a=this.gl;a.bindTexture(a.TEXTURE_2D,this.texture);a.pixelStorei(a.UNPACK_ALIGNMENT,1);return a.texSubImage2D(a.TEXTURE_2D,0,t,i,r,n,this.format,this.type,e)};e.prototype.dispose=function(){this.gl.deleteTexture(this.texture);this.textureObject.__webglInit=false;this.textureObject.__webglTexture=null;return this.textureObject=this.texture=null};return e}();t.exports=r},{"../../../util":166}],126:[function(e,t,i){var r;r=function(){function e(e,t,i,r,n){this.gl=e;if(n==null){n={}}if(n.minFilter==null){n.minFilter=THREE.NearestFilter}if(n.magFilter==null){n.magFilter=THREE.NearestFilter}if(n.format==null){n.format=THREE.RGBAFormat}if(n.type==null){n.type=THREE.UnsignedByteType}this.options=n;this.width=t||1;this.height=i||1;this.frames=r||1;this.buffers=this.frames+1;this.build()}e.prototype.build=function(){var e,t;t=function(e){return function(){return new THREE.WebGLRenderTarget(e.width,e.height,e.options)}}(this);this.targets=function(){var i,r,n;n=[];for(e=i=0,r=this.buffers;0<=r?i<r:i>r;e=0<=r?++i:--i){n.push(t())}return n}.call(this);this.reads=function(){var i,r,n;n=[];for(e=i=0,r=this.buffers;0<=r?i<r:i>r;e=0<=r?++i:--i){n.push(t())}return n}.call(this);this.write=t();this.index=0;return this.uniforms={dataResolution:{type:"v2",value:new THREE.Vector2(1/this.width,1/this.height)},dataTexture:{type:"t",value:this.reads[0]},dataTextures:{type:"tv",value:this.reads}}};e.prototype.cycle=function(){var e,t,i,r,n,a,o,s,h;a=["__webglTexture","__webglFramebuffer","__webglRenderbuffer"];t=this.buffers;i=function(e,t){var i,r,n;for(i=0,n=a.length;i<n;i++){r=a[i];t[r]=e[r]}return null};e=function(e,i){return(e+i+t*2)%t};i(this.write,this.targets[this.index]);h=this.reads;for(r=n=0,o=h.length;n<o;r=++n){s=h[r];i(this.targets[e(this.index,-r)],s)}this.index=e(this.index,1);return i(this.targets[this.index],this.write)};e.prototype.warmup=function(e){var t,i,r,n;n=[];for(t=i=0,r=this.buffers;0<=r?i<r:i>r;t=0<=r?++i:--i){e(this.write);n.push(this.cycle())}return n};e.prototype.dispose=function(){var e,t,i,r;i=this.targets;for(e=0,t=i.length;e<t;e++){r=i[e];r.dispose()}return this.targets=this.reads=this.write=null};return e}();t.exports=r},{}],127:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("./databuffer");n=e("../../util");a=function(e){o(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.prototype.build=function(e){t.__super__.build.apply(this,arguments);this.pad={x:0,y:0,z:0};return this.streamer=this.generate(this.data)};t.prototype.setActive=function(e,t,i){var r;return r=[Math.max(0,this.width-e),Math.max(0,this.height-t),Math.max(0,this.depth-i)],this.pad.x=r[0],this.pad.y=r[1],this.pad.z=r[2],r};t.prototype.fill=function(){var e,t,i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v;e=this.callback;if(typeof e.reset==="function"){e.reset()}d=this.streamer,r=d.emit,v=d.skip,t=d.count,i=d.done,g=d.reset;g();u=this.width;l=this.height;c=this.depth;p=this.pad.x;f=this.pad.y;h=this.samples-this.pad.z*u*l;n=a=o=s=0;if(p>0||f>0){while(!i()&&s<h){s++;m=e(r,n,a,o);if(++n===u-p){v(p);n=0;if(++a===l-f){v(u*f);a=0;o++}}if(m===false){break}}}else{while(!i()&&s<h){s++;m=e(r,n,a,o);if(++n===u){n=0;if(++a===l){a=0;o++}}if(m===false){break}}}return Math.floor(t()/this.items)};t.prototype.through=function(e,t){var i,r,a,o,s,h,l,u,c,p;c=p=this.streamer,i=c.consume,r=c.done;o=(a=t.streamer).emit;s=h=l=0;u=function(){return i(function(t,i,r,n){return e(o,t,i,r,n,s,h,l)})};u=n.Data.repeatCall(u,this.items);return function(e){return function(){var t,i,n,o,c,f,d;p.reset();a.reset();o=e.width;n=e.height;c=e.depth;f=e.pad.x;d=e.pad.y;i=e.samples-e.pad.z*o*n;s=h=l=t=0;if(f>0||d>0){while(!r()&&t<i){t++;u();if(++s===o-f){skip(f);s=0;if(++h===n-d){skip(o*d);h=0;l++}}}}else{while(!r()&&t<i){t++;u();if(++s===o){s=0;if(++h===n){h=0;l++}}}}return p.count()}}(this)};return t}(r);t.exports=a},{"../../util":166,"./databuffer":117}],128:[function(e,t,i){var r;r={sprite:e("./meshes/sprite"),point:e("./meshes/point"),line:e("./meshes/line"),surface:e("./meshes/surface"),face:e("./meshes/face"),strip:e("./meshes/strip"),arrow:e("./meshes/arrow"),screen:e("./meshes/screen"),memoScreen:e("./meshes/memoscreen"),debug:e("./meshes/debug"),dataBuffer:e("./buffer/databuffer"),arrayBuffer:e("./buffer/arraybuffer"),matrixBuffer:e("./buffer/matrixbuffer"),voxelBuffer:e("./buffer/voxelbuffer"),pushBuffer:e("./buffer/pushbuffer"),renderToTexture:e("./buffer/rendertotexture"),memo:e("./buffer/memo"),readback:e("./buffer/readback"),atlas:e("./buffer/atlas"),textAtlas:e("./buffer/textatlas"),scene:e("./scene")};t.exports=r},{"./buffer/arraybuffer":114,"./buffer/atlas":115,"./buffer/databuffer":117,"./buffer/matrixbuffer":118,"./buffer/memo":119,"./buffer/pushbuffer":120,"./buffer/readback":121,"./buffer/rendertotexture":122,"./buffer/textatlas":123,"./buffer/voxelbuffer":127,"./meshes/arrow":141,"./meshes/debug":143,"./meshes/face":144,"./meshes/line":145,"./meshes/memoscreen":146,"./meshes/point":147,"./meshes/screen":148,"./meshes/sprite":149,"./meshes/strip":150,"./meshes/surface":151,"./scene":153}],129:[function(e,t,i){var r;r=function(){function e(e,t,i){this.classes=e;this.renderer=t;this.shaders=i}e.prototype.getTypes=function(){return Object.keys(this.classes)};e.prototype.make=function(e,t){return new this.classes[e](this.renderer,this.shaders,t)};return e}();t.exports=r},{}],130:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;n=e("./clipgeometry");r=function(e){a(t,e);function t(e){var i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M,S,A,C,z,P,L,O,D,F,B,U,N,V,I,j,G,W,q,X,Y;t.__super__.constructor.call(this,e);this._clipUniforms();this.sides=V=+e.sides||12;this.samples=N=+e.samples||2;this.strips=j=+e.strips||1;this.ribbons=U=+e.ribbons||1;this.layers=w=+e.layers||1;this.flip=d=(A=e.flip)!=null?A:false;this.anchor=r=(C=e.anchor)!=null?C:d?0:N-1;o=j*U*w;k=(V+2)*o;W=V*2*o;this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(W*3),1));this.addAttribute("position4",new THREE.BufferAttribute(new Float32Array(k*4),4));this.addAttribute("arrow",new THREE.BufferAttribute(new Float32Array(k*3),3));this.addAttribute("attach",new THREE.BufferAttribute(new Float32Array(k*2),2));this._autochunk();g=this._emitter("index");H=this._emitter("position4");a=this._emitter("arrow");s=this._emitter("attach");p=[];for(y=v=0,z=V;0<=z?v<z:v>z;y=0<=z?++v:--v){n=y/V*;p.push([Math.cos(n),Math.sin(n),1])}u=0;for(m=b=0,P=o;0<=P?b<P:b>P;m=0<=P?++b:--b){G=u++;l=G+V+1;for(y=_=0,L=V;0<=L?_<L:_>L;y=0<=L?++_:--_){i=u+y%V;h=u+(y+1)%V;g(G);g(i);g(h);g(h);g(i);g(l)}u+=V+1}I=d?1:-1;f=d?N-1:0;x=r+I;q=r;for(E=T=0,O=w;0<=O?T<O:T>O;E=0<=O?++T:--T){for(Y=R=0,D=U;0<=D?R<D:R>D;Y=0<=D?++R:--R){for(X=M=0,F=j;0<=F?M<F:M>F;X=0<=F?++M:--M){H(q,X,Y,E);a(0,0,0);s(x,f);for(y=S=0,B=V;0<=B?S<B:S>B;y=0<=B?++S:--S){H(q,X,Y,E);c=p[y];a(c[0],c[1],c[2]);s(x,f)}H(q,X,Y,E);a(0,0,1);s(x,f)}}}this._finalize();this.clip();return}t.prototype.clip=function(e,t,i,r){var n,a,o,s;if(e==null){e=this.samples}if(t==null){t=this.strips}if(i==null){i=this.ribbons}if(r==null){r=this.layers}s=Math.max(0,e-1);this._clipGeometry(e,t,i,r);if(e>this.anchor){n=[r,i,t];a=[this.layers,this.ribbons,this.strips];o=this.sides*this._reduce(n,a)}else{o=0}return this._offsets([{start:0,count:o*6}])};return t}(n);t.exports=r},{"./clipgeometry":131}],131:[function(e,t,i){var r,n,a,o,s=function(e,t){for(var i in t){if(h.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},h={}.hasOwnProperty;n=e("./geometry");a=false;o=function(){var e;e=+new Date;return function(t){var i;i=+new Date-e;console.log(t,i+" ms");return i}};r=function(e){s(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.prototype._clipUniforms=function(){this.geometryClip=new THREE.Vector4(1e10,1e10,1e10,1e10);this.geometryResolution=new THREE.Vector4;this.mapSize=new THREE.Vector4;if(this.uniforms==null){this.uniforms={}}this.uniforms.geometryClip={type:"v4",value:this.geometryClip};this.uniforms.geometryResolution={type:"v4",value:this.geometryResolution};return this.uniforms.mapSize={type:"v4",value:this.mapSize}};t.prototype._clipGeometry=function(e,t,i,r){var n,a;n=function(e){return Math.max(0,e-1)};a=function(e){return 1/Math.max(1,e-1)};this.geometryClip.set(n(e),n(t),n(i),n(r));return this.geometryResolution.set(a(e),a(t),a(i),a(r))};t.prototype._clipMap=function(e,t,i,r){return this.mapSize.set(e,t,i,r)};t.prototype._clipOffsets=function(e,t,i,r,n,a,o,s,h){var l,u,c;l=[r,i,t,n];c=[s,o,a,h];u=this._reduce(l,c);return this._offsets([{start:0,count:u*e}])};return t}(n);t.exports=r},{"./geometry":133}],132:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;r=e("./clipgeometry");n=function(e){a(t,e);function t(e){var i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M,S,A;t.__super__.constructor.call(this,e);this._clipUniforms();this.items=s=+e.items||2;this.width=H=+e.width||1;this.height=n=+e.height||1;this.depth=r=+e.depth||1;this.sides=R=Math.max(0,s-2);T=H*n*r;m=s*T;k=R*T;this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(k*3),1));this.addAttribute("position4",new THREE.BufferAttribute(new Float32Array(m*4),4));this._autochunk();o=this._emitter("index");g=this._emitter("position4");i=0;for(a=l=0,y=T;0<=y?l<y:l>y;a=0<=y?++l:--l){for(h=c=0,E=R;0<=E?c<E:c>E;h=0<=E?++c:--c){o(i);o(i+h+1);o(i+h+2)}i+=s}for(A=p=0,w=r;0<=w?p<w:p>w;A=0<=w?++p:--p){for(S=f=0,b=n;0<=b?f<b:f>b;S=0<=b?++f:--f){for(M=d=0,_=H;0<=_?d<_:d>_;M=0<=_?++d:--d){for(u=v=0,x=s;0<=x?v<x:v>x;u=0<=x?++v:--v){g(M,S,A,u)}}}}this._finalize();this.clip();return}t.prototype.clip=function(e,t,i,r){var n;if(e==null){e=this.width}if(t==null){t=this.height}if(i==null){i=this.depth}if(r==null){r=this.items}n=Math.max(0,r-2);this._clipGeometry(e,t,i,r);return this._clipOffsets(3,e,t,i,n,this.width,this.height,this.depth,this.sides)};return t}(r);t.exports=n},{"./clipgeometry":131}],133:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=false;a=function(){var e;e=+new Date;return function(t){var i;i=+new Date-e;console.log(t,i+" ms");return i}};r=function(e){o(t,e);function t(){THREE.BufferGeometry.call(this);if(this.uniforms==null){this.uniforms={}}if(this.offsets==null){this.offsets=[]}if(n){this.tock=a()}this.chunked=false;this.limit=65535}t.prototype._reduce=function(e,t){var i,r,n,a,o,s,h;s=false;for(r=n=0,a=e.length;n<a;r=++n){i=e[r];o=t[r];if(s){e[r]=o}if(i>1){s=true}}return h=e.reduce(function(e,t){return e*t})};t.prototype._emitter=function(e){var t,i,r,n,a,o,s,h;i=this.attributes[e];r=i.itemSize;t=i.array;a=0;o=function(e){return t[a++]=e};h=function(e,i){t[a++]=e;return t[a++]=i};s=function(e,i,r){t[a++]=e;t[a++]=i;return t[a++]=r};n=function(e,i,r,n){t[a++]=e;t[a++]=i;t[a++]=r;return t[a++]=n};return[null,o,h,s,n][r]};t.prototype._autochunk=function(){var e,t,i,r,n,a;i=this.attributes.index;a=this.attributes;for(r in a){t=a[r];if(r!=="index"&&i){n=t.array.length/t.itemSize;if(n>this.limit){this.chunked=true}break}}if(this.chunked&&!i.u16){i.u16=e=i.array;return i.array=new Uint32Array(e.length)}};t.prototype._finalize=function(){var e;if(!this.chunked){return}e=this.attributes.index;this.chunks=this._chunks(e.array,this.limit);this._chunkify(e,this.chunks);if(n){return this.tock(this.constructor.name)}};t.prototype._chunks=function(e,t){var i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y;n=[];f=0;y=e[0];a=e[0];g=function(e){var t,i,r;r=f*3;i=e*3;t=i-r;return n.push({index:y,start:r,count:t,end:i})};d=Math.floor(e.length/3);m=0;for(o=s=0,v=d;0<=v?s<v:s>v;o=0<=v?++s:--s){h=e[m++];l=e[m++];u=e[m++];p=Math.min(h,l,u);c=Math.max(h,l,u);i=Math.min(y,p);r=Math.max(a,c);if(r-i>t){g(o);i=p;r=c;f=o}y=i;a=r}g(d);return n};t.prototype._chunkify=function(e,t){var i,r,n,a,o,s,h,l,u,c;if(!e.u16){return}r=e.array;c=e.u16;for(a=0,s=t.length;a<s;a++){i=t[a];h=i.index;for(n=o=l=i.start,u=i.end;l<=u?o<u:o>u;n=l<=u?++o:--o){c[n]=r[n]-h}}e.array=e.u16;return delete e.u16};t.prototype._offsets=function(e){var t,i,r,n,a,o,s,h,l,u,c,p;if(!this.chunked){this.offsets=e}else{n=this.chunks;c=this.offsets;c.length=null;for(o=0,h=e.length;o<h;o++){u=e[o];p=u.start;a=u.count-p;for(s=0,l=n.length;s<l;s++){r=n[s];i=r.start;t=r.end;if(p<=i&&a>i||p<t&&a>=t||p>i&&a<t){i=Math.max(p,i);t=Math.min(a,t);c.push({index:r.index,start:i,count:t-i})}}}}return null};return t}(THREE.BufferGeometry);t.exports=r},{}],134:[function(e,t,i){i.Geometry=e("./geometry");i.ArrowGeometry=e("./arrowgeometry");i.FaceGeometry=e("./facegeometry");i.LineGeometry=e("./linegeometry");i.ScreenGeometry=e("./screengeometry");i.SpriteGeometry=e("./spritegeometry");i.StripGeometry=e("./stripgeometry");i.SurfaceGeometry=e("./surfacegeometry")},{"./arrowgeometry":130,"./facegeometry":132,"./geometry":133,"./linegeometry":135,"./screengeometry":136,"./spritegeometry":137,"./stripgeometry":138,"./surfacegeometry":139}],135:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;r=e("./clipgeometry");n=function(e){a(t,e);function t(e){var i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M,S,A,C,z,P,L,O,D,F,B,U,N,V,I,j,G,W,q,X,Y,Z,K,Q,J,$,ee,te;t.__super__.constructor.call(this,e);this._clipUniforms();this.closed=r=e.closed||false;this.samples=I=(+e.samples||2)+(r?1:0);this.strips=W=+e.strips||1;this.ribbons=N=+e.ribbons||1;this.layers=g=+e.layers||1;this.detail=n=+e.detail||1;y=I-1;this.joints=f=n-1;this.vertices=K=(y-1)*f+I;this.segments=j=(y-1)*f+y;J=I-(r?1:0);x=K*W*N*g*2;k=j*W*N*g;X=k*2;this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(X*3),1));this.addAttribute("position4",new THREE.BufferAttribute(new Float32Array(x*4),4));this.addAttribute("line",new THREE.BufferAttribute(new Float32Array(x*2),2));this.addAttribute("strip",new THREE.BufferAttribute(new Float32Array(x*2),2));if(n>1){this.addAttribute("joint",new THREE.BufferAttribute(new Float32Array(x),1))}this._autochunk();l=this._emitter("index");T=this._emitter("position4");v=this._emitter("line");G=this._emitter("strip");if(n>1){p=this._emitter("joint")}i=0;for(s=w=0,M=N*g;0<=M?w<M:w>M;s=0<=M?++w:--w){for(u=b=0,S=W;0<=S?b<S:b>S;u=0<=S?++b:--b){for(d=_=0,z=j;0<=z?_<z:_>z;d=0<=z?++_:--_){l(i);l(i+1);l(i+2);l(i+2);l(i+1);l(i+3);i+=2}i+=2}}o=r?function(){return 0}:function(e){if(e===0){return-1}else if(e===I-1){return 1}else{return 0}};if(n>1){for(m=R=0,P=g;0<=P?R<P:R>P;m=0<=P?++R:--R){for(te=H=0,L=N;0<=L?H<L:H>L;te=0<=L?++H:--H){for(ee=V=0,O=W;0<=O?V<O:V>O;ee=0<=O?++V:--V){for($=q=0,D=I;0<=D?q<D:q>D;$=0<=D?++q:--q){if(r){$=$%J}a=o($);if(a!==0){T($,ee,te,m);T($,ee,te,m);v(a,1);v(a,-1);G(0,j);G(0,j);p(.5);p(.5)}else{for(E=Y=0,F=n;0<=F?Y<F:Y>F;E=0<=F?++Y:--Y){T($,ee,te,m);T($,ee,te,m);v(a,1);v(a,-1);G(0,j);G(0,j);p(E/f);p(E/f)}}}}}}}else{for(m=Z=0,B=g;0<=B?Z<B:Z>B;m=0<=B?++Z:--Z){for(te=Q=0,U=N;0<=U?Q<U:Q>U;te=0<=U?++Q:--Q){for(ee=h=0,A=W;0<=A?h<A:h>A;ee=0<=A?++h:--h){for($=c=0,C=I;0<=C?c<C:c>C;$=0<=C?++c:--c){if(r){$=$%J}a=o($);T($,ee,te,m);T($,ee,te,m);v(a,1);v(a,-1);G(0,j);G(0,j)}}}}}this._finalize();this.clip();return}t.prototype.clip=function(e,t,i,r){var n,a;if(e==null){e=this.samples-this.closed}if(t==null){t=this.strips}if(i==null){i=this.ribbons}if(r==null){r=this.layers}n=Math.max(0,e-(this.closed?0:1));a=e+(e-2)*this.joints;n=a-1;this._clipGeometry(a,t,i,r);return this._clipOffsets(6,n,t,i,r,this.segments,this.strips,this.ribbons,this.layers)};return t}(r);t.exports=n},{"./clipgeometry":131}],136:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;n=e("./surfacegeometry");r=function(e){a(t,e);function t(e){var i,r;if(this.uniforms==null){this.uniforms={}}this.uniforms.geometryScale={type:"v4",value:new THREE.Vector4};e.width=Math.max(2,(i=+e.width)!=null?i:2);e.height=Math.max(2,(r=+e.height)!=null?r:2);this.cover();t.__super__.constructor.call(this,e)}t.prototype.cover=function(e,t,i,r){this.scaleX=e!=null?e:1;this.scaleY=t!=null?t:1;this.scaleZ=i!=null?i:1;this.scaleW=r!=null?r:1};t.prototype.clip=function(e,i,r,n){var a;if(e==null){e=this.width}if(i==null){i=this.height}if(r==null){r=this.surfaces}if(n==null){n=this.layers}t.__super__.clip.call(this,e,i,r,n);a=function(e){return 1/Math.max(1,e-1)};return this.uniforms.geometryScale.value.set(a(e)*this.scaleX,a(i)*this.scaleY,a(r)*this.scaleZ,a(n)*this.scaleW)};return t}(n);t.exports=r},{"./surfacegeometry":139}],137:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;r=e("./clipgeometry");n=function(e){a(t,e);function t(e){var i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M,S,A,C;t.__super__.constructor.call(this,e);this._clipUniforms();this.items=s=+e.items||2;this.width=M=+e.width||1;this.height=n=+e.height||1;this.depth=r=+e.depth||1;T=s*M*n*r;g=T*4;k=T*2;this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(k*3),1));this.addAttribute("position4",new THREE.BufferAttribute(new Float32Array(g*4),4));this.addAttribute("sprite",new THREE.BufferAttribute(new Float32Array(g*2),2));this._autochunk();o=this._emitter("index");v=this._emitter("position4");R=this._emitter("sprite");y=[[-1,-1],[-1,1],[1,-1],[1,1]];i=0;for(a=h=0,E=T;0<=E?h<E:h>E;a=0<=E?++h:--h){o(i);o(i+1);o(i+2);o(i+1);o(i+2);o(i+3);i+=4}for(C=l=0,w=r;0<=w?l<w:l>w;C=0<=w?++l:--l){for(A=p=0,b=n;0<=b?p<b:p>b;A=0<=b?++p:--p){for(S=f=0,_=M;0<=_?f<_:f>_;S=0<=_?++f:--f){for(u=d=0,x=s;0<=x?d<x:d>x;u=0<=x?++d:--d){for(m=0,c=y.length;m<c;m++){H=y[m];v(S,A,C,u);R(H[0],H[1])}}}}}this._finalize();this.clip();return}t.prototype.clip=function(e,t,i,r){if(e==null){e=this.width}if(t==null){t=this.height}if(i==null){i=this.depth}if(r==null){r=this.items}this._clipGeometry(e,t,i,r);return this._clipOffsets(6,e,t,i,r,this.width,this.height,this.depth,this.items)};return t}(r);t.exports=n},{"./clipgeometry":131}],138:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;r=e("./clipgeometry");n=function(e){a(t,e);function t(e){var i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M,S,A,C,z,P,L;t.__super__.constructor.call(this,e);this._clipUniforms();this.items=h=+e.items||2;this.width=C=+e.width||1;this.height=a=+e.height||1;this.depth=r=+e.depth||1;this.sides=M=Math.max(0,h-2);H=C*a*r;v=h*H;A=M*H;this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(A*3),1));this.addAttribute("position4",new THREE.BufferAttribute(new Float32Array(v*4),4));this.addAttribute("strip",new THREE.BufferAttribute(new Float32Array(v*3),3));this._autochunk();s=this._emitter("index");y=this._emitter("position4");S=this._emitter("strip");i=0;for(o=u=0,b=H;0<=b?u<b:u>b;o=0<=b?++u:--u){m=i;for(l=f=0,_=M;0<=_?f<_:f>_;l=0<=_?++f:--f){if(l&1){s(m+1);s(m);s(m+2)}else{s(m);s(m+1);s(m+2)}m++}i+=h}p=h-1;for(L=d=0,x=r;0<=x?d<x:d>x;L=0<=x?++d:--d){for(P=g=0,T=a;0<=T?g<T:g>T;P=0<=T?++g:--g){for(z=E=0,R=C;0<=R?E<R:E>R;z=0<=R?++E:--E){n=1;y(z,P,L,0);S(1,2,n);for(c=w=1,k=p;1<=k?w<k:w>k;c=1<=k?++w:--w){y(z,P,L,c);S(c-1,c+1,n=-n)}y(z,P,L,p);S(p-2,p-1,-n)}}}this._finalize();this.clip();return}t.prototype.clip=function(e,t,i,r){var n;if(e==null){e=this.width}if(t==null){t=this.height}if(i==null){i=this.depth}if(r==null){r=this.items}n=Math.max(0,r-2);this._clipGeometry(e,t,i,r);return this._clipOffsets(3,e,t,i,n,this.width,this.height,this.depth,this.sides)};return t}(r);t.exports=n},{"./clipgeometry":131}],139:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;r=e("./clipgeometry");n=function(e){a(t,e);function t(e){var i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M,S,A,C,z,P,L,O,D,F,B,U,N,V,I,j;t.__super__.constructor.call(this,e);this._clipUniforms();this.closedX=r=e.closedX||false;this.closedY=n=e.closedY||false;this.width=B=(+e.width||2)+(r?1:0);this.height=l=(+e.height||2)+(n?1:0);this.surfaces=D=+e.surfaces||1;this.layers=m=+e.layers||1;U=B-(r?1:0);N=l-(n?1:0);this.segmentsX=P=Math.max(0,B-1);this.segmentsY=L=Math.max(0,l-1);w=B*l*D*m;x=P*L*D*m;F=x*2;this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(F*3),1));this.addAttribute("position4",new THREE.BufferAttribute(new Float32Array(w*4),4));this.addAttribute("surface",new THREE.BufferAttribute(new Float32Array(w*2),2));this._autochunk();c=this._emitter("index");b=this._emitter("position4");O=this._emitter("surface");i=0;for(u=g=0,R=D*m;0<=R?g<R:g>R;u=0<=R?++g:--g){for(p=v=0,k=L;0<=k?v<k:v>k;p=0<=k?++v:--v){for(f=y=0,H=P;0<=H?y<H:y>H;f=0<=H?++y:--y){c(i);c(i+1);c(i+B);c(i+B);c(i+1);c(i+B+1);i++}i++}i+=B}s=r?function(){return 0}:function(e){if(e===0){return-1}else if(e===P){return 1}else{return 0}};h=n?function(){return 0}:function(e){if(e===0){return-1}else if(e===L){return 1}else{return 0}};for(d=E=0,M=m;0<=M?E<M:E>M;d=0<=M?++E:--E){for(j=_=0,S=D;0<=S?_<S:_>S;j=0<=S?++_:--_){for(I=T=0,A=l;0<=A?T<A:T>A;I=0<=A?++T:--T){if(n){I=I%N}o=h(I);for(V=z=0,C=B;0<=C?z<C:z>C;V=0<=C?++z:--z){if(r){V=V%U}a=s(V);b(V,I,j,d);O(a,o)}}}}this._finalize();this.clip();return}t.prototype.clip=function(e,t,i,r){var n,a;if(e==null){e=this.width}if(t==null){t=this.height}if(i==null){i=this.surfaces}if(r==null){r=this.layers}n=Math.max(0,e-1);a=Math.max(0,t-1);this._clipGeometry(e,t,i,r);return this._clipOffsets(6,n,a,i,r,this.segmentsX,this.segmentsY,this.surfaces,this.layers)};t.prototype.map=function(e,t,i,r){if(e==null){e=this.width}if(t==null){t=this.height}if(i==null){i=this.surfaces}if(r==null){r=this.layers}return this._clipMap(e,t,i,r)};return t}(r);t.exports=n},{"./clipgeometry":131}],140:[function(e,t,i){i.Scene=e("./scene");i.Factory=e("./factory");i.Renderable=e("./scene");i.Classes=e("./classes")},{"./classes":128,"./factory":129,"./scene":153}],141:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;a=e("./base");n=e("../geometry").ArrowGeometry;r=function(e){o(t,e);function t(e,i,r){var a,o,s,h,l,u,c,p,f,d,m,g,v,y;t.__super__.constructor.call(this,e,i,r);v=r.uniforms,f=r.material,m=r.position,a=r.color,p=r.mask,c=r.map,o=r.combine,g=r.stpq,u=r.linear;if(v==null){v={}}l=v.styleColor!=null;this.geometry=new n({sides:r.sides,samples:r.samples,strips:r.strips,ribbons:r.ribbons,layers:r.layers,anchor:r.anchor,flip:r.flip});this._adopt(v);this._adopt(this.geometry.uniforms);h=i.material();y=h.vertex;y.pipe(this._vertexColor(a,p));y.require(this._vertexPosition(m,f,c,1,g));y.pipe("arrow.position",this.uniforms);y.pipe("project.position",this.uniforms);h.fragment=s=this._fragmentColor(l,f,a,p,c,1,g,o,u);s.pipe("fragment.color",this.uniforms);this.material=this._material(h.link({}));d=new THREE.Mesh(this.geometry,this.material);d.frustumCulled=false;d.matrixAutoUpdate=false;this._raw(d);this.renders=[d]}t.prototype.dispose=function(){this.geometry.dispose();this.material.dispose();this.renders=this.geometry=this.material=null;return t.__super__.dispose.apply(this,arguments)};return t}(a);t.exports=r},{"../geometry":134,"./base":142}],142:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("../renderable");a=e("../../util");r=function(e){o(t,e);function t(e,i,r){var n;t.__super__.constructor.call(this,e,i,r);this.zUnits=(n=r.zUnits)!=null?n:0}t.prototype.raw=function(){var e,t,i,r;r=this.renders;for(e=0,t=r.length;e<t;e++){i=r[e];this._raw(i)}return null};t.prototype.depth=function(e,t){var i,r,n,a;a=this.renders;for(i=0,r=a.length;i<r;i++){n=a[i];this._depth(n,e,t)}return null};t.prototype.polygonOffset=function(e,t){var i,r,n,a;a=this.renders;for(i=0,r=a.length;i<r;i++){n=a[i];this._polygonOffset(n,e,t)}return null};t.prototype.show=function(e,t,i){var r,n,a,o,s;o=this.renders;s=[];for(r=0,n=o.length;r<n;r++){a=o[r];s.push(this._show(a,e,t,i))}return s};t.prototype.hide=function(){var e,t,i,r;r=this.renders;for(e=0,t=r.length;e<t;e++){i=r[e];this._hide(i)}return null};t.prototype._material=function(e){var t,i,r,n,a,o,s,h;o=this.renderer.getPrecision();h="    precision "+o+" float;\n    precision "+o+" int;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;";t="    precision "+o+" float;\n    precision "+o+" int;\nuniform mat4 viewMatrix;\nuniform vec3 cameraPosition;";a=new THREE.RawShaderMaterial(e);s=["vertexGraph","fragmentGraph"];for(i=0,n=s.length;i<n;i++){r=s[i];a[r]=e[r]}a.vertexShader=[h,a.vertexShader].join("\n");a.fragmentShader=[t,a.fragmentShader].join("\n");return a};t.prototype._raw=function(e){e.rotationAutoUpdate=false;e.frustumCulled=false;e.matrixAutoUpdate=false;return e.material.defaultAttributeValues=void 0};t.prototype._depth=function(e,t,i){var r;r=e.material;r.depthWrite=t;return r.depthTest=i};t.prototype._polygonOffset=function(e,t,i){var r,n;i-=this.zUnits;r=i!==0;n=e.material;n.polygonOffset=r;if(r){n.polygonOffsetFactor=t;return n.polygonOffsetUnits=i}};t.prototype._show=function(e,t,i,r){var n;t=true;n=e.material;e.renderOrder=-r;e.visible=true;n.transparent=t;n.blending=i;return null};t.prototype._hide=function(e){return e.visible=false};t.prototype._vertexColor=function(e,t){var i;if(!(e||t)){return}i=this.shaders.shader();if(e){i.require(e);i.pipe("mesh.vertex.color",this.uniforms)}if(t){i.require(t);i.pipe("mesh.vertex.mask",this.uniforms)}return i};t.prototype._vertexPosition=function(e,t,i,r,n){var a,o;o=this.shaders.shader();if(i||t&&t!==true){a={};if(r>0||n){a.POSITION_MAP=""}if(r>0){a[["POSITION_U","POSITION_UV","POSITION_UVW","POSITION_UVWO"][r-1]]=""}if(n){a.POSITION_STPQ=""}}o.require(e);return o.pipe("mesh.vertex.position",this.uniforms,a)};t.prototype._fragmentColor=function(e,t,i,r,n,o,s,h,l){var u,c,p,f;c=this.shaders.shader();f=false;p=false;u={};if(o>0){u[["POSITION_U","POSITION_UV","POSITION_UVW","POSITION_UVWO"][o-1]]=""}if(s){u.POSITION_STPQ=""}if(e){c.pipe("style.color",this.uniforms);f=true;if(i||n||t){if(!l||i){c.pipe("mesh.gamma.in")}p=true}}if(i){c.isolate();c.pipe("mesh.fragment.color",this.uniforms);if(!l||f){c.pipe("mesh.gamma.in")}c.end();if(f){c.pipe(a.GLSL.binaryOperator("vec4","*"))}if(l&&f){c.pipe("mesh.gamma.out")}f=true;p=true}if(n){if(!f&&h){c.pipe(a.GLSL.constant("vec4","vec4(1.0)"))}c.isolate();c.require(n);c.pipe("mesh.fragment.map",this.uniforms,u);if(!l){c.pipe("mesh.gamma.in")}c.end();if(h){c.pipe(h)}else{if(f){c.pipe(a.GLSL.binaryOperator("vec4","*"))}}f=true;p=true}if(t){if(!f){c.pipe(a.GLSL.constant("vec4","vec4(1.0)"))}if(t===true){c.pipe("mesh.fragment.shaded",this.uniforms)}else{c.require(t);c.pipe("mesh.fragment.material",this.uniforms,u)}p=true}if(p&&!l){c.pipe("mesh.gamma.out")}if(r){c.pipe("mesh.fragment.mask",this.uniforms);if(f){c.pipe(a.GLSL.binaryOperator("vec4","*"))}}return c};return t}(n);t.exports=r},{"../../util":166,"../renderable":152}],143:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;r=e("./base");n=function(e){a(t,e);function t(e,i,r){var n;t.__super__.constructor.call(this,e,i,r);this.geometry=new THREE.PlaneGeometry(1,1);this.material=new THREE.MeshBasicMaterial({map:r.map});this.material.side=THREE.DoubleSide;n=new THREE.Mesh(this.geometry,this.material);n.position.x+=r.x||0;n.position.y+=r.y||0;n.frustumCulled=false;n.scale.set(2,2,2);n.__debug=true;this.objects=[n]}t.prototype.dispose=function(){this.geometry.dispose();this.material.dispose();this.objects=this.geometry=this.material=null;return t.__super__.dispose.apply(this,arguments)};return t}(r);t.exports=n},{"./base":142}],144:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("./base");a=e("../geometry").FaceGeometry;n=function(e){o(t,e);function t(e,i,r){var n,o,s,h,l,u,c,p,f,d,m,g,v,y;t.__super__.constructor.call(this,e,i,r);v=r.uniforms,f=r.material,m=r.position,n=r.color,p=r.mask,c=r.map,o=r.combine,g=r.stpq,u=r.linear;if(v==null){v={}}if(f==null){f=true}l=v.styleColor!=null;this.geometry=new a({items:r.items,width:r.width,height:r.height,depth:r.depth});this._adopt(v);this._adopt(this.geometry.uniforms);h=i.material();y=h.vertex;y.pipe(this._vertexColor(n,p));y.require(this._vertexPosition(m,f,c,2,g));if(!f){y.pipe("face.position",this.uniforms)}if(f){y.pipe("face.position.normal",this.uniforms)}y.pipe("project.position",this.uniforms);h.fragment=s=this._fragmentColor(l,f,n,p,c,2,g,o,u);s.pipe("fragment.color",this.uniforms);this.material=this._material(h.link({side:THREE.DoubleSide}));d=new THREE.Mesh(this.geometry,this.material);this._raw(d);this.renders=[d]}t.prototype.dispose=function(){this.geometry.dispose();this.material.dispose();this.renders=this.geometry=this.material=null;return t.__super__.dispose.apply(this,arguments)};return t}(r);t.exports=n},{"../geometry":134,"./base":142}],145:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("./base");a=e("../geometry").LineGeometry;n=function(e){o(t,e);function t(e,i,r){var n,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R;t.__super__.constructor.call(this,e,i,r);T=r.uniforms,v=r.material,E=r.position,o=r.color,g=r.mask,m=r.map,s=r.combine,_=r.stpq,d=r.linear,n=r.clip,x=r.stroke,f=r.join,w=r.proximity;if(T==null){T={}}x=[null,"dotted","dashed"][x];p=T.styleColor!=null;f=(b=["miter","round","bevel"][f])!=null?b:"miter";l={miter:1,round:4,bevel:2}[f];this.geometry=new a({samples:r.samples,strips:r.strips,ribbons:r.ribbons,layers:r.layers,anchor:r.anchor,closed:r.closed,detail:l});this._adopt(T);this._adopt(this.geometry.uniforms);c=i.material();h={};if(x){h.LINE_STROKE=""}if(n){h.LINE_CLIP=""}if(w!=null){h.LINE_PROXIMITY=""}h["LINE_JOIN_"+f.toUpperCase()]="";if(l>1){h["LINE_JOIN_DETAIL"]=l}R=c.vertex;R.pipe(this._vertexColor(o,g));R.require(this._vertexPosition(E,v,m,2,_));R.pipe("line.position",this.uniforms,h);R.pipe("project.position",this.uniforms);u=c.fragment;if(x){u.pipe("fragment.clip."+x,this.uniforms)}if(n){u.pipe("fragment.clip.ends",this.uniforms)}if(w!=null){u.pipe("fragment.clip.proximity",this.uniforms)}u.pipe(this._fragmentColor(p,v,o,g,m,2,_,s,d));u.pipe("fragment.color",this.uniforms);this.material=this._material(c.link({side:THREE.DoubleSide}));y=new THREE.Mesh(this.geometry,this.material);this._raw(y);this.renders=[y]}t.prototype.dispose=function(){this.geometry.dispose();this.material.dispose();this.renders=this.geometry=this.material=null;return t.__super__.dispose.apply(this,arguments)};return t}(r);t.exports=n},{"../geometry":134,"./base":142}],146:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("./screen");a=e("../../util");r=function(e){o(t,e);function t(e,i,r){var n,a,o,s,h,l,u,c,p,f,d,m;this.memo=(l=r.items,m=r.width,a=r.height,n=r.depth,d=r.stpq,r);s=function(e){return 1/Math.max(1,e)};h=function(e){return 1/Math.max(1,e-1)};this.uniforms={remapUVScale:{type:"v2",value:new THREE.Vector2(l*m,a*n)},remapModulus:{type:"v2",value:new THREE.Vector2(l,a)},remapModulusInv:{type:"v2",value:new THREE.Vector2(s(l),s(a))},remapSTPQScale:{type:"v4",value:new THREE.Vector4(h(m),h(a),h(n),h(l))}};c=i.shader();c.pipe("screen.map.xyzw",this.uniforms);if(r.map!=null){if(d){c.pipe("screen.map.stpq",this.uniforms)}c.pipe(r.map)}t.__super__.constructor.call(this,e,i,{map:c,linear:true});f=this.renders;for(o=0,u=f.length;o<u;o++){p=f[o];p.transparent=false}null}t.prototype.cover=function(e,t,i,r){var n,a,o;if(e==null){e=this.memo.width}if(t==null){t=this.memo.height}if(i==null){i=this.memo.depth}if(r==null){r=this.memo.items}n=function(e){return 1/Math.max(1,e-1)};this.uniforms.remapSTPQScale.value.set(n(e),n(t),n(i),n(r));a=e/this.memo.width;o=i/this.memo.depth;if(this.memo.depth===1){o=t/this.memo.height}return this.geometry.cover(a,o)};return t}(n);t.exports=r},{"../../util":166,"./screen":148}],147:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("./base");a=e("../geometry").SpriteGeometry;n=function(e){o(t,e);function t(e,i,r){var n,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M,S,A,C,z,P,L,O;t.__super__.constructor.call(this,e,i,r);L=r.uniforms,w=r.material,T=r.position,h=r.color,z=r.size,E=r.mask,y=r.map,l=r.combine,v=r.linear,A=r.shape,b=r.optical,d=r.fill,P=r.stpq;if(L==null){L={}}A=(R=+A)!=null?R:0;if(d==null){d=true}g=L.styleColor!=null;C=["circle","square","diamond","up","down","left","right"];x=["circle","generic","generic","generic","generic","generic","generic"];S=[1.2,1,1.414,1.16,1.16,1.16,1.16];_=(k=x[A])!=null?k:x[0];o=(H=C[A])!=null?H:C[0];n=(M=b&&S[A])!=null?M:1;s=d?_:_+".hollow";this.geometry=new a({items:r.items,width:r.width,height:r.height,depth:r.depth});this._adopt(L);this._adopt(this.geometry.uniforms);u={POINT_SHAPE_SCALE:+(n+1e-5)};f=i.material();O=f.vertex;O.pipe(this._vertexColor(h,E));if(z){O.isolate();O.require(z);O.require("point.size.varying",this.uniforms);O.end()}else{O.require("point.size.uniform",this.uniforms)}O.require(this._vertexPosition(T,w,y,2,P));O.pipe("point.position",this.uniforms,u);O.pipe("project.position",this.uniforms);f.fragment=p=this._fragmentColor(g,w,h,E,y,2,P,l,v);c=i.material();c.vertex.pipe(O);p=c.fragment.pipe(f.fragment);p.require("point.mask."+o,this.uniforms);p.require("point.alpha."+s,this.uniforms);p.pipe("point.edge",this.uniforms);m=i.material();m.vertex.pipe(O);p=m.fragment.pipe(f.fragment);p.require("point.mask."+o,this.uniforms);p.require("point.alpha."+s,this.uniforms);p.pipe("point.fill",this.uniforms);this.fillMaterial=this._material(m.link({side:THREE.DoubleSide}));this.edgeMaterial=this._material(c.link({side:THREE.DoubleSide}));this.fillObject=new THREE.Mesh(this.geometry,this.fillMaterial);this.edgeObject=new THREE.Mesh(this.geometry,this.edgeMaterial);this._raw(this.fillObject);this._raw(this.edgeObject);this.renders=[this.fillObject,this.edgeObject]}t.prototype.show=function(e,t,i,r){this._show(this.edgeObject,true,t,i,r);return this._show(this.fillObject,e,t,i,r)};t.prototype.dispose=function(){this.geometry.dispose();this.edgeMaterial.dispose();this.fillMaterial.dispose();this.renders=this.edgeObject=this.fillObject=this.geometry=this.edgeMaterial=this.fillMaterial=null;return t.__super__.dispose.apply(this,arguments)};return t}(r);t.exports=n},{"../geometry":134,"./base":142}],148:[function(e,t,i){var r,n,a,o,s=function(e,t){for(var i in t){if(h.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},h={}.hasOwnProperty;r=e("./base");a=e("../geometry").ScreenGeometry;o=e("../../util");n=function(e){s(t,e);function t(e,i,r){var n,o,s,h,l,u,c,p,f,d;t.__super__.constructor.call(this,e,i,r);f=r.uniforms,u=r.map,n=r.combine,p=r.stpq,l=r.linear;if(f==null){f={}}h=f.styleColor!=null;this.geometry=new a({width:r.width,height:r.height});this._adopt(f);this._adopt(this.geometry.uniforms);s=i.material();d=s.vertex;d.pipe("raw.position.scale",this.uniforms);d.fan();d.pipe("stpq.xyzw.2d",this.uniforms);d.next();d.pipe("screen.position",this.uniforms);d.join();s.fragment=o=this._fragmentColor(h,false,null,null,u,2,p,n,l);o.pipe("fragment.color",this.uniforms);this.material=this._material(s.link({side:THREE.DoubleSide}));c=new THREE.Mesh(this.geometry,this.material);c.frustumCulled=false;this._raw(c);this.renders=[c]}t.prototype.dispose=function(){this.geometry.dispose();this.material.dispose();this.renders=this.geometry=this.material=null;return t.__super__.dispose.apply(this,arguments)};return t}(r);t.exports=n},{"../../util":166,"../geometry":134,"./base":142}],149:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("./base");a=e("../geometry").SpriteGeometry;n=function(e){o(t,e);function t(e,i,r){var n,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w;t.__super__.constructor.call(this,e,i,r);E=r.uniforms,m=r.material,g=r.position,v=r.sprite,f=r.map,o=r.combine,p=r.linear,n=r.color,d=r.mask,y=r.stpq;if(E==null){E={}}c=E.styleColor!=null;this.geometry=new a({items:r.items,width:r.width,height:r.height,depth:r.depth});this._adopt(E);this._adopt(this.geometry.uniforms);l=i.material();w=l.vertex;w.pipe(this._vertexColor(n,d));w.require(this._vertexPosition(g,m,f,2,y));w.require(v);w.pipe("sprite.position",this.uniforms);w.pipe("project.position",this.uniforms);l.fragment=h=this._fragmentColor(c,m,n,d,f,2,y,o,p);s=i.material();s.vertex.pipe(w);s.fragment.pipe(h);s.fragment.pipe("fragment.transparent",this.uniforms);u=i.material();u.vertex.pipe(w);u.fragment.pipe(h);u.fragment.pipe("fragment.solid",this.uniforms);this.fillMaterial=this._material(u.link({side:THREE.DoubleSide}));this.edgeMaterial=this._material(s.link({side:THREE.DoubleSide}));this.fillObject=new THREE.Mesh(this.geometry,this.fillMaterial);this.edgeObject=new THREE.Mesh(this.geometry,this.edgeMaterial);this._raw(this.fillObject);this._raw(this.edgeObject);this.renders=[this.fillObject,this.edgeObject]}t.prototype.show=function(e,t,i,r){this._show(this.edgeObject,true,t,i,r);return this._show(this.fillObject,e,t,i,r)};t.prototype.dispose=function(){this.geometry.dispose();this.edgeMaterial.dispose();this.fillMaterial.dispose();this.nreders=this.geometry=this.edgeMaterial=this.fillMaterial=this.edgeObject=this.fillObject=null;return t.__super__.dispose.apply(this,arguments)};return t}(r);t.exports=n},{"../geometry":134,"./base":142}],150:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;r=e("./base");a=e("../geometry").StripGeometry;n=function(e){o(t,e);function t(e,i,r){var n,o,s,h,l,u,c,p,f,d,m,g,v,y;t.__super__.constructor.call(this,e,i,r);v=r.uniforms,f=r.material,m=r.position,n=r.color,p=r.mask,c=r.map,o=r.combine,u=r.linear,g=r.stpq;if(v==null){v={}}if(f==null){f=true}l=v.styleColor!=null;this.geometry=new a({items:r.items,width:r.width,height:r.height,depth:r.depth});this._adopt(v);this._adopt(this.geometry.uniforms);h=i.material();y=h.vertex;y.pipe(this._vertexColor(n,p));y.require(this._vertexPosition(m,f,c,2,g));if(!f){y.pipe("mesh.position",this.uniforms)}if(f){y.pipe("strip.position.normal",this.uniforms)}y.pipe("project.position",this.uniforms);h.fragment=s=this._fragmentColor(l,f,n,p,c,2,g,o,u);s.pipe("fragment.color",this.uniforms);this.material=this._material(h.link({side:THREE.DoubleSide}));d=new THREE.Mesh(this.geometry,this.material);this._raw(d);this.renders=[d]}t.prototype.dispose=function(){this.geometry.dispose();this.material.dispose();this.renders=this.geometry=this.material=null;return t.__super__.dispose.apply(this,arguments)};return t}(r);t.exports=n},{"../geometry":134,"./base":142}],151:[function(e,t,i){var r,n,a,o,s=function(e,t){for(var i in t){if(h.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},h={}.hasOwnProperty;r=e("./base");a=e("../geometry").SurfaceGeometry;o=e("../../util");n=function(e){s(t,e);function t(e,i,r){var n,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b;t.__super__.constructor.call(this,e,i,r);w=r.uniforms,g=r.material,y=r.position,n=r.color,m=r.mask,d=r.map,o=r.combine,f=r.linear,E=r.stpq,p=r.intUV;if(w==null){w={}}if(g==null){g=true}c=w.styleColor!=null;u=w.surfaceHollow!=null;this.geometry=new a({width:r.width,height:r.height,surfaces:r.surfaces,layers:r.layers,closedX:r.closedX,closedY:r.closedY});this._adopt(w);this._adopt(this.geometry.uniforms);l=i.material();b=l.vertex;if(p){s={POSITION_UV_INT:""}}b.pipe(this._vertexColor(n,m));b.require(this._vertexPosition(y,g,d,2,E));if(!g){b.pipe("surface.position",this.uniforms,s)}if(g){b.pipe("surface.position.normal",this.uniforms,s)}b.pipe("project.position",this.uniforms);l.fragment=h=this._fragmentColor(c,g,n,m,d,2,E,o,f);h.pipe("fragment.color",this.uniforms);this.material=this._material(l.link({side:THREE.DoubleSide}));v=new THREE.Mesh(this.geometry,this.material);this._raw(v);this.renders=[v]}t.prototype.dispose=function(){this.geometry.dispose();this.material.dispose();this.renders=this.geometry=this.material=null;return t.__super__.dispose.apply(this,arguments)};return t}(r);t.exports=n},{"../../util":166,"../geometry":134,"./base":142}],152:[function(e,t,i){var r;r=function(){function e(e,t){this.renderer=e;this.shaders=t;this.gl=this.renderer.context;if(this.uniforms==null){this.uniforms={}}}e.prototype.dispose=function(){return this.uniforms=null};e.prototype._adopt=function(e){var t,i;for(t in e){i=e[t];this.uniforms[t]=i}};e.prototype._set=function(e){var t,i;for(t in e){i=e[t];if(this.uniforms[t]!=null){this.uniforms[t].value=i}}};return e}();t.exports=r},{}],153:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty,h=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++){if(t in this&&this[t]===e)return t}return-1};n=e("./renderable");r=function(e){o(t,e);function t(){t.__super__.constructor.apply(this,arguments);this.rotationAutoUpdate=false;this.frustumCulled=false;this.matrixAutoUpdate=false}return t}(THREE.Object3D);a=function(e){o(t,e);function t(e,i,n){t.__super__.constructor.call(this,e,i,n);this.root=new r;if((n!=null?n.scene:void 0)!=null){this.scene=n.scene}if(this.scene==null){this.scene=new THREE.Scene}this.pending=[];this.async=0;this.scratch=new THREE.WebGLRenderTarget(1,1);this.camera=new THREE.PerspectiveCamera}t.prototype.inject=function(e){if(e!=null){this.scene=e}return this.scene.add(this.root)};t.prototype.unject=function(){var e;return(e=this.scene)!=null?e.remove(this.root):void 0};t.prototype.add=function(e){if(this.async){return this.pending.push(e)}else{return this._add(e)}};t.prototype.remove=function(e){this.pending=this.pending.filter(function(t){return t!==e});if(e.parent!=null){return this._remove(e)}};t.prototype._add=function(e){return this.root.add(e)};t.prototype._remove=function(e){return this.root.remove(e)};t.prototype.dispose=function(){if(this.root.parent!=null){return this.unject()}};t.prototype.warmup=function(e){return this.async=+e||0};t.prototype.render=function(){var e,t,i,r,n,a,o;if(!this.pending.length){return}t=this.root.children;e=[];for(i=r=0,a=this.async;0<=a?r<a:r>a;i=0<=a?++r:--r){n=this.pending.shift();if(!n){break}this._add(n);e.push(e)}o=t.map(function(e){var t;return t=e.visible});t.map(function(t){return t.visible=h.call(e,t)<0});this.renderer.render(this.scene,this.camera,this.scratch);return t.map(function(e,t){return e.visible=o[t]})};t.prototype.toJSON=function(){return this.root.toJSON()};return t}(n);t.exports=a},{"./renderable":152}],154:[function(e,t,i){var r,n;n=e("../../vendor/shadergraph/src");r=function(e){var t;t=function(t){var i,r,n,a,o;a=e[t];if(a!=null){return a}r=(n=t[0])==="#"||n==="."||n===":"||n==="[";o=r?t:"#"+t;i=document.querySelector(o);if(i!=null&&i.tagName==="SCRIPT"){return i.textContent||i.innerText}throw new Error("Unknown shader `"+t+"`")};return new n(t,{autoInspect:true})};t.exports=r},{"../../vendor/shadergraph/src":195}],155:[function(e,t,i){i.Factory=e("./factory");i.Snippets=e("../../build/shaders")},{"../../build/shaders":1,"./factory":154}],156:[function(e,t,i){THREE.Bootstrap.registerPlugin("splash",{defaults:{color:"mono",fancy:true},listen:["ready","mathbox/init:init","mathbox/progress:progress","mathbox/destroy:destroy"],uninstall:function(){return this.destroy()},ready:function(e,t){if(t.MathBox&&!this.div){return init(e,t)}},init:function(e,t){var i,r,n,a,o,s,h;this.destroy();i=this.options.color;n='<div class="mathbox-loader mathbox-splash-'+i+'">\n  <div class="mathbox-logo">\n    <div> <div></div><div></div><div></div> </div>\n    <div> <div></div><div></div><div></div> </div>\n  </div>\n  <div class="mathbox-progress"><div></div></div>\n</div>';this.div=r=document.createElement("div");r.innerHTML=n;t.element.appendChild(r);o=Math.random()*2-1;s=Math.random()*2-1;h=Math.random()*2-1;a=1/Math.sqrt(o*o+s*s+h*h);this.loader=r.querySelector(".mathbox-loader");this.bar=r.querySelector(".mathbox-progress > div");this.gyro=r.querySelectorAll(".mathbox-logo > div");this.transforms=["rotateZ(22deg) rotateX(24deg) rotateY(30deg)","rotateZ(11deg) rotateX(12deg) rotateY(15deg) scale3d(.6, .6, .6)"];this.random=[o*a,s*a,h*a];this.start=t.Time.now;return this.timer=null},progress:function(e,t){var i,r,n,a,o,s,h,l,u,c,p,f,d,m;if(!this.div){return}i=e.current,p=e.total;f=i<p;clearTimeout(this.timer);if(f){this.loader.classList.remove("mathbox-exit");this.loader.style.display="block"}else{this.loader.classList.add("mathbox-exit");this.timer=setTimeout(function(e){return function(){return e.loader.style.display="none"}}(this),150)}m=i<p?Math.round(1e3*i/p)*.1+"%":"100%";this.bar.style.width=m;if(this.options.fancy){d=this.random;n=Math.max(0,Math.min(1,t.Time.now-this.start));o=function(e,i){if(i==null){i=0}return e.replace(/(-?[0-9.e]+)deg/g,function(e,r){return+r+d[i++]*n*t.Time.step*60+"deg"})};l=this.gyro;u=[];for(a=s=0,h=l.length;s<h;a=++s){r=l[a];this.transforms[a]=c=o(this.transforms[a]);u.push(r.style.transform=r.style.WebkitTransform=c)}return u}},destroy:function(){var e;if((e=this.div)!=null){e.remove()}return this.div=null}})},{}],157:[function(e,t,i){var r,n,a;a=e("../util").Ease;n=function(){function e(e){this.context=e;this.anims=[]}e.prototype.make=function(e,t){var i;i=new r(this,this.context.time,e,t);this.anims.push(i);return i};e.prototype.unmake=function(e){var t;return this.anims=function(){var i,r,n,a;n=this.anims;a=[];for(i=0,r=n.length;i<r;i++){t=n[i];if(t!==e){a.push(t)}}return a}.call(this)};e.prototype.update=function(){var e,t;t=this.context.time;return this.anims=function(){var i,r,n,a;n=this.anims;a=[];for(i=0,r=n.length;i<r;i++){e=n[i];if(e.update(t)!==false){a.push(e)}}return a}.call(this)};e.prototype.lerp=function(e,t,i,r,n){var a,o,s,h;if(n==null){n=e.make()}if(e.lerp){n=e.lerp(t,i,n,r)}else if(e.emitter){o=t.emitterFrom;h=i.emitterTo;if(o!=null&&h!=null&&o===h){o.lerp(r);return o}else{a=e.emitter(t,i);t.emitterFrom=a;i.emitterTo=a;a.lerp(r);return a}}else if(e.op){s=function(e,t){if(e===+e&&t===+t){return e+(t-e)*r}else{if(r>.5){return t}else{return e}}};n=e.op(t,i,n,s)}else{n=r>.5?i:t}return n};return e}();r=function(){function e(e,t,i,r){this.animator=e;this.time=t;this.type=i;this.options=r;this.value=this.type.make();this.target=this.type.make();this.queue=[]}e.prototype.dispose=function(){return this.animator.unmake(this)};e.prototype.set=function(){var e,t,i;t=this.target;i=arguments.length>1?[].slice.call(arguments):arguments[0];e=false;i=this.type.validate(i,t,function(){return e=true});if(!e){t=i}this.cancel();this.target=this.value;this.value=t;return this.notify()};e.prototype.getTime=function(){var e,t;e=this.options.clock;t=e?e.getTime():this.time;if(this.options.realtime){return t.time}else{return t.clock}};e.prototype.cancel=function(e){var t,i,r,n,a,o;if(e==null){e=this.getTime()}a=this.queue;i=function(){var t,i,r;r=[];for(t=0,i=a.length;t<i;t++){o=a[t];if(o.end>=e){r.push(o)}}return r}();this.queue=function(){var t,i,r;r=[];for(t=0,i=a.length;t<i;t++){o=a[t];if(o.end<e){r.push(o)}}return r}();for(r=0,n=i.length;r<n;r++){o=i[r];if(typeof o.complete==="function"){o.complete(false)}}if(typeof(t=this.options).complete==="function"){t.complete(false)}};e.prototype.notify=function(){var e;return typeof(e=this.options).step==="function"?e.step(this.value):void 0};e.prototype.immediate=function(e,t){var i,r,n,a,o,s,h,l,u,c;n=t.duration,r=t.delay,a=t.ease,l=t.step,i=t.complete;c=this.getTime();h=c+r;o=h+n;s=false;u=this.type.make();e=this.type.validate(e,u,function(){s=true;return null});if(e!==void 0){u=e}this.cancel(h);return this.queue.push({from:null,to:u,start:h,end:o,ease:a,step:l,complete:i})};e.prototype.update=function(e){var t,i,r,n,o,s,h,l,u,c,p,f,d,m,g,v,y;this.time=e;if(this.queue.length===0){return true}r=this.getTime();p=this,y=p.value,c=p.queue;t=false;while(!t){f=d=c[0],l=f.from,v=f.to,m=f.start,s=f.end,g=f.step,n=f.complete,o=f.ease;if(l==null){l=d.from=this.type.clone(this.value)}h=a.clamp((r-m)/Math.max(1e-5,s-m)||0,0,1);if(h===0){return}u=function(){switch(o){case"linear":case 0:return null;case"cosine":case 1:return a.cosine;case"binary":case 2:return a.binary;case"hold":case 3:return a.hold;default:return a.cosine}}();if(u!=null){h=u(h)}t=h<1;y=t?this.animator.lerp(this.type,l,v,h,y):v;if(typeof g==="function"){g(y)}if(!t){if(typeof n==="function"){n(true)}if(typeof(i=this.options).complete==="function"){i.complete(true)}c.shift();if(c.length===0){break}}}this.value=y;return this.notify()};return e}();t.exports=n},{"../util":166}],158:[function(e,t,i){var r,n;n=e("../util");r=function(){e.prototype.v2=function(){return this};function e(e,t,i){var r,n,a,o,s,h,l,u,c,p;this._context=e;this._up=t;this._targets=i;u=this._context.controller.getRoot();if(this._targets==null){this._targets=[u]}this.isRoot=this._targets.length===1&&this._targets[0]===u;this.isLeaf=this._targets.length===1&&this._targets[0].children==null;h=this._targets;for(r=n=0,o=h.length;n<o;r=++n){c=h[r];this[r]=c}this.length=this._targets.length;l=this._context.controller.getTypes();for(a=0,s=l.length;a<s;a++){p=l[a];if(p!=="root"){(function(e){return function(t){return e[t]=function(i,r){return e.add(t,i,r)}}})(this)(p)}}}e.prototype.select=function(e){var t;t=this._context.model.select(e,!this.isRoot?this._targets:null);return this._push(t)};e.prototype.eq=function(e){if(this._targets.length>e){return this._push([this._targets[e]])}return this._push([])};e.prototype.filter=function(e){var t;if(typeof e==="string"){t=this._context.model._matcher(e);e=function(e){return t(e)}}return this._push(this._targets.filter(e))};e.prototype.map=function(e){var t,i,r,n;n=[];for(t=i=0,r=this.length;0<=r?i<r:i>r;t=0<=r?++i:--i){n.push(e(this[t],t,this))}return n};e.prototype.each=function(e){var t,i,r;for(t=i=0,r=this.length;0<=r?i<r:i>r;t=0<=r?++i:--i){e(this[t],t,this)}return this};e.prototype.add=function(e,t,i){var r,n,a,o,s,h,l;r=this._context.controller;if(this.isLeaf){return this._pop().add(e,t,i)}s=[];h=this._targets;for(n=0,a=h.length;n<a;n++){l=h[n];o=r.make(e,t,i);r.add(o,l);s.push(o)}return this._push(s)};e.prototype.remove=function(e){var t,i,r,n;if(e){return this.select(e).remove()}r=this._targets.slice().reverse();for(t=0,i=r.length;t<i;t++){n=r[t];this._context.controller.remove(n)}return this._pop()};e.prototype.set=function(e,t){var i,r,n,a;n=this._targets;for(i=0,r=n.length;i<r;i++){a=n[i];this._context.controller.set(a,e,t)}return this};e.prototype.getAll=function(e){var t,i,r,n,a;r=this._targets;n=[];for(t=0,i=r.length;t<i;t++){a=r[t];n.push(this._context.controller.get(a,e))}return n};e.prototype.get=function(e){var t;return(t=this._targets[0])!=null?t.get(e):void 0};e.prototype.evaluate=function(e,t){var i;return(i=this._targets[0])!=null?i.evaluate(e,t):void 0};e.prototype.bind=function(e,t){var i,r,n,a;n=this._targets;for(i=0,r=n.length;i<r;i++){a=n[i];this._context.controller.bind(a,e,t)}return this};e.prototype.unbind=function(e){var t,i,r,n;r=this._targets;for(t=0,i=r.length;t<i;t++){n=r[t];this._context.controller.unbind(n,e)}return this};e.prototype.end=function(){return(this.isLeaf?this._pop():this)._pop()};e.prototype._push=function(t){return new e(this._context,this,t)};e.prototype._pop=function(){var e;return(e=this._up)!=null?e:this};e.prototype._reset=function(){var e,t;return(e=(t=this._up)!=null?t.reset():void 0)!=null?e:this};e.prototype.map=function(e){return this._targets.map(e)};e.prototype["on"]=function(){var e;e=arguments;this._targets.map(function(t){return t.on.apply(t,e)});return this};e.prototype["off"]=function(){var e;e=arguments;this._targets.map(function(t){return t.off.apply(t,e)});return this};e.prototype.toString=function(){var e;e=this._targets.map(function(e){return e.toString()});if(this._targets.length>1){return"["+e.join(", ")+"]"}else{return e[0]}};e.prototype.toMarkup=function(){var e;e=this._targets.map(function(e){return e.toMarkup()});return e.join("\n\n")};e.prototype.print=function(){n.Pretty.print(this._targets.map(function(e){return e.toMarkup()}).join("\n\n"));return this};e.prototype.debug=function(){var e,t,i,r,n,a,o,s;t=this.inspect();console.log("Renderables: ",t.renderables);console.log("Renders: ",t.renders);console.log("Shaders: ",t.shaders);e=function(e){return e.constructor.toString().match("function +([^(]*)")[1]};s=[];a=t.shaders;for(i=0,r=a.length;i<r;i++){o=a[i];n=e(o.owner);s.push(n+" - Vertex");s.push(o.vertex);s.push(n+" - Fragment");s.push(o.fragment)}return ShaderGraph.inspect(s)};e.prototype.inspect=function(e,t,i){var r,n,a,o,s,h,l,u,c,p,f,d,m;if(typeof t==="boolean"){i=t;t=null}if(i==null){i=true}u=function(e){var t,i;return(t=(i=e.controller)!=null?i.objects:void 0)!=null?t:[]};c=d=function(e,i){var r,n,a,o;if(i==null){i=[]}if(!t||e.traits.hash[t]){i.push(u(e))}if(e.children!=null){o=e.children;for(n=0,a=o.length;n<a;n++){r=o[n];d(r,i)}}return i};n=function(e){e=e.reduce(function(e,t){return e.concat(t)},[]);return e=e.filter(function(t,i){return t!=null&&e.indexOf(t)===i})};l=function(e,t){var i;i={};i.owner=e;i.geometry=t.geometry;i.material=t.material;i.vertex=t.material.vertexGraph;i.fragment=t.material.fragmentGraph;return i};a={nodes:this._targets.slice(),renderables:[],renders:[],shaders:[]};p=this._targets;for(o=0,h=p.length;o<h;o++){m=p[o];if(i){m.print(e,"info")}r={renderables:f=n(c(m)),renders:n(f.map(function(e){return e.renders})),shaders:n(f.map(function(e){var t;return(t=e.renders)!=null?t.map(function(t){return l(e,t)}):void 0}))};for(s in r){a[s]=a[s].concat(r[s])}}return a};return e}();t.exports=r},{"../util":166}],159:[function(e,t,i){var r,n;n=e("../util");r=function(){function e(e,t){this.model=e;this.primitives=t}e.prototype.getRoot=function(){return this.model.getRoot()};e.prototype.getTypes=function(){return this.primitives.getTypes()};e.prototype.make=function(e,t,i){return this.primitives.make(e,t,i)};e.prototype.get=function(e,t){return e.get(t)};e.prototype.set=function(e,t,i){var r;try{return e.set(t,i)}catch(t){r=t;e.print(null,"warn");return console.error(r)}};e.prototype.bind=function(e,t,i){var r;try{return e.bind(t,i)}catch(t){r=t;e.print(null,"warn");return console.error(r)}};e.prototype.unbind=function(e,t){var i;try{return e.unbind(t)}catch(t){i=t;e.print(null,"warn");return console.error(i)}};e.prototype.add=function(e,t){if(t==null){t=this.model.getRoot()}return t.add(e)};e.prototype.remove=function(e){var t;t=e.parent;if(t){return t.remove(e)}};return e}();t.exports=r},{"../util":166}],160:[function(e,t,i){i.Animator=e("./animator");i.API=e("./api");i.Controller=e("./controller")},{"./animator":157,"./api":158,"./controller":159}],161:[function(e,t,i){var r=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++){if(t in this&&this[t]===e)return t}return-1};i.setOrigin=function(e,t,i){var n,a,o,s;if(+t===t){t=[t]}a=r.call(t,1)>=0?0:i.x;o=r.call(t,2)>=0?0:i.y;s=r.call(t,3)>=0?0:i.z;n=r.call(t,4)>=0?0:i.w;return e.set(a,o,s,n)};i.addOrigin=function(){var e;e=new THREE.Vector4;return function(t,r,n){i.setOrigin(e,r,n);return t.add(e)}}();i.setDimension=function(e,t){var i,r,n,a;r=t===1?1:0;n=t===2?1:0;a=t===3?1:0;i=t===4?1:0;return e.set(r,n,a,i)};i.setDimensionNormal=function(e,t){var i,r,n,a;r=t===1?1:0;n=t===2?1:0;a=t===3?1:0;i=t===4?1:0;return e.set(n,a+r,i,0)};i.recenterAxis=function(){var e;e=[0,0];return function(t,i,r,n){var a,o,s,h,l,u;if(n==null){n=0}if(r>0){l=t;u=t+i;a=Math.max(Math.abs(l),Math.abs(u));o=a*n;h=Math.min(l,u);s=Math.max(l,u);t=h+(-a+o-h)*r;i=s+(a+o-s)*r-t}e[0]=t;e[1]=i;return e}}()},{}],162:[function(e,t,i){t.exports=self={bind:function(e,t){return function(i,r){if(!r.__binds){r.__binds=[]}var n=e;if(_.isArray(i)){n=i[0];i=i[1]}var a=/^([^.:]*(?:\.[^.:]+)*)?(?:\:(.*))?$/.exec(i);var o=a[1].split(/\./g);var s=o.pop();var h=a[2]||s;var l=o.shift();var u={this:r}[l]||t[l]||e[l]||n;while(u&&(i=o.shift())){u=u[i]}if(u&&(u.on||u.addEventListener)){var c=function(t){r[h]&&r[h](t,e)};self._polyfill(u,["addEventListener","on"],function(e){u[e](s,c)});var p={target:u,name:s,callback:c};r.__binds.push(p);return c}else{throw"Cannot bind '"+i+"' in "+this.__name}}},unbind:function(){return function(e){if(e.__binds){e.__binds.forEach(function(e){self._polyfill(e.target,["removeEventListener","off"],function(t){e.target[t](e.name,e.callback)})}.bind(this));e.__binds=[]}}},apply:function(e){THREE.EventDispatcher.prototype.apply(e);e.trigger=self._trigger;e.triggerOnce=self._triggerOnce;e.on=e.addEventListener;e.off=e.removeEventListener;e.dispatchEvent=e.trigger},_triggerOnce:function(e){this.trigger(e);if(this._listeners){delete this._listeners[e.type]}},_trigger:function(e){if(this._listeners===undefined)return;var t=e.type;var i=this._listeners[t];if(i!==undefined){i=i.slice();var r=i.length;e.target=this;for(var n=0;n<r;n++){i[n].call(this,e,this)}}},_polyfill:function(e,t,i){t.map(function(t){return e.method});if(t.length)i(t[0])}}},{}],163:[function(e,t,i){var r;i.getSizes=r=function(e){var t,i;i=[];t=e;while(typeof t!=="string"&&(t!=null?t.length:void 0)!=null){i.push(t.length);t=t[0]}return i};i.getDimensions=function(e,t){var i,n,a,o,s,h,l,u,c,p,f,d,m,g,v;if(t==null){t={}}s=t.items,i=t.channels,v=t.width,o=t.height,n=t.depth;a={};if(!e||!e.length){return{items:s,channels:i,width:v!=null?v:0,height:o!=null?o:0,depth:n!=null?n:0}}g=r(e);u=g.length;a.channels=i!==1&&g.length>1?g.pop():i;a.items=s!==1&&g.length>1?g.pop():s;a.width=v!==1&&g.length>1?g.pop():v;a.height=o!==1&&g.length>1?g.pop():o;a.depth=n!==1&&g.length>1?g.pop():n;h=u;if(i===1){h++}if(s===1&&h>1){h++}if(v===1&&h>2){h++}if(o===1&&h>3){h++}l=(c=g.pop())!=null?c:1;if(h<=1){l/=(p=a.channels)!=null?p:1}if(h<=2){l/=(f=a.items)!=null?f:1}if(h<=3){l/=(d=a.width)!=null?d:1}if(h<=4){l/=(m=a.height)!=null?m:1}l=Math.floor(l);if(a.width==null){a.width=l;l=1}if(a.height==null){a.height=l;l=1}if(a.depth==null){a.depth=l;l=1}return a};i.repeatCall=function(e,t){switch(t){case 0:return function(){return true};case 1:return function(){return e()};case 2:return function(){e();return e()};case 3:return function(){e();e();e();return e()};case 4:return function(){e();e();e();return e()};case 6:return function(){e();e();e();e();e();return e()};case 8:return function(){e();e();e();e();e();return e()}}};i.makeEmitter=function(e,t,i){var r,n,a,o;r=function(){switch(i){case 0:return function(){return true};case 1:return function(t){return t(e())};case 2:return function(t){return t(e(),e())};case 3:return function(t){return t(e(),e(),e())};case 4:return function(t){return t(e(),e(),e(),e())};case 6:return function(t){return t(e(),e(),e(),e(),e(),e())};case 8:return function(t){return t(e(),e(),e(),e(),e(),e(),e(),e())}}}();a=null;while(t>0){n=Math.min(t,8);o=function(){switch(n){case 1:return function(e){return r(e)};case 2:return function(e){r(e);return r(e)};case 3:return function(e){r(e);r(e);return r(e)};case 4:return function(e){r(e);r(e);r(e);return r(e)};case 5:return function(e){r(e);r(e);r(e);r(e);return r(e)};case 6:return function(e){r(e);r(e);r(e);r(e);r(e);return r(e)};case 7:return function(e){r(e);r(e);r(e);r(e);r(e);r(e);return r(e)};case 8:return function(e){r(e);r(e);r(e);r(e);r(e);r(e);r(e);return r(e)}}}();if(a!=null){a=function(e,t){return function(i){e(i);return t(i)}}(o,a)}else{a=o}t-=n}o=a!=null?a:function(){return true};o.reset=e.reset;o.rebind=e.rebind;return o};i.getThunk=function(e){var t,i,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M;k=r(e);d=k.length;t=k.pop();i=k.pop();n=k.pop();a=k.pop();o=false;switch(d){case 0:M=function(){return 0};M.reset=function(){};break;case 1:l=0;M=function(){return e[l++]};M.reset=function(){return l=0};break;case 2:l=u=0;s=(m=e[u])!=null?m:[];M=function(){var i,r;r=s[l++];if(l===t){l=0;u++;s=(i=e[u])!=null?i:[]}return r};M.reset=function(){var t;l=u=0;s=(t=e[u])!=null?t:[]};break;case 3:l=u=c=0;R=(g=e[c])!=null?g:[];s=(v=R[u])!=null?v:[];M=function(){var r,n,a;a=s[l++];if(l===t){l=0;u++;if(u===i){u=0;c++;R=(r=e[c])!=null?r:[]}s=(n=R[u])!=null?n:[]}return a};M.reset=function(){var t,i;l=u=c=0;R=(t=e[c])!=null?t:[];s=(i=R[u])!=null?i:[]};break;case 4:l=u=c=p=0;H=(y=e[p])!=null?y:[];R=(E=H[c])!=null?E:[];s=(w=R[u])!=null?w:[];M=function(){var r,a,o,h;h=s[l++];if(l===t){l=0;u++;if(u===i){u=0;c++;if(c===n){c=0;p++;H=(r=e[p])!=null?r:[]}R=(a=H[c])!=null?a:[]}s=(o=R[u])!=null?o:[]}return h};M.reset=function(){var t,i,r;l=u=c=p=0;H=(t=e[p])!=null?t:[];R=(i=H[c])!=null?i:[];s=(r=R[u])!=null?r:[]};break;case 5:l=u=c=p=f=0;h=(b=e[f])!=null?b:[];H=(_=h[p])!=null?_:[];R=(x=H[c])!=null?x:[];s=(T=R[u])!=null?T:[];M=function(){var r,o,d,m,g;g=s[l++];if(l===t){l=0;u++;if(u===i){u=0;c++;if(c===n){c=0;p++;if(p===a){p=0;f++;h=(r=e[f])!=null?r:[]}H=(o=h[p])!=null?o:[]}R=(d=H[c])!=null?d:[]}s=(m=R[u])!=null?m:[]}return g};M.reset=function(){var t,i,r,n;l=u=c=p=f=0;h=(t=e[f])!=null?t:[];H=(i=h[p])!=null?i:[];R=(r=H[c])!=null?r:[];s=(n=R[u])!=null?n:[]}}M.rebind=function(a){e=a;k=r(e);if(k.length){t=k.pop()}if(k.length){i=k.pop()}if(k.length){n=k.pop()}if(k.length){return a=k.pop()}};return M};i.getStreamer=function(e,t,i,r){var n,a,o,s,h,l,u,c,p;u=h=l=0;c=function(){u=t*i*r;return h=l=0};a=function(){return l};o=function(){return u-h<=0};p=function(){switch(i){case 1:return function(e){h+=e;l+=e};case 2:return function(e){h+=e*2;l+=e};case 3:return function(e){h+=e*3;l+=e};case 4:return function(e){h+=e*4;l+=e}}}();n=function(){switch(i){case 1:return function(t){t(e[h++]);++l};case 2:return function(t){t(e[h++],e[h++]);++l};case 3:return function(t){t(e[h++],e[h++],e[h++]);++l};case 4:return function(t){t(e[h++],e[h++],e[h++],e[h++]);++l}}}();s=function(){switch(i){case 1:return function(t){e[h++]=t;++l};case 2:return function(t,i){e[h++]=t;e[h++]=i;++l};case 3:return function(t,i,r){e[h++]=t;e[h++]=i;e[h++]=r;++l};case 4:return function(t,i,r,n){e[h++]=t;e[h++]=i;e[h++]=r;e[h++]=n;++l}}}();n.reset=c;s.reset=c;c();return{emit:s,consume:n,skip:p,count:a,done:o,reset:c}};i.getLerpEmitter=function(e,t){var i,r,n,a,o,s,h,l,u,c,p;p=new Float32Array(4096);o=s=.5;h=l=u=c=0;r=function(e,t,i,r){u++;p[h++]=e*o;p[h++]=t*o;p[h++]=i*o;return p[h++]=r*o};n=function(e,t,i,r){c++;p[l++]+=e*s;p[l++]+=t*s;p[l++]+=i*s;return p[l++]+=r*s};i=Math.max(e.length,t.length);if(i<=3){a=function(i,a,o){var s,f,d,m,g,v;h=l=u=c=0;e(r,a,o);t(n,a,o);d=Math.min(u,c);f=0;v=[];for(s=m=0,g=d;0<=g?m<g:m>g;s=0<=g?++m:--m){v.push(i(p[f++],p[f++],p[f++],p[f++]))}return v}}else if(i<=5){a=function(i,a,o,s,f){var d,m,g,v,y,E;h=l=u=c=0;e(r,a,o,s,f);t(n,a,o,s,f);g=Math.min(u,c);m=0;E=[];for(d=v=0,y=g;0<=y?v<y:v>y;d=0<=y?++v:--v){E.push(i(p[m++],p[m++],p[m++],p[m++]))}return E}}else if(i<=7){a=function(i,a,o,s,f,d,m){var g,v,y,E,w;h=l=u=c=0;e(r,a,o,s,f,d,m);t(n,a,o,s,f,d,m);v=Math.min(u,c);g=0;w=[];for(m=y=0,E=v;0<=E?y<E:y>E;m=0<=E?++y:--y){w.push(i(p[g++],p[g++],p[g++],p[g++]))}return w}}else if(i<=9){a=function(i,a,o,s,f,d,m,g,v){var y,E,w,b;h=l=u=c=0;e(r,a,o,s,f,d,m,g,v);t(n,a,o,s,f,d,m,g,v);y=Math.min(u,c);v=0;b=[];for(g=E=0,w=y;0<=w?E<w:E>w;g=0<=w?++E:--E){b.push(i(p[v++],p[v++],p[v++],p[v++]))}return b}}else{a=function(i,a,o,s,f,d,m,g,v,y,E){var w,b,_,x;h=l=0;e(r,a,o,s,f,d,m,g,v,y,E);t(n,a,o,s,f,d,m,g,v,y,E);w=Math.min(u,c);v=0;x=[];for(g=b=0,_=w;0<=_?b<_:b>_;g=0<=_?++b:--b){x.push(i(p[v++],p[v++],p[v++],p[v++]))}return x}}a.lerp=function(e){var t;return t=[1-e,e],o=t[0],s=t[1],t};return a};i.getLerpThunk=function(e,t){var r,n,a,o,s,h;n=i.getSizes(e).reduce(function(e,t){return e*t});a=i.getSizes(t).reduce(function(e,t){return e*t});r=Math.min(n,a);s=i.getThunk(e);h=i.getThunk(t);o=new Float32Array(r);o.lerp=function(e){var t,i,n,a;s.reset();h.reset();n=0;a=[];while(n<r){t=s();i=h();a.push(o[n++]=t+(i-t)*e)}return a};return o}},{}],164:[function(e,t,i){var r,n;n=Math.PI;r={clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},cosine:function(e){return.5-.5*Math.cos(r.clamp(e,0,1)*n)},binary:function(e){return+(e>=.5)},hold:function(e){return+(e>=1)}};t.exports=r},{}],165:[function(e,t,i){var r,n,a,o,s,h=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++){if(t in this&&this[t]===e)return t}return-1};n="xyzw".split("");r={0:-1,x:0,y:1,z:2,w:3};a=function(e){if(e===""+e){e=e.split("")}if(e===+e){e=[e]}return e};s=function(e){if(e===+e){e="vec"+e}if(e==="vec1"){e="float"}return e};o=function(e){e=""+e;if(e.indexOf(".")<0){return e+=".0"}};i.mapByte2FloatOffset=function(e){var t;if(e==null){e=4}t=o(e);return"vec4 float2ByteIndex(vec4 xyzw, out float channelIndex) {\n  float relative = xyzw.w / "+t+";\n  float w = floor(relative);\n  channelIndex = (relative - w) * "+t+";\n  return vec4(xyzw.xyz, w);\n}"};i.sample2DArray=function(e){var t,i;i=function(e,t){var r,n;if(e===t){n="return texture2D(dataTextures["+e+"], uv);"}else{r=Math.ceil(e+(t-e)/2);n="if (z < "+(r-.5)+") {\n  "+i(e,r-1)+"\n}\nelse {\n  "+i(r,t)+"\n}"}return n=n.replace(/\n/g,"\n  ")};t=i(0,e-1);return"uniform sampler2D dataTextures["+e+"];\n\nvec4 sample2DArray(vec2 uv, float z) {\n  "+t+"\n}"};i.binaryOperator=function(e,t,i){e=s(e);if(i!=null){return e+" binaryOperator("+e+" a) {\n  return a "+t+" "+i+";\n}"}else{return e+" binaryOperator("+e+" a, "+e+" b) {\n  return a "+t+" b;\n}"}};i.extendVec=function(e,t,r){var n,a,h,l,u;if(r==null){r=0}if(e>t){return i.truncateVec(e,t)}a=t-e;e=s(e);t=s(t);r=o(r);l=function(){u=[];for(var e=0;0<=a?e<=a:e>=a;0<=a?e++:e--){u.push(e)}return u}.apply(this).map(function(e){if(e){return r}else{return"v"}});n=l.join(",");return t+" extendVec("+e+" v) { return "+t+"("+n+"); }"};i.truncateVec=function(e,t){var r;if(e<t){return i.extendVec(e,t)}r="."+"xyzw".substr(0,t);e=s(e);t=s(t);return t+" truncateVec("+e+" v) { return v"+r+"; }"};i.injectVec4=function(e){var t,i,n,o,s,h,l;l=["0.0","0.0","0.0","0.0"];e=a(e);e=e.map(function(e){if(e===""+e){return r[e]}else{return e}});for(n=o=0,s=e.length;o<s;n=++o){i=e[n];l[i]=["a","b","c","d"][n]}h=l.slice(0,4).join(", ");t=["float a","float b","float c","float d"].slice(0,e.length);return"vec4 inject("+t+") {\n  return vec4("+h+");\n}"};i.swizzleVec4=function(e,t){var i,n;if(t==null){t=null}i=["0.0","xyzw.x","xyzw.y","xyzw.z","xyzw.w"];if(t==null){t=e.length}e=a(e);e=e.map(function(e){var t;if(t=+e,h.call([0,1,2,3,4],t)>=0){e=+e}if(e===""+e){e=r[e]+1}return i[e]});while(e.length<t){e.push("0.0")}n=e.join(", ");return("vec"+t+" swizzle(vec4 xyzw) {\n  return vec"+t+"("+n+");\n}").replace(/vec1/g,"float")};i.invertSwizzleVec4=function(e){var t,i,o,s,h,l,u,c;c=["0.0","0.0","0.0","0.0"];e=a(e);e=e.map(function(e){if(e===+e){return n[e-1]}else{return e}});for(t=o=0,s=e.length;o<s;t=++o){h=e[t];u=n[t];i=r[h];c[i]="xyzw."+u}l=c.join(", ");return"vec4 invertSwizzle(vec4 xyzw) {\n  return vec4("+l+");\n}"};i.identity=function(e){var t;t=[].slice.call(arguments);if(t.length>1){t=t.map(function(e,t){return["inout",e,String.fromCharCode(97+t)].join(" ")});t=t.join(", ");return"void identity("+t+") { }"}else{return e+" identity("+e+" x) {\n  return x;\n}"}};i.constant=function(e,t){return e+" constant() {\n  return "+t+";\n}"};i.toType=s},{}],166:[function(e,t,i){i.Axis=e("./axis");i.Data=e("./data");i.Ease=e("./ease");i.GLSL=e("./glsl");i.JS=e("./js");i.Pretty=e("./pretty");i.Three=e("./three");i.Ticks=e("./ticks");i.VDOM=e("./vdom")},{"./axis":161,"./data":163,"./ease":164,"./glsl":165,"./js":167,"./pretty":168,"./three":169,"./ticks":170,"./vdom":171}],167:[function(e,t,i){i.merge=function(){var e,t,i,r,n,a;a={};for(e=0,i=arguments.length;e<i;e++){r=arguments[e];for(t in r){n=r[t];a[t]=n}}return a};i.clone=function(e){return JSON.parse(JSON.serialize(e))};i.parseQuoted=function(e){var t,i,r,n,a,o,s,h,l,u;t="";u=function(e){return e=e.replace(/\\/g,"")};s=function(e){if(t.length){o.push(u(t))}return t=e!=null?e:""};e=e.split(/(?=(?:\\.|["' ,]))/g);h=false;o=[];for(n=0,a=e.length;n<a;n++){r=e[n];i=r[0];l=r.slice(1);switch(i){case'"':case"'":if(h){if(h===i){h=false;s(l)}else{t+=r}}else{if(t!==""){throw new Error("ParseError: String `"+e+"` does not contain comma-separated quoted tokens.")}h=i;t+=l}break;case" ":case",":if(!h){s(l)}else{t+=r}break;default:t+=r}}s();return o}},{}],168:[function(e,t,i){var r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y;r=5;n=1e-4;a=function(e,t){return Math.abs(e/t-Math.round(e/t))<n};o=function(e){return a(e,1)};u=function(e,t,i,r){var n;n=Math.round(e/t);if(n===1){return""+i}if(n===-1){return"-"+i}if(i==="1"){return""+n}if(r){return""+n+i}else{return n+"*"+i}};l=function(e,t,i,r){var n;n=Math.round(e*t);if(Math.abs(n)===1){n=n<0?"-":"";n+=i}else if(i!=="1"){n+=r?""+i:"*"+i}return n+"/"+t};h=[{1:1},{1:1,"":Math.PI*2},{1:1,"":Math.PI},{1:1,"":Math.PI*2,"":Math.PI},{1:1,e:Math.E},{1:1,"":Math.PI*2,e:Math.E},{1:1,"":Math.PI,e:Math.E},{1:1,"":Math.PI*2,"":Math.PI,e:Math.E}];c=[[2*2*3*5*7,[2,3,5,7]],[2*2*2*3*3*5*5*7*7,[2,3,5,7]],[2*2*3*5*7*11*13,[2,3,5,7,11,13]],[2*2*17*19*23*29,[2,17,19,23,29]],[256*256,[2]],[1e6,[2,5]]];v=function(e){var t,i,a,s,p,f,d,m,g,v;if(e){t=e.cache,a=e.compact,g=e.tau,d=e.pi,s=e.e,v=e.threshold,m=e.precision}a=+!!(a!=null?a:true);g=+!!(g!=null?g:true);d=+!!(d!=null?d:true);s=+!!(s!=null?s:true);t=+!!(t!=null?t:true);v=+(v!=null?v:n);m=+(m!=null?m:r);p=g+d*2+s*4;i=p+v+m;f=t?{}:null;return function(e){var t,i,n,s,d,m,g,v,y,E,w,b,_,x,T,R,k,H;if(f!=null){if((i=f[e])!=null){return i}if(e===Math.round(e)){return f[e]=""+e}}T=""+e;t=T.length+T.indexOf(".")+2;b=function(e){var i;i=e.length;if(i<=t){T=""+e;return t=i}};k=h[p];for(v in k){d=k[v];if(o(e/d)){b(""+u(e/d,1,v,a))}else{for(m=0,y=c.length;m<y;m++){H=c[m],s=H[0],w=H[1];x=e/d*s;if(o(x)){for(g=0,E=w.length;g<E;g++){R=w[g];while(o(_=x/R)&&o(n=s/R)){x=_;s=n}}b(""+l(e/d,s,v,a));break}}}}if((""+e).length>r){b(""+e.toPrecision(r))}if(f!=null){f[e]=T}return T}};y=function(e,t){if(t==null){t="info"}e=g(e);return console[t].apply(console,e)};g=function(e){var t,i,r,n,a,o,s,h;s="color:rgb(128,0,128)";i="color:rgb(144,64,0)";o="color:rgb(0,0,192)";n="color:rgb(0,70,156)";h="color:inherit";a=false;r=0;t=[];e=e.replace(/(\\[<={}> "'])|(=>|[<={}> "'])/g,function(e,l,u){var c;if(l!=null?l.length:void 0){return l}if(a&&(u!=='"'&&u!=="'")){return u}if(r&&(u!=='"'&&u!=="'"&&u!=="{"&&u!=="}")){return u}return c=function(){switch(u){case"<":t.push(s);return"%c<";case">":t.push(s);t.push(h);return"%c>%c";case" ":t.push(i);return" %c";case"=":case"=>":t.push(s);return"%c"+u;case'"':case"'":a=!a;if(a){t.push(r?i:o);return u+"%c"}else{t.push(r?n:s);return"%c"+u}break;case"{":if(r++===0){t.push(n);return"%c"+u}else{return u}break;case"}":if(--r===0){t.push(s);return u+"%c"}else{return u}break;default:return u}}()});return[e].concat(t)};m=function(e,t){return d(e,t,"=")};f=function(e,t){return d(e,t,"=>")};d=function(){var e;e=v({compact:false});return function(t,i,r){var n,a,o;n=function(e){if(e===""+ +e||e.match(/^[A-Za-z_][A-Za-z0-9]*$/)){return e}else{return JSON.stringify(e)}};o=function(e){if(e.match('\n*"')){return e}else{return"{"+e+"}"}};a=function(t){var i,r;if(t instanceof Array){return"["+t.map(a).join(", ")+"]"}switch(typeof t){case"string":if(t.match("\n")){return'"\n'+t+'"\n'}else{return'"'+t+'"'}break;case"function":t=""+t;if(t.match("\n")){"\n"+t+"\n"}else{""+t}t=t.replace(/^function (\([^)]+\))/,"$1 =>");return t=t.replace(/^(\([^)]+\)) =>\s*{\s*return\s*([^}]+)\s*;\s*}/,"$1 => $2");case"number":return e(t);default:if(t!=null&&t!==!!t){if(t._up!=null){return a(t.map(function(e){return e}))}if(t.toMarkup){return t.toString()}else{return"{"+function(){var e;e=[];for(i in t){r=t[i];if(t.hasOwnProperty(i)){e.push(n(i)+": "+a(r))}}return e}().join(", ")+"}"}}else{return""+JSON.stringify(t)}}};return[t,r,o(a(i))].join("")}}();s=function(e){e=e.replace(/&/g,"&amp;");e=e.replace(/</g,"&lt;");return e=e.replace(/"/g,"&quot;")};p=function(e){var t,i,r,n,a;i=[].slice.call(arguments);i.shift();a="<span>";e=s(e);for(r=0,n=i.length;r<n;r++){t=i[r];e=e.replace(/%([a-z])/,function(e,t){var r;r=i.shift();switch(t){case"c":return'</span><span style="'+s(r)+'">';default:return s(r)}})}a+=e;return a+="</span>"};t.exports={markup:g,number:v,print:y,format:p,JSX:{prop:m,bind:f}}},{}],169:[function(e,t,i){i.paramToGL=function(e,t){if(t===THREE.RepeatWrapping){return e.REPEAT}if(t===THREE.ClampToEdgeWrapping){return e.CLAMP_TO_EDGE}if(t===THREE.MirroredRepeatWrapping){return e.MIRRORED_REPEAT}if(t===THREE.NearestFilter){return e.NEAREST}if(t===THREE.NearestMipMapNearestFilter){return e.NEAREST_MIPMAP_NEAREST}if(t===THREE.NearestMipMapLinearFilter){return e.NEAREST_MIPMAP_LINEAR}if(t===THREE.LinearFilter){return e.LINEAR}if(t===THREE.LinearMipMapNearestFilter){return e.LINEAR_MIPMAP_NEAREST}if(t===THREE.LinearMipMapLinearFilter){return e.LINEAR_MIPMAP_LINEAR}if(t===THREE.UnsignedByteType){return e.UNSIGNED_BYTE}if(t===THREE.UnsignedShort4444Type){return e.UNSIGNED_SHORT_4_4_4_4}if(t===THREE.UnsignedShort5551Type){return e.UNSIGNED_SHORT_5_5_5_1}if(t===THREE.UnsignedShort565Type){return e.UNSIGNED_SHORT_5_6_5}if(t===THREE.ByteType){return e.BYTE}if(t===THREE.ShortType){return e.SHORT}if(t===THREE.UnsignedShortType){return e.UNSIGNED_SHORT}if(t===THREE.IntType){return e.INT}if(t===THREE.UnsignedIntType){return e.UNSIGNED_INT}if(t===THREE.FloatType){return e.FLOAT}if(t===THREE.AlphaFormat){return e.ALPHA}if(t===THREE.RGBFormat){return e.RGB}if(t===THREE.RGBAFormat){return e.RGBA}if(t===THREE.LuminanceFormat){return e.LUMINANCE}if(t===THREE.LuminanceAlphaFormat){return e.LUMINANCE_ALPHA}if(t===THREE.AddEquation){return e.FUNC_ADD}if(t===THREE.SubtractEquation){return e.FUNC_SUBTRACT}if(t===THREE.ReverseSubtractEquation){return e.FUNC_REVERSE_SUBTRACT}if(t===THREE.ZeroFactor){return e.ZERO}if(t===THREE.OneFactor){return e.ONE}if(t===THREE.SrcColorFactor){return e.SRC_COLOR}if(t===THREE.OneMinusSrcColorFactor){return e.ONE_MINUS_SRC_COLOR}if(t===THREE.SrcAlphaFactor){return e.SRC_ALPHA}if(t===THREE.OneMinusSrcAlphaFactor){return e.ONE_MINUS_SRC_ALPHA}if(t===THREE.DstAlphaFactor){return e.DST_ALPHA}if(t===THREE.OneMinusDstAlphaFactor){return e.ONE_MINUS_DST_ALPHA}if(t===THREE.DstColorFactor){return e.DST_COLOR}if(t===THREE.OneMinusDstColorFactor){return e.ONE_MINUS_DST_COLOR}if(t===THREE.SrcAlphaSaturateFactor){return e.SRC_ALPHA_SATURATE}return 0};i.paramToArrayStorage=function(e){switch(e){case THREE.UnsignedByteType:return Uint8Array;case THREE.ByteType:return Int8Array;case THREE.ShortType:return Int16Array;case THREE.UnsignedShortType:return Uint16Array;case THREE.IntType:return Int32Array;case THREE.UnsignedIntType:return Uint32Array;case THREE.FloatType:return Float32Array}};i.swizzleToEulerOrder=function(e){return e.map(function(e){return["","X","Y","Z"][e]}).join("")};i.transformComposer=function(){var e,t,r,n,a;e=new THREE.Euler;r=new THREE.Quaternion;t=new THREE.Vector3;n=new THREE.Vector3;a=new THREE.Matrix4;return function(o,s,h,l,u,c){if(c==null){c="XYZ"}if(s!=null){if(c instanceof Array){c=i.swizzleToEulerOrder(c)}e.setFromVector3(s,c);r.setFromEuler(e)}else{r.set(0,0,0,1)}if(h!=null){r.multiply(h)}if(o!=null){t.copy(o)}else{t.set(0,0,0)}if(l!=null){n.copy(l)}else{n.set(1,1,1)}a.compose(t,r,n);if(u!=null){a.multiplyMatrices(a,u)}return a}}},{}],170:[function(e,t,i){var r,n,a,o,s;a=function(e,t,i,r,n,a,o,s,h,l){var u,c,p,f,d,m,g,v,y,E;if(l==null){l=true}i||(i=10);r||(r=1);n||(n=10);a||(a=1);g=t-e;d=g/i;if(!l){E=function(){var t,r,n;n=[];for(f=t=0,r=i;0<=r?t<=r:t>=r;f=0<=r?++t:--t){n.push(e+f*d)}return n}();if(!o){E.shift()}if(!s){E.pop()}if(!h){E=E.filter(function(e){return e!==0})}return E}r||(r=1);n||(n=10);m=r*Math.pow(n,Math.floor(Math.log(d/r)/Math.log(n)));p=n%2===0?[n/2,1,1/2]:n%3===0?[n/3,1,1/3]:[1];y=function(){var e,t,i;i=[];for(e=0,t=p.length;e<t;e++){c=p[e];i.push(m*c)}return i}();u=Infinity;v=y.reduce(function(e,t){var i;c=t/d;i=Math.max(c,1/c);if(i<u){u=i;return t}else{return e}},m);v*=a;e=Math.ceil(e/v+ +!o)*v;t=(Math.floor(t/v)-+!s)*v;i=Math.ceil((t-e)/v);E=function(){var t,r,n;n=[];for(f=t=0,r=i;0<=r?t<=r:t>=r;f=0<=r?++t:--t){n.push(e+f*v)}return n}();if(!h){E=E.filter(function(e){return e!==0})}return E};o=function(e,t,i,r,n,a,o,s,h,l){throw new Error("Log ticks not yet implemented.")};r=0;n=1;s=function(e,t,i,s,h,l,u,c,p,f,d){switch(e){case r:return a(t,i,s,h,l,u,c,p,f,d);case n:return o(t,i,s,h,l,u,c,p,f,d)}};i.make=s;i.linear=a;i.log=o},{}],171:[function(e,t,i){var r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b;r=[];u=0;n={};s=function(){return{id:u++,type:null,props:null,children:null,rendered:null,instance:null}};l=function(e){var t,i,n,a;e*=2;e=Math.max(0,r.length-e);a=[];for(t=i=0,n=e;0<=n?i<n:i>n;t=0<=n?++i:--i){a.push(r.push(s()))}return a};h=function(e,t,i){var n;n=r.length?r.pop():s();n.type=e!=null?e:"div";n.props=t!=null?t:null;n.children=i!=null?i:null;return n};v=function(e){var t,i,n,a;if(!e.type){return}i=e.children;e.type=e.props=e.children=e.instance=null;r.push(e);if(i!=null){for(n=0,a=i.length;n<a;n++){t=i[n];v(t)}}};a=function(e,t,i,r,o){var s,l,u,c,p,f,d,g,v,y,_,x,T,R,k,H,M,S,A,C,z,P,L,O,D,F,B,U,N,V;if(e!=null){if(t==null){return m(e,r,o)}else{if(e instanceof Node){F=e===t;if(F){return}}else{F=typeof e===typeof t&&t!==null&&e!==null&&e.type===t.type}if(!F){w(t.instance,i);i.remove();return m(e,r,o)}else{e.instance=t.instance;U=((z=e.type)!=null?z.isComponentClass:void 0)?e.type:n[e.type];A=t!=null?t.props:void 0;k=e.props;c=(P=t!=null?t.children:void 0)!=null?P:null;R=e.children;if(k!=null){k.children=R}if(U!=null){f=i._COMPONENT_DIRTY;if(A!=null!==(k!=null)){f=true}if(c!==R){f=true}if(A!=null&&k!=null){if(!f){for(y in A){if(!k.hasOwnProperty(y)){f=true}}}if(!f){for(y in k){V=k[y];if((C=A[y])!==V){f=true}}}}if(f){p=t.instance;if(e.props==null){e.props={}}L=p.defaultProps;for(v in L){N=L[v];if((s=e.props)[v]==null){s[v]=N}}e.props.children=e.children;if(typeof p.willReceiveProps==="function"){p.willReceiveProps(e.props)}B=i._COMPONENT_FORCE||((O=typeof p.shouldUpdate==="function"?p.shouldUpdate(e.props):void 0)!=null?O:true);if(B){H=p.getNextState();if(typeof p.willUpdate==="function"){p.willUpdate(e.props,H)}}M=p.props;S=p.applyNextState();p.props=e.props;p.children=e.children;if(B){e=e.rendered=typeof p.render==="function"?p.render(h,e.props,e.children):void 0;a(e,t.rendered,i,r,o);if(typeof p.didUpdate==="function"){p.didUpdate(M,S)}}}else{e.rendered=t.rendered}return}else{if(A!=null){for(y in A){if(!k.hasOwnProperty(y)){b(i,y,A[y])}}}if(k!=null){for(y in k){V=k[y];if((C=A[y])!==V&&y!=="children"){E(i,y,V,C)}}}if(R!=null){if((D=typeof R)==="string"||D==="number"){if(R!==c){i.textContent=R}}else{if(R.type!=null){a(R,c,i.childNodes[0],i,0)}else{u=i.childNodes;if(c!=null){for(d=g=0,x=R.length;g<x;d=++g){l=R[d];a(l,c[d],u[d],i,d)}}else{for(d=_=0,T=R.length;_<T;d=++_){l=R[d];a(l,null,u[d],i,d)}}}}}else if(c!=null){w(null,i);i.innerHTML=""}}return}}}if(t!=null){w(t.instance,i);return t.node.remove()}};m=function(e,t,i){var r,a,o,s,l,u,c,p,f,d,g,v,y,w,b,_,x,T,R,k;if(i==null){i=0}T=((v=e.type)!=null?v.isComponentClass:void 0)?e.type:n[e.type];if(e instanceof Node){g=e}else{if(T!=null){l=((y=e.type)!=null?y.isComponentClass:void 0)?e.type:n[e.type];if(!l){e=e.rendered=h("noscript");g=m(e,t,i);return g}e.instance=s=new l(t);if(e.props==null){e.props={}}w=s.defaultProps;for(p in w){R=w[p];if((r=e.props)[p]==null){r[p]=R}}e.props.children=e.children;s.props=e.props;s.children=e.children;s.setState(typeof s.getInitialState==="function"?s.getInitialState():void 0);if(typeof s.willMount==="function"){s.willMount()}e=e.rendered=typeof s.render==="function"?s.render(h,e.props,e.children):void 0;g=m(e,t,i);if(typeof s.didMount==="function"){s.didMount(e)}g._COMPONENT=s;return g}else if((b=typeof e)==="string"||b==="number"){g=document.createTextNode(e)}else{g=document.createElement(e.type);_=e.props;for(f in _){k=_[f];E(g,f,k)}}o=e.children;if(o!=null){if((x=typeof o)==="string"||x==="number"){g.textContent=o}else{if(o.type!=null){m(o,g,0)}else{for(u=c=0,d=o.length;c<d;u=++c){a=o[u];m(a,g,u)}}}}}t.insertBefore(g,t.childNodes[i]);return g};w=function(e,t){var i,r,n,a,o,s;if(e){if(typeof e.willUnmount==="function"){e.willUnmount()}for(n in e){delete e[n]}}o=t.childNodes;s=[];for(r=0,a=o.length;r<a;r++){i=o[r];w(i._COMPONENT,i);s.push(delete i._COMPONENT)}return s};g=function(e){var t,i,r,n;if(typeof document==="undefined"){return true}if(document.documentElement.style[e]!=null){return e}e=e[0].toUpperCase()+e.slice(1);n=["webkit","moz","ms","o"];for(t=0,i=n.length;t<i;t++){r=n[t];if(document.documentElement.style[r+e]!=null){return r+e}}};d={};y=["transform"];for(c=0,f=y.length;c<f;c++){p=y[c];d[p]=g(p)}E=function(e,t,i,r){var n,a,o;if(t==="style"){for(n in i){o=i[n];if((r!=null?r[n]:void 0)!==o){e.style[(a=d[n])!=null?a:n]=o}}return}if(e[t]!=null){e[t]=i;return}if(e instanceof Node){e.setAttribute(t,i)}};b=function(e,t,i){var r,n,a;if(t==="style"){for(r in i){a=i[r];e.style[(n=d[r])!=null?n:r]=""}return}if(e[t]!=null){e[t]=void 0}if(e instanceof Node){e.removeAttribute(t)}};o=function(e){var t,i,r,n,a;r={willMount:"componentWillMount",didMount:"componentDidMount",willReceiveProps:"componentWillReceiveProps",shouldUpdate:"shouldComponentUpdate",willUpdate:"componentWillUpdate",didUpdate:"componentDidUpdate",willUnmount:"componentWillUnmount"};for(i in r){n=r[i];if(e[i]==null){e[i]=e[n]}}t=function(){function t(t,i,r,n){var a,o,s,h;this.props=i!=null?i:{};this.state=r!=null?r:null;this.children=n!=null?n:null;a=function(e,t){if(typeof e==="function"){return e.bind(t)}else{return e}};for(o in e){h=e[o];this[o]=a(h,this)}s=null;this.setState=function(e){if(s==null){s=e?s!=null?s:{}:null}for(o in e){h=e[o];s[o]=h}t._COMPONENT_DIRTY=true};this.forceUpdate=function(){var e,i;t._COMPONENT_FORCE=t._COMPONENT_DIRTY=true;e=t;i=[];while(e=e.parentNode){if(e._COMPONENT){i.push(e._COMPONENT_FORCE=true)}else{i.push(void 0)}}return i};this.getNextState=function(){return s};this.applyNextState=function(){var e,i;t._COMPONENT_FORCE=t._COMPONENT_DIRTY=false;e=this.state;i=[null,s],s=i[0],this.state=i[1];return e};return}return t}();t.isComponentClass=true;t.prototype.defaultProps=(a=typeof e.getDefaultProps==="function"?e.getDefaultProps():void 0)!=null?a:{};return t};t.exports={element:h,recycle:v,apply:a,hint:l,Types:n,createClass:o}},{}],172:[function(e,t,i){var r,n,a,o,s,h;n=e("../graph");s=e("../linker").Program;a=e("../linker").Layout;h=false;r=function(){e.previous=function(e){var t;return(t=e.input)!=null?t.node.owner:void 0};function e(){var e;if(this.namespace==null){this.namespace=s.entry()}this.node=new n.Node(this,(e=typeof this.makeOutlets==="function"?this.makeOutlets():void 0)!=null?e:{})}e.prototype.refresh=function(){var e;return this.node.setOutlets((e=typeof this.makeOutlets==="function"?this.makeOutlets():void 0)!=null?e:{})};e.prototype.clone=function(){return new e};e.prototype.compile=function(e,t){var i;i=new s(e,t!=null?t:s.entry(),this.node.graph);this.call(i,0);return i.assemble()};e.prototype.link=function(e,t){var i,r;r=this.compile(e,t);i=new a(e,this.node.graph);this._include(r,i,0);this["export"](i,0);return i.link(r)};e.prototype.call=function(e,t){};e.prototype.callback=function(e,t,i,r,n){};e.prototype["export"]=function(e,t){};e.prototype._info=function(e){var t,i,r;r=(t=(i=this.node.owner.snippet)!=null?i._name:void 0)!=null?t:this.node.owner.namespace;if(e!=null){return r+="."+e}};e.prototype._outlet=function(e,t){var i;i=n.Outlet.make(e,t);i.meta.def=e;return i};e.prototype._call=function(e,t,i){return t.call(this.node,e,i)};e.prototype._require=function(e,t){return t.require(this.node,e)};e.prototype._inputs=function(t,i,r){var n,a,o,s,h,l,u;h=t.main.signature;u=[];for(a=0,o=h.length;a<o;a++){n=h[a];s=this.node.get(n.name);u.push((l=e.previous(s))!=null?l.call(i,r+1):void 0)}return u};e.prototype._callback=function(e,t,i,r,n,a){return t.callback(this.node,e,i,r,n,a)};e.prototype._include=function(e,t,i){return t.include(this.node,e,i)};e.prototype._link=function(t,i,r){var n,a,s,l,u,c,p,f,d,m,g,v;h&&console.log("block::_link",this.toString(),t.namespace);d=t.symbols;v=[];for(s=0,u=d.length;s<u;s++){l=d[s];a=t.externals[l];p=this.node.get(a.name);if(!p){throw new o("External not found on "+this._info(a.name))}if(p.meta.child!=null){continue}m=[p,p,null],c=m[0],f=m[1],n=m[2];while(!n&&f){g=[p.meta.parent,f],f=g[0],p=g[1]}n=e.previous(p);if(!n){throw new o("Missing connection on "+this._info(a.name))}h&&console.log("callback -> ",this.toString(),a.name,p);n.callback(i,r+1,l,a,p.input);v.push(n!=null?n["export"](i,r+1):void 0)}return v};e.prototype._trace=function(t,i,r){var n,a,o,s,l,u,c;h&&console.log("block::_trace",this.toString(),t.namespace);l=t.main.signature;c=[];for(a=0,o=l.length;a<o;a++){n=l[a];s=this.node.get(n.name);c.push((u=e.previous(s))!=null?u["export"](i,r+1):void 0)}return c};return e}();o=function(e){var t;t=new Error(e);t.name="OutletError";return t};o.prototype=new Error;t.exports=r},{"../graph":192,"../linker":197}],173:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;r=e("./block");n=function(e){a(t,e);function t(e){this.snippet=e;this.namespace=this.snippet.namespace;t.__super__.constructor.apply(this,arguments)}t.prototype.clone=function(){return new t(this.snippet)};t.prototype.makeOutlets=function(){var e,t,i,r,n,a,o;r=this.snippet.main.signature;t=this.snippet.externals;o=this.snippet.symbols;a=function(){var e,t,i;i=[];for(e=0,t=r.length;e<t;e++){n=r[e];i.push(this._outlet(n,{callback:false}))}return i}.call(this);e=function(){var e,r,n;n=[];for(e=0,r=o.length;e<r;e++){i=o[e];n.push(this._outlet(t[i],{callback:true}))}return n}.call(this);return a.concat(e)};t.prototype.call=function(e,t){this._call(this.snippet,e,t);return this._inputs(this.snippet,e,t)};t.prototype["export"]=function(e,t){if(!e.visit(this.namespace,t)){return}this._link(this.snippet,e,t);return this._trace(this.snippet,e,t)};return t}(r);t.exports=n},{"./block":172}],174:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;a=e("../graph");r=e("./block");n=function(e){o(t,e);function t(e){this.graph=e;t.__super__.constructor.apply(this,arguments)}t.prototype.refresh=function(){t.__super__.refresh.apply(this,arguments);return delete this.subroutine};t.prototype.clone=function(){return new t(this.graph)};t.prototype.makeOutlets=function(){var e,t,i,r,n,o,s,h,l,u,c,p;this.make();h=[];i=[];l=[];e=function(e){return function(e,t){var i,r;if(e.meta.callback){if(e.inout===a.IN){r=e.dupe();if((i=r.meta).child==null){i.child=e}e.meta.parent=r;return h.push(r)}}else{return t.push(e.type)}}}(this);u=this.graph.inputs();for(t=0,n=u.length;t<n;t++){s=u[t];e(s,i)}c=this.graph.outputs();for(r=0,o=c.length;r<o;r++){s=c[r];e(s,l)}i=i.join(",");l=l.join(",");p="("+i+")("+l+")";h.push({name:"callback",type:p,inout:a.OUT,meta:{callback:true,def:this.subroutine.main}});return h};t.prototype.make=function(){return this.subroutine=this.graph.compile(this.namespace)};t.prototype["export"]=function(e,t){if(!e.visit(this.namespace,t)){return}this._link(this.subroutine,e,t);return this.graph["export"](e,t)};t.prototype.call=function(e,t){return this._require(this.subroutine,e,t)};t.prototype.callback=function(e,t,i,r,n){this._include(this.subroutine,e,t);return this._callback(this.subroutine,e,t,i,r,n)};return t}(r);t.exports=n},{"../graph":192,"./block":172}],175:[function(e,t,i){i.Block=e("./block");i.Call=e("./call");i.Callback=e("./callback");i.Isolate=e("./isolate");i.Join=e("./join")},{"./block":172,"./call":173,"./callback":174,"./isolate":176,"./join":177}],176:[function(e,t,i){var r,n,a,o=function(e,t){for(var i in t){if(s.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},s={}.hasOwnProperty;n=e("../graph");r=e("./block");a=function(e){o(t,e);function t(e){this.graph=e;t.__super__.constructor.apply(this,arguments)}t.prototype.refresh=function(){t.__super__.refresh.apply(this,arguments);return delete this.subroutine};t.prototype.clone=function(){return new t(this.graph)};t.prototype.makeOutlets=function(){var e,t,i,r,a,o,s,h,l,u,c,p,f,d,m;this.make();u=[];d={};t={};c=["inputs","outputs"];for(r=0,o=c.length;r<o;r++){m=c[r];p=this.graph[m]();for(a=0,s=p.length;a<s;a++){l=p[a];h=void 0;if(((f=l.hint)==="return"||f==="callback")&&l.inout===n.OUT){h=l.hint}if(d[h]!=null){h=void 0}i=l.dupe(h);if((e=i.meta).child==null){e.child=l}l.meta.parent=i;if(h!=null){d[h]=true}t[l.name]=i;u.push(i)}}return u};t.prototype.make=function(){return this.subroutine=this.graph.compile(this.namespace)};t.prototype.call=function(e,t){this._call(this.subroutine,e,t);return this._inputs(this.subroutine,e,t)};t.prototype["export"]=function(e,t){if(!e.visit(this.namespace,t)){return}this._link(this.subroutine,e,t);this._trace(this.subroutine,e,t);return this.graph["export"](e,t)};t.prototype.callback=function(e,t,i,r,n){n=n.meta.child;return n.node.owner.callback(e,t,i,r,n)};return t}(r);t.exports=a},{"../graph":192,"./block":172}],177:[function(e,t,i){var r,n,a=function(e,t){for(var i in t){if(o.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},o={}.hasOwnProperty;r=e("./block");n=function(e){a(t,e);function t(e){this.nodes=e;t.__super__.constructor.apply(this,arguments)}t.prototype.clone=function(){return new t(this.nodes)};t.prototype.makeOutlets=function(){return[]};t.prototype.call=function(e,t){var i,r,n,a,o,s;o=this.nodes;s=[];for(r=0,n=o.length;r<n;r++){a=o[r];i=a.owner;s.push(i.call(e,t))}return s};t.prototype["export"]=function(e,t){var i,r,n,a,o,s;o=this.nodes;s=[];for(r=0,n=o.length;r<n;r++){a=o[r];i=a.owner;s.push(i["export"](e,t))}return s};return t}(r);t.exports=n},{"./block":172}],178:[function(e,t,i){var r,n,a;a=e("./queue");n=e("./hash");r=function(e){var t,i;t={};i=a(100);return function(r){var a,o;o=r.length>32?"##"+n(r).toString(16):r;a=i(o);if(a!=null){delete t[a]}if(t[o]==null){t[o]=e(r)}return t[o].clone()}};t.exports=r},{"./hash":180,"./queue":184}],179:[function(e,t,i){var r,n,a,o,s;a=e("../graph").Graph;r=e("../block");s=e("../visualize");n=function(){function e(e,t,i){this.language=e;this.fetch=t;this.config=i;this.graph()}e.prototype.pipe=function(t,i,r,n){if(t instanceof e){this._concat(t)}else if(t!=null){this._call(t,i,r,n)}return this};e.prototype.call=function(e,t,i,r){return this.pipe(e,t,i,r)};e.prototype.require=function(t,i,r,n){if(t instanceof e){this._import(t)}else if(t!=null){this.callback();this._call(t,i,r,n);this.end()}return this};e.prototype["import"]=function(e,t,i,r){return this.require(e,t,i,r)};e.prototype.split=function(){this._group("_combine",true);return this};e.prototype.fan=function(){this._group("_combine",false);return this};e.prototype.isolate=function(){this._group("_isolate");return this};e.prototype.callback=function(){this._group("_callback");return this};e.prototype.next=function(){this._next();return this};e.prototype.pass=function(){var e;e=this._stack[2].end;this.end();this._state.end=this._state.end.concat(e);return this};e.prototype.end=function(){var e,t,i,r;i=this._exit(),r=i[0],e=i[1];t=r.op;if(this[t]){this[t](r,e)}return this};e.prototype.join=function(){return this.end()};e.prototype.graph=function(){var e,t;while(((t=this._stack)!=null?t.length:void 0)>1){this.end()}if(this._graph){this._tail(this._state,this._graph)}e=this._graph;this._graph=new a;this._state=new o;this._stack=[this._state];return e};e.prototype.compile=function(e){if(e==null){e="main"}return this.graph().compile(e)};e.prototype.link=function(e){if(e==null){e="main"}return this.graph().link(e)};e.prototype.serialize=function(){return s.serialize(this._graph)};e.prototype.empty=function(){return this._graph.nodes.length===0};e.prototype._concat=function(e){var t,i;if(e._state.nodes.length===0){return this}this._tail(e._state,e._graph);try{t=new r.Isolate(e._graph)}catch(t){i=t;if(this.config.autoInspect){s.inspect(i,this._graph,e)}throw i}this._auto(t);return this};e.prototype._import=function(e){var t,i;if(e._state.nodes.length===0){throw"Can't import empty callback"}this._tail(e._state,e._graph);try{t=new r.Callback(e._graph)}catch(t){i=t;if(this.config.autoInspect){s.inspect(i,this._graph,e)}throw i}this._auto(t);return this};e.prototype._combine=function(e,t){var i,r,n,a,o,s,h,l;s=e.start;for(r=0,a=s.length;r<a;r++){l=s[r];h=t.end;for(n=0,o=h.length;n<o;n++){i=h[n];i.connect(l,e.multi)}}t.end=e.end;return t.nodes=t.nodes.concat(e.nodes)};e.prototype._isolate=function(e,t){var i,n,a;if(e.nodes.length){a=this._subgraph(e);this._tail(e,a);try{i=new r.Isolate(a)}catch(e){n=e;if(this.config.autoInspect){s.inspect(n,this._graph,a)}throw n}return this._auto(i)}};e.prototype._callback=function(e,t){var i,n,a;if(e.nodes.length){a=this._subgraph(e);this._tail(e,a);try{i=new r.Callback(a)}catch(e){n=e;if(this.config.autoInspect){s.inspect(n,this._graph,a)}throw n}return this._auto(i)}};e.prototype._call=function(e,t,i,n){var a,o;o=this.fetch(e);o.bind(this.config,t,i,n);a=new r.Call(o);return this._auto(a)};e.prototype._subgraph=function(e){var t;t=new a(null,this._graph);t.adopt(e.nodes);return t};e.prototype._tail=function(e,t){var i;i=e.end.concat(e.tail);i=i.filter(function(e,t){return i.indexOf(e)===t});if(i.length>1){i=new r.Join(i);i=[i.node];this._graph.add(i)}t.tail=i[0];e.end=i;e.tail=[];if(!t.tail){throw new Error("Cannot finalize empty graph")}t.compile=function(e){return function(i){var r;if(i==null){i="main"}try{return t.tail.owner.compile(e.language,i)}catch(i){r=i;if(e.config.autoInspect){t.inspect(r)}throw r}}}(this);t.link=function(e){return function(i){var r;if(i==null){i="main"}try{return t.tail.owner.link(e.language,i)}catch(i){r=i;if(e.config.autoInspect){t.inspect(r)}throw r}}}(this);t["export"]=function(e){return function(e,i){return t.tail.owner["export"](e,i)}}(this);return t.inspect=function(e){if(e==null){e=null}return s.inspect(e,t)}};e.prototype._group=function(e,t){this._push(e,t);this._push();return this};e.prototype._next=function(){var e;e=this._pop();this._state.start=this._state.start.concat(e.start);this._state.end=this._state.end.concat(e.end);this._state.nodes=this._state.nodes.concat(e.nodes);this._state.tail=this._state.tail.concat(e.tail);return this._push()};e.prototype._exit=function(){this._next();this._pop();return[this._pop(),this._state]};e.prototype._push=function(e,t){this._stack.unshift(new o(e,t));return this._state=this._stack[0]};e.prototype._pop=function(){var e;this._state=this._stack[1];if(this._state==null){this._state=new o}return(e=this._stack.shift())!=null?e:new o};e.prototype._auto=function(e){if(e.node.inputs.length){return this._append(e)}else{return this._insert(e)}};e.prototype._append=function(e){var t,i,r,n,a;n=e.node;this._graph.add(n);a=this._state.end;for(i=0,r=a.length;i<r;i++){t=a[i];t.connect(n)}if(!this._state.start.length){this._state.start=[n]}this._state.end=[n];this._state.nodes.push(n);if(!n.outputs.length){return this._state.tail.push(n)}};e.prototype._prepend=function(e){var t,i,r,n,a;r=e.node;this._graph.add(r);n=this._state.start;for(t=0,i=n.length;t<i;t++){a=n[t];r.connect(a)}if(!this._state.end.length){this._state.end=[r]}this._state.start=[r];this._state.nodes.push(r);if(!r.outputs.length){return this._state.tail.push(r)}};e.prototype._insert=function(e){var t;t=e.node;this._graph.add(t);this._state.start.push(t);this._state.end.push(t);this._state.nodes.push(t);if(!t.outputs.length){return this._state.tail.push(t)}};return e}();o=function(){function e(e,t,i,r,n,a){this.op=e!=null?e:null;this.multi=t!=null?t:false;this.start=i!=null?i:[];this.end=r!=null?r:[];this.nodes=n!=null?n:[];this.tail=a!=null?a:[]}return e}();t.exports=n},{"../block":175,"../graph":192,"../visualize":203}],180:[function(e,t,i){var r,n,a,o,s,h,l,u;r=3432918353;n=461845907;a=3864292196;o=2246822507;s=3266489909;l=function(e,t){var i,r,n,a;i=e>>>16&65535;r=e&65535;n=t>>>16&65535;a=t&65535;return r*a+(i*a+r*n<<16>>>0)|0};if(Math.imul!=null){u=Math.imul(4294967295,5);if(u===-5){l=Math.imul}}h=function(e){var t,i,h,u,c,p;c=e.length;u=Math.floor(c/2);h=t=0;p=function(){return e.charCodeAt(h++)};i=function(e,i){var o;o=e|i<<16;o^=o<<9;o=l(o,r);o=o<<15|o>>>17;o=l(o,n);t^=o;t=t<<13|t>>>19;t=l(t,5);return t=t+a|0};while(u--){i(p(),p())}if(c&1){i(p(),0)}t^=c;t^=t>>>16;t=l(t,o);t^=t>>>13;t=l(t,s);return t^=t>>>16};t.exports=h},{}],181:[function(e,t,i){i.Factory=e("./factory");i.Material=e("./material");i.library=e("./library");i.cache=e("./cache");i.queue=e("./queue");i.hash=e("./hash")},{"./cache":178,"./factory":179,"./hash":180,"./library":182,"./material":183,"./queue":184}],182:[function(e,t,i){var r;r=function(e,t,i){var r,n,a,o;r=null;o={};if(t!=null){if(typeof t==="function"){r=function(r){return i(e,r,t(r))}}else if(typeof t==="object"){r=function(r){if(t[r]==null){throw new Error("Unknown snippet `"+r+"`")}return i(e,r,t[r])}}}a=function(t){return i(e,"",t)};if(r==null){return a}n=function(e){if(e.match(/[{;]/)){return a(e)}o[e]=true;return r(e)};n.used=function(e){if(e==null){e=o}return o=e};return n};t.exports=r},{}],183:[function(e,t,i){var r,n,a,o;a=false;n=e("../visualize");o=function(){var e;e=+new Date;return function(t){var i;i=+new Date-e;console.log(t,i+" ms");return i}};r=function(){function e(e,t){this.vertex=e;this.fragment=t;if(a){this.tock=o()}}e.prototype.build=function(e){return this.link(e)};e.prototype.link=function(e){var t,i,r,o,s,h,l,u,c,p,f,d,m,g;if(e==null){e={}}f={};m={};t={};g=this.vertex.link("main");i=this.fragment.link("main");h=[g,i];for(r=0,s=h.length;r<s;r++){p=h[r];l=p.uniforms;for(o in l){d=l[o];f[o]=d}u=p.varyings;for(o in u){d=u[o];m[o]=d}c=p.attributes;for(o in c){d=c[o];t[o]=d}}e.vertexShader=g.code;e.vertexGraph=g.graph;e.fragmentShader=i.code;e.fragmentGraph=i.graph;e.attributes=t;e.uniforms=f;e.varyings=m;e.inspect=function(){return n.inspect("Vertex Shader",g,"Fragment Shader",i.graph)};if(a){this.tock("Material build")}return e};e.prototype.inspect=function(){return n.inspect("Vertex Shader",this.vertex,"Fragment Shader",this.fragment.graph)};return e}();t.exports=r},{"../visualize":203}],184:[function(e,t,i){var r;r=function(e){var t,i,r,n,a,o;if(e==null){e=100}n={};r=null;o=null;i=0;t=function(e){e.prev=null;e.next=r;if(r!=null){r.prev=e}r=e;if(o==null){return o=e}};a=function(e){var t,i;i=e.prev;t=e.next;if(i!=null){i.next=t}if(t!=null){t.prev=i}if(r===e){r=t}if(o===e){return o=i}};return function(s){var h,l;if(l=n[s]&&l!==r){a(l);t(l)}else{if(i===e){h=o.key;a(o);delete n[h]}else{i++}l={next:r,prev:null,key:s};t(l);n[s]=l}return h}};t.exports=r},{}],185:[function(e,t,i){var r,n,a,o;r=function(e){var t,i,r,o,s;i=e.ast,r=e.code,s=e.signatures;o=n(s);t=a(r,o);return[s,t]};o=function(){var e;e=+new Date;return function(t){var i;i=+new Date-e;console.log(t,i+" ms");return i}};n=function(e){var t,i,r,n,a,o,s,h,l,u;o={};l=function(e){return o[e.name]=true};l(e.main);s=["external","internal","varying","uniform","attribute"];for(t=0,n=s.length;t<n;t++){r=s[t];h=e[r];for(i=0,a=h.length;i<a;i++){u=h[i];l(u)}}return o};a=function(e,t){var i,r;r=new RegExp("\\b("+function(){var e;e=[];for(i in t){e.push(i)}return e}().join("|")+")\\b","g");e=e.replace(/\/\/[^\n]*/g,"");e=e.replace(/\/\*([^*]|\*[^\/])*\*\//g,"");return function(n,a,o){var s,h,l,u;if(n==null){n=""}if(a==null){a={}}if(o==null){o={}}l={};for(i in t){l[i]=a[i]!=null?i:n+i}s=e.replace(r,function(e){return l[e]});h=function(){var e;e=[];for(i in o){u=o[i];e.push("#define "+i+" "+u)}return e}();if(h.length){h.push("")}return h.join("\n")+s}};t.exports=r},{}],186:[function(e,t,i){t.exports={SHADOW_ARG:"_i_o",RETURN_ARG:"return"}},{}],187:[function(e,t,i){var r,n,a,o,s,h,l;t.exports=n={};n["in"]=0;n.out=1;n.inout=2;o=function(e){return e.token.data};n.node=function(e){var t,i;if(((t=e.children[5])!=null?t.type:void 0)==="function"){return n["function"](e)}else if(((i=e.token)!=null?i.type:void 0)==="keyword"){return n.external(e)}};n.external=function(e){var t,i,r,n,a,s,h,l,u,c,p,f,d;t=e.children;p=o(t[1]);f=o(t[3]);d=o(t[4]);s=t[5];if(p!=="attribute"&&p!=="uniform"&&p!=="varying"){p="global"}l=[];c=s.children;for(i=n=0,a=c.length;n<a;i=++n){t=c[i];if(t.type==="ident"){r=o(t);h=s.children[i+1];u=(h!=null?h.type:void 0)==="quantifier";l.push({decl:"external",storage:p,type:d,ident:r,quant:!!u,count:u})}}return l};n["function"]=function(e){var t,i,r,a,s,h,l,u,c,p;r=e.children;u=o(r[1]);c=o(r[3]);p=o(r[4]);h=r[5];l=o(h.children[0]);t=h.children[1];i=h.children[2];s=function(){var e,i,r,o;r=t.children;o=[];for(e=0,i=r.length;e<i;e++){a=r[e];o.push(n.argument(a))}return o}();return[{decl:"function",storage:u,type:p,ident:l,body:!!i,args:s}]};n.argument=function(e){var t,i,r,n,a,s,h,l;t=e.children;h=o(t[1]);n=o(t[2]);l=o(t[4]);a=t[5];r=o(a.children[0]);s=a.children[1];i=s?s.children[0].token.data:void 0;return{decl:"argument",storage:h,inout:n,type:l,ident:r,quant:!!s,count:i}};n.param=function(e,t,i,r,a){var o,s,h;s=[];if(t!=null){s.push(t)}if(i!=null){s.push(i)}s.push("");s=s.join(" ");h=r?"["+a+"]":"";if(e!==""){e+=" "}o=function(t,i){return(i?e:"")+(""+s+t+h)};o.split=function(e){return n.param(e,t,i,r,a)};return o};l=typeof window!=="undefined";h=l&&!!window.THREE;a={int:0,float:0,vec2:h?THREE.Vector2:null,vec3:h?THREE.Vector3:null,vec4:h?THREE.Vector4:null,mat2:null,mat3:h?THREE.Matrix3:null,mat4:h?THREE.Matrix4:null,sampler2D:0,samplerCube:0};s={int:"i",float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat2:"m2",mat3:"m3",mat4:"m4",sampler2D:"t",samplerCube:"t"};n.type=function(e,t,i,o,h,l){var u,c,p,f,d,m,g;u={in:n["in"],out:n.out,inout:n.inout};d={const:"const"};m=s[t];if(i){m+="v"}g=a[t];if(g!=null?g.call:void 0){g=new g}if(i){g=[g]}c=(f=u[h])!=null?f:u["in"];l=d[l];p=n.param(h,l,t,i,o);return new r(e,m,t,p,g,c)};r=function(){function e(e,t,i,r,n,a,o){this.name=e;this.type=t;this.spec=i;this.param=r;this.value=n;this.inout=a;this.meta=o}e.prototype.split=function(){var t,i,r,a;r=this.meta.shadowed!=null;t=r?"in":"out";i=r?n["in"]:n.out;a=this.param.split(t);return new e(this.name,this.type,this.spec,a,this.value,i)};e.prototype.copy=function(t,i){var r;return r=new e(t!=null?t:this.name,this.type,this.spec,this.param,this.value,this.inout,i)};return e}()},{}],188:[function(e,t,i){var r,n,a;n=e("../graph");r=e("./constants");t.exports=a={unshadow:function(e){var t;t=e.replace(r.SHADOW_ARG,"");if(t!==e){return t}else{return null}},lines:function(e){return e.join("\n")},list:function(e){return e.join(", ")},statements:function(e){return e.join(";\n")},body:function(e){return{entry:e,type:"void",params:[],signature:[],return:"",vars:{},calls:[],post:[],chain:{}}},define:function(e,t){return"#define "+e+" "+t},function:function(e,t,i,r,n){return e+" "+t+"("+i+") {\n"+r+n+"}"},invoke:function(e,t,i){e=e?e+" = ":"";i=a.list(i);return"  "+e+t+"("+i+")"},same:function(e,t){var i,n,a,o,s;for(a=o=0,s=e.length;o<s;a=++o){i=e[a];n=t[a];if(!n){return false}if(i.type!==n.type){return false}if(i.name===r.RETURN_ARG!==(n.name===r.RETURN_ARG)){return false}}return true},call:function(e,t,i,n,o){var s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T;h=[];_="";x=1;for(f=0,d=n.length;f<d;f++){s=n[f];g=s.name;l=u=e(g);E=null;m=null;v=false;c=s.inout;p=g===r.RETURN_ARG;if(T=(w=s.meta)!=null?w.shadowed:void 0){E=e(T);if(E){o.vars[E]="  "+s.param(E);o.calls.push("  "+E+" = "+u);if(!t(T)){s=s.split()}else{m={shadowed:E}}}}if(T=(b=s.meta)!=null?b.shadow:void 0){E=e(T);if(E){if(!t(T)){s=s.split();v=true}else{m={shadow:E};continue}}}if(p){_=u}else if(!v){h.push(E!=null?E:u)}if(t(g)){y="push";if(p){if(o["return"]===""){y="unshift";l=g;o.type=s.spec;o["return"]="  return "+u;o.vars[u]="  "+s.param(u)}else{o.vars[u]="  "+s.param(u);o.params.push(s.param(u,true))}}else{o.params.push(s.param(u,true))}s=s.copy(l,m);o.signature[y](s)}else{o.vars[u]="  "+s.param(u)}}return o.calls.push(a.invoke(_,i,h))},build:function(e,t){var i,r,n,o,s,h,l,u,c,p,f;s=e.entry;n=null;if(t&&t.length===1&&s!=="main"){i=e;r=t[0].module;if(a.same(e.signature,r.main.signature)){n=a.define(s,r.entry)}}if(n==null){f=function(){var t,i;t=e.vars;i=[];for(p in t){o=t[p];i.push(o)}return i}();t=e.calls;l=e.post;h=e.params;c=e.type;u=e["return"];t=t.concat(l);if(u!==""){t.push(u)}t.push("");if(f.length){f.push("");f=a.statements(f)+"\n"}else{f=""}t=a.statements(t);h=a.list(h);n=a["function"](c,s,h,f,t)}return{signature:e.signature,code:n,name:s}},links:function(e){var t,i,r,n;n={defs:[],bodies:[]};for(t=0,r=e.length;t<r;t++){i=e[t];a.link(i,n)}n.defs=a.lines(n.defs);n.bodies=a.statements(n.bodies);if(n.defs===""){delete n.defs}if(n.bodies===""){delete n.bodies}return n},link:function(e){return function(e,t){var i,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M;E=e.module,b=e.name,u=e.external;v=E.main;l=E.entry;if(a.same(v.signature,u.signature)){return t.defs.push(a.define(b,l))}p=[];T=[];y={};H=[E.namespace,r.RETURN_ARG].join("");R=u.signature;for(f=0,d=R.length;f<d;f++){h=R[f];g=h.inout===n.IN?p:T;g.push(h)}k=v.signature;for(w=0,m=k.length;w<m;w++){h=k[w];g=h.inout===n.IN?p:T;_=g.shift();s=_.name;if(s===r.RETURN_ARG){s=H}y[h.name]=s}o=function(e){return y[e]};i=function(){return true};c=a.body();a.call(o,i,l,v.signature,c);c.entry=l;y={return:H};o=function(e){var t;return(t=y[e])!=null?t:e};x=a.body();M=a.call(o,i,l,u.signature,x);x.calls=c.calls;x.entry=b;t.bodies.push(a.build(c).code.split(" {")[0]);return t.bodies.push(a.build(x).code)}}(this),defuse:function(e){var t,i,r,n,a,o,s,h,l,u,c,p,f,d,m;f=/([A-Za-z0-9_]+\s+)?[A-Za-z0-9_]+\s+[A-Za-z0-9_]+\s*\([^)]*\)\s*;\s*/gm;m=function(e){return e.replace(f,function(e){return""})};i=e.split(/(?=[{}])/g);u=0;for(a=s=0,h=i.length;s<h;a=++s){t=i[a];switch(t[0]){case"{":u++;break;case"}":u--}if(u===0){r=t.split(/^[ \t]*#/m);for(o=p=0,l=r.length;p<l;o=++p){c=r[o];if(o>0){c=c.split(/\n/);n=c.shift();d=c.join("\n");r[o]=[n,m(d)].join("\n")}else{r[o]=m(c)}}i[a]=r.join("#")}}return e=i.join("")},dedupe:function(e){var t,i;t={};i=/((attribute|uniform|varying)\s+)[A-Za-z0-9_]+\s+([A-Za-z0-9_]+)\s*(\[[^\]]*\]\s*)?;\s*/gm;return e.replace(i,function(e,i,r,n,a){if(t[n]){return""}t[n]=true;return e})},hoist:function(e){var t,i,r,n,a,o,s,h;h=/^#define ([^ ]+ _pg_[0-9]+_|_pg_[0-9]+_ [^ ]+)$/;a=e.split(/\n/g);t=[];s=[];for(i=0,r=a.length;i<r;i++){n=a[i];o=n.match(h)?t:s;o.push(n)}return t.concat(s).join("\n")}}},{"../graph":192,"./constants":186}],189:[function(e,t,i){var r,n,a,o,s;i.compile=e("./compile");i.parse=e("./parse");i.generate=e("./generate");o=e("./constants");for(s=r=0,a=o.length;r<a;s=++r){n=o[s];i[n]=s}},{"./compile":185,"./constants":186,"./generate":188,"./parse":190}],190:[function(e,t,i){var r,n,a,o,s,h,l,u,c,p,f,d,m,g;m=e("../../vendor/glsl-tokenizer");c=e("../../vendor/glsl-parser");o=e("./decl");r=e("./constants");a=false;l=function(e,t){var i,r;i=u(e,t);return r=p(i,t)};u=function(e,t){var i,r,n,o,s,h,l,u,p,f;if(a){f=d()}try{u=m().process(c(),t),p=u[0],i=p[0],o=u[1]}catch(e){r=e;o=[{message:r}]}if(a){f("GLSL Tokenize & Parse")}s=function(e){var t,i;e=e.split("\n");t=(""+e.length).length;i=function(e){if((e=""+e).length<t){return("       "+e).slice(-t)}else{return e}};return e.map(function(e,t){return i(t+1)+": "+e}).join("\n")};if(!i||o.length){if(!e){e="(inline code)"}console.warn(s(t));for(h=0,l=o.length;h<l;h++){n=o[h];console.error(e+" -",n.message)}throw new Error("GLSL parse error")}return i};p=function(e,t){var i,r,o,l,u,c,p;if(a){p=d()}c=[];g(h,n(c),e,"");l=f(c),o=l[0],r=l[1],i=l[2];u=s(o,r,i);if(a){p("GLSL AST")}return{ast:e,code:t,signatures:u}};h=function(e,t){switch(e.type){case"decl":t(o.node(e));return false}return true};n=function(e){return function(t){var i,r,n,a;if(t!=null){a=[];for(i=0,r=t.length;i<r;i++){n=t[i];a.push(e.push(n))}return a}}};f=function(e){var t,i,r,n,a,o,s,h,l;s=null;n=[];i=[];h={};r=false;for(a=0,o=e.length;a<o;a++){l=e[a];if(!l.body){if(l.storage==="global"){n.push(l)}else{i.push(l);h[l.ident]=true}}else{if(h[l.ident]){i=function(){var e,r,n;n=[];for(e=0,r=i.length;e<r;e++){t=i[e];if(t.ident!==l.ident){n.push(t)}}return n}();delete h[l.ident]}n.push(l);if(l.ident==="main"){s=l;r=true}else if(!r){s=l}}}return[s,n,i]};s=function(e,t,i){var n,a,s,h,l,u,c,p,f;p={uniform:[],attribute:[],varying:[],external:[],internal:[],global:[],main:null};a=function(e){return o.type(e.ident,e.type,e.quant,e.count,e.inout,e.storage)};s=function(e,t){var i,n,s,h,l,u,c,p,f,d,m;d=function(){var t,i,r,o;r=e.args;o=[];for(t=0,i=r.length;t<i;t++){n=r[t];o.push(a(n))}return o}();for(c=0,p=d.length;c<p;c++){h=d[c];if(!(h.inout===o.inout)){continue}i=h;s=h.copy();i.inout=o["in"];s.inout=o.out;s.meta={shadow:i.name};s.name+=r.SHADOW_ARG;i.meta={shadowed:s.name};d.push(s)}if(e.type!=="void"){d.unshift(o.type(r.RETURN_ARG,e.type,false,"","out"))}u=function(){var e,t,i;i=[];for(e=0,t=d.length;e<t;e++){h=d[e];if(h.inout===o["in"]){i.push(h.type)}}return i}().join(",");f=function(){var e,t,i;i=[];for(e=0,t=d.length;e<t;e++){h=d[e];if(h.inout===o.out){i.push(h.type)}}return i}().join(",");m="("+u+")("+f+")";return l={name:e.ident,type:m,signature:d,inout:t,spec:e.type}};p.main=s(e,o.out);for(h=0,u=t.length;h<u;h++){f=t[h];p.internal.push({name:f.ident})}for(l=0,c=i.length;l<c;l++){f=i[l];switch(f.decl){case"external":n=a(f);p[f.storage].push(n);break;case"function":n=s(f,o["in"]);p.external.push(n)}}return p};a=false;g=function(e,t,i,r){var n,o,s,h,l,u,c,p;a&&console.log(r,i.type,(u=i.token)!=null?u.data:void 0,(c=i.token)!=null?c.type:void 0);l=e(i,t);if(l){p=i.children;for(o=s=0,h=p.length;s<h;o=++s){n=p[o];g(e,t,n,r+"  ",a)}}return null};d=function(){var e;e=+new Date;return function(t){var i;i=+new Date-e;console.log(t,i+" ms");return i}};t.exports=g;t.exports=l},{"../../vendor/glsl-parser":206,"../../vendor/glsl-tokenizer":210,"./constants":186,"./decl":187}],191:[function(e,t,i){var r;r=function(){e.index=0;e.id=function(t){return++e.index};e.IN=0;e.OUT=1;function e(t,i){this.parent=i!=null?i:null;this.id=e.id();this.nodes=[];t&&this.add(t)}e.prototype.inputs=function(){var e,t,i,r,n,a,o,s,h;t=[];s=this.nodes;for(e=0,r=s.length;e<r;e++){a=s[e];h=a.inputs;for(i=0,n=h.length;i<n;i++){o=h[i];if(o.input===null){t.push(o)}}}return t};e.prototype.outputs=function(){var e,t,i,r,n,a,o,s,h;o=[];s=this.nodes;for(e=0,i=s.length;e<i;e++){n=s[e];h=n.outputs;for(t=0,r=h.length;t<r;t++){a=h[t];if(a.output.length===0){o.push(a)}}}return o};e.prototype.getIn=function(e){var t;return function(){var i,r,n,a;n=this.inputs();a=[];for(i=0,r=n.length;i<r;i++){t=n[i];if(t.name===e){a.push(t)}}return a}.call(this)[0]};e.prototype.getOut=function(e){var t;return function(){var i,r,n,a;n=this.outputs();a=[];for(i=0,r=n.length;i<r;i++){t=n[i];if(t.name===e){a.push(t)}}return a}.call(this)[0]};e.prototype.add=function(e,t){var i,r,n;if(e.length){for(r=0,n=e.length;r<n;r++){i=e[r];this.add(i)}return}if(e.graph&&!t){throw new Error("Adding node to two graphs at once")}e.graph=this;return this.nodes.push(e)};e.prototype.remove=function(e,t){var i,r,n;if(e.length){for(r=0,n=e.length;r<n;r++){i=e[r];this.remove(i)}return}if(e.graph!==this){throw new Error("Removing node from wrong graph.")}t||e.disconnect();this.nodes.splice(this.nodes.indexOf(e),1);return e.graph=null};e.prototype.adopt=function(e){var t,i,r;if(e.length){for(i=0,r=e.length;i<r;i++){t=e[i];this.adopt(t)}return}e.graph.remove(e,true);return this.add(e,true)};return e}();t.exports=r},{}],192:[function(e,t,i){i.Graph=e("./graph");i.Node=e("./node");i.Outlet=e("./outlet");i.IN=i.Graph.IN;i.OUT=i.Graph.OUT},{"./graph":191,"./node":193,"./outlet":194}],193:[function(e,t,i){var r,n,a;r=e("./graph");a=e("./outlet");n=function(){e.index=0;e.id=function(t){return++e.index};function e(t,i){this.owner=t;this.graph=null;this.inputs=[];this.outputs=[];this.all=[];this.outlets=null;this.id=e.id();this.setOutlets(i)}e.prototype.getIn=function(e){var t;return function(){var i,r,n,a;n=this.inputs;a=[];for(i=0,r=n.length;i<r;i++){t=n[i];if(t.name===e){a.push(t)}}return a}.call(this)[0]};e.prototype.getOut=function(e){var t;return function(){var i,r,n,a;n=this.outputs;a=[];for(i=0,r=n.length;i<r;i++){t=n[i];if(t.name===e){a.push(t)}}return a}.call(this)[0]};e.prototype.get=function(e){return this.getIn(e)||this.getOut(e)};e.prototype.setOutlets=function(e){var t,i,r,n,o,s,h,l,u,c,p,f;if(e!=null){if(this.outlets==null){this.outlets={};for(r=0,h=e.length;r<h;r++){p=e[r];if(!(p instanceof a)){p=a.make(p)}this._add(p)}return}i=function(e){return[e.name,e.inout,e.type].join("-")};c={};for(n=0,l=e.length;n<l;n++){p=e[n];c[i(p)]=true}f=this.outlets;for(s in f){p=f[s];s=i(p);if(c[s]){c[s]=p}else{this._remove(p)}}for(o=0,u=e.length;o<u;o++){p=e[o];t=c[i(p)];if(t instanceof a){this._morph(t,p)}else{if(!(p instanceof a)){p=a.make(p)}this._add(p)}}this}return this.outlets};e.prototype.connect=function(e,t,i){var r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b;d={};o={};b=function(e){return w+"/"+e.hint};m=e.inputs;for(s=0,u=m.length;s<u;s++){r=m[s];if(!i&&r.input){continue}w=r.type;a=b(r);if(!o[a]){o[a]=r}d[w]=f=d[w]||[];f.push(r)}E=this.outputs;E=E.filter(function(e){return!(t&&e.output.length)});g=E.slice();for(h=0,c=g.length;h<c;h++){y=g[h];w=y.type;a=b(y);n=d[w];if(r=o[a]){y.connect(r);delete o[a];n.splice(n.indexOf(r),1);E.splice(E.indexOf(y),1)}}if(!E.length){return this}v=E.slice();for(l=0,p=v.length;l<p;l++){y=v[l];w=y.type;n=d[w];if(n&&n.length){y.connect(n.shift())}}return this};e.prototype.disconnect=function(e){var t,i,r,n,a,o,s;o=this.inputs;for(t=0,r=o.length;t<r;t++){a=o[t];a.disconnect()}s=this.outputs;for(i=0,n=s.length;i<n;i++){a=s[i];a.disconnect()}return this};e.prototype._key=function(e){return[e.name,e.inout].join("-")};e.prototype._add=function(e){var t;t=this._key(e);if(e.node){throw new Error("Adding outlet to two nodes at once.")}if(this.outlets[t]){throw new Error("Adding two identical outlets to same node. ("+t+")")}e.node=this;if(e.inout===r.IN){this.inputs.push(e)}if(e.inout===r.OUT){this.outputs.push(e)}this.all.push(e);return this.outlets[t]=e};e.prototype._morph=function(e,t){var i;i=this._key(t);delete this.outlets[i];e.morph(t);i=this._key(t);return this.outlets[i]=t};e.prototype._remove=function(e){var t,i;i=this._key(e);t=e.inout;if(e.node!==this){throw new Error("Removing outlet from wrong node.")}e.disconnect();e.node=null;delete this.outlets[i];if(e.inout===r.IN){this.inputs.splice(this.inputs.indexOf(e),1)}if(e.inout===r.OUT){this.outputs.splice(this.outputs.indexOf(e),1)}this.all.splice(this.all.indexOf(e),1);return this};return e}();t.exports=n},{"./graph":191,"./outlet":194}],194:[function(e,t,i){var r,n;r=e("./graph");n=function(){e.make=function(t,i){var r,n,a,o;if(i==null){i={}}n=i;if(t.meta!=null){a=t.meta;for(r in a){o=a[r];n[r]=o}}return new e(t.inout,t.name,t.hint,t.type,n)};e.index=0;e.id=function(t){return"_io_"+ ++e.index+"_"+t};e.hint=function(e){e=e.replace(/^_io_[0-9]+_/,"");e=e.replace(/_i_o$/,"");return e=e.replace(/(In|Out|Inout|InOut)$/,"")};function e(t,i,r,n,a,o){this.inout=t;this.name=i;this.hint=r;this.type=n;this.meta=a!=null?a:{};this.id=o;if(this.hint==null){this.hint=e.hint(this.name)}this.node=null;this.input=null;this.output=[];if(this.id==null){this.id=e.id(this.hint)}}e.prototype.morph=function(e){this.inout=e.inout;this.name=e.name;this.hint=e.hint;this.type=e.type;return this.meta=e.meta};e.prototype.dupe=function(t){var i;if(t==null){t=this.id}i=e.make(this);i.name=t;return i};e.prototype.connect=function(e){if(this.inout===r.IN&&e.inout===r.OUT){return e.connect(this)}if(this.inout!==r.OUT||e.inout!==r.IN){throw new Error("Can only connect out to in.")}if(e.input===this){return}e.disconnect();e.input=this;return this.output.push(e)};e.prototype.disconnect=function(e){var t,i,r,n;if(this.input){this.input.disconnect(this)}if(this.output.length){if(e){i=this.output.indexOf(e);if(i>=0){this.output.splice(i,1);return e.input=null}}else{n=this.output;for(t=0,r=n.length;t<r;t++){e=n[t];e.input=null}return this.output=[]}}};return e}();t.exports=n},{"./graph":191}],195:[function(e,t,i){var r,n,a,o,s,h,l,u,c,p,f,d,m;r=e("./block");n=e("./factory");a=e("./glsl");o=e("./graph");s=e("./linker");u=e("./visualize");f=n.library;c=n.cache;m=u.visualize;p=u.inspect;l=s.Snippet;d=function(e,t){var i,r,n,a;if(t==null){t={}}r={};for(i in e){a=e[i];r[i]=(n=t[i])!=null?n:e[i]}return r};h=function(){function e(t,i){var r;if(!(this instanceof e)){return new e(t,i)}r={globalUniforms:false,globalVaryings:true,globalAttributes:true,globals:[],autoInspect:false};this.config=d(r,i);this.fetch=c(f(a,t,l.load))}e.prototype.shader=function(e){var t;if(e==null){e={}}t=d(this.config,e);return new n.Factory(a,this.fetch,t)};e.prototype.material=function(e){return new n.Material(this.shader(e),this.shader(e))};e.prototype.inspect=function(t){return e.inspect(t)};e.prototype.visualize=function(t){return e.visualize(t)};e.Block=r;e.Factory=n;e.GLSL=a;e.Graph=o;e.Linker=s;e.Visualize=u;e.inspect=function(e){return p(e)};e.visualize=function(e){return m(e)};return e}();t.exports=h;if(typeof window!=="undefined"){window.ShaderGraph=h}},{"./block":175,"./factory":181,"./glsl":189,"./graph":192,"./linker":197,"./visualize":203}],196:[function(e,t,i){var r,n,a;r=e("../graph");n=e("./priority");a=function(e,t,i,a){var o,s,h,l,u,c,p,f,d,m,g,v,y,E;l=e.generate;h={};v=[];y={};E={};s={};f={};m=function(){var e,r,o,c,p,d,m,w,b;for(d in a){m=a[d];g(m.node,m.module)}w=u(i),e=w[0],i=w[1];if(t!=null){e.entry=t}p=l.build(e,i);b=function(){var e;e=[];for(d in f){c=f[d];e.push(c)}return e}().sort(function(e,t){return n.compare(e.priority,t.priority)});o=b.map(function(e){return e.code});o.push(p.code);r=l.lines(o);return{namespace:p.name,library:f,body:p.code,code:r,main:p,entry:p.name,symbols:v,externals:h,uniforms:y,varyings:E,attributes:s}};u=function(e){return function(e){var t,i,r,n,a,o;e=function(){var t;t=[];for(o in e){i=e[o];t.push(i)}return t}();e.sort(function(e,t){return t.priority-e.priority});r=function(e,i,r){var n,a,o,s;c(e,i,r);s=i.main;o=i.entry;a=function(t){return d(e,t)};n=function(t){return p(e,t)};return l.call(a,n,o,s.signature,t)};t=l.body();for(n=0,a=e.length;n<a;n++){i=e[n];r(i.node,i.module,i.priority)}return[t,e]}}(this);o=function(e,t,i){var r;r=f[e];if(r!=null){return r.priority=n.max(r.priority,i)}else{return f[e]={code:t,priority:i}}};c=function(e,t,i){var r,a,h,l,u,c,p,f;i=n.make(i);u=t.library;for(l in u){h=u[l];o(l,h.code,n.nest(i,h.priority))}o(t.namespace,t.body,i);c=t.uniforms;for(a in c){r=c[a];y[a]=r}p=t.varyings;for(a in p){r=p[a];E[a]=r}f=t.attributes;for(a in f){r=f[a];s[a]=r}return g(e,t)};g=function(e,t){var i,r,n,a,o,s,l,u,c;l=t.symbols;u=[];for(n=0,s=l.length;n<s;n++){o=l[n];r=t.externals[o];if(p(e,r.name)){i={};for(a in r){c=r[a];i[a]=c}i.name=d(e,r.name);h[o]=i;u.push(v.push(o))}else{u.push(void 0)}}return u};p=function(e,t){var i;i=e.get(t);if(i.inout===r.IN){return i.input===null}else if(i.inout===r.OUT){return i.output.length===0}};d=function(e,t){var i;i=e.get(t);if(!i){return null}if(i.input){i=i.input}t=i.name;return i.id};return m()};t.exports=a},{"../graph":192,"./priority":200}],197:[function(e,t,i){i.Snippet=e("./snippet");i.Program=e("./program");i.Layout=e("./layout");i.assemble=e("./assemble");i.link=e("./link");i.priority=e("./priority");i.load=i.Snippet.load},{"./assemble":196,"./layout":198,"./link":199,"./priority":200,"./program":201,"./snippet":202}],198:[function(e,t,i){var r,n,a,o;n=e("./snippet");o=e("./link");a=false;r=function(){function e(e,t){this.language=e;this.graph=t;this.links=[];this.includes=[];this.modules={};this.visits={}}e.prototype.callback=function(e,t,i,r,n){return this.links.push({node:e,module:t,priority:i,name:r,external:n})};e.prototype.include=function(e,t,i){var r;if((r=this.modules[t.namespace])!=null){return r.priority=Math.max(i,r.priority)}else{this.modules[t.namespace]=true;return this.includes.push({node:e,module:t,priority:i})}};e.prototype.visit=function(e){a&&console.log("Visit",e,!this.visits[e]);if(this.visits[e]){return false}return this.visits[e]=true};e.prototype.link=function(e){var t,i,r;t=o(this.language,this.links,this.includes,e);r=new n;for(i in t){r[i]=t[i]}r.graph=this.graph;return r};return e}();t.exports=r},{"./link":199,"./snippet":202}],199:[function(e,t,i){var r,n,a;r=e("../graph");n=e("./priority");a=function(e,t,i,a){var o,s,h,l,u,c,p,f,d,m,g,v;l=e.generate;c=[];m=[];h={};g={};s={};v={};f={};d=function(){var e,r,o,p,d,m,y,E,w,b;o=l.links(t);p=[];if(o.defs!=null){p.push(o.defs)}if(o.bodies!=null){p.push(o.bodies)}for(d=0,m=i.length;d<m;d++){E=i[d];u(E.node,E.module,E.priority)}b=function(){var e;e=[];for(w in f){y=f[w];e.push(y)}return e}().sort(function(e,t){return n.compare(e.priority,t.priority)});c=b.map(function(e){return e.code});e=l.lines(c);e=l.defuse(e);if(p.length){e=[l.lines(p),e].join("\n")}e=l.hoist(e);e=l.dedupe(e);r=a;return{namespace:r.main.name,code:e,main:r.main,entry:r.main.name,externals:h,uniforms:g,attributes:s,varyings:v}};o=function(e,t,i){var r;r=f[e];if(r!=null){return r.priority=n.max(r.priority,i)}else{return f[e]={code:t,priority:i}}};u=function(e,t,i){var r,a,l,u,c,f,d,y,E,w,b,_,x;i=n.make(i);y=t.library;for(d in y){f=y[d];o(d,f.code,n.nest(i,f.priority))}o(t.namespace,t.body,i);E=t.uniforms;for(u in E){r=E[u];g[u]=r}w=t.varyings;for(u in w){r=w[u];v[u]=r}b=t.attributes;for(u in b){r=b[u];s[u]=r}_=t.symbols;x=[];for(l=0,c=_.length;l<c;l++){u=_[l];a=t.externals[u];if(p(e,a.name)){h[u]=a;x.push(m.push(u))}else{x.push(void 0)}}return x};p=function(e,t){var i,n,a,o;n=e.get(t);if(!n){i=(a=(o=e.owner.snippet)!=null?o._name:void 0)!=null?a:e.owner.namespace;throw new Error("Unable to link program. Unlinked callback `"+t+"` on `"+i+"`")}if(n.inout===r.IN){return n.input===null}else if(n.inout===r.OUT){return n.output.length===0}};return d()};t.exports=a},{"../graph":192,"./priority":200}],200:[function(e,t,i){i.make=function(e){var t;if(e==null){e=[]}if(!(e instanceof Array)){e=[(t=+e)!=null?t:0]}return e};i.nest=function(e,t){return e.concat(t)};i.compare=function(e,t){var i,r,n,a,o,s;n=Math.min(e.length,t.length);for(i=r=0,s=n;0<=s?r<s:r>s;i=0<=s?++r:--r){a=e[i];o=t[i];if(a>o){return-1}if(a<o){return 1}}e=e.length;t=t.length;if(e>t){return-1}else if(e<t){return 1}else{return 0}};i.max=function(e,t){if(i.compare(e,t)>0){return t}else{return e}}},{}],201:[function(e,t,i){var r,n,a;n=e("./snippet");a=e("./assemble");r=function(){e.index=0;e.entry=function(){return"_pg_"+ ++e.index+"_"};function e(e,t,i){this.language=e;this.namespace=t;this.graph=i;this.calls={};this.requires={}}e.prototype.call=function(e,t,i){var r,n;n=t.namespace;if(r=this.calls[n]){r.priority=Math.max(r.priority,i)}else{this.calls[n]={node:e,module:t,priority:i}}return this};e.prototype.require=function(e,t){var i;i=t.namespace;return this.requires[i]={node:e,module:t}};e.prototype.assemble=function(){var t,i,r,o;t=a(this.language,(r=this.namespace)!=null?r:e.entry,this.calls,this.requires);o=new n;for(i in t){o[i]=t[i]}o.graph=this.graph;return o};return e}();t.exports=r},{"./assemble":196,"./snippet":202}],202:[function(e,t,i){var r;r=function(){e.index=0;e.namespace=function(){return"_sn_"+ ++e.index+"_"};e.load=function(t,i,r){var n,a,o,s;a=t.parse(i,r);o=t.compile(a),s=o[0],n=o[1];return new e(t,s,n,i,r)};function e(e,t,i,r,n){var a;this.language=e;this._signatures=t;this._compiler=i;this._name=r;this._original=n;this.namespace=null;this.code=null;this.main=null;this.entry=null;this.uniforms=null;this.externals=null;this.symbols=null;this.attributes=null;this.varyings=null;if(!this.language){delete this.language}if(!this._signatures){delete this._signatures}if(!this._compiler){delete this._compiler}if(!this._original){delete this._original}if(!this._name){this._name=(a=this._signatures)!=null?a.main.name:void 0}}e.prototype.clone=function(){return new e(this.language,this._signatures,this._compiler,this._name,this._original)};e.prototype.bind=function(t,i,r,n){var a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M,S,A,C,z,P,L,O,D,F,B,U,N,V,I,j,G;if(i===""+i){P=[i,r!=null?r:{},n!=null?n:{}],r=P[0],i=P[1],n=P[2]}else if(r!==""+r){L=[r!=null?r:{},void 0],n=L[0],r=L[1]}this.main=this._signatures.main;this.namespace=(O=r!=null?r:this.namespace)!=null?O:e.namespace();this.entry=this.namespace+this.main.name;this.uniforms={};this.varyings={};this.attributes={};this.externals={};this.symbols=[];d={};f={};m=function(e){f[e]=true;return e};H=function(e){return function(t){return e.namespace+t}}(this);if(t.globals){D=t.globals;for(g=0,b=D.length;g<b;g++){E=D[g];m(E)}}s=t.globalUniforms?m:H;h=t.globalVaryings?m:H;a=t.globalAttributes?m:H;o=H;G=function(e){return function(e){return d[e.name]=true}}(this);I=function(e){return function(t,i){return e.uniforms[s(i!=null?i:t.name)]=t}}(this);j=function(e){return function(t){return e.varyings[h(t.name)]=t}}(this);l=function(e){return function(t){return e.attributes[a(t.name)]=t}}(this);p=function(e){return function(t){var i;i=o(t.name);e.externals[i]=t;return e.symbols.push(i)}}(this);z=function(e){return{type:e.type,name:e.name,value:e.value}};F=this._signatures.uniform;for(v=0,_=F.length;v<_;v++){u=F[v];G(u)}B=this._signatures.uniform;for(w=0,x=B.length;w<x;w++){u=B[w];I(z(u))}U=this._signatures.varying;for(M=0,T=U.length;M<T;M++){u=U[M];j(z(u))}N=this._signatures.external;for(S=0,R=N.length;S<R;S++){u=N[S];p(u)}V=this._signatures.attribute;for(C=0,k=V.length;C<k;C++){u=V[C];l(z(u))}for(A in i){u=i[A];if(d[A]){I(u,A)}}this.body=this.code=this._compiler(this.namespace,f,n);if(n){c=function(){var e;e=[];for(y in n){j=n[y];e.push("#define "+y+" "+j)}return e}().join("\n");if(c.length){this._original=[c,"//----------------------------------------",this._original].join("\n")}}return null};return e}();t.exports=r},{}],203:[function(e,t,i){var r,n,a,o,s,h;r=e("../graph").Graph;i.serialize=s=e("./serialize");i.markup=n=e("./markup");h=function(e){var t;if(!e){return}if(!e.nodes){return e}t=s(e);return n.process(t)};o=function(e){if(e==null){return e}if(e instanceof Array){return e.map(o)}if(e.vertex!=null&&e.fragment!=null){return[o(e.vertex,o(e.fragment))]}if(e._graph!=null){return e._graph}if(e.graph!=null){return e.graph}return e};a=function(e){var t,i,r,n;n=[];for(i=0,r=e.length;i<r;i++){t=e[i];if(t instanceof Array){n=n.concat(a(t))}else if(t!=null){n.push(t)}}return n};i.visualize=function(){var e,t;t=a(o([].slice.call(arguments)));return n.merge(function(){var i,r,n;n=[];for(i=0,r=t.length;i<r;i++){e=t[i];if(e){n.push(h(e))}}return n}())};i.inspect=function(){var e,t,r,a,o,s;e=i.visualize.apply(null,arguments);r=n.overlay(e);s=document.querySelectorAll(".shadergraph-overlay");for(a=0,o=s.length;a<o;a++){t=s[a];t.remove()}document.body.appendChild(r);e.update();return r}},{"../graph":192,"./markup":204,"./serialize":205}],204:[function(e,t,i){var r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y;l=e("../factory/hash");v=function(e){return(""+e).replace(/^\s+|\s+$/g,"")};s=function(e,t,i,r){return"rgba("+[e,t,i,r].join(", ")+")"};u=function(e,t){var i,r,n,a,o,h,u;if(t==null){t=1}r=l(e)^1193046;u=r&255;n=r>>>8&255;i=r>>>16&255;a=Math.max(u,n,i);h=140/a;o=Math.round(a/3);u=Math.min(255,Math.round(h*Math.max(u,o)));n=Math.min(255,Math.round(h*Math.max(n,o)));i=Math.min(255,Math.round(h*Math.max(i,o)));return s(u,n,i,t)};h=function(e){e=e!=null?e:"";return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")};m=function(e){var t,i;i=[];t=n(e,i);t.update=function(){return o(t,i)};r(t);return t};r=function(e){var t,i,r,n,a;i=e.querySelectorAll(".shadergraph-code");a=[];for(r=0,n=i.length;r<n;r++){t=i[r];a.push(function(){var e;e=t;e.parentNode.classList.add("shadergraph-has-code");return e.parentNode.addEventListener("click",function(t){return e.style.display={block:"none",none:"block"}[e.style.display||"none"]})}())}return a};a=function(e){var t,i,r,n,a,o,s,h,l,u,c,p,f,d,m;c={};h={};f=e.nodes;for(t=0,n=f.length;t<n;t++){u=f[t];c[u.id]=u}d=e.links;for(i=0,a=d.length;i<a;i++){s=d[i];if(h[l=s.from]==null){h[l]=[]}h[s.from].push(s)}p=function(e,t){var i,r,n,a;if(t==null){t=0}e.depth=Math.max((a=e.depth)!=null?a:0,t);if(n=h[e.id]){for(i=0,r=n.length;i<r;i++){s=n[i];p(c[s.to],t+1)}}return null};m=e.nodes;for(r=0,o=m.length;r<o;r++){u=m[r];if(u.depth==null){p(u)}}return null};n=function(e,t){var i,r,o,s,l,c,p,f,d,m,g,y,E,w,b,_,x,T,R,k,H,M,S,A,C,z;a(e);z=document.createElement("div");z.classList.add("shadergraph-graph");c=[];H={};M=e.nodes;for(f=0,y=M.length;f<y;f++){R=M[f];r=document.createElement("div");r.classList.add("shadergraph-node");r.classList.add("shadergraph-node-"+R.type);r.innerHTML='<div class="shadergraph-header">'+h(R.name)+"</div>";i=function(e,t){var i,n;i=u(e.type);n=document.createElement("div");n.classList.add("shadergraph-outlet");n.classList.add("shadergraph-outlet-"+t);n.innerHTML='<div class="shadergraph-point" style="background: '+i+'"></div>\n<div class="shadergraph-type" style="color: '+i+'">'+h(e.type)+'</div>\n<div class="shadergraph-name">'+h(e.name)+"</div>";r.appendChild(n);return H[e.id]=n.querySelector(".shadergraph-point")};S=R.inputs;for(d=0,E=S.length;d<E;d++){k=S[d];i(k,"in")}A=R.outputs;for(m=0,w=A.length;m<w;m++){k=A[m];i(k,"out")}if(R.graph!=null){r.appendChild(n(R.graph,t))}else{o=document.createElement("div");o.classList.add("shadergraph-clear");r.appendChild(o)}if(R.code!=null){p=document.createElement("div");p.classList.add("shadergraph-code");p.innerHTML=h(v(R.code));r.appendChild(p)}l=c[R.depth];if(l==null){l=document.createElement("div");l.classList.add("shadergraph-column");c[R.depth]=l}l.appendChild(r)}for(g=0,b=c.length;g<b;g++){l=c[g];if(l!=null){z.appendChild(l)}}C=e.links;for(T=0,_=C.length;T<_;T++){x=C[T];s=u(x.type);t.push({color:s,out:H[x.out],in:H[x["in"]]})}return z};g=function(e){return e*e};d=function(e,t,i,r){var n,a,o,s,h,l,u,c;a=i-e;o=r-t;n=Math.sqrt(g(a)+g(o));c=Math.abs(o)>Math.abs(a);if(c){l=(e+i)/2;u=(t+r)/2;s=o>0?.3:-.3;h=Math.min(Math.abs(a)/2,20+n/8);return["M",e,t,"C",e+h,t+",",l,u-n*s,l,u,"C",l,u+n*s,i-h,r+",",i,r].join(" ")}else{h=Math.min(Math.abs(a)/2.5,20+n/4);return["M",e,t,"C",e+h,t+",",i-h,r+",",i,r].join(" ")}};c=function(e){if(e==null){e="svg"}return document.createElementNS("http://www.w3.org/2000/svg",e)};o=function(e,t){var i,r,n,a,o,s,h,l,u,p,f,m;if(e.parentNode==null){return}f=e.getBoundingClientRect();for(o=0,h=t.length;o<h;o++){p=t[o];i=p.out.getBoundingClientRect();r=p["in"].getBoundingClientRect();p.coords={x1:(i.left+i.right)/2-f.left,y1:(i.top+i.bottom)/2-f.top,x2:(r.left+r.right)/2-f.left,y2:(r.top+r.bottom)/2-f.top}}m=e.querySelector("svg");if(m!=null){e.removeChild(m)}n=e;while(n.parentNode&&n.offsetHeight===0){n=n.parentNode}m=c();m.setAttribute("width",n.offsetWidth);m.setAttribute("height",n.offsetHeight);for(s=0,l=t.length;s<l;s++){p=t[s];a=p.coords;u=c("path");u.setAttribute("d",d(a.x1,a.y1,a.x2,a.y2));u.setAttribute("stroke",p.color);u.setAttribute("stroke-width",3);u.setAttribute("fill","transparent");m.appendChild(u)}return e.appendChild(m)};f=function(e){var t,i,r,n;i=document.createElement("div");i.setAttribute("class","shadergraph-overlay");t=document.createElement("div");t.setAttribute("class","shadergraph-close");t.innerHTML="&times;";n=document.createElement("div");n.setAttribute("class","shadergraph-view");r=document.createElement("div");r.setAttribute("class","shadergraph-inside");r.appendChild(e);n.appendChild(r);i.appendChild(n);i.appendChild(t);t.addEventListener("click",function(){return i.parentNode.removeChild(i)});return i};y=function(e){var t;if(e instanceof Node){return e}t=document.createElement("span");t.innerText=e!=null?e:"";return t};p=function(e){var t,i,r,n;if(e.length!==1){t=document.createElement("div");for(r=0,n=e.length;r<n;r++){i=e[r];t.appendChild(y(i))}t.update=function(){var t,r,n;n=[];for(t=0,r=e.length;t<r;t++){i=e[t];n.push(typeof i.update==="function"?i.update():void 0)}return n};return t}else{return y(e[0])}};t.exports={process:m,merge:p,overlay:f}},{"../factory/hash":180}],205:[function(e,t,i){var r,n,a;r=e("../block");n=function(e){return e.type[0]==="("};a=function(e){var t,i,n,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R;g=[];d=[];b=e.nodes;for(n=0,u=b.length;n<u;n++){m=b[n];w={id:m.id,name:null,type:null,depth:null,graph:null,inputs:[],outputs:[]};g.push(w);o=w.inputs;E=w.outputs;t=m.owner;if(t instanceof r.Call){w.name=t.snippet._name;w.type="call";w.code=t.snippet._original}else if(t instanceof r.Callback){w.name="Callback";w.type="callback";w.graph=a(t.graph)}else if(t instanceof r.Isolate){w.name="Isolate";w.type="isolate";w.graph=a(t.graph)}else if(t instanceof r.Join){w.name="Join";w.type="join"}else if(t!=null){if(w.name==null){w.name=(_=t.name)!=null?_:t.type}if(w.type==null){w.type=t.type}if(w.code==null){w.code=t.code}if(t.graph!=null){w.graph=a(t.graph)}}i=function(e){e=e.replace(")(",")(");return e=e.replace("()","")};x=m.inputs;for(s=0,c=x.length;s<c;s++){y=x[s];o.push({id:y.id,name:y.name,type:i(y.type),open:y.input==null})}T=m.outputs;for(h=0,p=T.length;h<p;h++){y=T[h];E.push({id:y.id,name:y.name,type:i(y.type),open:!y.output.length});R=y.output;for(l=0,f=R.length;l<f;l++){v=R[l];d.push({from:m.id,out:y.id,to:v.node.id,in:v.id,type:i(y.type)})}}}return{nodes:g,links:d}};t.exports=a},{"../block":175}],206:[function(e,t,i){t.exports=e("./lib/index")},{"./lib/index":208}],207:[function(e,t,i){var r,n,a,o;var s={nud:function(){return this.children&&this.children.length?this:y("unexpected")()},led:y("missing operator")};var h={};function l(){return this}u("(ident)").nud=l;u("(keyword)").nud=l;u("(builtin)").nud=l;u("(literal)").nud=l;u("(end)");u(":");u(";");u(",");u(")");u("]");u("}");f("&&",30);f("||",30);p("|",43);p("^",44);p("&",45);p("==",46);p("!=",46);p("<",47);p("<=",47);p(">",47);p(">=",47);p(">>",48);p("<<",48);p("+",50);p("-",50);p("*",60);p("/",60);p("%",60);p("?",20,function(e){this.children=[e,c(0),(v(":"),c(0))];this.type="ternary";return this});p(".",80,function(e){n.type="literal";r.fake(n);this.children=[e,n];v();return this});p("[",80,function(e){this.children=[e,c(0)];this.type="binary";v("]");return this});p("(",80,function(e){this.children=[e];this.type="call";if(n.data!==")")while(1){this.children.push(c(0));if(n.data!==",")break;v(",")}v(")");return this});d("-");d("+");d("!");d("~");d("defined");d("(",function(){this.type="group";this.children=[c(0)];v(")");return this});d("++");d("--");m("++");m("--");g("=");g("+=");g("-=");g("*=");g("/=");g("%=");g("&=");g("|=");g("^=");g(">>=");g("<<=");t.exports=function(e,t){r=e;a=t;o=0;var i;if(!a.length)return;v();i=c(0);i.parent=r[0];n(i);if(o<a.length){throw new Error("did not use all tokens")}i.parent.children=[i];function n(e){r.unshift(e,false);for(var t=0,i=e.children.length;t<i;++t){n(e.children[t])}r.shift()}};function u(e,t){var i=h[e];t=t||0;if(i){if(t>i.lbp){i.lbp=t}}else{i=Object.create(s);i.id=e;i.lbp=t;h[e]=i}return i}function c(e){var t,i=n;v();t=i.nud();while(e<n.lbp){i=n;v();t=i.led(t)}return t}function p(e,t,i){var r=u(e,t);r.led=i||function(e){this.children=[e,c(t)];this.type="binary";return this}}function f(e,t,i){var r=u(e,t);r.led=i||function(e){this.children=[e,c(t-1)];this.type="binary";return this};return r}function d(e,t){var i=u(e);i.nud=t||function(){this.children=[c(70)];this.type="unary";return this};return i}function m(e){var t=u(e,150);t.led=function(e){this.children=[e];this.type="suffix";return this}}function g(e){return f(e,10,function(e){this.children=[e,c(9)];this.assignment=true;this.type="assign";return this})}function v(e){var t,i,s,u;if(e&&n.data!==e){return r.unexpected("expected `"+e+"`, got `"+n.data+"`")}if(o>=a.length){n=h["(end)"];return}t=a[o++];i=t.data;s=t.type;if(s==="ident"){u=r.scope.find(i)||r.create_node();s=u.type}else if(s==="builtin"){u=h["(builtin)"]}else if(s==="keyword"){u=h["(keyword)"]}else if(s==="operator"){u=h[i];if(!u){return r.unexpected("unknown operator `"+i+"`")}}else if(s==="float"||s==="integer"){s="literal";u=h["(literal)"]}else{return r.unexpected("unexpected token.")}if(u){if(!u.nud){u.nud=l}if(!u.children){u.children=[]}}u=Object.create(u);u.token=t;u.type=s;if(!u.data)u.data=i;return n=u}function y(e){return function(){return r.unexpected(e)}}},{}],208:[function(e,t,i){t.exports=Y;var r=e("../../through"),n=e("./expr"),a=e("./scope");var o=new Object;var s=false;var h=0,l=h++,u=h++,c=h++,p=h++,f=h++,d=h++,m=h++,g=h++,v=h++,y=h++,E=h++,w=h++,b=h++,_=h++,x=h++,T=h++,R=h++,k=h++,H=h++,M=h++,S=h++,A=h++,C=h++,z=h++;var P=1,L=2,O=4,D=8,F=16,B=32,U=64,N=255,V=N&~(P|L|B|D|O),I=N&~(P|D|F|U);var j=["const","attribute","uniform","varying"];var G=false,W=false;var q={"block-comment":_,"line-comment":_,preprocessor:x};var X=h=["ident","stmt","stmtlist","struct","function","functionargs","decl","decllist","forloop","whileloop","i"+"f","expr","precision","comment","preprocessor","keyword","keyword_or_ident","return","break","continue","discard","do-while","placeholder","quantifier"];function Y(){var e=Fe(c),t=Fe(u),i=Fe(g),h=Fe(b),_=Fe(l),x=Fe(R),O=Fe(f),j=Fe(d),X=Fe(v),Y=Fe(E),$=Fe(y),ee=Fe(k),te=Fe(A),ie=Fe(z);var re,ne,ae,oe,se,he,le,ue,ce,pe;var fe=r(xe,Te),de=arguments.length?[].slice.call(arguments):[],me=0,ge=[],ve=[],ye=[],Ee=false,we,be,_e;ge.shift=Me;ge.unshift=He;ge.fake=ke;ge.unexpected=je;ge.scope=new a(ge);ge.create_node=function(){var e=Z(l,be);e.parent=fe.program;return e};$e();_e=e();_e.expecting="(eof)";_e.mode=c;_e.token={type:"(program)",data:"(program)"};we=_e;fe.program=we;fe.scope=function(e){if(arguments.length===1){ge.scope=e}return ge.scope};ge.unshift(_e);return fe;function xe(e){if(e.type==="whitespace"||e.type==="line-comment"||e.type==="block-comment"){ye.push(e);return}ve.push(e);be=be||ve[0];if(be&&ye.length){be.preceding=be.preceding||[];be.preceding=be.preceding.concat(ye);ye=[]}while(Re())switch(ge[0].mode){case u:Ae();break;case c:Se();break;case m:Ce();break;case g:ze();break;case w:De();break;case p:re(true,true);break;case b:ne();break;case l:Oe();break;case T:Le();break;case R:Pe();break;case f:ce();break;case d:pe();break;case v:oe();break;case y:le();break;case A:ue();break;case k:he();break;case E:se();break;case z:ae();break}}function Te(e){if(arguments.length){xe(e)}if(ge.length>1){je("unexpected EOF");return}fe.emit("end")}function Re(){if(Ee||!ge.length)return false;return(be=ve[0])&&!fe.paused}function ke(e){ge.unshift(e);ge.shift()}function He(e,t){e.parent=ge[0];var i=[].unshift.call(this,e);t=t===undefined?true:t;if(s){var r="";for(var n=0,a=this.length-1;n<a;++n){r+=" |"}console.log(r,"\\"+e.type,e.token.data)}if(t&&_e!==e)_e.children.push(e);_e=e;return i}function Me(){var e=[].shift.call(this),t=de[this.length],i=false;if(s){var r="";for(var n=0,a=this.length;n<a;++n){r+=" |"}console.log(r,"/"+e.type)}if(de.length){if(typeof de[0]==="function"){i=de[0](e)}else if(t!==undefined){i=t.test?t.test(e.type):t===e.type}}else{i=true}if(i)fe.emit("data",e);_e=e.parent;return e}function Se(){return qe(function(){ge.scope.enter();return o},e)();function e(){if(be.data===ge[0].expecting){return ge.scope.exit(),ge.shift()}switch(be.type){case"preprocessor":ge.fake(Be());ve.shift();return;default:ge.unshift(t());return}}}function Ae(){if(ge[0].brace){if(be.data!=="}"){return je("expected `}`, got "+be.data)}ge[0].brace=false;return ve.shift(),ge.shift()}switch(be.type){case"eof":return ge.shift();case"keyword":switch(be.data){case"for":return ge.unshift(X());case"if":return ge.unshift(Y());case"while":return ge.unshift($());case"do":return ge.unshift(te());case"break":return ge.fake(Z(H,be)),ve.shift();case"continue":return ge.fake(Z(M,be)),ve.shift();case"discard":return ge.fake(Z(S,be)),ve.shift();case"return":return ge.unshift(ee());case"precision":return ge.unshift(h())}return ge.unshift(Ue(N));case"ident":var t;if(t=ge.scope.find(be.data)){if(t.parent.type==="struct"){return ge.unshift(Ue(N))}return ge.unshift(Ve(";"))}case"operator":if(be.data==="{"){ge[0].brace=true;var i=e();i.expecting="}";return ve.shift(),ge.unshift(i)}if(be.data===";"){return ve.shift(),ge.shift()}default:return ge.unshift(Ve(";"))}}function Ce(){var e=ge[0];return qe(t,r,n,a,s,h,l,u,c)();function t(){if(be.data==="invariant"){if(e.flags&D){ge.unshift(Ie());return o}else{return je("`invariant` is not allowed here")}}else{ge.fake(Z(C,{data:"",position:be.position}));return o}}function r(){if(K(be)){if(e.flags&F){ge.unshift(Ie());return o}else{return je("storage is not allowed here")}}else{ge.fake(Z(C,{data:"",position:be.position}));return o}}function n(){if(Q(be)){if(!(e.flags&B)){ge.unshift(Ie());return o}else{return je("parameter is not allowed here")}}else{ge.fake(Z(C,{data:"",position:be.position}));return o}}function a(){if(J(be)){ge.unshift(Ie());return o}else{ge.fake(Z(C,{data:"",position:be.position}));return o}}function s(){if(be.data==="struct"){if(!(e.flags&U)){return je("cannot nest structs")}ge.unshift(Ne());return o}if(be.type==="keyword"){ge.unshift(Ie());return o}var t=ge.scope.find(be.data);if(t){ge.fake(Object.create(t));ve.shift();return o}return je("expected user defined type, struct or keyword, got "+be.data)}function h(){if(be.data===","&&!(e.flags&L)){return ge.shift()}if(be.data==="["){ge.unshift(ie());return}if(be.data===")")return ge.shift();if(be.data===";"){return e.stage+3}if(be.type!=="ident"){console.log(be);return je("expected identifier, got "+be.data)}e.collected_name=ve.shift();return o}function l(){if(be.data==="("){ve.unshift(e.collected_name);delete e.collected_name;ge.unshift(O());return e.stage+2}return o}function u(){ve.unshift(e.collected_name);delete e.collected_name;ge.unshift(i());return o}function c(){return ge.shift()}}function ze(){if(be.type==="ident"){var e=be.data;ge.unshift(_());ge.scope.define(e);return}if(be.type==="operator"){if(be.data===","){if(!(ge[1].flags&L)){return ge.shift()}return ve.shift()}else if(be.data==="="){if(!(ge[1].flags&P))return je("`=` is not allowed here.");ve.shift();ge.unshift(Ve(",",";"));return}else if(be.data==="["){ge.unshift(ie());return}}return ge.shift()}function Pe(){if(be.type==="keyword"){ge[0].type="keyword";ge[0].mode=T;return}if(be.type==="ident"){ge[0].type="ident";ge[0].mode=l;return}return je("expected keyword or user-defined name, got "+be.data)}function Le(){if(be.type!=="keyword"){return je("expected keyword, got "+be.data)}return ge.shift(),ve.shift()}function Oe(){if(be.type!=="ident"){return je("expected user-defined name, got "+be.data)}ge[0].data=be.data;return ge.shift(),ve.shift()}function De(){var e=ge[0].expecting;ge[0].tokens=ge[0].tokens||[];if(ge[0].parenlevel===undefined){ge[0].parenlevel=0;ge[0].bracelevel=0}if(ge[0].parenlevel<1&&e.indexOf(be.data)>-1){return t(ge[0].tokens)}if(be.data==="("){++ge[0].parenlevel}else if(be.data===")"){--ge[0].parenlevel}switch(be.data){case"{":++ge[0].bracelevel;break;case"}":--ge[0].bracelevel;break;case"(":++ge[0].parenlevel;break;case")":--ge[0].parenlevel;break}if(ge[0].parenlevel<0)return je("unexpected `)`");if(ge[0].bracelevel<0)return je("unexpected `}`");ge[0].tokens.push(ve.shift());return;function t(e){return n(ge,e),ge.shift()}}function Fe(e){return function(){return Z(e,be)}}function Be(){return Z(q[be.type],be,_e)}function Ue(e){var t=Z(m,be,_e);t.flags=e;return t}function Ne(e,t){var i=Z(p,be,_e);i.allow_assign=e===undefined?true:e;i.allow_comma=t===undefined?true:t;return i}function Ve(){var e=Z(w,be,_e);e.expecting=[].slice.call(arguments);return e}function Ie(e){var t=be;if(e){t={type:"(implied)",data:"(default)",position:t.position}}return Z(T,t,_e)}function je(e){Ee=true;fe.emit("error",new Error((e||"unexpected "+ge)+" at line "+ge[0].token.line))}function Ge(e,t){return 1,We(e,be.type)&&We(t,be.data)}function We(e,t){switch(typeof e){case"string":if(t!==e){je("expected `"+e+"`, got "+t+"\n"+be.data)}return!Ee;case"object":if(e&&e.indexOf(t)===-1){je("expected one of `"+e.join("`, `")+"`, got "+t)}return!Ee}return true}function qe(){var e=[].slice.call(arguments),t,i;return function(){var r=ge[0];r.stage||(r.stage=0);t=e[r.stage];if(!t)return je("parser in undefined state!");i=t();if(i===o)return++r.stage;if(i===undefined)return;r.stage=i}}function Xe(e,t){t=t||"operator";return function(){if(!Ge(t,e))return;var i=ve.shift(),r=ge[0].children,n=r[r.length-1];if(n&&n.token&&i.preceding){n.token.succeeding=n.token.succeeding||[];n.token.succeeding=n.token.succeeding.concat(i.preceding)}return o}}function Ye(e){return function(){return ge.unshift(Ve(e)),o}}function Ze(e){return e?function(){var e=be.data;return Ge("ident")&&(ge.unshift(_()),ge.scope.define(e),o)}:function(){if(!Ge("ident"))return;var e=Object.create(ge.scope.find(be.data));e.token=be;return ve.shift(),o}}function Ke(){return function(){var t=e();t.expecting="}";return ge.unshift(t),o}}function Qe(e){return function(){var i=ge[0].stage;if(be.data!=="{"){return ge.unshift(t()),i+e}return ve.shift(),o}}function Je(){return function(){return ge.shift(),ge.shift()}}function $e(){re=qe(Xe("struct","keyword"),function(){if(be.data==="{"){ge.fake(Z(l,{data:"",position:be.position,type:"ident"}));return o}return Ze(true)()},function(){ge.scope.enter();return o},Xe("{"),function(){if(be.data==="}"){ge.scope.exit();ve.shift();return ge.shift()}if(be.data===";"){ve.shift();return}ge.unshift(Ue(I))});ne=qe(function(){return ve.shift(),o},function(){return Ge("keyword",["lowp","mediump","highp"])&&(ge.unshift(Ie()),o)},function(){return ge.unshift(Ie()),o},function(){return ge.shift()});ae=qe(Xe("["),Ye("]"),Xe("]"),function(){return ge.shift()});oe=qe(Xe("for","keyword"),Xe("("),function(){var e;if(be.type==="ident"){if(!(e=ge.scope.find(be.data))){e=ge.create_node()}if(e.parent.type==="struct"){return ge.unshift(Ue(N)),o}}else if(be.type==="builtin"||be.type==="keyword"){return ge.unshift(Ue(N)),o}return Ye(";")()},Xe(";"),Ye(";"),Xe(";"),Ye(")"),Xe(")"),Qe(3),Ke(),Xe("}"),Je());se=qe(Xe("if","keyword"),Xe("("),Ye(")"),Xe(")"),Qe(3),Ke(),Xe("}"),function(){if(be.data==="else"){return ve.shift(),ge.unshift(t()),o}return Je()()},Je());he=qe(Xe("return","keyword"),function(){if(be.data===";")return o;return ge.unshift(Ve(";")),o},function(){ve.shift(),Je()()});le=qe(Xe("while","keyword"),Xe("("),Ye(")"),Xe(")"),Qe(3),Ke(),Xe("}"),Je());ue=qe(Xe("do","keyword"),Qe(3),Ke(),Xe("}"),Xe("while","keyword"),Xe("("),Ye(")"),Xe(")"),Je());ce=qe(function(){for(var e=1,t=ge.length;e<t;++e)if(ge[e].mode===f){return je("function definition is not allowed within another function")}return o},function(){if(!Ge("ident"))return;var e=be.data,t=ge.scope.find(e);ge.unshift(_());ge.scope.define(e);ge.scope.enter(t?t.scope:null);return o},Xe("("),function(){return ge.unshift(j()),o},Xe(")"),function(){if(be.data===";"){return ge.scope.exit(),ge.shift(),ge.shift()}return o},Xe("{"),Ke(),Xe("}"),function(){ge.scope.exit();return o},function(){return ge.shift(),ge.shift(),ge.shift()});pe=qe(function(){if(be.data==="void"){ge.fake(Ie());ve.shift();return o}if(be.data===")"){ge.shift();return}if(be.data==="struct"){ge.unshift(Ne(G,W));return o}ge.unshift(Ue(V));return o},function(){if(be.data===","){ve.shift();return 0}if(be.data===")"){ge.shift();return}je("expected one of `,` or `)`, got "+be.data)})}}function Z(e,t){return{mode:e,token:t,children:[],type:X[e]}}function K(e){return e.data==="const"||e.data==="attribute"||e.data==="uniform"||e.data==="varying"}function Q(e){return e.data==="in"||e.data==="inout"||e.data==="out"}function J(e){return e.data==="highp"||e.data==="mediump"||e.data==="lowp"}},{"../../through":214,"./expr":207,"./scope":209}],209:[function(e,t,i){t.exports=r;function r(e){if(this.constructor!==r)return new r(e);this.state=e;this.scopes=[];this.current=null}var n=r,a=n.prototype;a.enter=function(e){this.scopes.push(this.current=this.state[0].scope=e||{})};a.exit=function(){this.scopes.pop();this.current=this.scopes[this.scopes.length-1]};a.define=function(e){this.current[e]=this.state[0]};a.find=function(e,t){for(var i=this.scopes.length-1;i>-1;--i){if(this.scopes[i].hasOwnProperty(e)){return this.scopes[i][e]}}return null}},{}],210:[function(e,t,i){t.exports=_;var r=e("../through");var n=e("./lib/literals"),a=e("./lib/operators"),o=e("./lib/builtins");var s=999,h=9999,l=0,u=1,c=2,p=3,f=4,d=5,m=6,g=7,v=8,y=9,E=10,w=11;var b=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function _(){var e=r(O,D);var t=0,i=0,_=s,x,T,R=[],k=0,H=0,M=1,S=0,A=false,C=false,z="",P;return e;function L(t){if(t.length){e.queue({type:b[_],data:t,position:S,line:M})}}function O(e){t=0;z+=e.toString();P=z.length;while(x=z[t],t<P)switch(_){case l:t=V();break;case u:t=N();break;case c:t=U();break;case p:t=I();break;case f:t=W();break;case w:t=G();break;case d:t=q();break;case h:t=X();break;case y:t=B();break;case s:t=F();break}i+=t;z=z.slice(t)}function D(t){if(R.length){L(R.join(""))}_=E;L("(eof)");e.queue(null)}function F(){R=R.length?[]:R;if(T==="/"&&x==="*"){S=i+t-1;_=l;T=x;return t+1}if(T==="/"&&x==="/"){S=i+t-1;_=u;T=x;return t+1}if(x==="#"){_=c;S=i+t;return t}if(/\s/.test(x)){_=y;S=i+t;return t}A=/\d/.test(x);C=/[^\w_]/.test(x);S=i+t;_=A?f:C?p:h;return t}function B(){if(x==="\n")++M;if(/[^\s]/g.test(x)){L(R.join(""));_=s;return t}R.push(x);T=x;return t+1}function U(){if(x==="\n")++M;if(x==="\n"&&T!=="\\"){L(R.join(""));_=s;return t}R.push(x);T=x;return t+1}function N(){return U()}function V(){if(x==="/"&&T==="*"){R.push(x);L(R.join(""));_=s;return t+1}if(x==="\n")++M;R.push(x);T=x;return t+1}function I(){if(T==="."&&/\d/.test(x)){_=d;return t}if(T==="/"&&x==="*"){_=l;return t}if(T==="/"&&x==="/"){_=u;return t}if(x==="."&&R.length){while(j(R));_=d;return t}if(x===";"){if(R.length)while(j(R));L(x);_=s;return t+1}var e=R.length===2&&x!=="=";if(/[\w_\d\s]/.test(x)||e){while(j(R));_=s;return t}R.push(x);T=x;return t+1}function j(e){var t=0,i=e.length,r;do{r=a.indexOf(e.slice(0,e.length+t).join(""));if(r===-1){t-=1;i-=1;if(i<0)return 0;continue}L(a[r]);S+=a[r].length;R=R.slice(a[r].length);return R.length}while(1)}function G(){if(/[^a-fA-F0-9]/.test(x)){L(R.join(""));_=s;return t}R.push(x);T=x;return t+1}function W(){if(x==="."){R.push(x);_=d;T=x;return t+1}if(/[eE]/.test(x)){R.push(x);_=d;T=x;return t+1}if(x==="x"&&R.length===1&&R[0]==="0"){_=w;R.push(x);T=x;return t+1}if(/[^\d]/.test(x)){L(R.join(""));_=s;return t}R.push(x);T=x;return t+1}function q(){if(x==="f"){R.push(x);T=x;t+=1}if(/[eE]/.test(x)){R.push(x);T=x;return t+1}if(/[^\d]/.test(x)){L(R.join(""));_=s;return t}R.push(x);T=x;return t+1}function X(){if(/[^\d\w_]/.test(x)){var e=R.join("");if(n.indexOf(e)>-1){_=v}else if(o.indexOf(e)>-1){_=g}else{_=m}L(R.join(""));_=s;return t}R.push(x);T=x;return t+1}}},{"../through":214,"./lib/builtins":211,"./lib/literals":212,"./lib/operators":213}],211:[function(e,t,i){t.exports=["gl_Position","gl_PointSize","gl_ClipVertex","gl_FragCoord","gl_FrontFacing","gl_FragColor","gl_FragData","gl_FragDepth","gl_Color","gl_SecondaryColor","gl_Normal","gl_Vertex","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_FogCoord","gl_MaxLights","gl_MaxClipPlanes","gl_MaxTextureUnits","gl_MaxTextureCoords","gl_MaxVertexAttribs","gl_MaxVertexUniformComponents","gl_MaxVaryingFloats","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformComponents","gl_MaxDrawBuffers","gl_ModelViewMatrix","gl_ProjectionMatrix","gl_ModelViewProjectionMatrix","gl_TextureMatrix","gl_NormalMatrix","gl_ModelViewMatrixInverse","gl_ProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverse","gl_TextureMatrixInverse","gl_ModelViewMatrixTranspose","gl_ProjectionMatrixTranspose","gl_ModelViewProjectionMatrixTranspose","gl_TextureMatrixTranspose","gl_ModelViewMatrixInverseTranspose","gl_ProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixInverseTranspose","gl_TextureMatrixInverseTranspose","gl_NormalScale","gl_DepthRangeParameters","gl_DepthRange","gl_ClipPlane","gl_PointParameters","gl_Point","gl_MaterialParameters","gl_FrontMaterial","gl_BackMaterial","gl_LightSourceParameters","gl_LightSource","gl_LightModelParameters","gl_LightModel","gl_LightModelProducts","gl_FrontLightModelProduct","gl_BackLightModelProduct","gl_LightProducts","gl_FrontLightProduct","gl_BackLightProduct","gl_FogParameters","gl_Fog","gl_TextureEnvColor","gl_EyePlaneS","gl_EyePlaneT","gl_EyePlaneR","gl_EyePlaneQ","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_ObjectPlaneR","gl_ObjectPlaneQ","gl_FrontColor","gl_BackColor","gl_FrontSecondaryColor","gl_BackSecondaryColor","gl_TexCoord","gl_FogFragCoord","gl_Color","gl_SecondaryColor","gl_TexCoord","gl_FogFragCoord","gl_PointCoord","radians","degrees","sin","cos","tan","asin","acos","atan","pow","exp","log","exp2","log2","sqrt","inversesqrt","abs","sign","floor","ceil","fract","mod","min","max","clamp","mix","step","smoothstep","length","distance","dot","cross","normalize","faceforward","reflect","refract","matrixCompMult","lessThan","lessThanEqual","greaterThan","greaterThanEqual","equal","notEqual","any","all","not","texture2D","texture2DProj","texture2DLod","texture2DProjLod","textureCube","textureCubeLod"]},{}],212:[function(e,t,i){t.exports=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","fo"+"r","whi"+"le","i"+"f","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"]},{}],213:[function(e,t,i){t.exports=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"]},{}],214:[function(e,t,i){var r;r=function(e,t){var i,r;r=[];i=[];return{output:r,parser:null,write:e,end:t,process:function(t,i){this.parser=t;e(i);this.flush();return this.parser.flush()},flush:function(){t();return[r,i]},queue:function(e){var t;if(e!=null){return(t=this.parser)!=null?t.write(e):void 0}},emit:function(e,t){if(e==="data"){if(t.parent==null){r.push(t)}}if(e==="error"){return i.push(t)}}}};t.exports=r},{}]},{},[20]);(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.katex=e()}})(function(){var e,t,i;return function e(t,i,r){function n(o,s){if(!i[o]){if(!t[o]){var h=typeof require=="function"&&require;if(!s&&h)return h(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[o]={exports:{}};t[o][0].call(u.exports,function(e){var i=t[o][1][e];return n(i?i:e)},u,u.exports,e,t,i,r)}return i[o].exports}var a=typeof require=="function"&&require;for(var o=0;o<r.length;o++)n(r[o]);return n}({1:[function(e,t,i){var r=e("./src/ParseError");var n=e("./src/Settings");var a=e("./src/buildTree");var o=e("./src/parseTree");var s=e("./src/utils");var h=function(e,t,i){s.clearNode(t);var r=new n(i);var h=o(e,r);var l=a(h,e,r).toNode();t.appendChild(l)};if(typeof document!=="undefined"){if(document.compatMode!=="CSS1Compat"){typeof console!=="undefined"&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your "+"website has a suitable doctype.");h=function(){throw new r("KaTeX doesn't work in quirks mode.")}}}var l=function(e,t){var i=new n(t);var r=o(e,i);return a(r,e,i).toMarkup()};var u=function(e,t){var i=new n(t);return o(e,i)};t.exports={render:h,renderToString:l,__parse:u,ParseError:r}},{"./src/ParseError":5,"./src/Settings":7,"./src/buildTree":12,"./src/parseTree":21,"./src/utils":23}],2:[function(e,t,i){"use strict";function r(e){if(!e.__matchAtRelocatable){var t=e.source+"|()";var i="g"+(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"");e.__matchAtRelocatable=new RegExp(t,i)}return e.__matchAtRelocatable}function n(e,t,i){if(e.global||e.sticky){throw new Error("matchAt(...): Only non-global regexes are supported")}var n=r(e);n.lastIndex=i;var a=n.exec(t);if(a[a.length-1]==null){a.length=a.length-1;return a}else{return null}}t.exports=n},{}],3:[function(e,t,i){var r=e("match-at");var n=e("./ParseError");function a(e){this._input=e}function o(e,t,i){this.text=e;this.data=t;this.position=i}var s=[/[/|@.""`0-9a-zA-Z]/,/[*+-]/,/[=<>:]/,/[,;]/,/['\^_{}]/,/[(\[]/,/[)\]?!]/,/~/,/&/,/\\\\/];var h=[/[a-zA-Z0-9`!@*()-=+\[\]'";:?\/.,]/,/[{}]/,/~/,/&/,/\\\\/];var l=/\s*/;var u=/ +|\\  +/;var c=/\\(?:[a-zA-Z]+|.)/;a.prototype._innerLex=function(e,t,i){var a=this._input;var s;if(i){s=r(l,a,e)[0];e+=s.length}else{s=r(u,a,e);if(s!==null){return new o(" ",null,e+s[0].length)}}if(e===a.length){return new o("EOF",null,e)}var h;if(h=r(c,a,e)){return new o(h[0],null,e+h[0].length)}else{for(var p=0;p<t.length;p++){var f=t[p];if(h=r(f,a,e)){return new o(h[0],null,e+h[0].length)}}}throw new n("Unexpected character: '"+a[e]+"'",this,e)};var p=/#[a-z0-9]+|[a-z]+/i;a.prototype._innerLexColor=function(e){var t=this._input;var i=r(l,t,e)[0];e+=i.length;var a;if(a=r(p,t,e)){return new o(a[0],null,e+a[0].length)}else{throw new n("Invalid color",this,e)}};var f=/(-?)\s*(\d+(?:\.\d*)?|\.\d+)\s*([a-z]{2})/;a.prototype._innerLexSize=function(e){var t=this._input;var i=r(l,t,e)[0];e+=i.length;var a;if(a=r(f,t,e)){var s=a[3];if(s!=="em"&&s!=="ex"){throw new n("Invalid unit: '"+s+"'",this,e)}return new o(a[0],{number:+(a[1]+a[2]),unit:s},e+a[0].length)}throw new n("Invalid size",this,e)};a.prototype._innerLexWhitespace=function(e){var t=this._input;var i=r(l,t,e)[0];e+=i.length;return new o(i[0],null,e)};a.prototype.lex=function(e,t){if(t==="math"){return this._innerLex(e,s,true)}else if(t==="text"){return this._innerLex(e,h,false)}else if(t==="color"){return this._innerLexColor(e)}else if(t==="size"){return this._innerLexSize(e)}else if(t==="whitespace"){return this._innerLexWhitespace(e)}};t.exports=a},{"./ParseError":5,"match-at":2}],4:[function(e,t,i){function r(e){this.style=e.style;this.color=e.color;this.size=e.size;this.phantom=e.phantom;this.font=e.font;if(e.parentStyle===undefined){this.parentStyle=e.style}else{this.parentStyle=e.parentStyle}if(e.parentSize===undefined){this.parentSize=e.size}else{this.parentSize=e.parentSize}}r.prototype.extend=function(e){var t={style:this.style,size:this.size,color:this.color,parentStyle:this.style,parentSize:this.size,phantom:this.phantom,font:this.font};for(var i in e){if(e.hasOwnProperty(i)){t[i]=e[i]}}return new r(t)};r.prototype.withStyle=function(e){return this.extend({style:e})};r.prototype.withSize=function(e){return this.extend({size:e})};r.prototype.withColor=function(e){return this.extend({color:e})};r.prototype.withPhantom=function(){return this.extend({phantom:true})};r.prototype.withFont=function(e){return this.extend({font:e})};r.prototype.reset=function(){return this.extend({})};var n={"katex-blue":"#6495ed","katex-orange":"#ffa500","katex-pink":"#ff00af","katex-red":"#df0030","katex-green":"#28ae7b","katex-gray":"gray","katex-purple":"#9d38bd","katex-blueA":"#c7e9f1","katex-blueB":"#9cdceb","katex-blueC":"#58c4dd","katex-blueD":"#29abca","katex-blueE":"#1c758a","katex-tealA":"#acead7","katex-tealB":"#76ddc0","katex-tealC":"#5cd0b3","katex-tealD":"#55c1a7","katex-tealE":"#49a88f","katex-greenA":"#c9e2ae","katex-greenB":"#a6cf8c","katex-greenC":"#83c167","katex-greenD":"#77b05d","katex-greenE":"#699c52","katex-goldA":"#f7c797","katex-goldB":"#f9b775","katex-goldC":"#f0ac5f","katex-goldD":"#e1a158","katex-goldE":"#c78d46","katex-redA":"#f7a1a3","katex-redB":"#ff8080","katex-redC":"#fc6255","katex-redD":"#e65a4c","katex-redE":"#cf5044","katex-maroonA":"#ecabc1","katex-maroonB":"#ec92ab","katex-maroonC":"#c55f73","katex-maroonD":"#a24d61","katex-maroonE":"#94424f","katex-purpleA":"#caa3e8","katex-purpleB":"#b189c6","katex-purpleC":"#9a72ac","katex-purpleD":"#715582","katex-purpleE":"#644172","katex-mintA":"#f5f9e8","katex-mintB":"#edf2df","katex-mintC":"#e0e5cc","katex-grayA":"#fdfdfd","katex-grayB":"#f7f7f7","katex-grayC":"#eeeeee","katex-grayD":"#dddddd","katex-grayE":"#cccccc","katex-grayF":"#aaaaaa","katex-grayG":"#999999","katex-grayH":"#555555","katex-grayI":"#333333","katex-kaBlue":"#314453","katex-kaGreen":"#639b24"};r.prototype.getColor=function(){if(this.phantom){return"transparent"}else{return n[this.color]||this.color}};t.exports=r},{}],5:[function(e,t,i){function r(e,t,i){var n="KaTeX parse error: "+e;if(t!==undefined&&i!==undefined){n+=" at position "+i+": ";var a=t._input;a=a.slice(0,i)+""+a.slice(i);var o=Math.max(0,i-15);var s=i+15;n+=a.slice(o,s)}var h=new Error(n);h.name="ParseError";h.__proto__=r.prototype;h.position=i;return h}r.prototype.__proto__=Error.prototype;t.exports=r},{}],6:[function(e,t,i){var r=e("./functions");var n=e("./environments");var a=e("./Lexer");var o=e("./symbols");var s=e("./utils");var h=e("./parseData");var l=e("./ParseError");function u(e,t){this.lexer=new a(e);this.settings=t}var c=h.ParseNode;var p=h.ParseResult;function f(e,t){this.result=e;this.isFunction=t}u.prototype.expect=function(e,t){if(e.text!==t){throw new l("Expected '"+t+"', got '"+e.text+"'",this.lexer,e.position)}};u.prototype.parse=function(e){var t=this.parseInput(0,"math");return t.result};u.prototype.parseInput=function(e,t){var i=this.parseExpression(e,t,false);this.expect(i.peek,"EOF");return i};var d=["}","\\end","\\right","&","\\\\","\\cr"];u.prototype.parseExpression=function(e,t,i,r){var n=[];var a=null;while(true){a=this.lexer.lex(e,t);if(d.indexOf(a.text)!==-1){break}if(r&&a.text===r){break}var o=this.parseAtom(e,t);if(!o){if(!this.settings.throwOnError&&a.text[0]==="\\"){var s=this.handleUnsupportedCmd(a.text,t);n.push(s);e=a.position;continue}break}if(i&&o.result.type==="infix"){break}n.push(o.result);e=o.position}var h=new p(this.handleInfixNodes(n,t),e);h.peek=a;return h};u.prototype.handleInfixNodes=function(e,t){var i=-1;var n;var a;for(var o=0;o<e.length;o++){var s=e[o];if(s.type==="infix"){if(i!==-1){throw new l("only one infix operator per group",this.lexer,-1)}i=o;a=s.value.replaceWith;n=r.funcs[a]}}if(i!==-1){var h,u;var p=e.slice(0,i);var f=e.slice(i+1);if(p.length===1&&p[0].type==="ordgroup"){h=p[0]}else{h=new c("ordgroup",p,t)}if(f.length===1&&f[0].type==="ordgroup"){u=f[0]}else{u=new c("ordgroup",f,t)}var d=n.handler(a,h,u);return[new c(d.type,d,t)]}else{return e}};var m=1;u.prototype.handleSupSubscript=function(e,t,i,n){var a=this.parseGroup(e,t);if(!a){var o=this.lexer.lex(e,t);if(!this.settings.throwOnError&&o.text[0]==="\\"){return new p(this.handleUnsupportedCmd(o.text,t),o.position)}else{throw new l("Expected group after '"+i+"'",this.lexer,e)}}else if(a.isFunction){var s=r.funcs[a.result.result].greediness;if(s>m){return this.parseFunction(e,t)}else{throw new l("Got function '"+a.result.result+"' with no arguments "+"as "+n,this.lexer,e)}}else{return a.result}};u.prototype.handleUnsupportedCmd=function(e,t){var i=[];for(var r=0;r<e.length;r++){i.push(new c("textord",e[r],"text"))}var n=new c("text",{body:i,type:"text"},t);var a=new c("color",{color:this.settings.errorColor,value:[n],type:"color"},t);return a};u.prototype.parseAtom=function(e,t){var i=this.parseImplicitGroup(e,t);if(t==="text"){return i}var r;if(!i){r=e;i=undefined}else{r=i.position}var n;var a;var o;while(true){var s=this.lexer.lex(r,t);if(s.text==="\\limits"||s.text==="\\nolimits"){if(!i||i.result.type!=="op"){throw new l("Limit controls must follow a math operator",this.lexer,r)}else{var h=s.text==="\\limits";i.result.value.limits=h;i.result.value.alwaysHandleSupSub=true;r=s.position}}else if(s.text==="^"){if(n){throw new l("Double superscript",this.lexer,r)}o=this.handleSupSubscript(s.position,t,s.text,"superscript");r=o.position;n=o.result}else if(s.text==="_"){if(a){throw new l("Double subscript",this.lexer,r)}o=this.handleSupSubscript(s.position,t,s.text,"subscript");r=o.position;a=o.result}else if(s.text==="'"){var u=new c("textord","\\prime",t);var f=[u];r=s.position;while((s=this.lexer.lex(r,t)).text==="'"){f.push(u);r=s.position}n=new c("ordgroup",f,t)}else{break}}if(n||a){return new p(new c("supsub",{base:i&&i.result,sup:n,sub:a},t),r)}else{return i}};var g=["\\tiny","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"];var v=["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"];u.prototype.parseImplicitGroup=function(e,t){var i=this.parseSymbol(e,t);if(!i||!i.result){return this.parseFunction(e,t)}var r=i.result.result;var a;if(r==="\\left"){var o=this.parseFunction(e,t);a=this.parseExpression(o.position,t,false);this.expect(a.peek,"\\right");var h=this.parseFunction(a.position,t);return new p(new c("leftright",{body:a.result,left:o.result.value.value,right:h.result.value.value},t),h.position)}else if(r==="\\begin"){var u=this.parseFunction(e,t);var f=u.result.value.name;if(!n.hasOwnProperty(f)){throw new l("No such environment: "+f,this.lexer,u.result.value.namepos)}var d=n[f];var m=[null,t,f];var y=this.parseArguments(u.position,t,"\\begin{"+f+"}",d,m);m[0]=y;var E=d.handler.apply(this,m);var w=this.lexer.lex(E.position,t);this.expect(w,"\\end");var b=this.parseFunction(E.position,t);if(b.result.value.name!==f){throw new l("Mismatch: \\begin{"+f+"} matched "+"by \\end{"+b.result.value.name+"}",this.lexer,b.namepos)}E.position=b.position;return E}else if(s.contains(g,r)){a=this.parseExpression(i.result.position,t,false);return new p(new c("sizing",{size:"size"+(s.indexOf(g,r)+1),value:a.result},t),a.position)}else if(s.contains(v,r)){a=this.parseExpression(i.result.position,t,true);return new p(new c("styling",{style:r.slice(1,r.length-5),value:a.result},t),a.position)}else{return this.parseFunction(e,t)}};u.prototype.parseFunction=function(e,t){var i=this.parseGroup(e,t);if(i){if(i.isFunction){var n=i.result.result;var a=r.funcs[n];if(t==="text"&&!a.allowedInText){throw new l("Can't use function '"+n+"' in text mode",this.lexer,i.position)}var o=[n];var s=this.parseArguments(i.result.position,t,n,a,o);var h=r.funcs[n].handler.apply(this,o);return new p(new c(h.type,h,t),s)}else{return i.result}}else{return null}};u.prototype.parseArguments=function(e,t,i,n,a){var o=n.numArgs+n.numOptionalArgs;if(o===0){return e}var s=e;var h=n.greediness;var u=[s];for(var c=0;c<o;c++){var d=n.argTypes&&n.argTypes[c];var m;if(c<n.numOptionalArgs){if(d){m=this.parseSpecialGroup(s,d,t,true)}else{m=this.parseOptionalGroup(s,t)}if(!m){a.push(null);u.push(s);continue}}else{if(d){m=this.parseSpecialGroup(s,d,t)}else{m=this.parseGroup(s,t)}if(!m){var g=this.lexer.lex(s,t);if(!this.settings.throwOnError&&g.text[0]==="\\"){m=new f(new p(this.handleUnsupportedCmd(g.text,t),g.position),false)}else{throw new l("Expected group after '"+i+"'",this.lexer,e)}}}var v;if(m.isFunction){var y=r.funcs[m.result.result].greediness;if(y>h){v=this.parseFunction(s,t)}else{throw new l("Got function '"+m.result.result+"' as "+"argument to '"+i+"'",this.lexer,m.result.position-1)}}else{v=m.result}a.push(v.result);u.push(v.position);s=v.position}a.push(u);return s};u.prototype.parseSpecialGroup=function(e,t,i,r){if(t==="original"){t=i}if(t==="color"||t==="size"){var n=this.lexer.lex(e,i);if(r&&n.text!=="["){return null}this.expect(n,r?"[":"{");var a=this.lexer.lex(n.position,t);var o;if(t==="color"){o=a.text}else{o=a.data}var s=this.lexer.lex(a.position,i);this.expect(s,r?"]":"}");return new f(new p(new c(t,o,i),s.position),false)}else if(t==="text"){var h=this.lexer.lex(e,"whitespace");e=h.position}if(r){return this.parseOptionalGroup(e,t)}else{return this.parseGroup(e,t)}};u.prototype.parseGroup=function(e,t){var i=this.lexer.lex(e,t);if(i.text==="{"){var r=this.parseExpression(i.position,t,false);var n=this.lexer.lex(r.position,t);this.expect(n,"}");return new f(new p(new c("ordgroup",r.result,t),n.position),false)}else{return this.parseSymbol(e,t)}};u.prototype.parseOptionalGroup=function(e,t){var i=this.lexer.lex(e,t);if(i.text==="["){var r=this.parseExpression(i.position,t,false,"]");var n=this.lexer.lex(r.position,t);this.expect(n,"]");return new f(new p(new c("ordgroup",r.result,t),n.position),false)}else{return null}};u.prototype.parseSymbol=function(e,t){var i=this.lexer.lex(e,t);if(r.funcs[i.text]){return new f(new p(i.text,i.position),true)}else if(o[t][i.text]){return new f(new p(new c(o[t][i.text].group,i.text,t),i.position),false)}else{return null}};u.prototype.ParseNode=c;t.exports=u},{"./Lexer":3,"./ParseError":5,"./environments":15,"./functions":18,"./parseData":20,"./symbols":22,"./utils":23}],7:[function(e,t,i){function r(e,t){return e===undefined?t:e}function n(e){e=e||{};this.displayMode=r(e.displayMode,false);this.throwOnError=r(e.throwOnError,true);this.errorColor=r(e.errorColor,"#cc0000")}t.exports=n},{}],8:[function(e,t,i){function r(e,t,i,r){this.id=e;this.size=t;this.cramped=r;this.sizeMultiplier=i}r.prototype.sup=function(){return d[m[this.id]]};r.prototype.sub=function(){return d[g[this.id]]};r.prototype.fracNum=function(){return d[v[this.id]]};r.prototype.fracDen=function(){return d[y[this.id]]};r.prototype.cramp=function(){return d[E[this.id]]};r.prototype.cls=function(){return p[this.size]+(this.cramped?" cramped":" uncramped")};r.prototype.reset=function(){return f[this.size]};var n=0;var a=1;var o=2;var s=3;var h=4;var l=5;var u=6;var c=7;var p=["displaystyle textstyle","textstyle","scriptstyle","scriptscriptstyle"];var f=["reset-textstyle","reset-textstyle","reset-scriptstyle","reset-scriptscriptstyle"];var d=[new r(n,0,1,false),new r(a,0,1,true),new r(o,1,1,false),new r(s,1,1,true),new r(h,2,.7,false),new r(l,2,.7,true),new r(u,3,.5,false),new r(c,3,.5,true)];var m=[h,l,h,l,u,c,u,c];var g=[l,l,l,l,c,c,c,c];var v=[o,s,h,l,u,c,u,c];var y=[s,s,l,l,c,c,c,c];var E=[a,a,s,s,l,l,c,c];t.exports={DISPLAY:d[n],TEXT:d[o],SCRIPT:d[h],SCRIPTSCRIPT:d[u]}},{}],9:[function(e,t,i){var r=e("./domTree");var n=e("./fontMetrics");var a=e("./symbols");var o=e("./utils");var s=["\\Gamma","\\Delta","\\Theta","\\Lambda","\\Xi","\\Pi","\\Sigma","\\Upsilon","\\Phi","\\Psi","\\Omega"];var h=["",""];var l=function(e,t,i,o,s){if(a[i][e]&&a[i][e].replace){e=a[i][e].replace}var h=n.getCharacterMetrics(e,t);var l;if(h){l=new r.symbolNode(e,h.height,h.depth,h.italic,h.skew,s)}else{typeof console!=="undefined"&&console.warn("No character metrics for '"+e+"' in style '"+t+"'");l=new r.symbolNode(e,0,0,0,0,s)}if(o){l.style.color=o}return l};var u=function(e,t,i,r){if(e==="\\"||a[t][e].font==="main"){return l(e,"Main-Regular",t,i,r)}else{return l(e,"AMS-Regular",t,i,r.concat(["amsrm"]))}};var c=function(e,t,i,r,n){if(n==="mathord"){return p(e,t,i,r)}else if(n==="textord"){return l(e,"Main-Regular",t,i,r.concat(["mathrm"]))}else{throw new Error("unexpected type: "+n+" in mathDefault")}};var p=function(e,t,i,r){if(/[0-9]/.test(e.charAt(0))||o.contains(h,e)||o.contains(s,e)){return l(e,"Main-Italic",t,i,r.concat(["mainit"]))}else{return l(e,"Math-Italic",t,i,r.concat(["mathit"]))}};var f=function(e,t,i){var r=e.mode;var s=e.value;if(a[r][s]&&a[r][s].replace){s=a[r][s].replace}var u=["mord"];var f=t.getColor();var d=t.font;if(d){if(d==="mathit"||o.contains(h,s)){return p(s,r,f,u)}else{var m=b[d].fontName;if(n.getCharacterMetrics(s,m)){return l(s,m,r,f,u.concat([d]))}else{return c(s,r,f,u,i)}}}else{return c(s,r,f,u,i)}};var d=function(e){var t=0;var i=0;var r=0;if(e.children){for(var n=0;n<e.children.length;n++){if(e.children[n].height>t){t=e.children[n].height}if(e.children[n].depth>i){i=e.children[n].depth}if(e.children[n].maxFontSize>r){r=e.children[n].maxFontSize}}}e.height=t;e.depth=i;e.maxFontSize=r};var m=function(e,t,i){var n=new r.span(e,t);d(n);if(i){n.style.color=i}return n};var g=function(e){var t=new r.documentFragment(e);d(t);return t};var v=function(e,t){var i=m([],[new r.symbolNode("")]);i.style.fontSize=t/e.style.sizeMultiplier+"em";var n=m(["fontsize-ensurer","reset-"+e.size,"size5"],[i]);return n};var y=function(e,t,i,n){var a;var o;var s;if(t==="individualShift"){var h=e;e=[h[0]];a=-h[0].shift-h[0].elem.depth;o=a;for(s=1;s<h.length;s++){var l=-h[s].shift-o-h[s].elem.depth;var u=l-(h[s-1].elem.height+h[s-1].elem.depth);o=o+l;e.push({type:"kern",size:u});e.push(h[s])}}else if(t==="top"){var c=i;for(s=0;s<e.length;s++){if(e[s].type==="kern"){c-=e[s].size}else{c-=e[s].elem.height+e[s].elem.depth}}a=c}else if(t==="bottom"){a=-i}else if(t==="shift"){a=-e[0].elem.depth-i}else if(t==="firstBaseline"){a=-e[0].elem.depth}else{a=0}var p=0;for(s=0;s<e.length;s++){if(e[s].type==="elem"){p=Math.max(p,e[s].elem.maxFontSize)}}var f=v(n,p);var d=[];o=a;for(s=0;s<e.length;s++){if(e[s].type==="kern"){o+=e[s].size}else{var g=e[s].elem;var y=-g.depth-o;o+=g.height+g.depth;var E=m([],[f,g]);E.height-=y;E.depth+=y;E.style.top=y+"em";d.push(E)}}var w=m(["baseline-fix"],[f,new r.symbolNode("")]);d.push(w);var b=m(["vlist"],d);b.height=Math.max(o,b.height);b.depth=Math.max(-a,b.depth);return b};var E={size1:.5,size2:.7,size3:.8,size4:.9,size5:1,size6:1.2,size7:1.44,size8:1.73,size9:2.07,size10:2.49};var w={"\\qquad":{size:"2em",className:"qquad"},"\\quad":{size:"1em",className:"quad"},"\\enspace":{size:"0.5em",className:"enspace"},"\\;":{size:"0.277778em",className:"thickspace"},"\\:":{size:"0.22222em",className:"mediumspace"},"\\,":{size:"0.16667em",className:"thinspace"},"\\!":{size:"-0.16667em",className:"negativethinspace"}};var b={mathbf:{variant:"bold",fontName:"Main-Bold"},mathrm:{variant:"normal",fontName:"Main-Regular"},mathbb:{variant:"double-struck",fontName:"AMS-Regular"},mathcal:{variant:"script",fontName:"Caligraphic-Regular"},mathfrak:{variant:"fraktur",fontName:"Fraktur-Regular"},mathscr:{variant:"script",fontName:"Script-Regular"},mathsf:{variant:"sans-serif",fontName:"SansSerif-Regular"},mathtt:{variant:"monospace",fontName:"Typewriter-Regular"}};t.exports={fontMap:b,makeSymbol:l,mathsym:u,makeSpan:m,makeFragment:g,makeVList:y,makeOrd:f,sizingMultiplier:E,spacingFunctions:w}},{"./domTree":14,"./fontMetrics":16,"./symbols":22,"./utils":23}],10:[function(e,t,i){var r=e("./ParseError");var n=e("./Style");var a=e("./buildCommon");var o=e("./delimiter");var s=e("./domTree");var h=e("./fontMetrics");var l=e("./utils");var u=a.makeSpan;var c=function(e,t,i){var r=[];for(var n=0;n<e.length;n++){var a=e[n];r.push(E(a,t,i));i=a}return r};var p={mathord:"mord",textord:"mord",bin:"mbin",rel:"mrel",text:"mord",open:"mopen",close:"mclose",inner:"minner",genfrac:"mord",array:"mord",spacing:"mord",punct:"mpunct",ordgroup:"mord",op:"mop",katex:"mord",overline:"mord",rule:"mord",leftright:"minner",sqrt:"mord",accent:"mord"};var f=function(e){if(e==null){return p.mathord}else if(e.type==="supsub"){return f(e.value.base)}else if(e.type==="llap"||e.type==="rlap"){return f(e.value)}else if(e.type==="color"){return f(e.value.value)}else if(e.type==="sizing"){return f(e.value.value)}else if(e.type==="styling"){return f(e.value.value)}else if(e.type==="delimsizing"){return p[e.value.delimType]}else{return p[e.type]}};var d=function(e,t){if(!e){return false}else if(e.type==="op"){return e.value.limits&&(t.style.size===n.DISPLAY.size||e.value.alwaysHandleSupSub)}else if(e.type==="accent"){return g(e.value.base)}else{return null}};var m=function(e){if(!e){return false}else if(e.type==="ordgroup"){if(e.value.length===1){return m(e.value[0])}else{return e}}else if(e.type==="color"){if(e.value.value.length===1){return m(e.value.value[0])}else{return e}}else{return e}};var g=function(e){var t=m(e);return t.type==="mathord"||t.type==="textord"||t.type==="bin"||t.type==="rel"||t.type==="inner"||t.type==="open"||t.type==="close"||t.type==="punct"};var v=function(e){return u(["sizing","reset-"+e.size,"size5",e.style.reset(),n.TEXT.cls(),"nulldelimiter"])};var y={mathord:function(e,t,i){return a.makeOrd(e,t,"mathord")},textord:function(e,t,i){return a.makeOrd(e,t,"textord")},bin:function(e,t,i){var r="mbin";var n=i;while(n&&n.type==="color"){var o=n.value.value;n=o[o.length-1]}if(!i||l.contains(["mbin","mopen","mrel","mop","mpunct"],f(n))){e.type="textord";r="mord"}return a.mathsym(e.value,e.mode,t.getColor(),[r])},rel:function(e,t,i){return a.mathsym(e.value,e.mode,t.getColor(),["mrel"])},open:function(e,t,i){return a.mathsym(e.value,e.mode,t.getColor(),["mopen"])},close:function(e,t,i){return a.mathsym(e.value,e.mode,t.getColor(),["mclose"])},inner:function(e,t,i){return a.mathsym(e.value,e.mode,t.getColor(),["minner"])},punct:function(e,t,i){return a.mathsym(e.value,e.mode,t.getColor(),["mpunct"])},ordgroup:function(e,t,i){return u(["mord",t.style.cls()],c(e.value,t.reset()))},text:function(e,t,i){return u(["text","mord",t.style.cls()],c(e.value.body,t.reset()))},color:function(e,t,i){var r=c(e.value.value,t.withColor(e.value.color),i);return new a.makeFragment(r)},supsub:function(e,t,i){if(d(e.value.base,t)){return y[e.value.base.type](e,t,i)}var r=E(e.value.base,t.reset());var o,l,c,p;if(e.value.sup){c=E(e.value.sup,t.withStyle(t.style.sup()));o=u([t.style.reset(),t.style.sup().cls()],[c])}if(e.value.sub){p=E(e.value.sub,t.withStyle(t.style.sub()));l=u([t.style.reset(),t.style.sub().cls()],[p])}var m,v;if(g(e.value.base)){m=0;v=0}else{m=r.height-h.metrics.supDrop;v=r.depth+h.metrics.subDrop}var w;if(t.style===n.DISPLAY){w=h.metrics.sup1}else if(t.style.cramped){w=h.metrics.sup3}else{w=h.metrics.sup2}var b=n.TEXT.sizeMultiplier*t.style.sizeMultiplier;var _=.5/h.metrics.ptPerEm/b+"em";var x;if(!e.value.sup){v=Math.max(v,h.metrics.sub1,p.height-.8*h.metrics.xHeight);x=a.makeVList([{type:"elem",elem:l}],"shift",v,t);x.children[0].style.marginRight=_;if(r instanceof s.symbolNode){x.children[0].style.marginLeft=-r.italic+"em"}}else if(!e.value.sub){m=Math.max(m,w,c.depth+.25*h.metrics.xHeight);x=a.makeVList([{type:"elem",elem:o}],"shift",-m,t);x.children[0].style.marginRight=_}else{m=Math.max(m,w,c.depth+.25*h.metrics.xHeight);v=Math.max(v,h.metrics.sub2);var T=h.metrics.defaultRuleThickness;if(m-c.depth-(p.height-v)<4*T){v=4*T-(m-c.depth)+p.height;var R=.8*h.metrics.xHeight-(m-c.depth);if(R>0){m+=R;v-=R}}x=a.makeVList([{type:"elem",elem:l,shift:v},{type:"elem",elem:o,shift:-m}],"individualShift",null,t);if(r instanceof s.symbolNode){x.children[0].style.marginLeft=-r.italic+"em"}x.children[0].style.marginRight=_;x.children[1].style.marginRight=_}return u([f(e.value.base)],[r,x])},genfrac:function(e,t,i){var r=t.style;if(e.value.size==="display"){r=n.DISPLAY}else if(e.value.size==="text"){r=n.TEXT}var s=r.fracNum();var l=r.fracDen();var c=E(e.value.numer,t.withStyle(s));var p=u([r.reset(),s.cls()],[c]);var f=E(e.value.denom,t.withStyle(l));var d=u([r.reset(),l.cls()],[f]);var m;if(e.value.hasBarLine){m=h.metrics.defaultRuleThickness/t.style.sizeMultiplier}else{m=0}var g;var y;var w;if(r.size===n.DISPLAY.size){g=h.metrics.num1;if(m>0){y=3*m}else{y=7*h.metrics.defaultRuleThickness}w=h.metrics.denom1}else{if(m>0){g=h.metrics.num2;y=m}else{g=h.metrics.num3;y=3*h.metrics.defaultRuleThickness}w=h.metrics.denom2}var b;if(m===0){var _=g-c.depth-(f.height-w);if(_<y){g+=.5*(y-_);w+=.5*(y-_)}b=a.makeVList([{type:"elem",elem:d,shift:w},{type:"elem",elem:p,shift:-g}],"individualShift",null,t)}else{var x=h.metrics.axisHeight;if(g-c.depth-(x+.5*m)<y){g+=y-(g-c.depth-(x+.5*m))}if(x-.5*m-(f.height-w)<y){w+=y-(x-.5*m-(f.height-w))}var T=u([t.style.reset(),n.TEXT.cls(),"frac-line"]);T.height=m;var R=-(x-.5*m);b=a.makeVList([{type:"elem",elem:d,shift:w},{type:"elem",elem:T,shift:R},{type:"elem",elem:p,shift:-g}],"individualShift",null,t)}b.height*=r.sizeMultiplier/t.style.sizeMultiplier;b.depth*=r.sizeMultiplier/t.style.sizeMultiplier;var k;if(r.size===n.DISPLAY.size){k=h.metrics.delim1}else{k=h.metrics.getDelim2(r)}var H,M;if(e.value.leftDelim==null){H=v(t)}else{H=o.customSizedDelim(e.value.leftDelim,k,true,t.withStyle(r),e.mode)}if(e.value.rightDelim==null){M=v(t)}else{M=o.customSizedDelim(e.value.rightDelim,k,true,t.withStyle(r),e.mode)}return u(["mord",t.style.reset(),r.cls()],[H,u(["mfrac"],[b]),M],t.getColor())},array:function(e,t,i){var n,o;var s=e.value.body.length;var c=0;var p=new Array(s);var f=1/h.metrics.ptPerEm;var d=5*f;var m=12*f;var g=l.deflt(e.value.arraystretch,1);var v=g*m;var y=.7*v;var w=.3*v;var b=0;for(n=0;n<e.value.body.length;++n){var _=e.value.body[n];var x=y;var T=w;if(c<_.length){c=_.length}var R=new Array(_.length);for(o=0;o<_.length;++o){var k=E(_[o],t);if(T<k.depth){T=k.depth}if(x<k.height){x=k.height}R[o]=k}var H=0;if(e.value.rowGaps[n]){H=e.value.rowGaps[n].value;switch(H.unit){case"em":H=H.number;break;case"ex":H=H.number*h.metrics.emPerEx;break;default:console.error("Can't handle unit "+H.unit);H=0}if(H>0){H+=w;if(T<H){T=H}H=0}}R.height=x;R.depth=T;b+=x;R.pos=b;b+=T+H;p[n]=R}var M=b/2+h.metrics.axisHeight;var S=e.value.cols||[];var A=[];var C;var z;for(o=0,z=0;o<c||z<S.length;++o,++z){var P=S[z]||{};var L=true;while(P.type==="separator"){if(!L){C=u(["arraycolsep"],[]);C.style.width=h.metrics.doubleRuleSep+"em";A.push(C)}if(P.separator==="|"){var O=u(["vertical-separator"],[]);O.style.height=b+"em";O.style.verticalAlign=-(b-M)+"em";A.push(O)}else{throw new r("Invalid separator type: "+P.separator)}z++;P=S[z]||{};L=false}if(o>=c){continue}var D;if(o>0||e.value.hskipBeforeAndAfter){D=l.deflt(P.pregap,d);if(D!==0){C=u(["arraycolsep"],[]);C.style.width=D+"em";A.push(C)}}var F=[];for(n=0;n<s;++n){var B=p[n];var U=B[o];if(!U){continue}var N=B.pos-M;U.depth=B.depth;U.height=B.height;F.push({type:"elem",elem:U,shift:N})}F=a.makeVList(F,"individualShift",null,t);F=u(["col-align-"+(P.align||"c")],[F]);A.push(F);if(o<c-1||e.value.hskipBeforeAndAfter){D=l.deflt(P.postgap,d);if(D!==0){C=u(["arraycolsep"],[]);C.style.width=D+"em";A.push(C)}}}p=u(["mtable"],A);return u(["mord"],[p],t.getColor())},spacing:function(e,t,i){if(e.value==="\\ "||e.value==="\\space"||e.value===" "||e.value==="~"){return u(["mord","mspace"],[a.mathsym(e.value,e.mode)])}else{return u(["mord","mspace",a.spacingFunctions[e.value].className])}},llap:function(e,t,i){var r=u(["inner"],[E(e.value.body,t.reset())]);var n=u(["fix"],[]);return u(["llap",t.style.cls()],[r,n])},rlap:function(e,t,i){var r=u(["inner"],[E(e.value.body,t.reset())]);var n=u(["fix"],[]);return u(["rlap",t.style.cls()],[r,n])},op:function(e,t,i){var r;var o;var s=false;if(e.type==="supsub"){r=e.value.sup;o=e.value.sub;e=e.value.base;s=true}var c=["\\smallint"];var p=false;if(t.style.size===n.DISPLAY.size&&e.value.symbol&&!l.contains(c,e.value.body)){p=true}var f;var d=0;var m=0;if(e.value.symbol){var g=p?"Size2-Regular":"Size1-Regular";f=a.makeSymbol(e.value.body,g,"math",t.getColor(),["op-symbol",p?"large-op":"small-op","mop"]);d=(f.height-f.depth)/2-h.metrics.axisHeight*t.style.sizeMultiplier;m=f.italic}else{var v=[];for(var y=1;y<e.value.body.length;y++){v.push(a.mathsym(e.value.body[y],e.mode))}f=u(["mop"],v,t.getColor())}if(s){f=u([],[f]);var w,b,_,x;if(r){var T=E(r,t.withStyle(t.style.sup()));w=u([t.style.reset(),t.style.sup().cls()],[T]);b=Math.max(h.metrics.bigOpSpacing1,h.metrics.bigOpSpacing3-T.depth)}if(o){var R=E(o,t.withStyle(t.style.sub()));_=u([t.style.reset(),t.style.sub().cls()],[R]);x=Math.max(h.metrics.bigOpSpacing2,h.metrics.bigOpSpacing4-R.height)}var k,H,M;if(!r){H=f.height-d;k=a.makeVList([{type:"kern",size:h.metrics.bigOpSpacing5},{type:"elem",elem:_},{type:"kern",size:x},{type:"elem",elem:f}],"top",H,t);k.children[0].style.marginLeft=-m+"em"}else if(!o){M=f.depth+d;k=a.makeVList([{type:"elem",elem:f},{type:"kern",size:b},{type:"elem",elem:w},{type:"kern",size:h.metrics.bigOpSpacing5}],"bottom",M,t);k.children[1].style.marginLeft=m+"em"}else if(!r&&!o){return f}else{M=h.metrics.bigOpSpacing5+_.height+_.depth+x+f.depth+d;k=a.makeVList([{type:"kern",size:h.metrics.bigOpSpacing5},{type:"elem",elem:_},{type:"kern",size:x},{type:"elem",elem:f},{type:"kern",size:b},{type:"elem",elem:w},{type:"kern",size:h.metrics.bigOpSpacing5}],"bottom",M,t);k.children[0].style.marginLeft=-m+"em";k.children[2].style.marginLeft=m+"em"}return u(["mop","op-limits"],[k])}else{if(e.value.symbol){f.style.top=d+"em"}return f}},katex:function(e,t,i){var r=u(["k"],[a.mathsym("K",e.mode)]);var n=u(["a"],[a.mathsym("A",e.mode)]);n.height=(n.height+.2)*.75;n.depth=(n.height-.2)*.75;var o=u(["t"],[a.mathsym("T",e.mode)]);var s=u(["e"],[a.mathsym("E",e.mode)]);s.height=s.height-.2155;s.depth=s.depth+.2155;var h=u(["x"],[a.mathsym("X",e.mode)]);return u(["katex-logo","mord"],[r,n,o,s,h],t.getColor())},overline:function(e,t,i){var r=E(e.value.body,t.withStyle(t.style.cramp()));var o=h.metrics.defaultRuleThickness/t.style.sizeMultiplier;var s=u([t.style.reset(),n.TEXT.cls(),"overline-line"]);s.height=o;s.maxFontSize=1;var l=a.makeVList([{type:"elem",elem:r},{type:"kern",size:3*o},{type:"elem",elem:s},{type:"kern",size:o}],"firstBaseline",null,t);return u(["overline","mord"],[l],t.getColor())},sqrt:function(e,t,i){var r=E(e.value.body,t.withStyle(t.style.cramp()));var s=h.metrics.defaultRuleThickness/t.style.sizeMultiplier;var l=u([t.style.reset(),n.TEXT.cls(),"sqrt-line"],[],t.getColor());l.height=s;l.maxFontSize=1;var c=s;if(t.style.id<n.TEXT.id){c=h.metrics.xHeight}var p=s+c/4;var f=(r.height+r.depth)*t.style.sizeMultiplier;var d=f+p+s;var m=u(["sqrt-sign"],[o.customSizedDelim("\\surd",d,false,t,e.mode)],t.getColor());var g=m.height+m.depth-s;if(g>r.height+r.depth+p){p=(p+g-r.height-r.depth)/2}var v=-(r.height+p+s)+m.height;m.style.top=v+"em";m.height-=v;m.depth+=v;var y;if(r.height===0&&r.depth===0){y=u()}else{y=a.makeVList([{type:"elem",elem:r},{type:"kern",size:p},{type:"elem",elem:l},{type:"kern",size:s}],"firstBaseline",null,t)}if(!e.value.index){return u(["sqrt","mord"],[m,y])}else{var w=E(e.value.index,t.withStyle(n.SCRIPTSCRIPT));var b=u([t.style.reset(),n.SCRIPTSCRIPT.cls()],[w]);var _=Math.max(m.height,y.height);var x=Math.max(m.depth,y.depth);var T=.6*(_-x);var R=a.makeVList([{type:"elem",elem:b}],"shift",-T,t);var k=u(["root"],[R]);return u(["sqrt","mord"],[k,m,y])}},sizing:function(e,t,i){var r=c(e.value.value,t.withSize(e.value.size),i);var n=u(["mord"],[u(["sizing","reset-"+t.size,e.value.size,t.style.cls()],r)]);var o=a.sizingMultiplier[e.value.size];n.maxFontSize=o*t.style.sizeMultiplier;return n},styling:function(e,t,i){var r={display:n.DISPLAY,text:n.TEXT,script:n.SCRIPT,scriptscript:n.SCRIPTSCRIPT};var a=r[e.value.style];var o=c(e.value.value,t.withStyle(a),i);return u([t.style.reset(),a.cls()],o)},font:function(e,t,i){var r=e.value.font;return E(e.value.body,t.withFont(r),i)},delimsizing:function(e,t,i){var r=e.value.value;if(r==="."){return u([p[e.value.delimType]])}return u([p[e.value.delimType]],[o.sizedDelim(r,e.value.size,t,e.mode)])},leftright:function(e,t,i){var r=c(e.value.body,t.reset());var n=0;var a=0;for(var s=0;s<r.length;s++){n=Math.max(r[s].height,n);a=Math.max(r[s].depth,a)}n*=t.style.sizeMultiplier;a*=t.style.sizeMultiplier;var h;if(e.value.left==="."){h=v(t)}else{h=o.leftRightDelim(e.value.left,n,a,t,e.mode)}r.unshift(h);var l;if(e.value.right==="."){l=v(t)}else{l=o.leftRightDelim(e.value.right,n,a,t,e.mode)}r.push(l);return u(["minner",t.style.cls()],r,t.getColor())},rule:function(e,t,i){var r=u(["mord","rule"],[],t.getColor());var n=0;if(e.value.shift){n=e.value.shift.number;if(e.value.shift.unit==="ex"){n*=h.metrics.xHeight}}var a=e.value.width.number;if(e.value.width.unit==="ex"){a*=h.metrics.xHeight}var o=e.value.height.number;if(e.value.height.unit==="ex"){o*=h.metrics.xHeight}n/=t.style.sizeMultiplier;a/=t.style.sizeMultiplier;o/=t.style.sizeMultiplier;r.style.borderRightWidth=a+"em";r.style.borderTopWidth=o+"em";r.style.bottom=n+"em";r.width=a;r.height=o+n;r.depth=-n;return r},accent:function(e,t,i){var r=e.value.base;var n;if(e.type==="supsub"){var o=e;e=o.value.base;r=e.value.base;o.value.base=r;n=E(o,t.reset(),i)}var s=E(r,t.withStyle(t.style.cramp()));var l;if(g(r)){var c=m(r);var p=E(c,t.withStyle(t.style.cramp()));l=p.skew}else{l=0}var f=Math.min(s.height,h.metrics.xHeight);var d=a.makeSymbol(e.value.accent,"Main-Regular","math",t.getColor());d.italic=0;var v=e.value.accent==="\\vec"?"accent-vec":null;var y=u(["accent-body",v],[u([],[d])]);y=a.makeVList([{type:"elem",elem:s},{type:"kern",size:-f},{type:"elem",elem:y}],"firstBaseline",null,t);y.children[1].style.marginLeft=2*l+"em";var w=u(["mord","accent"],[y]);if(n){n.children[0]=w;n.height=Math.max(w.height,n.height);n.classes[0]="mord";return n}else{return w}},phantom:function(e,t,i){var r=c(e.value.value,t.withPhantom(),i);return new a.makeFragment(r)}};var E=function(e,t,i){if(!e){return u()}if(y[e.type]){var n=y[e.type](e,t,i);var o;if(t.style!==t.parentStyle){o=t.style.sizeMultiplier/t.parentStyle.sizeMultiplier;n.height*=o;n.depth*=o}if(t.size!==t.parentSize){o=a.sizingMultiplier[t.size]/a.sizingMultiplier[t.parentSize];n.height*=o;n.depth*=o}return n}else{throw new r("Got group of unknown type: '"+e.type+"'")}};var w=function(e,t){e=JSON.parse(JSON.stringify(e));var i=c(e,t);var r=u(["base",t.style.cls()],i);var n=u(["strut"]);var a=u(["strut","bottom"]);n.style.height=r.height+"em";a.style.height=r.height+r.depth+"em";a.style.verticalAlign=-r.depth+"em";var o=u(["katex-html"],[n,a,r]);o.setAttribute("aria-hidden","true");return o};t.exports=w},{"./ParseError":5,"./Style":8,"./buildCommon":9,"./delimiter":13,"./domTree":14,"./fontMetrics":16,"./utils":23}],11:[function(e,t,i){var r=e("./buildCommon");var n=e("./fontMetrics");var a=e("./mathMLTree");var o=e("./ParseError");var s=e("./symbols");var h=e("./utils");var l=r.makeSpan;var u=r.fontMap;var c=function(e,t){if(s[t][e]&&s[t][e].replace){e=s[t][e].replace}return new a.TextNode(e)};var p=function(e,t){var i=t.font;if(!i){return null}var r=e.mode;if(i==="mathit"){return"italic"}var a=e.value;if(h.contains(["\\imath","\\jmath"],a)){return null}if(s[r][a]&&s[r][a].replace){a=s[r][a].replace}var o=u[i].fontName;if(n.getCharacterMetrics(a,o)){return u[t.font].variant}return null};var f={mathord:function(e,t){var i=new a.MathNode("mi",[c(e.value,e.mode)]);var r=p(e,t);if(r){i.setAttribute("mathvariant",r)}return i},textord:function(e,t){var i=c(e.value,e.mode);var r=p(e,t)||"normal";var n;if(/[0-9]/.test(e.value)){n=new a.MathNode("mn",[i]);if(t.font){n.setAttribute("mathvariant",r)}}else{n=new a.MathNode("mi",[i]);n.setAttribute("mathvariant",r)}return n},bin:function(e){var t=new a.MathNode("mo",[c(e.value,e.mode)]);return t},rel:function(e){var t=new a.MathNode("mo",[c(e.value,e.mode)]);return t},open:function(e){var t=new a.MathNode("mo",[c(e.value,e.mode)]);return t},close:function(e){var t=new a.MathNode("mo",[c(e.value,e.mode)]);return t},inner:function(e){var t=new a.MathNode("mo",[c(e.value,e.mode)]);return t},punct:function(e){var t=new a.MathNode("mo",[c(e.value,e.mode)]);t.setAttribute("separator","true");return t},ordgroup:function(e,t){var i=d(e.value,t);var r=new a.MathNode("mrow",i);return r},text:function(e,t){var i=d(e.value.body,t);var r=new a.MathNode("mtext",i);return r},color:function(e,t){var i=d(e.value.value,t);var r=new a.MathNode("mstyle",i);r.setAttribute("mathcolor",e.value.color);return r},supsub:function(e,t){var i=[m(e.value.base,t)];if(e.value.sub){i.push(m(e.value.sub,t))}if(e.value.sup){i.push(m(e.value.sup,t))}var r;if(!e.value.sub){r="msup"}else if(!e.value.sup){r="msub"}else{r="msubsup"}var n=new a.MathNode(r,i);return n},genfrac:function(e,t){var i=new a.MathNode("mfrac",[m(e.value.numer,t),m(e.value.denom,t)]);if(!e.value.hasBarLine){i.setAttribute("linethickness","0px")}if(e.value.leftDelim!=null||e.value.rightDelim!=null){var r=[];if(e.value.leftDelim!=null){var n=new a.MathNode("mo",[new a.TextNode(e.value.leftDelim)]);n.setAttribute("fence","true");r.push(n)}r.push(i);if(e.value.rightDelim!=null){var o=new a.MathNode("mo",[new a.TextNode(e.value.rightDelim)]);o.setAttribute("fence","true");r.push(o)}var s=new a.MathNode("mrow",r);return s}return i},array:function(e,t){return new a.MathNode("mtable",e.value.body.map(function(e){return new a.MathNode("mtr",e.map(function(e){return new a.MathNode("mtd",[m(e,t)])}))}))},sqrt:function(e,t){var i;if(e.value.index){i=new a.MathNode("mroot",[m(e.value.body,t),m(e.value.index,t)])}else{i=new a.MathNode("msqrt",[m(e.value.body,t)])}return i},leftright:function(e,t){var i=d(e.value.body,t);if(e.value.left!=="."){var r=new a.MathNode("mo",[c(e.value.left,e.mode)]);r.setAttribute("fence","true");i.unshift(r)}if(e.value.right!=="."){var n=new a.MathNode("mo",[c(e.value.right,e.mode)]);n.setAttribute("fence","true");i.push(n)}var o=new a.MathNode("mrow",i);return o},accent:function(e,t){var i=new a.MathNode("mo",[c(e.value.accent,e.mode)]);var r=new a.MathNode("mover",[m(e.value.base,t),i]);r.setAttribute("accent","true");return r},spacing:function(e){var t;if(e.value==="\\ "||e.value==="\\space"||e.value===" "||e.value==="~"){t=new a.MathNode("mtext",[new a.TextNode("")])}else{t=new a.MathNode("mspace");t.setAttribute("width",r.spacingFunctions[e.value].size)}return t},op:function(e){var t;if(e.value.symbol){t=new a.MathNode("mo",[c(e.value.body,e.mode)])}else{t=new a.MathNode("mi",[new a.TextNode(e.value.body.slice(1))])}return t},katex:function(e){var t=new a.MathNode("mtext",[new a.TextNode("KaTeX")]);return t},font:function(e,t){var i=e.value.font;return m(e.value.body,t.withFont(i))},delimsizing:function(e){var t=[];if(e.value.value!=="."){t.push(c(e.value.value,e.mode))}var i=new a.MathNode("mo",t);if(e.value.delimType==="open"||e.value.delimType==="close"){i.setAttribute("fence","true")}else{i.setAttribute("fence","false")}return i},styling:function(e,t){var i=d(e.value.value,t);var r=new a.MathNode("mstyle",i);var n={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]};var o=n[e.value.style];r.setAttribute("scriptlevel",o[0]);r.setAttribute("displaystyle",o[1]);return r},sizing:function(e,t){var i=d(e.value.value,t);var n=new a.MathNode("mstyle",i);n.setAttribute("mathsize",r.sizingMultiplier[e.value.size]+"em");return n},overline:function(e,t){var i=new a.MathNode("mo",[new a.TextNode("")]);i.setAttribute("stretchy","true");var r=new a.MathNode("mover",[m(e.value.body,t),i]);r.setAttribute("accent","true");return r},rule:function(e){var t=new a.MathNode("mrow");return t},llap:function(e,t){var i=new a.MathNode("mpadded",[m(e.value.body,t)]);i.setAttribute("lspace","-1width");i.setAttribute("width","0px");return i},rlap:function(e,t){var i=new a.MathNode("mpadded",[m(e.value.body,t)]);i.setAttribute("width","0px");return i},phantom:function(e,t,i){var r=d(e.value.value,t);return new a.MathNode("mphantom",r)}};var d=function(e,t){var i=[];for(var r=0;r<e.length;r++){var n=e[r];i.push(m(n,t))}return i};var m=function(e,t){if(!e){return new a.MathNode("mrow")}if(f[e.type]){return f[e.type](e,t)}else{throw new o("Got group of unknown type: '"+e.type+"'")}};var g=function(e,t,i){var r=d(e,i);var n=new a.MathNode("mrow",r);var o=new a.MathNode("annotation",[new a.TextNode(t)]);o.setAttribute("encoding","application/x-tex");var s=new a.MathNode("semantics",[n,o]);var h=new a.MathNode("math",[s]);return l(["katex-mathml"],[h])};t.exports=g},{"./ParseError":5,"./buildCommon":9,"./fontMetrics":16,"./mathMLTree":19,"./symbols":22,"./utils":23}],12:[function(e,t,i){var r=e("./buildHTML");var n=e("./buildMathML");var a=e("./buildCommon");var o=e("./Options");var s=e("./Settings");var h=e("./Style");var l=a.makeSpan;var u=function(e,t,i){i=i||new s({});var a=h.TEXT;if(i.displayMode){a=h.DISPLAY}var u=new o({style:a,size:"size5"});var c=n(e,t,u);var p=r(e,u);var f=l(["katex"],[c,p]);if(i.displayMode){return l(["katex-display"],[f])}else{return f}};t.exports=u},{"./Options":4,"./Settings":7,"./Style":8,"./buildCommon":9,"./buildHTML":10,"./buildMathML":11}],13:[function(e,t,i){var r=e("./ParseError");var n=e("./Style");var a=e("./buildCommon");var o=e("./fontMetrics");var s=e("./symbols");var h=e("./utils");var l=a.makeSpan;var u=function(e,t){if(s.math[e]&&s.math[e].replace){return o.getCharacterMetrics(s.math[e].replace,t)}else{return o.getCharacterMetrics(e,t)}};var c=function(e,t,i){return a.makeSymbol(e,"Size"+t+"-Regular",i)};var p=function(e,t,i){var r=l(["style-wrap",i.style.reset(),t.cls()],[e]);var n=t.sizeMultiplier/i.style.sizeMultiplier;r.height*=n;r.depth*=n;r.maxFontSize=t.sizeMultiplier;return r};var f=function(e,t,i,r,n){var s=a.makeSymbol(e,"Main-Regular",n);var h=p(s,t,r);if(i){var l=(1-r.style.sizeMultiplier/t.sizeMultiplier)*o.metrics.axisHeight;h.style.top=l+"em";h.height-=l;h.depth+=l}return h};var d=function(e,t,i,r,a){var s=c(e,t,a);var h=p(l(["delimsizing","size"+t],[s],r.getColor()),n.TEXT,r);if(i){var u=(1-r.style.sizeMultiplier)*o.metrics.axisHeight;h.style.top=u+"em";h.height-=u;h.depth+=u}return h};var m=function(e,t,i){var r;if(t==="Size1-Regular"){r="delim-size1"}else if(t==="Size4-Regular"){r="delim-size4"}var n=l(["delimsizinginner",r],[l([],[a.makeSymbol(e,t,i)])]);return{type:"elem",elem:n}};var g=function(e,t,i,r,s){var h,c,f,d;h=f=d=e;c=null;var g="Size1-Regular";if(e==="\\uparrow"){f=d=""}else if(e==="\\Uparrow"){f=d=""}else if(e==="\\downarrow"){h=f=""}else if(e==="\\Downarrow"){h=f=""}else if(e==="\\updownarrow"){h="\\uparrow";f="";d="\\downarrow"}else if(e==="\\Updownarrow"){h="\\Uparrow";f="";d="\\Downarrow"}else if(e==="["||e==="\\lbrack"){h="";f="";d="";g="Size4-Regular"}else if(e==="]"||e==="\\rbrack"){h="";f="";d="";g="Size4-Regular"}else if(e==="\\lfloor"){f=h="";d="";g="Size4-Regular"}else if(e==="\\lceil"){h="";f=d="";g="Size4-Regular"}else if(e==="\\rfloor"){f=h="";d="";g="Size4-Regular"}else if(e==="\\rceil"){h="";f=d="";g="Size4-Regular"}else if(e==="("){h="";f="";d="";g="Size4-Regular"}else if(e===")"){h="";f="";d="";g="Size4-Regular"}else if(e==="\\{"||e==="\\lbrace"){h="";c="";d="";f="";g="Size4-Regular"}else if(e==="\\}"||e==="\\rbrace"){h="";c="";d="";f="";g="Size4-Regular"}else if(e==="\\lgroup"){h="";d="";f="";g="Size4-Regular"}else if(e==="\\rgroup"){h="";d="";f="";g="Size4-Regular"}else if(e==="\\lmoustache"){h="";d="";f="";g="Size4-Regular"}else if(e==="\\rmoustache"){h="";d="";f="";g="Size4-Regular"}else if(e==="\\surd"){h="";d="";f="";g="Size4-Regular"}var v=u(h,g);var y=v.height+v.depth;var E=u(f,g);var w=E.height+E.depth;var b=u(d,g);var _=b.height+b.depth;var x=0;var T=1;if(c!==null){var R=u(c,g);x=R.height+R.depth;T=2}var k=y+_+x;var H=Math.ceil((t-k)/(T*w));var M=k+H*T*w;var S=o.metrics.axisHeight;if(i){S*=r.style.sizeMultiplier}var A=M/2-S;var C=[];C.push(m(d,g,s));var z;if(c===null){for(z=0;z<H;z++){C.push(m(f,g,s))}}else{for(z=0;z<H;z++){C.push(m(f,g,s))}C.push(m(c,g,s));for(z=0;z<H;z++){C.push(m(f,g,s))}}C.push(m(h,g,s));var P=a.makeVList(C,"bottom",A,r);return p(l(["delimsizing","mult"],[P],r.getColor()),n.TEXT,r)};var v=["(",")","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","\\lceil","\\rceil","\\surd"];var y=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","\\lmoustache","\\rmoustache"];var E=["<",">","\\langle","\\rangle","/","\\backslash"];var w=[0,1.2,1.8,2.4,3];var b=function(e,t,i,n){if(e==="<"){e="\\langle"}else if(e===">"){e="\\rangle"}if(h.contains(v,e)||h.contains(E,e)){return d(e,t,false,i,n)}else if(h.contains(y,e)){return g(e,w[t],false,i,n)}else{throw new r("Illegal delimiter: '"+e+"'")}};var _=[{type:"small",style:n.SCRIPTSCRIPT},{type:"small",style:n.SCRIPT},{type:"small",style:n.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}];var x=[{type:"small",style:n.SCRIPTSCRIPT},{type:"small",style:n.SCRIPT},{type:"small",style:n.TEXT},{type:"stack"}];var T=[{type:"small",style:n.SCRIPTSCRIPT},{type:"small",style:n.SCRIPT},{type:"small",style:n.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}];var R=function(e){if(e.type==="small"){return"Main-Regular"}else if(e.type==="large"){return"Size"+e.size+"-Regular"}else if(e.type==="stack"){return"Size4-Regular"}};var k=function(e,t,i,r){var n=Math.min(2,3-r.style.size);for(var a=n;a<i.length;a++){if(i[a].type==="stack"){break}var o=u(e,R(i[a]));var s=o.height+o.depth;if(i[a].type==="small"){s*=i[a].style.sizeMultiplier}if(s>t){return i[a]}}return i[i.length-1]};var H=function(e,t,i,r,n){if(e==="<"){e="\\langle"}else if(e===">"){e="\\rangle"}var a;if(h.contains(E,e)){a=_}else if(h.contains(v,e)){a=T}else{a=x}var o=k(e,t,a,r);if(o.type==="small"){return f(e,o.style,i,r,n)}else if(o.type==="large"){return d(e,o.size,i,r,n)}else if(o.type==="stack"){return g(e,t,i,r,n)}};var M=function(e,t,i,r,n){var a=o.metrics.axisHeight*r.style.sizeMultiplier;var s=901;var h=5/o.metrics.ptPerEm;var l=Math.max(t-a,i+a);var u=Math.max(l/500*s,2*l-h);return H(e,u,true,r,n)};t.exports={sizedDelim:b,customSizedDelim:H,leftRightDelim:M}},{"./ParseError":5,"./Style":8,"./buildCommon":9,"./fontMetrics":16,"./symbols":22,"./utils":23}],14:[function(e,t,i){var r=e("./utils");var n=function(e){e=e.slice();for(var t=e.length-1;t>=0;t--){if(!e[t]){e.splice(t,1)}}return e.join(" ")};function a(e,t,i,r,n,a){this.classes=e||[];this.children=t||[];this.height=i||0;this.depth=r||0;this.maxFontSize=n||0;this.style=a||{};this.attributes={}}a.prototype.setAttribute=function(e,t){this.attributes[e]=t};a.prototype.toNode=function(){var e=document.createElement("span");e.className=n(this.classes);for(var t in this.style){if(Object.prototype.hasOwnProperty.call(this.style,t)){e.style[t]=this.style[t]}}for(var i in this.attributes){if(Object.prototype.hasOwnProperty.call(this.attributes,i)){e.setAttribute(i,this.attributes[i])}}for(var r=0;r<this.children.length;r++){e.appendChild(this.children[r].toNode())}return e};a.prototype.toMarkup=function(){var e="<span";if(this.classes.length){e+=' class="';e+=r.escape(n(this.classes));e+='"'}var t="";for(var i in this.style){if(this.style.hasOwnProperty(i)){t+=r.hyphenate(i)+":"+this.style[i]+";"}}if(t){e+=' style="'+r.escape(t)+'"'}for(var a in this.attributes){if(Object.prototype.hasOwnProperty.call(this.attributes,a)){e+=" "+a+'="';e+=r.escape(this.attributes[a]);e+='"'}}e+=">";for(var o=0;o<this.children.length;o++){e+=this.children[o].toMarkup()}e+="</span>";return e};function o(e,t,i,r){this.children=e||[];this.height=t||0;this.depth=i||0;this.maxFontSize=r||0}o.prototype.toNode=function(){var e=document.createDocumentFragment();for(var t=0;t<this.children.length;t++){e.appendChild(this.children[t].toNode())}return e};o.prototype.toMarkup=function(){var e="";for(var t=0;t<this.children.length;t++){e+=this.children[t].toMarkup()}return e};function s(e,t,i,r,n,a,o){this.value=e||"";this.height=t||0;this.depth=i||0;this.italic=r||0;this.skew=n||0;this.classes=a||[];this.style=o||{};this.maxFontSize=0}s.prototype.toNode=function(){var e=document.createTextNode(this.value);var t=null;if(this.italic>0){t=document.createElement("span");t.style.marginRight=this.italic+"em"}if(this.classes.length>0){t=t||document.createElement("span");t.className=n(this.classes)}for(var i in this.style){if(this.style.hasOwnProperty(i)){t=t||document.createElement("span");t.style[i]=this.style[i]}}if(t){t.appendChild(e);return t}else{return e}};s.prototype.toMarkup=function(){var e=false;var t="<span";if(this.classes.length){e=true;t+=' class="';t+=r.escape(n(this.classes));t+='"'}var i="";if(this.italic>0){i+="margin-right:"+this.italic+"em;"}for(var a in this.style){if(this.style.hasOwnProperty(a)){i+=r.hyphenate(a)+":"+this.style[a]+";"}}if(i){e=true;t+=' style="'+r.escape(i)+'"'}var o=r.escape(this.value);if(e){t+=">";t+=o;t+="</span>";return t}else{return o}};t.exports={span:a,documentFragment:o,symbolNode:s}},{"./utils":23}],15:[function(e,t,i){var r=e("./fontMetrics");var n=e("./parseData");var a=e("./ParseError");var o=n.ParseNode;var s=n.ParseResult;function h(e,t,i,r){var n=[],h=[n],l=[];while(true){var u=e.parseExpression(t,i,false,null);n.push(new o("ordgroup",u.result,i));t=u.position;var c=u.peek.text;if(c==="&"){t=u.peek.position}else if(c==="\\end"){break}else if(c==="\\\\"||c==="\\cr"){var p=e.parseFunction(t,i);l.push(p.result.value.size);t=p.position;n=[];h.push(n)}else{throw new a("Expected & or \\\\ or \\end",e.lexer,u.peek.position)}}r.body=h;r.rowGaps=l;return new s(new o(r.type,r,i),t)}var l=[{names:["array"],numArgs:1,handler:function(e,t,i,r,n){var o=this;r=r.value.map?r.value:[r];var s=r.map(function(e){var t=e.value;if("lcr".indexOf(t)!==-1){return{type:"align",align:t}}else if(t==="|"){return{type:"separator",separator:"|"}}throw new a("Unknown column alignment: "+e.value,o.lexer,n[1])});var l={type:"array",cols:s,hskipBeforeAndAfter:true};l=h(o,e,t,l);return l}},{names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix"],handler:function(e,t,i){var r={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[i];var n={type:"array",hskipBeforeAndAfter:false};n=h(this,e,t,n);if(r){n.result=new o("leftright",{body:[n.result],left:r[0],right:r[1]},t)}return n}},{names:["cases"],handler:function(e,t,i){var n={type:"array",arraystretch:1.2,cols:[{type:"align",align:"l",pregap:0,postgap:r.metrics.quad},{type:"align",align:"l",pregap:0,postgap:0}]};n=h(this,e,t,n);n.result=new o("leftright",{body:[n.result],left:"\\{",right:"."},t);return n}}];t.exports=function(){var e={};for(var t=0;t<l.length;++t){var i=l[t];i.greediness=1;i.allowedInText=!!i.allowedInText;i.numArgs=i.numArgs||0;i.numOptionalArgs=i.numOptionalArgs||0;for(var r=0;r<i.names.length;++r){e[i.names[r]]=i}}return e}()},{"./ParseError":5,"./fontMetrics":16,"./parseData":20}],16:[function(e,t,i){var r=e("./Style");var n=.025;var a=0;var o=0;var s=0;var h=.431;var l=1;var u=0;var c=.677;var p=.394;var f=.444;var d=.686;var m=.345;var g=.413;var v=.363;var y=.289;var E=.15;var w=.247;var b=.386;var _=.05;var x=2.39;var T=1.01;var R=.81;var k=.71;var H=.25;var M=0;var S=0;var A=0;var C=0;var z=.431;var P=1;var L=0;var O=.04;var D=.111;var F=.166;var B=.2;var U=.6;var N=.1;var V=10;var I=2/V;var j={xHeight:h,quad:l,num1:c,num2:p,num3:f,denom1:d,denom2:m,sup1:g,sup2:v,sup3:y,sub1:E,sub2:w,supDrop:b,subDrop:_,axisHeight:H,defaultRuleThickness:O,bigOpSpacing1:D,bigOpSpacing2:F,bigOpSpacing3:B,bigOpSpacing4:U,bigOpSpacing5:N,ptPerEm:V,emPerEx:h/l,doubleRuleSep:I,delim1:x,getDelim2:function(e){if(e.size===r.TEXT.size){return T}else if(e.size===r.SCRIPT.size){return R}else if(e.size===r.SCRIPTSCRIPT.size){return k}throw new Error("Unexpected style size: "+e.size)}};var G=e("./fontMetricsData");var W=function(e,t){return G[t][e.charCodeAt(0)]};t.exports={metrics:j,getCharacterMetrics:W}},{"./Style":8,"./fontMetricsData":17}],17:[function(e,t,i){t.exports={"AMS-Regular":{65:{depth:0,height:.68889,italic:0,skew:0},66:{depth:0,height:.68889,italic:0,skew:0},67:{depth:0,height:.68889,italic:0,skew:0},68:{depth:0,height:.68889,italic:0,skew:0},69:{depth:0,height:.68889,italic:0,skew:0},70:{depth:0,height:.68889,italic:0,skew:0},71:{depth:0,height:.68889,italic:0,skew:0},72:{depth:0,height:.68889,italic:0,skew:0},73:{depth:0,height:.68889,italic:0,skew:0},74:{depth:.16667,height:.68889,italic:0,skew:0},75:{depth:0,height:.68889,italic:0,skew:0},76:{depth:0,height:.68889,italic:0,skew:0},77:{depth:0,height:.68889,italic:0,skew:0},78:{depth:0,height:.68889,italic:0,skew:0},79:{depth:.16667,height:.68889,italic:0,skew:0},80:{depth:0,height:.68889,italic:0,skew:0},81:{depth:.16667,height:.68889,italic:0,skew:0},82:{depth:0,height:.68889,italic:0,skew:0},83:{depth:0,height:.68889,italic:0,skew:0},84:{depth:0,height:.68889,italic:0,skew:0},85:{depth:0,height:.68889,italic:0,skew:0},86:{depth:0,height:.68889,italic:0,skew:0},87:{depth:0,height:.68889,italic:0,skew:0},88:{depth:0,height:.68889,italic:0,skew:0},89:{depth:0,height:.68889,italic:0,skew:0},90:{depth:0,height:.68889,italic:0,skew:0},107:{depth:0,height:.68889,italic:0,skew:0},165:{depth:0,height:.675,italic:.025,skew:0},174:{depth:.15559,height:.69224,italic:0,skew:0},240:{depth:0,height:.68889,italic:0,skew:0},295:{depth:0,height:.68889,italic:0,skew:0},710:{depth:0,height:.825,italic:0,skew:0},732:{depth:0,height:.9,italic:0,skew:0},770:{depth:0,height:.825,italic:0,skew:0},771:{depth:0,height:.9,italic:0,skew:0},989:{depth:.08167,height:.58167,italic:0,skew:0},1008:{depth:0,height:.43056,italic:.04028,skew:0},8245:{depth:0,height:.54986,italic:0,skew:0},8463:{depth:0,height:.68889,italic:0,skew:0},8487:{depth:0,height:.68889,italic:0,skew:0},8498:{depth:0,height:.68889,italic:0,skew:0},8502:{depth:0,height:.68889,italic:0,skew:0},8503:{depth:0,height:.68889,italic:0,skew:0},8504:{depth:0,height:.68889,italic:0,skew:0},8513:{depth:0,height:.68889,italic:0,skew:0},8592:{depth:-.03598,height:.46402,italic:0,skew:0},8594:{depth:-.03598,height:.46402,italic:0,skew:0},8602:{depth:-.13313,height:.36687,italic:0,skew:0},8603:{depth:-.13313,height:.36687,italic:0,skew:0},8606:{depth:.01354,height:.52239,italic:0,skew:0},8608:{depth:.01354,height:.52239,italic:0,skew:0},8610:{depth:.01354,height:.52239,italic:0,skew:0},8611:{depth:.01354,height:.52239,italic:0,skew:0},8619:{depth:0,height:.54986,italic:0,skew:0},8620:{depth:0,height:.54986,italic:0,skew:0},8621:{depth:-.13313,height:.37788,italic:0,skew:0},8622:{depth:-.13313,height:.36687,italic:0,skew:0},8624:{depth:0,height:.69224,italic:0,skew:0},8625:{depth:0,height:.69224,italic:0,skew:0},8630:{depth:0,height:.43056,italic:0,skew:0},8631:{depth:0,height:.43056,italic:0,skew:0},8634:{depth:.08198,height:.58198,italic:0,skew:0},8635:{depth:.08198,height:.58198,italic:0,skew:0},8638:{depth:.19444,height:.69224,italic:0,skew:0},8639:{depth:.19444,height:.69224,italic:0,skew:0},8642:{depth:.19444,height:.69224,italic:0,skew:0},8643:{depth:.19444,height:.69224,italic:0,skew:0},8644:{depth:.1808,height:.675,italic:0,skew:0},8646:{depth:.1808,height:.675,italic:0,skew:0},8647:{depth:.1808,height:.675,italic:0,skew:0},8648:{depth:.19444,height:.69224,italic:0,skew:0},8649:{depth:.1808,height:.675,italic:0,skew:0},8650:{depth:.19444,height:.69224,italic:0,skew:0},8651:{depth:.01354,height:.52239,italic:0,skew:0},8652:{depth:.01354,height:.52239,italic:0,skew:0},8653:{depth:-.13313,height:.36687,italic:0,skew:0},8654:{depth:-.13313,height:.36687,italic:0,skew:0},8655:{depth:-.13313,height:.36687,italic:0,skew:0},8666:{depth:.13667,height:.63667,italic:0,skew:0},8667:{depth:.13667,height:.63667,italic:0,skew:0},8669:{depth:-.13313,height:.37788,italic:0,skew:0},8672:{depth:-.064,height:.437,italic:0,skew:0},8674:{depth:-.064,height:.437,italic:0,skew:0},8705:{depth:0,height:.825,italic:0,skew:0},8708:{depth:0,height:.68889,italic:0,skew:0},8709:{depth:.08167,height:.58167,italic:0,skew:0},8717:{depth:0,height:.43056,italic:0,skew:0},8722:{depth:-.03598,height:.46402,italic:0,skew:0},8724:{depth:.08198,height:.69224,italic:0,skew:0},8726:{depth:.08167,height:.58167,italic:0,skew:0},8733:{depth:0,height:.69224,italic:0,skew:0},8736:{depth:0,height:.69224,italic:0,skew:0},8737:{depth:0,height:.69224,italic:0,skew:0},8738:{depth:.03517,height:.52239,italic:0,skew:0},8739:{depth:.08167,height:.58167,italic:0,skew:0},8740:{depth:.25142,height:.74111,italic:0,skew:0},8741:{depth:.08167,height:.58167,italic:0,skew:0},8742:{depth:.25142,height:.74111,italic:0,skew:0},8756:{depth:0,height:.69224,italic:0,skew:0},8757:{depth:0,height:.69224,italic:0,skew:0},8764:{depth:-.13313,height:.36687,italic:0,skew:0},8765:{depth:-.13313,height:.37788,italic:0,skew:0},8769:{depth:-.13313,height:.36687,italic:0,skew:0},8770:{depth:-.03625,height:.46375,italic:0,skew:0},8774:{depth:.30274,height:.79383,italic:0,skew:0},8776:{depth:-.01688,height:.48312,italic:0,skew:0},8778:{depth:.08167,height:.58167,italic:0,skew:0},8782:{depth:.06062,height:.54986,italic:0,skew:0},8783:{depth:.06062,height:.54986,italic:0,skew:0},8785:{depth:.08198,height:.58198,italic:0,skew:0},8786:{depth:.08198,height:.58198,italic:0,skew:0},8787:{depth:.08198,height:.58198,italic:0,skew:0},8790:{depth:0,height:.69224,italic:0,skew:0},8791:{depth:.22958,height:.72958,italic:0,skew:0},8796:{depth:.08198,height:.91667,italic:0,skew:0},8806:{depth:.25583,height:.75583,italic:0,skew:0},8807:{depth:.25583,height:.75583,italic:0,skew:0},8808:{depth:.25142,height:.75726,italic:0,skew:0},8809:{depth:.25142,height:.75726,italic:0,skew:0},8812:{depth:.25583,height:.75583,italic:0,skew:0},8814:{depth:.20576,height:.70576,italic:0,skew:0},8815:{depth:.20576,height:.70576,italic:0,skew:0},8816:{depth:.30274,height:.79383,italic:0,skew:0},8817:{depth:.30274,height:.79383,italic:0,skew:0},8818:{depth:.22958,height:.72958,italic:0,skew:0},8819:{depth:.22958,height:.72958,italic:0,skew:0},8822:{depth:.1808,height:.675,italic:0,skew:0},8823:{depth:.1808,height:.675,italic:0,skew:0},8828:{depth:.13667,height:.63667,italic:0,skew:0},8829:{depth:.13667,height:.63667,italic:0,skew:0},8830:{depth:.22958,height:.72958,italic:0,skew:0},8831:{depth:.22958,height:.72958,italic:0,skew:0},8832:{depth:.20576,height:.70576,italic:0,skew:0},8833:{depth:.20576,height:.70576,italic:0,skew:0},8840:{depth:.30274,height:.79383,italic:0,skew:0},8841:{depth:.30274,height:.79383,italic:0,skew:0},8842:{depth:.13597,height:.63597,italic:0,skew:0},8843:{depth:.13597,height:.63597,italic:0,skew:0},8847:{depth:.03517,height:.54986,italic:0,skew:0},8848:{depth:.03517,height:.54986,italic:0,skew:0},8858:{depth:.08198,height:.58198,italic:0,skew:0},8859:{depth:.08198,height:.58198,italic:0,skew:0},8861:{depth:.08198,height:.58198,italic:0,skew:0},8862:{depth:0,height:.675,italic:0,skew:0},8863:{depth:0,height:.675,italic:0,skew:0},8864:{depth:0,height:.675,italic:0,skew:0},8865:{depth:0,height:.675,italic:0,skew:0},8872:{depth:0,height:.69224,italic:0,skew:0},8873:{depth:0,height:.69224,italic:0,skew:0},8874:{depth:0,height:.69224,italic:0,skew:0},8876:{depth:0,height:.68889,italic:0,skew:0},8877:{depth:0,height:.68889,italic:0,skew:0},8878:{depth:0,height:.68889,italic:0,skew:0},8879:{depth:0,height:.68889,italic:0,skew:0},8882:{depth:.03517,height:.54986,italic:0,skew:0},8883:{depth:.03517,height:.54986,italic:0,skew:0},8884:{depth:.13667,height:.63667,italic:0,skew:0},8885:{depth:.13667,height:.63667,italic:0,skew:0},8888:{depth:0,height:.54986,italic:0,skew:0},8890:{depth:.19444,height:.43056,italic:0,skew:0},8891:{depth:.19444,height:.69224,italic:0,skew:0},8892:{depth:.19444,height:.69224,italic:0,skew:0},8901:{depth:0,height:.54986,italic:0,skew:0},8903:{depth:.08167,height:.58167,italic:0,skew:0},8905:{depth:.08167,height:.58167,italic:0,skew:0},8906:{depth:.08167,height:.58167,italic:0,skew:0},8907:{depth:0,height:.69224,italic:0,skew:0},8908:{depth:0,height:.69224,italic:0,skew:0},8909:{depth:-.03598,height:.46402,italic:0,skew:0},8910:{depth:0,height:.54986,italic:0,skew:0},8911:{depth:0,height:.54986,italic:0,skew:0},8912:{depth:.03517,height:.54986,italic:0,skew:0},8913:{depth:.03517,height:.54986,italic:0,skew:0},8914:{depth:0,height:.54986,italic:0,skew:0},8915:{depth:0,height:.54986,italic:0,skew:0},8916:{depth:0,height:.69224,italic:0,skew:0},8918:{depth:.0391,height:.5391,italic:0,skew:0},8919:{depth:.0391,height:.5391,italic:0,skew:0},8920:{depth:.03517,height:.54986,italic:0,skew:0},8921:{depth:.03517,height:.54986,italic:0,skew:0},8922:{depth:.38569,height:.88569,italic:0,skew:0},8923:{depth:.38569,height:.88569,italic:0,skew:0},8926:{depth:.13667,height:.63667,italic:0,skew:0},8927:{depth:.13667,height:.63667,italic:0,skew:0},8928:{depth:.30274,height:.79383,italic:0,skew:0},8929:{depth:.30274,height:.79383,italic:0,skew:0},8934:{depth:.23222,height:.74111,italic:0,skew:0},8935:{depth:.23222,height:.74111,italic:0,skew:0},8936:{depth:.23222,height:.74111,italic:0,skew:0},8937:{depth:.23222,height:.74111,italic:0,skew:0},8938:{depth:.20576,height:.70576,italic:0,skew:0},8939:{depth:.20576,height:.70576,italic:0,skew:0},8940:{depth:.30274,height:.79383,italic:0,skew:0},8941:{depth:.30274,height:.79383,italic:0,skew:0},8994:{depth:.19444,height:.69224,italic:0,skew:0},8995:{depth:.19444,height:.69224,italic:0,skew:0},9416:{depth:.15559,height:.69224,italic:0,skew:0},9484:{depth:0,height:.69224,italic:0,skew:0},9488:{depth:0,height:.69224,italic:0,skew:0},9492:{depth:0,height:.37788,italic:0,skew:0},9496:{depth:0,height:.37788,italic:0,skew:0},9585:{depth:.19444,height:.68889,italic:0,skew:0},9586:{depth:.19444,height:.74111,italic:0,skew:0},9632:{depth:0,height:.675,italic:0,skew:0},9633:{depth:0,height:.675,italic:0,skew:0},9650:{depth:0,height:.54986,italic:0,skew:0},9651:{depth:0,height:.54986,italic:0,skew:0},9654:{depth:.03517,height:.54986,italic:0,skew:0},9660:{depth:0,height:.54986,italic:0,skew:0},9661:{depth:0,height:.54986,italic:0,skew:0},9664:{depth:.03517,height:.54986,italic:0,skew:0},9674:{depth:.11111,height:.69224,italic:0,skew:0},9733:{depth:.19444,height:.69224,italic:0,skew:0},10003:{depth:0,height:.69224,italic:0,skew:0},10016:{depth:0,height:.69224,italic:0,skew:0},10731:{depth:.11111,height:.69224,italic:0,skew:0},10846:{depth:.19444,height:.75583,italic:0,skew:0},10877:{depth:.13667,height:.63667,italic:0,skew:0},10878:{depth:.13667,height:.63667,italic:0,skew:0},10885:{depth:.25583,height:.75583,italic:0,skew:0},10886:{depth:.25583,height:.75583,italic:0,skew:0},10887:{depth:.13597,height:.63597,italic:0,skew:0},10888:{depth:.13597,height:.63597,italic:0,skew:0},10889:{depth:.26167,height:.75726,italic:0,skew:0},10890:{depth:.26167,height:.75726,italic:0,skew:0},10891:{depth:.48256,height:.98256,italic:0,skew:0},10892:{depth:.48256,height:.98256,italic:0,skew:0},10901:{depth:.13667,height:.63667,italic:0,skew:0},10902:{depth:.13667,height:.63667,italic:0,skew:0},10933:{depth:.25142,height:.75726,italic:0,skew:0},10934:{depth:.25142,height:.75726,italic:0,skew:0},10935:{depth:.26167,height:.75726,italic:0,skew:0},10936:{depth:.26167,height:.75726,italic:0,skew:0},10937:{depth:.26167,height:.75726,italic:0,skew:0},10938:{depth:.26167,height:.75726,italic:0,skew:0},10949:{depth:.25583,height:.75583,italic:0,skew:0},10950:{depth:.25583,height:.75583,italic:0,skew:0},10955:{depth:.28481,height:.79383,italic:0,skew:0},10956:{depth:.28481,height:.79383,italic:0,skew:0},57350:{depth:.08167,height:.58167,italic:0,skew:0},57351:{depth:.08167,height:.58167,italic:0,skew:0},57352:{depth:.08167,height:.58167,italic:0,skew:0},57353:{depth:0,height:.43056,italic:.04028,skew:0},57356:{depth:.25142,height:.75726,italic:0,skew:0},57357:{depth:.25142,height:.75726,italic:0,skew:0},57358:{depth:.41951,height:.91951,italic:0,skew:0},57359:{depth:.30274,height:.79383,italic:0,skew:0},57360:{depth:.30274,height:.79383,italic:0,skew:0},57361:{depth:.41951,height:.91951,italic:0,skew:0},57366:{depth:.25142,height:.75726,italic:0,skew:0},57367:{depth:.25142,height:.75726,italic:0,skew:0},57368:{depth:.25142,height:.75726,italic:0,skew:0},57369:{depth:.25142,height:.75726,italic:0,skew:0},57370:{depth:.13597,height:.63597,italic:0,skew:0},57371:{depth:.13597,height:.63597,italic:0,skew:0}},"Caligraphic-Regular":{48:{depth:0,height:.43056,italic:0,skew:0},49:{depth:0,height:.43056,italic:0,skew:0},50:{depth:0,height:.43056,italic:0,skew:0},51:{depth:.19444,height:.43056,italic:0,skew:0},52:{depth:.19444,height:.43056,italic:0,skew:0},53:{depth:.19444,height:.43056,italic:0,skew:0},54:{depth:0,height:.64444,italic:0,skew:0},55:{depth:.19444,height:.43056,italic:0,skew:0},56:{depth:0,height:.64444,italic:0,skew:0},57:{depth:.19444,height:.43056,italic:0,skew:0},65:{depth:0,height:.68333,italic:0,skew:.19445},66:{depth:0,height:.68333,italic:.03041,skew:.13889},67:{depth:0,height:.68333,italic:.05834,skew:.13889},68:{depth:0,height:.68333,italic:.02778,skew:.08334},69:{depth:0,height:.68333,italic:.08944,skew:.11111},70:{depth:0,height:.68333,italic:.09931,skew:.11111},71:{depth:.09722,height:.68333,italic:.0593,skew:.11111},72:{depth:0,height:.68333,italic:.00965,skew:.11111},73:{depth:0,height:.68333,italic:.07382,skew:0},74:{depth:.09722,height:.68333,italic:.18472,skew:.16667},75:{depth:0,height:.68333,italic:.01445,skew:.05556},76:{depth:0,height:.68333,italic:0,skew:.13889},77:{depth:0,height:.68333,italic:0,skew:.13889},78:{depth:0,height:.68333,italic:.14736,skew:.08334},79:{depth:0,height:.68333,italic:.02778,skew:.11111},80:{depth:0,height:.68333,italic:.08222,skew:.08334},81:{depth:.09722,height:.68333,italic:0,skew:.11111},82:{depth:0,height:.68333,italic:0,skew:.08334},83:{depth:0,height:.68333,italic:.075,skew:.13889},84:{depth:0,height:.68333,italic:.25417,skew:0},85:{depth:0,height:.68333,italic:.09931,skew:.08334},86:{depth:0,height:.68333,italic:.08222,skew:0},87:{depth:0,height:.68333,italic:.08222,skew:.08334},88:{depth:0,height:.68333,italic:.14643,skew:.13889},89:{depth:.09722,height:.68333,italic:.08222,skew:.08334},90:{depth:0,height:.68333,italic:.07944,skew:.13889}},"Fraktur-Regular":{33:{depth:0,height:.69141,italic:0,skew:0},34:{depth:0,height:.69141,italic:0,skew:0},38:{depth:0,height:.69141,italic:0,skew:0},39:{depth:0,height:.69141,italic:0,skew:0},40:{depth:.24982,height:.74947,italic:0,skew:0},41:{depth:.24982,height:.74947,italic:0,skew:0},42:{depth:0,height:.62119,italic:0,skew:0},43:{depth:.08319,height:.58283,italic:0,skew:0},44:{depth:0,height:.10803,italic:0,skew:0},45:{depth:.08319,height:.58283,italic:0,skew:0},46:{depth:0,height:.10803,italic:0,skew:0},47:{depth:.24982,height:.74947,italic:0,skew:0},48:{depth:0,height:.47534,italic:0,skew:0},49:{depth:0,height:.47534,italic:0,skew:0},50:{depth:0,height:.47534,italic:0,skew:0},51:{depth:.18906,height:.47534,italic:0,skew:0},52:{depth:.18906,height:.47534,italic:0,skew:0},53:{depth:.18906,height:.47534,italic:0,skew:0},54:{depth:0,height:.69141,italic:0,skew:0},55:{depth:.18906,height:.47534,italic:0,skew:0},56:{depth:0,height:.69141,italic:0,skew:0},57:{depth:.18906,height:.47534,italic:0,skew:0},58:{depth:0,height:.47534,italic:0,skew:0},59:{depth:.12604,height:.47534,italic:0,skew:0},61:{depth:-.13099,height:.36866,italic:0,skew:0},63:{depth:0,height:.69141,italic:0,skew:0},65:{depth:0,height:.69141,italic:0,skew:0},66:{depth:0,height:.69141,italic:0,skew:0},67:{depth:0,height:.69141,italic:0,skew:0},68:{depth:0,height:.69141,italic:0,skew:0},69:{depth:0,height:.69141,italic:0,skew:0},70:{depth:.12604,height:.69141,italic:0,skew:0},71:{depth:0,height:.69141,italic:0,skew:0},72:{depth:.06302,height:.69141,italic:0,skew:0},73:{depth:0,height:.69141,italic:0,skew:0},74:{depth:.12604,height:.69141,italic:0,skew:0},75:{depth:0,height:.69141,italic:0,skew:0},76:{depth:0,height:.69141,italic:0,skew:0},77:{depth:0,height:.69141,italic:0,skew:0},78:{depth:0,height:.69141,italic:0,skew:0},79:{depth:0,height:.69141,italic:0,skew:0},80:{depth:.18906,height:.69141,italic:0,skew:0},81:{depth:.03781,height:.69141,italic:0,skew:0},82:{depth:0,height:.69141,italic:0,skew:0},83:{depth:0,height:.69141,italic:0,skew:0},84:{depth:0,height:.69141,italic:0,skew:0},85:{depth:0,height:.69141,italic:0,skew:0},86:{depth:0,height:.69141,italic:0,skew:0},87:{depth:0,height:.69141,italic:0,skew:0},88:{depth:0,height:.69141,italic:0,skew:0},89:{depth:.18906,height:.69141,italic:0,skew:0},90:{depth:.12604,height:.69141,italic:0,skew:0},91:{depth:.24982,height:.74947,italic:0,skew:0},93:{depth:.24982,height:.74947,italic:0,skew:0},94:{depth:0,height:.69141,italic:0,skew:0},97:{depth:0,height:.47534,italic:0,skew:0},98:{depth:0,height:.69141,italic:0,skew:0},99:{depth:0,height:.47534,italic:0,skew:0},100:{depth:0,height:.62119,italic:0,skew:0},101:{depth:0,height:.47534,italic:0,skew:0},102:{depth:.18906,height:.69141,italic:0,skew:0},103:{depth:.18906,height:.47534,italic:0,skew:0},104:{depth:.18906,height:.69141,italic:0,skew:0},105:{depth:0,height:.69141,italic:0,skew:0},106:{depth:0,height:.69141,italic:0,skew:0},107:{depth:0,height:.69141,italic:0,skew:0},108:{depth:0,height:.69141,italic:0,skew:0},109:{depth:0,height:.47534,italic:0,skew:0},110:{depth:0,height:.47534,italic:0,skew:0},111:{depth:0,height:.47534,italic:0,skew:0},112:{depth:.18906,height:.52396,italic:0,skew:0},113:{depth:.18906,height:.47534,italic:0,skew:0},114:{depth:0,height:.47534,italic:0,skew:0},115:{depth:0,height:.47534,italic:0,skew:0},116:{depth:0,height:.62119,italic:0,skew:0},117:{depth:0,height:.47534,italic:0,skew:0},118:{depth:0,height:.52396,italic:0,skew:0},119:{depth:0,height:.52396,italic:0,skew:0},120:{depth:.18906,height:.47534,italic:0,skew:0},121:{depth:.18906,height:.47534,italic:0,skew:0},122:{depth:.18906,height:.47534,italic:0,skew:0},8216:{depth:0,height:.69141,italic:0,skew:0},8217:{depth:0,height:.69141,italic:0,skew:0},58112:{depth:0,height:.62119,italic:0,skew:0},58113:{depth:0,height:.62119,italic:0,skew:0},58114:{depth:.18906,height:.69141,italic:0,skew:0},58115:{depth:.18906,height:.69141,italic:0,skew:0},58116:{depth:.18906,height:.47534,italic:0,skew:0},58117:{depth:0,height:.69141,italic:0,skew:0},58118:{depth:0,height:.62119,italic:0,skew:0},58119:{depth:0,height:.47534,italic:0,skew:0}},"Main-Bold":{33:{depth:0,height:.69444,italic:0,skew:0},34:{depth:0,height:.69444,italic:0,skew:0},35:{depth:.19444,height:.69444,italic:0,skew:0},36:{depth:.05556,height:.75,italic:0,skew:0},37:{depth:.05556,height:.75,italic:0,skew:0},38:{depth:0,height:.69444,italic:0,skew:0},39:{depth:0,height:.69444,italic:0,skew:0},40:{depth:.25,height:.75,italic:0,skew:0},41:{depth:.25,height:.75,italic:0,skew:0},42:{depth:0,height:.75,italic:0,skew:0},43:{depth:.13333,height:.63333,italic:0,skew:0},44:{depth:.19444,height:.15556,italic:0,skew:0},45:{depth:0,height:.44444,italic:0,skew:0},46:{depth:0,height:.15556,italic:0,skew:0},47:{depth:.25,height:.75,italic:0,skew:0},48:{depth:0,height:.64444,italic:0,skew:0},49:{depth:0,height:.64444,italic:0,skew:0},50:{depth:0,height:.64444,italic:0,skew:0},51:{depth:0,height:.64444,italic:0,skew:0},52:{depth:0,height:.64444,italic:0,skew:0},53:{depth:0,height:.64444,italic:0,skew:0},54:{depth:0,height:.64444,italic:0,skew:0},55:{depth:0,height:.64444,italic:0,skew:0},56:{depth:0,height:.64444,italic:0,skew:0},57:{depth:0,height:.64444,italic:0,skew:0},58:{depth:0,height:.44444,italic:0,skew:0},59:{depth:.19444,height:.44444,italic:0,skew:0},60:{depth:.08556,height:.58556,italic:0,skew:0},61:{depth:-.10889,height:.39111,italic:0,skew:0},62:{depth:.08556,height:.58556,italic:0,skew:0},63:{depth:0,height:.69444,italic:0,skew:0},64:{depth:0,height:.69444,italic:0,skew:0},65:{depth:0,height:.68611,italic:0,skew:0},66:{depth:0,height:.68611,italic:0,skew:0},67:{depth:0,height:.68611,italic:0,skew:0},68:{depth:0,height:.68611,italic:0,skew:0},69:{depth:0,height:.68611,italic:0,skew:0},70:{depth:0,height:.68611,italic:0,skew:0},71:{depth:0,height:.68611,italic:0,skew:0},72:{depth:0,height:.68611,italic:0,skew:0},73:{depth:0,height:.68611,italic:0,skew:0},74:{depth:0,height:.68611,italic:0,skew:0},75:{depth:0,height:.68611,italic:0,skew:0},76:{depth:0,height:.68611,italic:0,skew:0},77:{depth:0,height:.68611,italic:0,skew:0},78:{depth:0,height:.68611,italic:0,skew:0},79:{depth:0,height:.68611,italic:0,skew:0},80:{depth:0,height:.68611,italic:0,skew:0},81:{depth:.19444,height:.68611,italic:0,skew:0},82:{depth:0,height:.68611,italic:0,skew:0},83:{depth:0,height:.68611,italic:0,skew:0},84:{depth:0,height:.68611,italic:0,skew:0},85:{depth:0,height:.68611,italic:0,skew:0},86:{depth:0,height:.68611,italic:.01597,skew:0},87:{depth:0,height:.68611,italic:.01597,skew:0},88:{depth:0,height:.68611,italic:0,skew:0},89:{depth:0,height:.68611,italic:.02875,skew:0},90:{depth:0,height:.68611,italic:0,skew:0},91:{depth:.25,height:.75,italic:0,skew:0},92:{depth:.25,height:.75,italic:0,skew:0},93:{depth:.25,height:.75,italic:0,skew:0},94:{depth:0,height:.69444,italic:0,skew:0},95:{depth:.31,height:.13444,italic:.03194,skew:0},96:{depth:0,height:.69444,italic:0,skew:0},97:{depth:0,height:.44444,italic:0,skew:0},98:{depth:0,height:.69444,italic:0,skew:0},99:{depth:0,height:.44444,italic:0,skew:0},100:{depth:0,height:.69444,italic:0,skew:0},101:{depth:0,height:.44444,italic:0,skew:0},102:{depth:0,height:.69444,italic:.10903,skew:0},103:{depth:.19444,height:.44444,italic:.01597,skew:0},104:{depth:0,height:.69444,italic:0,skew:0},105:{depth:0,height:.69444,italic:0,skew:0},106:{depth:.19444,height:.69444,italic:0,skew:0},107:{depth:0,height:.69444,italic:0,skew:0},108:{depth:0,height:.69444,italic:0,skew:0},109:{depth:0,height:.44444,italic:0,skew:0},110:{depth:0,height:.44444,italic:0,skew:0},111:{depth:0,height:.44444,italic:0,skew:0},112:{depth:.19444,height:.44444,italic:0,skew:0},113:{depth:.19444,height:.44444,italic:0,skew:0},114:{depth:0,height:.44444,italic:0,skew:0},115:{depth:0,height:.44444,italic:0,skew:0},116:{depth:0,height:.63492,italic:0,skew:0},117:{depth:0,height:.44444,italic:0,skew:0},118:{depth:0,height:.44444,italic:.01597,skew:0},119:{depth:0,height:.44444,italic:.01597,skew:0},120:{depth:0,height:.44444,italic:0,skew:0},121:{depth:.19444,height:.44444,italic:.01597,skew:0},122:{depth:0,height:.44444,italic:0,skew:0},123:{depth:.25,height:.75,italic:0,skew:0},124:{depth:.25,height:.75,italic:0,skew:0},125:{depth:.25,height:.75,italic:0,skew:0},126:{depth:.35,height:.34444,italic:0,skew:0},168:{depth:0,height:.69444,italic:0,skew:0},172:{depth:0,height:.44444,italic:0,skew:0},175:{depth:0,height:.59611,italic:0,skew:0},176:{depth:0,height:.69444,italic:0,skew:0},177:{depth:.13333,height:.63333,italic:0,skew:0},180:{depth:0,height:.69444,italic:0,skew:0},215:{depth:.13333,height:.63333,italic:0,skew:0},247:{depth:.13333,height:.63333,italic:0,skew:0},305:{depth:0,height:.44444,italic:0,skew:0},567:{depth:.19444,height:.44444,italic:0,skew:0},710:{depth:0,height:.69444,italic:0,skew:0},711:{depth:0,height:.63194,italic:0,skew:0},713:{depth:0,height:.59611,italic:0,skew:0},714:{depth:0,height:.69444,italic:0,skew:0},715:{depth:0,height:.69444,italic:0,skew:0},728:{depth:0,height:.69444,italic:0,skew:0},729:{depth:0,height:.69444,italic:0,skew:0},730:{depth:0,height:.69444,italic:0,skew:0},732:{depth:0,height:.69444,italic:0,skew:0},768:{depth:0,height:.69444,italic:0,skew:0},769:{depth:0,height:.69444,italic:0,skew:0},770:{depth:0,height:.69444,italic:0,skew:0},771:{depth:0,height:.69444,italic:0,skew:0},772:{depth:0,height:.59611,italic:0,skew:0},774:{depth:0,height:.69444,italic:0,skew:0},775:{depth:0,height:.69444,italic:0,skew:0},776:{depth:0,height:.69444,italic:0,skew:0},778:{depth:0,height:.69444,italic:0,skew:0},779:{depth:0,height:.69444,italic:0,skew:0},780:{depth:0,height:.63194,italic:0,skew:0},824:{depth:.19444,height:.69444,italic:0,skew:0},915:{depth:0,height:.68611,italic:0,skew:0},916:{depth:0,height:.68611,italic:0,skew:0},920:{depth:0,height:.68611,italic:0,skew:0},923:{depth:0,height:.68611,italic:0,skew:0},926:{depth:0,height:.68611,italic:0,skew:0},928:{depth:0,height:.68611,italic:0,skew:0},931:{depth:0,height:.68611,italic:0,skew:0},933:{depth:0,height:.68611,italic:0,skew:0},934:{depth:0,height:.68611,italic:0,skew:0},936:{depth:0,height:.68611,italic:0,skew:0},937:{depth:0,height:.68611,italic:0,skew:0},8211:{depth:0,height:.44444,italic:.03194,skew:0},8212:{depth:0,height:.44444,italic:.03194,skew:0},8216:{depth:0,height:.69444,italic:0,skew:0},8217:{depth:0,height:.69444,italic:0,skew:0},8220:{depth:0,height:.69444,italic:0,skew:0},8221:{depth:0,height:.69444,italic:0,skew:0},8224:{depth:.19444,height:.69444,italic:0,skew:0},8225:{depth:.19444,height:.69444,italic:0,skew:0},8242:{depth:0,height:.55556,italic:0,skew:0},8407:{depth:0,height:.72444,italic:.15486,skew:0},8463:{depth:0,height:.69444,italic:0,skew:0},8465:{depth:0,height:.69444,italic:0,skew:0},8467:{depth:0,height:.69444,italic:0,skew:0},8472:{depth:.19444,height:.44444,italic:0,skew:0},8476:{depth:0,height:.69444,italic:0,skew:0},8501:{depth:0,height:.69444,italic:0,skew:0},8592:{depth:-.10889,height:.39111,italic:0,skew:0},8593:{depth:.19444,height:.69444,italic:0,skew:0},8594:{depth:-.10889,height:.39111,italic:0,skew:0},8595:{depth:.19444,height:.69444,italic:0,skew:0},8596:{depth:-.10889,height:.39111,italic:0,skew:0},8597:{depth:.25,height:.75,italic:0,skew:0},8598:{depth:.19444,height:.69444,italic:0,skew:0},8599:{depth:.19444,height:.69444,italic:0,skew:0},8600:{depth:.19444,height:.69444,italic:0,skew:0},8601:{depth:.19444,height:.69444,italic:0,skew:0},8636:{depth:-.10889,height:.39111,italic:0,skew:0},8637:{depth:-.10889,height:.39111,italic:0,skew:0},8640:{depth:-.10889,height:.39111,italic:0,skew:0},8641:{depth:-.10889,height:.39111,italic:0,skew:0},8656:{depth:-.10889,height:.39111,italic:0,skew:0},8657:{depth:.19444,height:.69444,italic:0,skew:0},8658:{depth:-.10889,height:.39111,italic:0,skew:0},8659:{depth:.19444,height:.69444,italic:0,skew:0},8660:{depth:-.10889,height:.39111,italic:0,skew:0},8661:{depth:.25,height:.75,italic:0,skew:0},8704:{depth:0,height:.69444,italic:0,skew:0},8706:{depth:0,height:.69444,italic:.06389,skew:0},8707:{depth:0,height:.69444,italic:0,skew:0},8709:{depth:.05556,height:.75,italic:0,skew:0},8711:{depth:0,height:.68611,italic:0,skew:0},8712:{depth:.08556,height:.58556,italic:0,skew:0},8715:{depth:.08556,height:.58556,italic:0,skew:0},8722:{depth:.13333,height:.63333,italic:0,skew:0},8723:{depth:.13333,height:.63333,italic:0,skew:0},8725:{depth:.25,height:.75,italic:0,skew:0},8726:{depth:.25,height:.75,italic:0,skew:0},8727:{depth:-.02778,height:.47222,italic:0,skew:0},8728:{depth:-.02639,height:.47361,italic:0,skew:0},8729:{depth:-.02639,height:.47361,italic:0,skew:0},8730:{depth:.18,height:.82,italic:0,skew:0},8733:{depth:0,height:.44444,italic:0,skew:0},8734:{depth:0,height:.44444,italic:0,skew:0},8736:{depth:0,height:.69224,italic:0,skew:0},8739:{depth:.25,height:.75,italic:0,skew:0},8741:{depth:.25,height:.75,italic:0,skew:0},8743:{depth:0,height:.55556,italic:0,skew:0},8744:{depth:0,height:.55556,italic:0,skew:0},8745:{depth:0,height:.55556,italic:0,skew:0},8746:{depth:0,height:.55556,italic:0,skew:0},8747:{depth:.19444,height:.69444,italic:.12778,skew:0},8764:{depth:-.10889,height:.39111,italic:0,skew:0},8768:{depth:.19444,height:.69444,italic:0,skew:0},8771:{depth:.00222,height:.50222,italic:0,skew:0},8776:{depth:.02444,height:.52444,italic:0,skew:0},8781:{depth:.00222,height:.50222,italic:0,skew:0},8801:{depth:.00222,height:.50222,italic:0,skew:0},8804:{depth:.19667,height:.69667,italic:0,skew:0},8805:{depth:.19667,height:.69667,italic:0,skew:0},8810:{depth:.08556,height:.58556,italic:0,skew:0},8811:{depth:.08556,height:.58556,italic:0,skew:0},8826:{depth:.08556,height:.58556,italic:0,skew:0},8827:{depth:.08556,height:.58556,italic:0,skew:0},8834:{depth:.08556,height:.58556,italic:0,skew:0},8835:{depth:.08556,height:.58556,italic:0,skew:0},8838:{depth:.19667,height:.69667,italic:0,skew:0},8839:{depth:.19667,height:.69667,italic:0,skew:0},8846:{depth:0,height:.55556,italic:0,skew:0},8849:{depth:.19667,height:.69667,italic:0,skew:0},8850:{depth:.19667,height:.69667,italic:0,skew:0},8851:{depth:0,height:.55556,italic:0,skew:0},8852:{depth:0,height:.55556,italic:0,skew:0},8853:{depth:.13333,height:.63333,italic:0,skew:0},8854:{depth:.13333,height:.63333,italic:0,skew:0},8855:{depth:.13333,height:.63333,italic:0,skew:0},8856:{depth:.13333,height:.63333,italic:0,skew:0},8857:{depth:.13333,height:.63333,italic:0,skew:0},8866:{depth:0,height:.69444,italic:0,skew:0},8867:{depth:0,height:.69444,italic:0,skew:0},8868:{depth:0,height:.69444,italic:0,skew:0},8869:{depth:0,height:.69444,italic:0,skew:0},8900:{depth:-.02639,height:.47361,italic:0,skew:0},8901:{depth:-.02639,height:.47361,italic:0,skew:0},8902:{depth:-.02778,height:.47222,italic:0,skew:0},8968:{depth:.25,height:.75,italic:0,skew:0},8969:{depth:.25,height:.75,italic:0,skew:0},8970:{depth:.25,height:.75,italic:0,skew:0},8971:{depth:.25,height:.75,italic:0,skew:0},8994:{depth:-.13889,height:.36111,italic:0,skew:0},8995:{depth:-.13889,height:.36111,italic:0,skew:0},9651:{depth:.19444,height:.69444,italic:0,skew:0},9657:{depth:-.02778,height:.47222,italic:0,skew:0},9661:{depth:.19444,height:.69444,italic:0,skew:0},9667:{depth:-.02778,height:.47222,italic:0,skew:0},9711:{depth:.19444,height:.69444,italic:0,skew:0},9824:{depth:.12963,height:.69444,italic:0,skew:0},9825:{depth:.12963,height:.69444,italic:0,skew:0},9826:{depth:.12963,height:.69444,italic:0,skew:0},9827:{depth:.12963,height:.69444,italic:0,skew:0},9837:{depth:0,height:.75,italic:0,skew:0},9838:{depth:.19444,height:.69444,italic:0,skew:0},9839:{depth:.19444,height:.69444,italic:0,skew:0},10216:{depth:.25,height:.75,italic:0,skew:0},10217:{depth:.25,height:.75,italic:0,skew:0},10815:{depth:0,height:.68611,italic:0,skew:0},10927:{depth:.19667,height:.69667,italic:0,skew:0},10928:{depth:.19667,height:.69667,italic:0,skew:0}},"Main-Italic":{33:{depth:0,height:.69444,italic:.12417,skew:0},34:{depth:0,height:.69444,italic:.06961,skew:0},35:{depth:.19444,height:.69444,italic:.06616,skew:0},37:{depth:.05556,height:.75,italic:.13639,skew:0},38:{depth:0,height:.69444,italic:.09694,skew:0},39:{depth:0,height:.69444,italic:.12417,skew:0},40:{depth:.25,height:.75,italic:.16194,skew:0},41:{depth:.25,height:.75,italic:.03694,skew:0},42:{depth:0,height:.75,italic:.14917,skew:0},43:{depth:.05667,height:.56167,italic:.03694,skew:0},44:{depth:.19444,height:.10556,italic:0,skew:0},45:{depth:0,height:.43056,italic:.02826,skew:0},46:{depth:0,height:.10556,italic:0,skew:0},47:{depth:.25,height:.75,italic:.16194,skew:0},48:{depth:0,height:.64444,italic:.13556,skew:0},49:{depth:0,height:.64444,italic:.13556,skew:0},50:{depth:0,height:.64444,italic:.13556,skew:0},51:{depth:0,height:.64444,italic:.13556,skew:0},52:{depth:.19444,height:.64444,italic:.13556,skew:0},53:{depth:0,height:.64444,italic:.13556,skew:0},54:{depth:0,height:.64444,italic:.13556,skew:0},55:{depth:.19444,height:.64444,italic:.13556,skew:0},56:{depth:0,height:.64444,italic:.13556,skew:0},57:{depth:0,height:.64444,italic:.13556,skew:0},58:{depth:0,height:.43056,italic:.0582,skew:0},59:{depth:.19444,height:.43056,italic:.0582,skew:0},61:{depth:-.13313,height:.36687,italic:.06616,skew:0},63:{depth:0,height:.69444,italic:.1225,skew:0},64:{depth:0,height:.69444,italic:.09597,skew:0},65:{depth:0,height:.68333,italic:0,skew:0},66:{depth:0,height:.68333,italic:.10257,skew:0},67:{depth:0,height:.68333,italic:.14528,skew:0},68:{depth:0,height:.68333,italic:.09403,skew:0},69:{depth:0,height:.68333,italic:.12028,skew:0},70:{depth:0,height:.68333,italic:.13305,skew:0},71:{depth:0,height:.68333,italic:.08722,skew:0},72:{depth:0,height:.68333,italic:.16389,skew:0},73:{depth:0,height:.68333,italic:.15806,skew:0},74:{depth:0,height:.68333,italic:.14028,skew:0},75:{depth:0,height:.68333,italic:.14528,skew:0},76:{depth:0,height:.68333,italic:0,skew:0},77:{depth:0,height:.68333,italic:.16389,skew:0},78:{depth:0,height:.68333,italic:.16389,skew:0},79:{depth:0,height:.68333,italic:.09403,skew:0},80:{depth:0,height:.68333,italic:.10257,skew:0},81:{depth:.19444,height:.68333,italic:.09403,skew:0},82:{depth:0,height:.68333,italic:.03868,skew:0},83:{depth:0,height:.68333,italic:.11972,skew:0},84:{depth:0,height:.68333,italic:.13305,skew:0},85:{depth:0,height:.68333,italic:.16389,skew:0},86:{depth:0,height:.68333,italic:.18361,skew:0},87:{depth:0,height:.68333,italic:.18361,skew:0},88:{depth:0,height:.68333,italic:.15806,skew:0},89:{depth:0,height:.68333,italic:.19383,skew:0},90:{depth:0,height:.68333,italic:.14528,skew:0},91:{depth:.25,height:.75,italic:.1875,skew:0},93:{depth:.25,height:.75,italic:.10528,skew:0},94:{depth:0,height:.69444,italic:.06646,skew:0},95:{depth:.31,height:.12056,italic:.09208,skew:0},97:{depth:0,height:.43056,italic:.07671,skew:0},98:{depth:0,height:.69444,italic:.06312,skew:0},99:{depth:0,height:.43056,italic:.05653,skew:0},100:{depth:0,height:.69444,italic:.10333,skew:0},101:{depth:0,height:.43056,italic:.07514,skew:0},102:{depth:.19444,height:.69444,italic:.21194,skew:0},103:{depth:.19444,height:.43056,italic:.08847,skew:0},104:{depth:0,height:.69444,italic:.07671,skew:0},105:{depth:0,height:.65536,italic:.1019,skew:0},106:{depth:.19444,height:.65536,italic:.14467,skew:0},107:{depth:0,height:.69444,italic:.10764,skew:0},108:{depth:0,height:.69444,italic:.10333,skew:0},109:{depth:0,height:.43056,italic:.07671,skew:0},110:{depth:0,height:.43056,italic:.07671,skew:0},111:{depth:0,height:.43056,italic:.06312,skew:0},112:{depth:.19444,height:.43056,italic:.06312,skew:0},113:{depth:.19444,height:.43056,italic:.08847,skew:0},114:{depth:0,height:.43056,italic:.10764,skew:0},115:{depth:0,height:.43056,italic:.08208,skew:0},116:{depth:0,height:.61508,italic:.09486,skew:0},117:{depth:0,height:.43056,italic:.07671,skew:0},118:{depth:0,height:.43056,italic:.10764,skew:0},119:{depth:0,height:.43056,italic:.10764,skew:0},120:{depth:0,height:.43056,italic:.12042,skew:0},121:{depth:.19444,height:.43056,italic:.08847,skew:0},122:{depth:0,height:.43056,italic:.12292,skew:0},126:{depth:.35,height:.31786,italic:.11585,skew:0},163:{depth:0,height:.69444,italic:0,skew:0},305:{depth:0,height:.43056,italic:0,skew:.02778},567:{depth:.19444,height:.43056,italic:0,skew:.08334},768:{depth:0,height:.69444,italic:0,skew:0},769:{depth:0,height:.69444,italic:.09694,skew:0},770:{depth:0,height:.69444,italic:.06646,skew:0},771:{depth:0,height:.66786,italic:.11585,skew:0},772:{depth:0,height:.56167,italic:.10333,skew:0},774:{depth:0,height:.69444,italic:.10806,skew:0},775:{depth:0,height:.66786,italic:.11752,skew:0},776:{depth:0,height:.66786,italic:.10474,skew:0},778:{depth:0,height:.69444,italic:0,skew:0},779:{depth:0,height:.69444,italic:.1225,skew:0},780:{depth:0,height:.62847,italic:.08295,skew:0},915:{depth:0,height:.68333,italic:.13305,skew:0},916:{depth:0,height:.68333,italic:0,skew:0},920:{depth:0,height:.68333,italic:.09403,skew:0},923:{depth:0,height:.68333,italic:0,skew:0},926:{depth:0,height:.68333,italic:.15294,skew:0},928:{depth:0,height:.68333,italic:.16389,skew:0},931:{depth:0,height:.68333,italic:.12028,skew:0},933:{depth:0,height:.68333,italic:.11111,skew:0},934:{depth:0,height:.68333,italic:.05986,skew:0},936:{depth:0,height:.68333,italic:.11111,skew:0},937:{depth:0,height:.68333,italic:.10257,skew:0},8211:{depth:0,height:.43056,italic:.09208,skew:0},8212:{depth:0,height:.43056,italic:.09208,skew:0},8216:{depth:0,height:.69444,italic:.12417,skew:0},8217:{depth:0,height:.69444,italic:.12417,skew:0},8220:{depth:0,height:.69444,italic:.1685,skew:0},8221:{depth:0,height:.69444,italic:.06961,skew:0},8463:{depth:0,height:.68889,italic:0,skew:0}},"Main-Regular":{32:{depth:0,height:0,italic:0,skew:0},33:{depth:0,height:.69444,italic:0,skew:0},34:{depth:0,height:.69444,italic:0,skew:0},35:{depth:.19444,height:.69444,italic:0,skew:0},36:{depth:.05556,height:.75,italic:0,skew:0},37:{depth:.05556,height:.75,italic:0,skew:0},38:{depth:0,height:.69444,italic:0,skew:0},39:{depth:0,height:.69444,italic:0,skew:0},40:{depth:.25,height:.75,italic:0,skew:0},41:{depth:.25,height:.75,italic:0,skew:0},42:{depth:0,height:.75,italic:0,skew:0},43:{depth:.08333,height:.58333,italic:0,skew:0},44:{depth:.19444,height:.10556,italic:0,skew:0},45:{depth:0,height:.43056,italic:0,skew:0},46:{depth:0,height:.10556,italic:0,skew:0},47:{depth:.25,height:.75,italic:0,skew:0},48:{depth:0,height:.64444,italic:0,skew:0},49:{depth:0,height:.64444,italic:0,skew:0},50:{depth:0,height:.64444,italic:0,skew:0},51:{depth:0,height:.64444,italic:0,skew:0},52:{depth:0,height:.64444,italic:0,skew:0},53:{depth:0,height:.64444,italic:0,skew:0},54:{depth:0,height:.64444,italic:0,skew:0},55:{depth:0,height:.64444,italic:0,skew:0},56:{depth:0,height:.64444,italic:0,skew:0},57:{depth:0,height:.64444,italic:0,skew:0},58:{depth:0,height:.43056,italic:0,skew:0},59:{depth:.19444,height:.43056,italic:0,skew:0},60:{depth:.0391,height:.5391,italic:0,skew:0},61:{depth:-.13313,height:.36687,italic:0,skew:0},62:{depth:.0391,height:.5391,italic:0,skew:0},63:{depth:0,height:.69444,italic:0,skew:0},64:{depth:0,height:.69444,italic:0,skew:0},65:{depth:0,height:.68333,italic:0,skew:0},66:{depth:0,height:.68333,italic:0,skew:0},67:{depth:0,height:.68333,italic:0,skew:0},68:{depth:0,height:.68333,italic:0,skew:0},69:{depth:0,height:.68333,italic:0,skew:0},70:{depth:0,height:.68333,italic:0,skew:0},71:{depth:0,height:.68333,italic:0,skew:0},72:{depth:0,height:.68333,italic:0,skew:0},73:{depth:0,height:.68333,italic:0,skew:0},74:{depth:0,height:.68333,italic:0,skew:0},75:{depth:0,height:.68333,italic:0,skew:0},76:{depth:0,height:.68333,italic:0,skew:0},77:{depth:0,height:.68333,italic:0,skew:0},78:{depth:0,height:.68333,italic:0,skew:0},79:{depth:0,height:.68333,italic:0,skew:0},80:{depth:0,height:.68333,italic:0,skew:0},81:{depth:.19444,height:.68333,italic:0,skew:0},82:{depth:0,height:.68333,italic:0,skew:0},83:{depth:0,height:.68333,italic:0,skew:0},84:{depth:0,height:.68333,italic:0,skew:0},85:{depth:0,height:.68333,italic:0,skew:0},86:{depth:0,height:.68333,italic:.01389,skew:0},87:{depth:0,height:.68333,italic:.01389,skew:0},88:{depth:0,height:.68333,italic:0,skew:0},89:{depth:0,height:.68333,italic:.025,skew:0},90:{depth:0,height:.68333,italic:0,skew:0},91:{depth:.25,height:.75,italic:0,skew:0},92:{depth:.25,height:.75,italic:0,skew:0},93:{depth:.25,height:.75,italic:0,skew:0},94:{depth:0,height:.69444,italic:0,skew:0},95:{depth:.31,height:.12056,italic:.02778,skew:0},96:{depth:0,height:.69444,italic:0,skew:0},97:{depth:0,height:.43056,italic:0,skew:0},98:{depth:0,height:.69444,italic:0,skew:0},99:{depth:0,height:.43056,italic:0,skew:0},100:{depth:0,height:.69444,italic:0,skew:0},101:{depth:0,height:.43056,italic:0,skew:0},102:{depth:0,height:.69444,italic:.07778,skew:0},103:{depth:.19444,height:.43056,italic:.01389,skew:0},104:{depth:0,height:.69444,italic:0,skew:0},105:{depth:0,height:.66786,italic:0,skew:0},106:{depth:.19444,height:.66786,italic:0,skew:0},107:{depth:0,height:.69444,italic:0,skew:0},108:{depth:0,height:.69444,italic:0,skew:0},109:{depth:0,height:.43056,italic:0,skew:0},110:{depth:0,height:.43056,italic:0,skew:0},111:{depth:0,height:.43056,italic:0,skew:0},112:{depth:.19444,height:.43056,italic:0,skew:0},113:{depth:.19444,height:.43056,italic:0,skew:0},114:{depth:0,height:.43056,italic:0,skew:0},115:{depth:0,height:.43056,italic:0,skew:0},116:{depth:0,height:.61508,italic:0,skew:0},117:{depth:0,height:.43056,italic:0,skew:0},118:{depth:0,height:.43056,italic:.01389,skew:0},119:{depth:0,height:.43056,italic:.01389,skew:0},120:{depth:0,height:.43056,italic:0,skew:0},121:{depth:.19444,height:.43056,italic:.01389,skew:0},122:{depth:0,height:.43056,italic:0,skew:0},123:{depth:.25,height:.75,italic:0,skew:0},124:{depth:.25,height:.75,italic:0,skew:0},125:{depth:.25,height:.75,italic:0,skew:0},126:{depth:.35,height:.31786,italic:0,skew:0},160:{depth:0,height:0,italic:0,skew:0},168:{depth:0,height:.66786,italic:0,skew:0},172:{depth:0,height:.43056,italic:0,skew:0},175:{depth:0,height:.56778,italic:0,skew:0},176:{depth:0,height:.69444,italic:0,skew:0},177:{depth:.08333,height:.58333,italic:0,skew:0},180:{depth:0,height:.69444,italic:0,skew:0},215:{depth:.08333,height:.58333,italic:0,skew:0},247:{depth:.08333,height:.58333,italic:0,skew:0},305:{depth:0,height:.43056,italic:0,skew:0},567:{depth:.19444,height:.43056,italic:0,skew:0},710:{depth:0,height:.69444,italic:0,skew:0},711:{depth:0,height:.62847,italic:0,skew:0},713:{depth:0,height:.56778,italic:0,skew:0},714:{depth:0,height:.69444,italic:0,skew:0},715:{depth:0,height:.69444,italic:0,skew:0},728:{depth:0,height:.69444,italic:0,skew:0},729:{depth:0,height:.66786,italic:0,skew:0},730:{depth:0,height:.69444,italic:0,skew:0},732:{depth:0,height:.66786,italic:0,skew:0},768:{depth:0,height:.69444,italic:0,skew:0},769:{depth:0,height:.69444,italic:0,skew:0},770:{depth:0,height:.69444,italic:0,skew:0},771:{depth:0,height:.66786,italic:0,skew:0},772:{depth:0,height:.56778,italic:0,skew:0},774:{depth:0,height:.69444,italic:0,skew:0},775:{depth:0,height:.66786,italic:0,skew:0},776:{depth:0,height:.66786,italic:0,skew:0},778:{depth:0,height:.69444,italic:0,skew:0},779:{depth:0,height:.69444,italic:0,skew:0},780:{depth:0,height:.62847,italic:0,skew:0},824:{depth:.19444,height:.69444,italic:0,skew:0},915:{depth:0,height:.68333,italic:0,skew:0},916:{depth:0,height:.68333,italic:0,skew:0},920:{depth:0,height:.68333,italic:0,skew:0},923:{depth:0,height:.68333,italic:0,skew:0},926:{depth:0,height:.68333,italic:0,skew:0},928:{depth:0,height:.68333,italic:0,skew:0},931:{depth:0,height:.68333,italic:0,skew:0},933:{depth:0,height:.68333,italic:0,skew:0},934:{depth:0,height:.68333,italic:0,skew:0},936:{depth:0,height:.68333,italic:0,skew:0},937:{depth:0,height:.68333,italic:0,skew:0},8211:{depth:0,height:.43056,italic:.02778,skew:0},8212:{depth:0,height:.43056,italic:.02778,skew:0},8216:{depth:0,height:.69444,italic:0,skew:0},8217:{depth:0,height:.69444,italic:0,skew:0},8220:{depth:0,height:.69444,italic:0,skew:0},8221:{depth:0,height:.69444,italic:0,skew:0},8224:{depth:.19444,height:.69444,italic:0,skew:0},8225:{depth:.19444,height:.69444,italic:0,skew:0},8230:{depth:0,height:.12,italic:0,skew:0},8242:{depth:0,height:.55556,italic:0,skew:0},8407:{depth:0,height:.71444,italic:.15382,skew:0},8463:{depth:0,height:.68889,italic:0,skew:0},8465:{depth:0,height:.69444,italic:0,skew:0},8467:{depth:0,height:.69444,italic:0,skew:.11111},8472:{depth:.19444,height:.43056,italic:0,skew:.11111},8476:{depth:0,height:.69444,italic:0,skew:0},8501:{depth:0,height:.69444,italic:0,skew:0},8592:{depth:-.13313,height:.36687,italic:0,skew:0},8593:{depth:.19444,height:.69444,italic:0,skew:0},8594:{depth:-.13313,height:.36687,italic:0,skew:0},8595:{depth:.19444,height:.69444,italic:0,skew:0},8596:{depth:-.13313,height:.36687,italic:0,skew:0},8597:{depth:.25,height:.75,italic:0,skew:0},8598:{depth:.19444,height:.69444,italic:0,skew:0},8599:{depth:.19444,height:.69444,italic:0,skew:0},8600:{depth:.19444,height:.69444,italic:0,skew:0},8601:{depth:.19444,height:.69444,italic:0,skew:0},8614:{depth:.011,height:.511,italic:0,skew:0},8617:{depth:.011,height:.511,italic:0,skew:0},8618:{depth:.011,height:.511,italic:0,skew:0},8636:{depth:-.13313,height:.36687,italic:0,skew:0},8637:{depth:-.13313,height:.36687,italic:0,skew:0},8640:{depth:-.13313,height:.36687,italic:0,skew:0},8641:{depth:-.13313,height:.36687,italic:0,skew:0},8652:{depth:.011,height:.671,italic:0,skew:0},8656:{depth:-.13313,height:.36687,italic:0,skew:0},8657:{depth:.19444,height:.69444,italic:0,skew:0},8658:{depth:-.13313,height:.36687,italic:0,skew:0},8659:{depth:.19444,height:.69444,italic:0,skew:0},8660:{depth:-.13313,height:.36687,italic:0,skew:0},8661:{depth:.25,height:.75,italic:0,skew:0},8704:{depth:0,height:.69444,italic:0,skew:0},8706:{depth:0,height:.69444,italic:.05556,skew:.08334},8707:{depth:0,height:.69444,italic:0,skew:0},8709:{depth:.05556,height:.75,italic:0,skew:0},8711:{depth:0,height:.68333,italic:0,skew:0},8712:{depth:.0391,height:.5391,italic:0,skew:0},8715:{depth:.0391,height:.5391,italic:0,skew:0},8722:{depth:.08333,height:.58333,italic:0,skew:0},8723:{depth:.08333,height:.58333,italic:0,skew:0},8725:{depth:.25,height:.75,italic:0,skew:0},8726:{depth:.25,height:.75,italic:0,skew:0},8727:{depth:-.03472,height:.46528,italic:0,skew:0},8728:{depth:-.05555,height:.44445,italic:0,skew:0},8729:{depth:-.05555,height:.44445,italic:0,skew:0},8730:{depth:.2,height:.8,italic:0,skew:0},8733:{depth:0,height:.43056,italic:0,skew:0},8734:{depth:0,height:.43056,italic:0,skew:0},8736:{depth:0,height:.69224,italic:0,skew:0},8739:{depth:.25,height:.75,italic:0,skew:0},8741:{depth:.25,height:.75,italic:0,skew:0},8743:{depth:0,height:.55556,italic:0,skew:0},8744:{depth:0,height:.55556,italic:0,skew:0},8745:{depth:0,height:.55556,italic:0,skew:0},8746:{depth:0,height:.55556,italic:0,skew:0},8747:{depth:.19444,height:.69444,italic:.11111,skew:0},8764:{depth:-.13313,height:.36687,italic:0,skew:0},8768:{depth:.19444,height:.69444,italic:0,skew:0},8771:{depth:-.03625,height:.46375,italic:0,skew:0},8773:{depth:-.022,height:.589,italic:0,skew:0},8776:{depth:-.01688,height:.48312,italic:0,skew:0},8781:{depth:-.03625,height:.46375,italic:0,skew:0},8784:{depth:-.133,height:.67,italic:0,skew:0},8800:{depth:.215,height:.716,italic:0,skew:0},8801:{depth:-.03625,height:.46375,italic:0,skew:0},8804:{depth:.13597,height:.63597,italic:0,skew:0},8805:{depth:.13597,height:.63597,italic:0,skew:0},8810:{depth:.0391,height:.5391,italic:0,skew:0},8811:{depth:.0391,height:.5391,italic:0,skew:0},8826:{depth:.0391,height:.5391,italic:0,skew:0},8827:{depth:.0391,height:.5391,italic:0,skew:0},8834:{depth:.0391,height:.5391,italic:0,skew:0},8835:{depth:.0391,height:.5391,italic:0,skew:0},8838:{depth:.13597,height:.63597,italic:0,skew:0},8839:{depth:.13597,height:.63597,italic:0,skew:0},8846:{depth:0,height:.55556,italic:0,skew:0},8849:{depth:.13597,height:.63597,italic:0,skew:0},8850:{depth:.13597,height:.63597,italic:0,skew:0},8851:{depth:0,height:.55556,italic:0,skew:0},8852:{depth:0,height:.55556,italic:0,skew:0},8853:{depth:.08333,height:.58333,italic:0,skew:0},8854:{depth:.08333,height:.58333,italic:0,skew:0},8855:{depth:.08333,height:.58333,italic:0,skew:0},8856:{depth:.08333,height:.58333,italic:0,skew:0},8857:{depth:.08333,height:.58333,italic:0,skew:0},8866:{depth:0,height:.69444,italic:0,skew:0},8867:{depth:0,height:.69444,italic:0,skew:0},8868:{depth:0,height:.69444,italic:0,skew:0},8869:{depth:0,height:.69444,italic:0,skew:0},8872:{depth:.249,height:.75,italic:0,skew:0},8900:{depth:-.05555,height:.44445,italic:0,skew:0},8901:{depth:-.05555,height:.44445,italic:0,skew:0},8902:{depth:-.03472,height:.46528,italic:0,skew:0},8904:{depth:.005,height:.505,italic:0,skew:0},8942:{depth:.03,height:.9,italic:0,skew:0},8943:{depth:-.19,height:.31,italic:0,skew:0},8945:{depth:-.1,height:.82,italic:0,skew:0},8968:{depth:.25,height:.75,italic:0,skew:0},8969:{depth:.25,height:.75,italic:0,skew:0},8970:{depth:.25,height:.75,italic:0,skew:0},8971:{depth:.25,height:.75,italic:0,skew:0},8994:{depth:-.14236,height:.35764,italic:0,skew:0},8995:{depth:-.14236,height:.35764,italic:0,skew:0},9136:{depth:.244,height:.744,italic:0,skew:0},9137:{depth:.244,height:.744,italic:0,skew:0},9651:{depth:.19444,height:.69444,italic:0,skew:0},9657:{depth:-.03472,height:.46528,italic:0,skew:0},9661:{depth:.19444,height:.69444,italic:0,skew:0},9667:{depth:-.03472,height:.46528,italic:0,skew:0},9711:{depth:.19444,height:.69444,italic:0,skew:0},9824:{depth:.12963,height:.69444,italic:0,skew:0},9825:{depth:.12963,height:.69444,italic:0,skew:0},9826:{depth:.12963,height:.69444,italic:0,skew:0},9827:{depth:.12963,height:.69444,italic:0,skew:0},9837:{depth:0,height:.75,italic:0,skew:0},9838:{depth:.19444,height:.69444,italic:0,skew:0},9839:{depth:.19444,height:.69444,italic:0,skew:0},10216:{depth:.25,height:.75,italic:0,skew:0},10217:{depth:.25,height:.75,italic:0,skew:0},10222:{depth:.244,height:.744,italic:0,skew:0},10223:{depth:.244,height:.744,italic:0,skew:0},10229:{depth:.011,height:.511,italic:0,skew:0},10230:{depth:.011,height:.511,italic:0,skew:0},10231:{depth:.011,height:.511,italic:0,skew:0},10232:{depth:.024,height:.525,italic:0,skew:0},10233:{depth:.024,height:.525,italic:0,skew:0},10234:{depth:.024,height:.525,italic:0,skew:0},10236:{depth:.011,height:.511,italic:0,skew:0},10815:{depth:0,height:.68333,italic:0,skew:0},10927:{depth:.13597,height:.63597,italic:0,skew:0},10928:{depth:.13597,height:.63597,italic:0,skew:0}},"Math-BoldItalic":{47:{depth:.19444,height:.69444,italic:0,skew:0},65:{depth:0,height:.68611,italic:0,skew:0},66:{depth:0,height:.68611,italic:.04835,skew:0},67:{depth:0,height:.68611,italic:.06979,skew:0},68:{depth:0,height:.68611,italic:.03194,skew:0},69:{depth:0,height:.68611,italic:.05451,skew:0},70:{depth:0,height:.68611,italic:.15972,skew:0},71:{depth:0,height:.68611,italic:0,skew:0},72:{depth:0,height:.68611,italic:.08229,skew:0},73:{depth:0,height:.68611,italic:.07778,skew:0},74:{depth:0,height:.68611,italic:.10069,skew:0},75:{depth:0,height:.68611,italic:.06979,skew:0},76:{depth:0,height:.68611,italic:0,skew:0},77:{depth:0,height:.68611,italic:.11424,skew:0},78:{depth:0,height:.68611,italic:.11424,skew:0},79:{depth:0,height:.68611,italic:.03194,skew:0},80:{depth:0,height:.68611,italic:.15972,skew:0},81:{depth:.19444,height:.68611,italic:0,skew:0},82:{depth:0,height:.68611,italic:.00421,skew:0},83:{depth:0,height:.68611,italic:.05382,skew:0},84:{depth:0,height:.68611,italic:.15972,skew:0},85:{depth:0,height:.68611,italic:.11424,skew:0},86:{depth:0,height:.68611,italic:.25555,skew:0},87:{depth:0,height:.68611,italic:.15972,skew:0},88:{depth:0,height:.68611,italic:.07778,skew:0},89:{depth:0,height:.68611,italic:.25555,skew:0},90:{depth:0,height:.68611,italic:.06979,skew:0},97:{depth:0,height:.44444,italic:0,skew:0},98:{depth:0,height:.69444,italic:0,skew:0},99:{depth:0,height:.44444,italic:0,skew:0},100:{depth:0,height:.69444,italic:0,skew:0},101:{depth:0,height:.44444,italic:0,skew:0},102:{depth:.19444,height:.69444,italic:.11042,skew:0},103:{depth:.19444,height:.44444,italic:.03704,skew:0},104:{depth:0,height:.69444,italic:0,skew:0},105:{depth:0,height:.69326,italic:0,skew:0},106:{depth:.19444,height:.69326,italic:.0622,skew:0},107:{depth:0,height:.69444,italic:.01852,skew:0},108:{depth:0,height:.69444,italic:.0088,skew:0},109:{depth:0,height:.44444,italic:0,skew:0},110:{depth:0,height:.44444,italic:0,skew:0},111:{depth:0,height:.44444,italic:0,skew:0},112:{depth:.19444,height:.44444,italic:0,skew:0},113:{depth:.19444,height:.44444,italic:.03704,skew:0},114:{depth:0,height:.44444,italic:.03194,skew:0},115:{depth:0,height:.44444,italic:0,skew:0},116:{depth:0,height:.63492,italic:0,skew:0},117:{depth:0,height:.44444,italic:0,skew:0},118:{depth:0,height:.44444,italic:.03704,skew:0},119:{depth:0,height:.44444,italic:.02778,skew:0},120:{depth:0,height:.44444,italic:0,skew:0},121:{depth:.19444,height:.44444,italic:.03704,skew:0},122:{depth:0,height:.44444,italic:.04213,skew:0},915:{depth:0,height:.68611,italic:.15972,skew:0},916:{depth:0,height:.68611,italic:0,skew:0},920:{depth:0,height:.68611,italic:.03194,skew:0},923:{depth:0,height:.68611,italic:0,skew:0},926:{depth:0,height:.68611,italic:.07458,skew:0},928:{depth:0,height:.68611,italic:.08229,skew:0},931:{depth:0,height:.68611,italic:.05451,skew:0},933:{depth:0,height:.68611,italic:.15972,skew:0},934:{depth:0,height:.68611,italic:0,skew:0},936:{depth:0,height:.68611,italic:.11653,skew:0},937:{depth:0,height:.68611,italic:.04835,skew:0},945:{depth:0,height:.44444,italic:0,skew:0},946:{depth:.19444,height:.69444,italic:.03403,skew:0},947:{depth:.19444,height:.44444,italic:.06389,skew:0},948:{depth:0,height:.69444,italic:.03819,skew:0},949:{depth:0,height:.44444,italic:0,skew:0},950:{depth:.19444,height:.69444,italic:.06215,skew:0},951:{depth:.19444,height:.44444,italic:.03704,skew:0},952:{depth:0,height:.69444,italic:.03194,skew:0},953:{depth:0,height:.44444,italic:0,skew:0},954:{depth:0,height:.44444,italic:0,skew:0},955:{depth:0,height:.69444,italic:0,skew:0},956:{depth:.19444,height:.44444,italic:0,skew:0},957:{depth:0,height:.44444,italic:.06898,skew:0},958:{depth:.19444,height:.69444,italic:.03021,skew:0},959:{depth:0,height:.44444,italic:0,skew:0},960:{depth:0,height:.44444,italic:.03704,skew:0},961:{depth:.19444,height:.44444,italic:0,skew:0},962:{depth:.09722,height:.44444,italic:.07917,skew:0},963:{depth:0,height:.44444,italic:.03704,skew:0},964:{depth:0,height:.44444,italic:.13472,skew:0},965:{depth:0,height:.44444,italic:.03704,skew:0},966:{depth:.19444,height:.44444,italic:0,skew:0},967:{depth:.19444,height:.44444,italic:0,skew:0},968:{depth:.19444,height:.69444,italic:.03704,skew:0},969:{depth:0,height:.44444,italic:.03704,skew:0},977:{depth:0,height:.69444,italic:0,skew:0},981:{depth:.19444,height:.69444,italic:0,skew:0},982:{depth:0,height:.44444,italic:.03194,skew:0},1009:{depth:.19444,height:.44444,italic:0,skew:0},1013:{depth:0,height:.44444,italic:0,skew:0}},"Math-Italic":{47:{depth:.19444,height:.69444,italic:0,skew:0},65:{depth:0,height:.68333,italic:0,skew:.13889},66:{depth:0,height:.68333,italic:.05017,skew:.08334},67:{depth:0,height:.68333,italic:.07153,skew:.08334},68:{depth:0,height:.68333,italic:.02778,skew:.05556},69:{depth:0,height:.68333,italic:.05764,skew:.08334},70:{depth:0,height:.68333,italic:.13889,skew:.08334},71:{depth:0,height:.68333,italic:0,skew:.08334},72:{depth:0,height:.68333,italic:.08125,skew:.05556},73:{depth:0,height:.68333,italic:.07847,skew:.11111},74:{depth:0,height:.68333,italic:.09618,skew:.16667},75:{depth:0,height:.68333,italic:.07153,skew:.05556},76:{depth:0,height:.68333,italic:0,skew:.02778},77:{depth:0,height:.68333,italic:.10903,skew:.08334},78:{depth:0,height:.68333,italic:.10903,skew:.08334},79:{depth:0,height:.68333,italic:.02778,skew:.08334},80:{depth:0,height:.68333,italic:.13889,skew:.08334},81:{depth:.19444,height:.68333,italic:0,skew:.08334},82:{depth:0,height:.68333,italic:.00773,skew:.08334},83:{depth:0,height:.68333,italic:.05764,skew:.08334},84:{depth:0,height:.68333,italic:.13889,skew:.08334},85:{depth:0,height:.68333,italic:.10903,skew:.02778},86:{depth:0,height:.68333,italic:.22222,skew:0},87:{depth:0,height:.68333,italic:.13889,skew:0},88:{depth:0,height:.68333,italic:.07847,skew:.08334},89:{depth:0,height:.68333,italic:.22222,skew:0},90:{depth:0,height:.68333,italic:.07153,skew:.08334},97:{depth:0,height:.43056,italic:0,skew:0},98:{depth:0,height:.69444,italic:0,skew:0},99:{depth:0,height:.43056,italic:0,skew:.05556},100:{depth:0,height:.69444,italic:0,skew:.16667},101:{depth:0,height:.43056,italic:0,skew:.05556},102:{depth:.19444,height:.69444,italic:.10764,skew:.16667},103:{depth:.19444,height:.43056,italic:.03588,skew:.02778},104:{depth:0,height:.69444,italic:0,skew:0},105:{depth:0,height:.65952,italic:0,skew:0},106:{depth:.19444,height:.65952,italic:.05724,skew:0},107:{depth:0,height:.69444,italic:.03148,skew:0},108:{depth:0,height:.69444,italic:.01968,skew:.08334},109:{depth:0,height:.43056,italic:0,skew:0},110:{depth:0,height:.43056,italic:0,skew:0},111:{depth:0,height:.43056,italic:0,skew:.05556},112:{depth:.19444,height:.43056,italic:0,skew:.08334},113:{depth:.19444,height:.43056,italic:.03588,skew:.08334},114:{depth:0,height:.43056,italic:.02778,skew:.05556},115:{depth:0,height:.43056,italic:0,skew:.05556},116:{depth:0,height:.61508,italic:0,skew:.08334},117:{depth:0,height:.43056,italic:0,skew:.02778},118:{depth:0,height:.43056,italic:.03588,skew:.02778},119:{depth:0,height:.43056,italic:.02691,skew:.08334},120:{depth:0,height:.43056,italic:0,skew:.02778},121:{depth:.19444,height:.43056,italic:.03588,skew:.05556},122:{depth:0,height:.43056,italic:.04398,skew:.05556},915:{depth:0,height:.68333,italic:.13889,skew:.08334},916:{depth:0,height:.68333,italic:0,skew:.16667},920:{depth:0,height:.68333,italic:.02778,skew:.08334},923:{depth:0,height:.68333,italic:0,skew:.16667},926:{depth:0,height:.68333,italic:.07569,skew:.08334},928:{depth:0,height:.68333,italic:.08125,skew:.05556},931:{depth:0,height:.68333,italic:.05764,skew:.08334},933:{depth:0,height:.68333,italic:.13889,skew:.05556},934:{depth:0,height:.68333,italic:0,skew:.08334},936:{depth:0,height:.68333,italic:.11,skew:.05556},937:{depth:0,height:.68333,italic:.05017,skew:.08334},945:{depth:0,height:.43056,italic:.0037,skew:.02778},946:{depth:.19444,height:.69444,italic:.05278,skew:.08334},947:{depth:.19444,height:.43056,italic:.05556,skew:0},948:{depth:0,height:.69444,italic:.03785,skew:.05556},949:{depth:0,height:.43056,italic:0,skew:.08334},950:{depth:.19444,height:.69444,italic:.07378,skew:.08334},951:{depth:.19444,height:.43056,italic:.03588,skew:.05556},952:{depth:0,height:.69444,italic:.02778,skew:.08334},953:{depth:0,height:.43056,italic:0,skew:.05556},954:{depth:0,height:.43056,italic:0,skew:0},955:{depth:0,height:.69444,italic:0,skew:0},956:{depth:.19444,height:.43056,italic:0,skew:.02778},957:{depth:0,height:.43056,italic:.06366,skew:.02778},958:{depth:.19444,height:.69444,italic:.04601,skew:.11111},959:{depth:0,height:.43056,italic:0,skew:.05556},960:{depth:0,height:.43056,italic:.03588,skew:0},961:{depth:.19444,height:.43056,italic:0,skew:.08334},962:{depth:.09722,height:.43056,italic:.07986,skew:.08334},963:{depth:0,height:.43056,italic:.03588,skew:0},964:{depth:0,height:.43056,italic:.1132,skew:.02778},965:{depth:0,height:.43056,italic:.03588,skew:.02778},966:{depth:.19444,height:.43056,italic:0,skew:.08334},967:{depth:.19444,height:.43056,italic:0,skew:.05556},968:{depth:.19444,height:.69444,italic:.03588,skew:.11111},969:{depth:0,height:.43056,italic:.03588,skew:0},977:{depth:0,height:.69444,italic:0,skew:.08334},981:{depth:.19444,height:.69444,italic:0,skew:.08334},982:{depth:0,height:.43056,italic:.02778,skew:0},1009:{depth:.19444,height:.43056,italic:0,skew:.08334},1013:{depth:0,height:.43056,italic:0,skew:.05556}},"Math-Regular":{65:{depth:0,height:.68333,italic:0,skew:.13889},66:{depth:0,height:.68333,italic:.05017,skew:.08334},67:{depth:0,height:.68333,italic:.07153,skew:.08334},68:{depth:0,height:.68333,italic:.02778,skew:.05556},69:{depth:0,height:.68333,italic:.05764,skew:.08334},70:{depth:0,height:.68333,italic:.13889,skew:.08334},71:{depth:0,height:.68333,italic:0,skew:.08334},72:{depth:0,height:.68333,italic:.08125,skew:.05556},73:{depth:0,height:.68333,italic:.07847,skew:.11111},74:{depth:0,height:.68333,italic:.09618,skew:.16667},75:{depth:0,height:.68333,italic:.07153,skew:.05556},76:{depth:0,height:.68333,italic:0,skew:.02778},77:{depth:0,height:.68333,italic:.10903,skew:.08334},78:{depth:0,height:.68333,italic:.10903,skew:.08334},79:{depth:0,height:.68333,italic:.02778,skew:.08334},80:{depth:0,height:.68333,italic:.13889,skew:.08334},81:{depth:.19444,height:.68333,italic:0,skew:.08334},82:{depth:0,height:.68333,italic:.00773,skew:.08334},83:{depth:0,height:.68333,italic:.05764,skew:.08334},84:{depth:0,height:.68333,italic:.13889,skew:.08334},85:{depth:0,height:.68333,italic:.10903,skew:.02778},86:{depth:0,height:.68333,italic:.22222,skew:0},87:{depth:0,height:.68333,italic:.13889,skew:0},88:{depth:0,height:.68333,italic:.07847,skew:.08334},89:{depth:0,height:.68333,italic:.22222,skew:0},90:{depth:0,height:.68333,italic:.07153,skew:.08334},97:{depth:0,height:.43056,italic:0,skew:0},98:{depth:0,height:.69444,italic:0,skew:0},99:{depth:0,height:.43056,italic:0,skew:.05556},100:{depth:0,height:.69444,italic:0,skew:.16667},101:{depth:0,height:.43056,italic:0,skew:.05556},102:{depth:.19444,height:.69444,italic:.10764,skew:.16667},103:{depth:.19444,height:.43056,italic:.03588,skew:.02778},104:{depth:0,height:.69444,italic:0,skew:0},105:{depth:0,height:.65952,italic:0,skew:0},106:{depth:.19444,height:.65952,italic:.05724,skew:0},107:{depth:0,height:.69444,italic:.03148,skew:0},108:{depth:0,height:.69444,italic:.01968,skew:.08334},109:{depth:0,height:.43056,italic:0,skew:0},110:{depth:0,height:.43056,italic:0,skew:0},111:{depth:0,height:.43056,italic:0,skew:.05556},112:{depth:.19444,height:.43056,italic:0,skew:.08334},113:{depth:.19444,height:.43056,italic:.03588,skew:.08334},114:{depth:0,height:.43056,italic:.02778,skew:.05556},115:{depth:0,height:.43056,italic:0,skew:.05556},116:{depth:0,height:.61508,italic:0,skew:.08334},117:{depth:0,height:.43056,italic:0,skew:.02778},118:{depth:0,height:.43056,italic:.03588,skew:.02778},119:{depth:0,height:.43056,italic:.02691,skew:.08334},120:{depth:0,height:.43056,italic:0,skew:.02778},121:{depth:.19444,height:.43056,italic:.03588,skew:.05556},122:{depth:0,height:.43056,italic:.04398,skew:.05556},915:{depth:0,height:.68333,italic:.13889,skew:.08334},916:{depth:0,height:.68333,italic:0,skew:.16667},920:{depth:0,height:.68333,italic:.02778,skew:.08334},923:{depth:0,height:.68333,italic:0,skew:.16667},926:{depth:0,height:.68333,italic:.07569,skew:.08334},928:{depth:0,height:.68333,italic:.08125,skew:.05556},931:{depth:0,height:.68333,italic:.05764,skew:.08334},933:{depth:0,height:.68333,italic:.13889,skew:.05556},934:{depth:0,height:.68333,italic:0,skew:.08334},936:{depth:0,height:.68333,italic:.11,skew:.05556},937:{depth:0,height:.68333,italic:.05017,skew:.08334},945:{depth:0,height:.43056,italic:.0037,skew:.02778},946:{depth:.19444,height:.69444,italic:.05278,skew:.08334},947:{depth:.19444,height:.43056,italic:.05556,skew:0},948:{depth:0,height:.69444,italic:.03785,skew:.05556},949:{depth:0,height:.43056,italic:0,skew:.08334},950:{depth:.19444,height:.69444,italic:.07378,skew:.08334},951:{depth:.19444,height:.43056,italic:.03588,skew:.05556},952:{depth:0,height:.69444,italic:.02778,skew:.08334},953:{depth:0,height:.43056,italic:0,skew:.05556},954:{depth:0,height:.43056,italic:0,skew:0},955:{depth:0,height:.69444,italic:0,skew:0},956:{depth:.19444,height:.43056,italic:0,skew:.02778},957:{depth:0,height:.43056,italic:.06366,skew:.02778},958:{depth:.19444,height:.69444,italic:.04601,skew:.11111},959:{depth:0,height:.43056,italic:0,skew:.05556},960:{depth:0,height:.43056,italic:.03588,skew:0},961:{depth:.19444,height:.43056,italic:0,skew:.08334},962:{depth:.09722,height:.43056,italic:.07986,skew:.08334},963:{depth:0,height:.43056,italic:.03588,skew:0},964:{depth:0,height:.43056,italic:.1132,skew:.02778},965:{depth:0,height:.43056,italic:.03588,skew:.02778},966:{depth:.19444,height:.43056,italic:0,skew:.08334},967:{depth:.19444,height:.43056,italic:0,skew:.05556},968:{depth:.19444,height:.69444,italic:.03588,skew:.11111},969:{depth:0,height:.43056,italic:.03588,skew:0},977:{depth:0,height:.69444,italic:0,skew:.08334},981:{depth:.19444,height:.69444,italic:0,skew:.08334},982:{depth:0,height:.43056,italic:.02778,skew:0},1009:{depth:.19444,height:.43056,italic:0,skew:.08334},1013:{depth:0,height:.43056,italic:0,skew:.05556}},"SansSerif-Regular":{33:{depth:0,height:.69444,italic:0,skew:0},34:{depth:0,height:.69444,italic:0,skew:0},35:{depth:.19444,height:.69444,italic:0,skew:0},36:{depth:.05556,height:.75,italic:0,skew:0},37:{depth:.05556,height:.75,italic:0,skew:0},38:{depth:0,height:.69444,italic:0,skew:0},39:{depth:0,height:.69444,italic:0,skew:0},40:{depth:.25,height:.75,italic:0,skew:0},41:{depth:.25,height:.75,italic:0,skew:0},42:{depth:0,height:.75,italic:0,skew:0},43:{depth:.08333,height:.58333,italic:0,skew:0},44:{depth:.125,height:.08333,italic:0,skew:0},45:{depth:0,height:.44444,italic:0,skew:0},46:{depth:0,height:.08333,italic:0,skew:0},47:{depth:.25,height:.75,italic:0,skew:0},48:{depth:0,height:.65556,italic:0,skew:0},49:{depth:0,height:.65556,italic:0,skew:0},50:{depth:0,height:.65556,italic:0,skew:0},51:{depth:0,height:.65556,italic:0,skew:0},52:{depth:0,height:.65556,italic:0,skew:0},53:{depth:0,height:.65556,italic:0,skew:0},54:{depth:0,height:.65556,italic:0,skew:0},55:{depth:0,height:.65556,italic:0,skew:0},56:{depth:0,height:.65556,italic:0,skew:0},57:{depth:0,height:.65556,italic:0,skew:0},58:{depth:0,height:.44444,italic:0,skew:0},59:{depth:.125,height:.44444,italic:0,skew:0},61:{depth:-.13,height:.37,italic:0,skew:0},63:{depth:0,height:.69444,italic:0,skew:0},64:{depth:0,height:.69444,italic:0,skew:0},65:{depth:0,height:.69444,italic:0,skew:0},66:{depth:0,height:.69444,italic:0,skew:0},67:{depth:0,height:.69444,italic:0,skew:0},68:{depth:0,height:.69444,italic:0,skew:0},69:{depth:0,height:.69444,italic:0,skew:0},70:{depth:0,height:.69444,italic:0,skew:0},71:{depth:0,height:.69444,italic:0,skew:0},72:{depth:0,height:.69444,italic:0,skew:0},73:{depth:0,height:.69444,italic:0,skew:0},74:{depth:0,height:.69444,italic:0,skew:0},75:{depth:0,height:.69444,italic:0,skew:0},76:{depth:0,height:.69444,italic:0,skew:0},77:{depth:0,height:.69444,italic:0,skew:0},78:{depth:0,height:.69444,italic:0,skew:0},79:{depth:0,height:.69444,italic:0,skew:0},80:{depth:0,height:.69444,italic:0,skew:0},81:{depth:.125,height:.69444,italic:0,skew:0},82:{depth:0,height:.69444,italic:0,skew:0},83:{depth:0,height:.69444,italic:0,skew:0},84:{depth:0,height:.69444,italic:0,skew:0},85:{depth:0,height:.69444,italic:0,skew:0},86:{depth:0,height:.69444,italic:.01389,skew:0},87:{depth:0,height:.69444,italic:.01389,skew:0},88:{depth:0,height:.69444,italic:0,skew:0},89:{depth:0,height:.69444,italic:.025,skew:0},90:{depth:0,height:.69444,italic:0,skew:0},91:{depth:.25,height:.75,italic:0,skew:0},93:{depth:.25,height:.75,italic:0,skew:0},94:{depth:0,height:.69444,italic:0,skew:0},95:{depth:.35,height:.09444,italic:.02778,skew:0},97:{depth:0,height:.44444,italic:0,skew:0},98:{depth:0,height:.69444,italic:0,skew:0},99:{depth:0,height:.44444,italic:0,skew:0},100:{depth:0,height:.69444,italic:0,skew:0},101:{depth:0,height:.44444,italic:0,skew:0},102:{depth:0,height:.69444,italic:.06944,skew:0},103:{depth:.19444,height:.44444,italic:.01389,skew:0},104:{depth:0,height:.69444,italic:0,skew:0},105:{depth:0,height:.67937,italic:0,skew:0},106:{depth:.19444,height:.67937,italic:0,skew:0},107:{depth:0,height:.69444,italic:0,skew:0},108:{depth:0,height:.69444,italic:0,skew:0},109:{depth:0,height:.44444,italic:0,skew:0},110:{depth:0,height:.44444,italic:0,skew:0},111:{depth:0,height:.44444,italic:0,skew:0},112:{depth:.19444,height:.44444,italic:0,skew:0},113:{depth:.19444,height:.44444,italic:0,skew:0},114:{depth:0,height:.44444,italic:.01389,skew:0},115:{depth:0,height:.44444,italic:0,skew:0},116:{depth:0,height:.57143,italic:0,skew:0},117:{depth:0,height:.44444,italic:0,skew:0},118:{depth:0,height:.44444,italic:.01389,skew:0},119:{depth:0,height:.44444,italic:.01389,skew:0},120:{depth:0,height:.44444,italic:0,skew:0},121:{depth:.19444,height:.44444,italic:.01389,skew:0},122:{depth:0,height:.44444,italic:0,skew:0},126:{depth:.35,height:.32659,italic:0,skew:0},305:{depth:0,height:.44444,italic:0,skew:0},567:{depth:.19444,height:.44444,italic:0,skew:0},768:{depth:0,height:.69444,italic:0,skew:0},769:{depth:0,height:.69444,italic:0,skew:0},770:{depth:0,height:.69444,italic:0,skew:0},771:{depth:0,height:.67659,italic:0,skew:0},772:{depth:0,height:.60889,italic:0,skew:0},774:{depth:0,height:.69444,italic:0,skew:0},775:{depth:0,height:.67937,italic:0,skew:0},776:{depth:0,height:.67937,italic:0,skew:0},778:{depth:0,height:.69444,italic:0,skew:0},779:{depth:0,height:.69444,italic:0,skew:0},780:{depth:0,height:.63194,italic:0,skew:0},915:{depth:0,height:.69444,italic:0,skew:0},916:{depth:0,height:.69444,italic:0,skew:0},920:{depth:0,height:.69444,italic:0,skew:0},923:{depth:0,height:.69444,italic:0,skew:0},926:{depth:0,height:.69444,italic:0,skew:0},928:{depth:0,height:.69444,italic:0,skew:0},931:{depth:0,height:.69444,italic:0,skew:0},933:{depth:0,height:.69444,italic:0,skew:0},934:{depth:0,height:.69444,italic:0,skew:0},936:{depth:0,height:.69444,italic:0,skew:0},937:{depth:0,height:.69444,italic:0,skew:0},8211:{depth:0,height:.44444,italic:.02778,skew:0},8212:{depth:0,height:.44444,italic:.02778,skew:0},8216:{depth:0,height:.69444,italic:0,skew:0},8217:{depth:0,height:.69444,italic:0,skew:0},8220:{depth:0,height:.69444,italic:0,skew:0},8221:{depth:0,height:.69444,italic:0,skew:0}},"Script-Regular":{65:{depth:0,height:.7,italic:.22925,skew:0},66:{depth:0,height:.7,italic:.04087,skew:0},67:{depth:0,height:.7,italic:.1689,skew:0},68:{depth:0,height:.7,italic:.09371,skew:0},69:{depth:0,height:.7,italic:.18583,skew:0},70:{depth:0,height:.7,italic:.13634,skew:0},71:{depth:0,height:.7,italic:.17322,skew:0},72:{depth:0,height:.7,italic:.29694,skew:0},73:{depth:0,height:.7,italic:.19189,skew:0},74:{depth:.27778,height:.7,italic:.19189,skew:0},75:{depth:0,height:.7,italic:.31259,skew:0},76:{depth:0,height:.7,italic:.19189,skew:0},77:{depth:0,height:.7,italic:.15981,skew:0},78:{depth:0,height:.7,italic:.3525,skew:0},79:{depth:0,height:.7,italic:.08078,skew:0},80:{depth:0,height:.7,italic:.08078,skew:0},81:{depth:0,height:.7,italic:.03305,skew:0},82:{depth:0,height:.7,italic:.06259,skew:0},83:{depth:0,height:.7,italic:.19189,skew:0},84:{depth:0,height:.7,italic:.29087,skew:0},85:{depth:0,height:.7,italic:.25815,skew:0},86:{depth:0,height:.7,italic:.27523,skew:0},87:{depth:0,height:.7,italic:.27523,skew:0},88:{depth:0,height:.7,italic:.26006,skew:0},89:{depth:0,height:.7,italic:.2939,skew:0},90:{depth:0,height:.7,italic:.24037,skew:0}},"Size1-Regular":{40:{depth:.35001,height:.85,italic:0,skew:0},41:{depth:.35001,height:.85,italic:0,skew:0},47:{depth:.35001,height:.85,italic:0,skew:0},91:{depth:.35001,height:.85,italic:0,skew:0},92:{depth:.35001,height:.85,italic:0,skew:0},93:{depth:.35001,height:.85,italic:0,skew:0},123:{depth:.35001,height:.85,italic:0,skew:0},125:{depth:.35001,height:.85,italic:0,skew:0},710:{depth:0,height:.72222,italic:0,skew:0},732:{depth:0,height:.72222,italic:0,skew:0},770:{depth:0,height:.72222,italic:0,skew:0},771:{depth:0,height:.72222,italic:0,skew:0},8214:{depth:-99e-5,height:.601,italic:0,skew:0},8593:{depth:1e-5,height:.6,italic:0,skew:0},8595:{depth:1e-5,height:.6,italic:0,skew:0},8657:{depth:1e-5,height:.6,italic:0,skew:0},8659:{depth:1e-5,height:.6,italic:0,skew:0},8719:{depth:.25001,height:.75,italic:0,skew:0},8720:{depth:.25001,height:.75,italic:0,skew:0},8721:{depth:.25001,height:.75,italic:0,skew:0},8730:{depth:.35001,height:.85,italic:0,skew:0},8739:{depth:-.00599,height:.606,italic:0,skew:0},8741:{depth:-.00599,height:.606,italic:0,skew:0},8747:{depth:.30612,height:.805,italic:.19445,skew:0},8748:{depth:.306,height:.805,italic:.19445,skew:0},8749:{depth:.306,height:.805,italic:.19445,skew:0},8750:{depth:.30612,height:.805,italic:.19445,skew:0},8896:{depth:.25001,height:.75,italic:0,skew:0},8897:{depth:.25001,height:.75,italic:0,skew:0},8898:{depth:.25001,height:.75,italic:0,skew:0},8899:{depth:.25001,height:.75,italic:0,skew:0},8968:{depth:.35001,height:.85,italic:0,skew:0},8969:{depth:.35001,height:.85,italic:0,skew:0},8970:{depth:.35001,height:.85,italic:0,skew:0},8971:{depth:.35001,height:.85,italic:0,skew:0},9168:{depth:-99e-5,height:.601,italic:0,skew:0},10216:{depth:.35001,height:.85,italic:0,skew:0},10217:{depth:.35001,height:.85,italic:0,skew:0},10752:{depth:.25001,height:.75,italic:0,skew:0},10753:{depth:.25001,height:.75,italic:0,skew:0},10754:{depth:.25001,height:.75,italic:0,skew:0},10756:{depth:.25001,height:.75,italic:0,skew:0},10758:{depth:.25001,height:.75,italic:0,skew:0}},"Size2-Regular":{40:{depth:.65002,height:1.15,italic:0,skew:0},41:{depth:.65002,height:1.15,italic:0,skew:0},47:{depth:.65002,height:1.15,italic:0,skew:0},91:{depth:.65002,height:1.15,italic:0,skew:0},92:{depth:.65002,height:1.15,italic:0,skew:0},93:{depth:.65002,height:1.15,italic:0,skew:0},123:{depth:.65002,height:1.15,italic:0,skew:0},125:{depth:.65002,height:1.15,italic:0,skew:0},710:{depth:0,height:.75,italic:0,skew:0},732:{depth:0,height:.75,italic:0,skew:0},770:{depth:0,height:.75,italic:0,skew:0},771:{depth:0,height:.75,italic:0,skew:0},8719:{depth:.55001,height:1.05,italic:0,skew:0},8720:{depth:.55001,height:1.05,italic:0,skew:0},8721:{depth:.55001,height:1.05,italic:0,skew:0},8730:{depth:.65002,height:1.15,italic:0,skew:0},8747:{depth:.86225,height:1.36,italic:.44445,skew:0},8748:{depth:.862,height:1.36,italic:.44445,skew:0},8749:{depth:.862,height:1.36,italic:.44445,skew:0},8750:{depth:.86225,height:1.36,italic:.44445,skew:0},8896:{depth:.55001,height:1.05,italic:0,skew:0},8897:{depth:.55001,height:1.05,italic:0,skew:0},8898:{depth:.55001,height:1.05,italic:0,skew:0},8899:{depth:.55001,height:1.05,italic:0,skew:0},8968:{depth:.65002,height:1.15,italic:0,skew:0},8969:{depth:.65002,height:1.15,italic:0,skew:0},8970:{depth:.65002,height:1.15,italic:0,skew:0},8971:{depth:.65002,height:1.15,italic:0,skew:0},10216:{depth:.65002,height:1.15,italic:0,skew:0},10217:{depth:.65002,height:1.15,italic:0,skew:0},10752:{depth:.55001,height:1.05,italic:0,skew:0},10753:{depth:.55001,height:1.05,italic:0,skew:0},10754:{depth:.55001,height:1.05,italic:0,skew:0},10756:{depth:.55001,height:1.05,italic:0,skew:0},10758:{depth:.55001,height:1.05,italic:0,skew:0}},"Size3-Regular":{40:{depth:.95003,height:1.45,italic:0,skew:0},41:{depth:.95003,height:1.45,italic:0,skew:0},47:{depth:.95003,height:1.45,italic:0,skew:0},91:{depth:.95003,height:1.45,italic:0,skew:0},92:{depth:.95003,height:1.45,italic:0,skew:0},93:{depth:.95003,height:1.45,italic:0,skew:0},123:{depth:.95003,height:1.45,italic:0,skew:0},125:{depth:.95003,height:1.45,italic:0,skew:0},710:{depth:0,height:.75,italic:0,skew:0},732:{depth:0,height:.75,italic:0,skew:0},770:{depth:0,height:.75,italic:0,skew:0},771:{depth:0,height:.75,italic:0,skew:0},8730:{depth:.95003,height:1.45,italic:0,skew:0},8968:{depth:.95003,height:1.45,italic:0,skew:0},8969:{depth:.95003,height:1.45,italic:0,skew:0},8970:{depth:.95003,height:1.45,italic:0,skew:0},8971:{depth:.95003,height:1.45,italic:0,skew:0},10216:{depth:.95003,height:1.45,italic:0,skew:0},10217:{depth:.95003,height:1.45,italic:0,skew:0}},"Size4-Regular":{40:{depth:1.25003,height:1.75,italic:0,skew:0},41:{depth:1.25003,height:1.75,italic:0,skew:0},47:{depth:1.25003,height:1.75,italic:0,skew:0},91:{depth:1.25003,height:1.75,italic:0,skew:0},92:{depth:1.25003,height:1.75,italic:0,skew:0},93:{depth:1.25003,height:1.75,italic:0,skew:0},123:{depth:1.25003,height:1.75,italic:0,skew:0},125:{depth:1.25003,height:1.75,italic:0,skew:0},710:{depth:0,height:.825,italic:0,skew:0},732:{depth:0,height:.825,italic:0,skew:0},770:{depth:0,height:.825,italic:0,skew:0},771:{depth:0,height:.825,italic:0,skew:0},8730:{depth:1.25003,height:1.75,italic:0,skew:0},8968:{depth:1.25003,height:1.75,italic:0,skew:0},8969:{depth:1.25003,height:1.75,italic:0,skew:0},8970:{depth:1.25003,height:1.75,italic:0,skew:0},8971:{depth:1.25003,height:1.75,italic:0,skew:0},9115:{depth:.64502,height:1.155,italic:0,skew:0},9116:{depth:1e-5,height:.6,italic:0,skew:0},9117:{depth:.64502,height:1.155,italic:0,skew:0},9118:{depth:.64502,height:1.155,italic:0,skew:0},9119:{depth:1e-5,height:.6,italic:0,skew:0},9120:{depth:.64502,height:1.155,italic:0,skew:0},9121:{depth:.64502,height:1.155,italic:0,skew:0},9122:{depth:-99e-5,height:.601,italic:0,skew:0},9123:{depth:.64502,height:1.155,italic:0,skew:0},9124:{depth:.64502,height:1.155,italic:0,skew:0},9125:{depth:-99e-5,height:.601,italic:0,skew:0},9126:{depth:.64502,height:1.155,italic:0,skew:0},9127:{depth:1e-5,height:.9,italic:0,skew:0},9128:{depth:.65002,height:1.15,italic:0,skew:0},9129:{depth:.90001,height:0,italic:0,skew:0},9130:{depth:0,height:.3,italic:0,skew:0},9131:{depth:1e-5,height:.9,italic:0,skew:0},9132:{depth:.65002,height:1.15,italic:0,skew:0},9133:{depth:.90001,height:0,italic:0,skew:0},9143:{depth:.88502,height:.915,italic:0,skew:0},10216:{depth:1.25003,height:1.75,italic:0,skew:0},10217:{depth:1.25003,height:1.75,italic:0,skew:0},57344:{depth:-.00499,height:.605,italic:0,skew:0},57345:{depth:-.00499,height:.605,italic:0,skew:0},57680:{depth:0,height:.12,italic:0,skew:0},57681:{depth:0,height:.12,italic:0,skew:0},57682:{depth:0,height:.12,italic:0,skew:0},57683:{depth:0,height:.12,italic:0,skew:0}},"Typewriter-Regular":{33:{depth:0,height:.61111,italic:0,skew:0},34:{depth:0,height:.61111,italic:0,skew:0},35:{depth:0,height:.61111,italic:0,skew:0},36:{depth:.08333,height:.69444,italic:0,skew:0},37:{depth:.08333,height:.69444,italic:0,skew:0},38:{depth:0,height:.61111,italic:0,skew:0},39:{depth:0,height:.61111,italic:0,skew:0},40:{depth:.08333,height:.69444,italic:0,skew:0},41:{depth:.08333,height:.69444,italic:0,skew:0},42:{depth:0,height:.52083,italic:0,skew:0},43:{depth:-.08056,height:.53055,italic:0,skew:0},44:{depth:.13889,height:.125,italic:0,skew:0},45:{depth:-.08056,height:.53055,italic:0,skew:0},46:{depth:0,height:.125,italic:0,skew:0},47:{depth:.08333,height:.69444,italic:0,skew:0},48:{depth:0,height:.61111,italic:0,skew:0},49:{depth:0,height:.61111,italic:0,skew:0},50:{depth:0,height:.61111,italic:0,skew:0},51:{depth:0,height:.61111,italic:0,skew:0},52:{depth:0,height:.61111,italic:0,skew:0},53:{depth:0,height:.61111,italic:0,skew:0},54:{depth:0,height:.61111,italic:0,skew:0},55:{depth:0,height:.61111,italic:0,skew:0},56:{depth:0,height:.61111,italic:0,skew:0},57:{depth:0,height:.61111,italic:0,skew:0},58:{depth:0,height:.43056,italic:0,skew:0},59:{depth:.13889,height:.43056,italic:0,skew:0},60:{depth:-.05556,height:.55556,italic:0,skew:0},61:{depth:-.19549,height:.41562,italic:0,skew:0},62:{depth:-.05556,height:.55556,italic:0,skew:0},63:{depth:0,height:.61111,italic:0,skew:0},64:{depth:0,height:.61111,italic:0,skew:0},65:{depth:0,height:.61111,italic:0,skew:0},66:{depth:0,height:.61111,italic:0,skew:0},67:{depth:0,height:.61111,italic:0,skew:0},68:{depth:0,height:.61111,italic:0,skew:0},69:{depth:0,height:.61111,italic:0,skew:0},70:{depth:0,height:.61111,italic:0,skew:0},71:{depth:0,height:.61111,italic:0,skew:0},72:{depth:0,height:.61111,italic:0,skew:0},73:{depth:0,height:.61111,italic:0,skew:0},74:{depth:0,height:.61111,italic:0,skew:0},75:{depth:0,height:.61111,italic:0,skew:0},76:{depth:0,height:.61111,italic:0,skew:0},77:{depth:0,height:.61111,italic:0,skew:0},78:{depth:0,height:.61111,italic:0,skew:0},79:{depth:0,height:.61111,italic:0,skew:0},80:{depth:0,height:.61111,italic:0,skew:0},81:{depth:.13889,height:.61111,italic:0,skew:0},82:{depth:0,height:.61111,italic:0,skew:0},83:{depth:0,height:.61111,italic:0,skew:0},84:{depth:0,height:.61111,italic:0,skew:0},85:{depth:0,height:.61111,italic:0,skew:0},86:{depth:0,height:.61111,italic:0,skew:0},87:{depth:0,height:.61111,italic:0,skew:0},88:{depth:0,height:.61111,italic:0,skew:0},89:{depth:0,height:.61111,italic:0,skew:0},90:{depth:0,height:.61111,italic:0,skew:0},91:{depth:.08333,height:.69444,italic:0,skew:0},92:{depth:.08333,height:.69444,italic:0,skew:0},93:{depth:.08333,height:.69444,italic:0,skew:0},94:{depth:0,height:.61111,italic:0,skew:0},95:{depth:.09514,height:0,italic:0,skew:0},96:{depth:0,height:.61111,italic:0,skew:0},97:{depth:0,height:.43056,italic:0,skew:0},98:{depth:0,height:.61111,italic:0,skew:0},99:{depth:0,height:.43056,italic:0,skew:0},100:{depth:0,height:.61111,italic:0,skew:0},101:{depth:0,height:.43056,italic:0,skew:0},102:{depth:0,height:.61111,italic:0,skew:0},103:{depth:.22222,height:.43056,italic:0,skew:0},104:{depth:0,height:.61111,italic:0,skew:0},105:{depth:0,height:.61111,italic:0,skew:0},106:{depth:.22222,height:.61111,italic:0,skew:0},107:{depth:0,height:.61111,italic:0,skew:0},108:{depth:0,height:.61111,italic:0,skew:0},109:{depth:0,height:.43056,italic:0,skew:0},110:{depth:0,height:.43056,italic:0,skew:0},111:{depth:0,height:.43056,italic:0,skew:0},112:{depth:.22222,height:.43056,italic:0,skew:0},113:{depth:.22222,height:.43056,italic:0,skew:0},114:{depth:0,height:.43056,italic:0,skew:0},115:{depth:0,height:.43056,italic:0,skew:0},116:{depth:0,height:.55358,italic:0,skew:0},117:{depth:0,height:.43056,italic:0,skew:0},118:{depth:0,height:.43056,italic:0,skew:0},119:{depth:0,height:.43056,italic:0,skew:0},120:{depth:0,height:.43056,italic:0,skew:0},121:{depth:.22222,height:.43056,italic:0,skew:0},122:{depth:0,height:.43056,italic:0,skew:0},123:{depth:.08333,height:.69444,italic:0,skew:0},124:{depth:.08333,height:.69444,italic:0,skew:0},125:{depth:.08333,height:.69444,italic:0,skew:0},126:{depth:0,height:.61111,italic:0,skew:0},127:{depth:0,height:.61111,italic:0,skew:0},305:{depth:0,height:.43056,italic:0,skew:0},567:{depth:.22222,height:.43056,italic:0,skew:0},768:{depth:0,height:.61111,italic:0,skew:0},769:{depth:0,height:.61111,italic:0,skew:0},770:{depth:0,height:.61111,italic:0,skew:0},771:{depth:0,height:.61111,italic:0,skew:0},772:{depth:0,height:.56555,italic:0,skew:0},774:{depth:0,height:.61111,italic:0,skew:0},776:{depth:0,height:.61111,italic:0,skew:0},778:{depth:0,height:.61111,italic:0,skew:0},780:{depth:0,height:.56597,italic:0,skew:0},915:{depth:0,height:.61111,italic:0,skew:0},916:{depth:0,height:.61111,italic:0,skew:0},920:{depth:0,height:.61111,italic:0,skew:0},923:{depth:0,height:.61111,italic:0,skew:0},926:{depth:0,height:.61111,italic:0,skew:0},928:{depth:0,height:.61111,italic:0,skew:0},931:{depth:0,height:.61111,italic:0,skew:0},933:{depth:0,height:.61111,italic:0,skew:0},934:{depth:0,height:.61111,italic:0,skew:0},936:{depth:0,height:.61111,italic:0,skew:0},937:{depth:0,height:.61111,italic:0,skew:0},2018:{depth:0,height:.61111,italic:0,skew:0},2019:{depth:0,height:.61111,italic:0,skew:0},8242:{depth:0,height:.61111,italic:0,skew:0}}}},{}],18:[function(e,t,i){var r=e("./utils");var n=e("./ParseError");var a={"\\sqrt":{numArgs:1,numOptionalArgs:1,handler:function(e,t,i,r){return{type:"sqrt",body:i,index:t}}},"\\text":{numArgs:1,argTypes:["text"],greediness:2,handler:function(e,t){var i;if(t.type==="ordgroup"){i=t.value}else{i=[t]}return{type:"text",body:i}}},"\\color":{numArgs:2,allowedInText:true,greediness:3,argTypes:["color","original"],handler:function(e,t,i){var r;if(i.type==="ordgroup"){r=i.value}else{r=[i]}return{type:"color",color:t.value,value:r}}},"\\overline":{numArgs:1,handler:function(e,t){return{type:"overline",body:t}}},"\\rule":{numArgs:2,numOptionalArgs:1,argTypes:["size","size","size"],handler:function(e,t,i,r){return{type:"rule",shift:t&&t.value,width:i.value,height:r.value}}},"\\KaTeX":{numArgs:0,handler:function(e){return{type:"katex"}}},"\\phantom":{numArgs:1,handler:function(e,t){var i;if(t.type==="ordgroup"){i=t.value}else{i=[t]}return{type:"phantom",value:i}}}};var o={"\\bigl":{type:"open",size:1},"\\Bigl":{type:"open",size:2},"\\biggl":{type:"open",size:3},"\\Biggl":{type:"open",size:4},"\\bigr":{type:"close",size:1},"\\Bigr":{type:"close",size:2},"\\biggr":{type:"close",size:3},"\\Biggr":{type:"close",size:4},"\\bigm":{type:"rel",size:1},"\\Bigm":{type:"rel",size:2},"\\biggm":{type:"rel",size:3},"\\Biggm":{type:"rel",size:4},"\\big":{type:"textord",size:1},"\\Big":{type:"textord",size:2},"\\bigg":{type:"textord",size:3},"\\Bigg":{type:"textord",size:4}};var s=["(",")","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","\\lceil","\\rceil","<",">","\\langle","\\rangle","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","\\lmoustache","\\rmoustache","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];var h={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak"};var l=[{funcs:["\\blue","\\orange","\\pink","\\red","\\green","\\gray","\\purple","\\blueA","\\blueB","\\blueC","\\blueD","\\blueE","\\tealA","\\tealB","\\tealC","\\tealD","\\tealE","\\greenA","\\greenB","\\greenC","\\greenD","\\greenE","\\goldA","\\goldB","\\goldC","\\goldD","\\goldE","\\redA","\\redB","\\redC","\\redD","\\redE","\\maroonA","\\maroonB","\\maroonC","\\maroonD","\\maroonE","\\purpleA","\\purpleB","\\purpleC","\\purpleD","\\purpleE","\\mintA","\\mintB","\\mintC","\\grayA","\\grayB","\\grayC","\\grayD","\\grayE","\\grayF","\\grayG","\\grayH","\\grayI","\\kaBlue","\\kaGreen"],data:{numArgs:1,allowedInText:true,greediness:3,handler:function(e,t){var i;if(t.type==="ordgroup"){i=t.value}else{i=[t]}return{type:"color",color:"katex-"+e.slice(1),value:i}}}},{funcs:["\\arcsin","\\arccos","\\arctan","\\arg","\\cos","\\cosh","\\cot","\\coth","\\csc","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\tan","\\tanh"],data:{numArgs:0,handler:function(e){return{type:"op",limits:false,symbol:false,body:e}}}},{funcs:["\\det","\\gcd","\\inf","\\lim","\\liminf","\\limsup","\\max","\\min","\\Pr","\\sup"],data:{numArgs:0,handler:function(e){return{type:"op",limits:true,symbol:false,body:e}}}},{funcs:["\\int","\\iint","\\iiint","\\oint"],data:{numArgs:0,handler:function(e){return{type:"op",limits:false,symbol:true,body:e}}}},{funcs:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint"],data:{numArgs:0,handler:function(e){return{type:"op",limits:true,symbol:true,body:e}}}},{funcs:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom"],data:{numArgs:2,greediness:2,handler:function(e,t,i){var r;var n=null;var a=null;var o="auto";switch(e){case"\\dfrac":case"\\frac":case"\\tfrac":r=true;break;case"\\dbinom":case"\\binom":case"\\tbinom":r=false;n="(";a=")";break;default:throw new Error("Unrecognized genfrac command")}switch(e){case"\\dfrac":case"\\dbinom":o="display";break;case"\\tfrac":case"\\tbinom":o="text";break}return{type:"genfrac",numer:t,denom:i,hasBarLine:r,leftDelim:n,rightDelim:a,size:o}}}},{funcs:["\\llap","\\rlap"],data:{numArgs:1,allowedInText:true,handler:function(e,t){return{type:e.slice(1),body:t}}}},{funcs:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg","\\left","\\right"],data:{numArgs:1,handler:function(e,t,i){if(!r.contains(s,t.value)){throw new n("Invalid delimiter: '"+t.value+"' after '"+e+"'",this.lexer,i[1])}if(e==="\\left"||e==="\\right"){return{type:"leftright",value:t.value}}else{return{type:"delimsizing",size:o[e].size,delimType:o[e].type,value:t.value}}}}},{funcs:["\\tiny","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"],data:{numArgs:0}},{funcs:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],data:{numArgs:0}},{funcs:["\\mathrm","\\mathit","\\mathbf","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bold","\\frak"],data:{numArgs:1,handler:function(e,t){if(e in h){e=h[e]}return{type:"font",font:e.slice(1),body:t}}}},{funcs:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot"],data:{numArgs:1,handler:function(e,t){return{type:"accent",accent:e,base:t}}}},{funcs:["\\over","\\choose"],data:{numArgs:0,handler:function(e){var t;switch(e){case"\\over":t="\\frac";break;case"\\choose":t="\\binom";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",replaceWith:t}}}},{funcs:["\\\\","\\cr"],data:{numArgs:0,numOptionalArgs:1,argTypes:["size"],handler:function(e,t){return{type:"cr",size:t}}}},{funcs:["\\begin","\\end"],data:{numArgs:1,argTypes:["text"],handler:function(e,t,i){if(t.type!=="ordgroup"){throw new n("Invalid environment name",this.lexer,i[1])}var r="";for(var a=0;a<t.value.length;++a){r+=t.value[a].value}return{type:"environment",name:r,namepos:i[1]}}}}];var u=function(e,t){for(var i=0;i<e.length;i++){a[e[i]]=t}};for(var c=0;c<l.length;c++){u(l[c].funcs,l[c].data)}for(var p in a){if(a.hasOwnProperty(p)){var f=a[p];a[p]={numArgs:f.numArgs,argTypes:f.argTypes,greediness:f.greediness===undefined?1:f.greediness,allowedInText:f.allowedInText?f.allowedInText:false,numOptionalArgs:f.numOptionalArgs===undefined?0:f.numOptionalArgs,handler:f.handler}}}t.exports={funcs:a}},{"./ParseError":5,"./utils":23}],19:[function(e,t,i){var r=e("./utils");function n(e,t){this.type=e;this.attributes={};this.children=t||[]}n.prototype.setAttribute=function(e,t){this.attributes[e]=t};n.prototype.toNode=function(){var e=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(var t in this.attributes){if(Object.prototype.hasOwnProperty.call(this.attributes,t)){e.setAttribute(t,this.attributes[t])}}for(var i=0;i<this.children.length;i++){e.appendChild(this.children[i].toNode())}return e};n.prototype.toMarkup=function(){var e="<"+this.type;for(var t in this.attributes){if(Object.prototype.hasOwnProperty.call(this.attributes,t)){e+=" "+t+'="';e+=r.escape(this.attributes[t]);e+='"'}}e+=">";for(var i=0;i<this.children.length;i++){e+=this.children[i].toMarkup()}e+="</"+this.type+">";return e};function a(e){this.text=e}a.prototype.toNode=function(){return document.createTextNode(this.text)};a.prototype.toMarkup=function(){return r.escape(this.text)};t.exports={MathNode:n,TextNode:a}},{"./utils":23}],20:[function(e,t,i){function r(e,t,i){this.type=e;this.value=t;this.mode=i}function n(e,t,i){this.result=e;this.position=t}t.exports={ParseNode:r,ParseResult:n}},{}],21:[function(e,t,i){var r=e("./Parser");var n=function(e,t){var i=new r(e,t);return i.parse()};t.exports=n},{"./Parser":6}],22:[function(e,t,i){var r={math:{"\\equiv":{font:"main",group:"rel",replace:""},"\\prec":{font:"main",group:"rel",replace:""},"\\succ":{font:"main",group:"rel",replace:""},"\\sim":{font:"main",group:"rel",replace:""},"\\perp":{font:"main",group:"rel",replace:""},"\\preceq":{font:"main",group:"rel",replace:""},"\\succeq":{font:"main",group:"rel",replace:""},"\\simeq":{font:"main",group:"rel",replace:""},"\\mid":{font:"main",group:"rel",replace:""},"\\ll":{font:"main",group:"rel",replace:""},"\\gg":{font:"main",group:"rel",replace:""},"\\asymp":{font:"main",group:"rel",replace:""},"\\parallel":{font:"main",group:"rel",replace:""},"\\bowtie":{font:"main",group:"rel",replace:""},"\\smile":{font:"main",group:"rel",replace:""},"\\sqsubseteq":{font:"main",group:"rel",replace:""},"\\sqsupseteq":{font:"main",group:"rel",replace:""},"\\doteq":{font:"main",group:"rel",replace:""},"\\frown":{font:"main",group:"rel",replace:""},"\\ni":{font:"main",group:"rel",replace:""},"\\propto":{font:"main",group:"rel",replace:""},"\\vdash":{font:"main",group:"rel",replace:""},"\\dashv":{font:"main",group:"rel",replace:""},"\\owns":{font:"main",group:"rel",replace:""},"\\ldotp":{font:"main",group:"punct",replace:"."},"\\cdotp":{font:"main",group:"punct",replace:""},"\\#":{font:"main",group:"textord",replace:"#"},"\\&":{font:"main",group:"textord",replace:"&"},"\\aleph":{font:"main",group:"textord",replace:""},"\\forall":{font:"main",group:"textord",replace:""},"\\hbar":{font:"main",group:"textord",replace:""},"\\exists":{font:"main",group:"textord",replace:""},"\\nabla":{font:"main",group:"textord",replace:""},"\\flat":{font:"main",group:"textord",replace:""},"\\ell":{font:"main",group:"textord",replace:""},"\\natural":{font:"main",group:"textord",replace:""},"\\clubsuit":{font:"main",group:"textord",replace:""},"\\wp":{font:"main",group:"textord",replace:""},"\\sharp":{font:"main",group:"textord",replace:""},"\\diamondsuit":{font:"main",group:"textord",replace:""},"\\Re":{font:"main",group:"textord",replace:""},"\\heartsuit":{font:"main",group:"textord",replace:""},"\\Im":{font:"main",group:"textord",replace:""},"\\spadesuit":{font:"main",group:"textord",replace:""},"\\dag":{font:"main",group:"textord",replace:""},"\\ddag":{font:"main",group:"textord",replace:""},"\\rmoustache":{font:"main",group:"close",replace:""},"\\lmoustache":{font:"main",group:"open",replace:""},"\\rgroup":{font:"main",group:"close",replace:""},"\\lgroup":{font:"main",group:"open",replace:""},"\\mp":{font:"main",group:"bin",replace:""},"\\ominus":{font:"main",group:"bin",replace:""},"\\uplus":{font:"main",group:"bin",replace:""},"\\sqcap":{font:"main",group:"bin",replace:""},"\\ast":{font:"main",group:"bin",replace:""},"\\sqcup":{font:"main",group:"bin",replace:""},"\\bigcirc":{font:"main",group:"bin",replace:""},"\\bullet":{font:"main",group:"bin",replace:""},"\\ddagger":{font:"main",group:"bin",replace:""},"\\wr":{font:"main",group:"bin",replace:""},"\\amalg":{font:"main",group:"bin",replace:""},"\\longleftarrow":{font:"main",group:"rel",replace:""},"\\Leftarrow":{font:"main",group:"rel",replace:""},"\\Longleftarrow":{font:"main",group:"rel",replace:""},"\\longrightarrow":{font:"main",group:"rel",replace:""},"\\Rightarrow":{font:"main",group:"rel",replace:""},"\\Longrightarrow":{font:"main",group:"rel",replace:""},"\\leftrightarrow":{font:"main",group:"rel",replace:""},"\\longleftrightarrow":{font:"main",group:"rel",replace:""},"\\Leftrightarrow":{font:"main",group:"rel",replace:""},"\\Longleftrightarrow":{font:"main",group:"rel",replace:""},"\\mapsto":{font:"main",group:"rel",replace:""},"\\longmapsto":{font:"main",group:"rel",replace:""},"\\nearrow":{font:"main",group:"rel",replace:""},"\\hookleftarrow":{font:"main",group:"rel",replace:""},"\\hookrightarrow":{font:"main",group:"rel",replace:""},"\\searrow":{font:"main",group:"rel",replace:""},"\\leftharpoonup":{font:"main",group:"rel",replace:""},"\\rightharpoonup":{font:"main",group:"rel",replace:""},"\\swarrow":{font:"main",group:"rel",replace:""},"\\leftharpoondown":{font:"main",group:"rel",replace:""},"\\rightharpoondown":{font:"main",group:"rel",replace:""},"\\nwarrow":{font:"main",group:"rel",replace:""},"\\rightleftharpoons":{font:"main",group:"rel",replace:""},"\\nless":{font:"ams",group:"rel",replace:""},"\\nleqslant":{font:"ams",group:"rel",replace:""},"\\nleqq":{font:"ams",group:"rel",replace:""},"\\lneq":{font:"ams",group:"rel",replace:""},"\\lneqq":{font:"ams",group:"rel",replace:""},"\\lvertneqq":{font:"ams",group:"rel",replace:""},"\\lnsim":{font:"ams",group:"rel",replace:""},"\\lnapprox":{font:"ams",group:"rel",replace:""},"\\nprec":{font:"ams",group:"rel",replace:""},"\\npreceq":{font:"ams",group:"rel",replace:""},"\\precnsim":{font:"ams",group:"rel",replace:""},"\\precnapprox":{font:"ams",group:"rel",replace:""},"\\nsim":{font:"ams",group:"rel",replace:""},"\\nshortmid":{font:"ams",group:"rel",replace:""},"\\nmid":{font:"ams",group:"rel",replace:""},"\\nvdash":{font:"ams",group:"rel",replace:""},"\\nvDash":{font:"ams",group:"rel",replace:""},"\\ntriangleleft":{font:"ams",group:"rel",replace:""},"\\ntrianglelefteq":{font:"ams",group:"rel",replace:""},"\\subsetneq":{font:"ams",group:"rel",replace:""},"\\varsubsetneq":{font:"ams",group:"rel",replace:""},"\\subsetneqq":{font:"ams",group:"rel",replace:""},"\\varsubsetneqq":{font:"ams",group:"rel",replace:""},"\\ngtr":{font:"ams",group:"rel",replace:""},"\\ngeqslant":{font:"ams",group:"rel",replace:""},"\\ngeqq":{font:"ams",group:"rel",replace:""},"\\gneq":{font:"ams",group:"rel",replace:""},"\\gneqq":{font:"ams",group:"rel",replace:""},"\\gvertneqq":{font:"ams",group:"rel",replace:""},"\\gnsim":{font:"ams",group:"rel",replace:""},"\\gnapprox":{font:"ams",group:"rel",replace:""},"\\nsucc":{font:"ams",group:"rel",replace:""},"\\nsucceq":{font:"ams",group:"rel",replace:""},"\\succnsim":{font:"ams",group:"rel",replace:""},"\\succnapprox":{font:"ams",group:"rel",replace:""},"\\ncong":{font:"ams",group:"rel",replace:""},"\\nshortparallel":{font:"ams",group:"rel",replace:""},"\\nparallel":{font:"ams",group:"rel",replace:""},"\\nVDash":{font:"ams",group:"rel",replace:""},"\\ntriangleright":{font:"ams",group:"rel",replace:""},"\\ntrianglerighteq":{font:"ams",group:"rel",replace:""},"\\nsupseteqq":{font:"ams",group:"rel",replace:""},"\\supsetneq":{font:"ams",group:"rel",replace:""},"\\varsupsetneq":{font:"ams",group:"rel",replace:""},"\\supsetneqq":{font:"ams",group:"rel",replace:""},"\\varsupsetneqq":{font:"ams",group:"rel",replace:""},"\\nVdash":{font:"ams",group:"rel",replace:""},"\\precneqq":{font:"ams",group:"rel",replace:""},"\\succneqq":{font:"ams",group:"rel",replace:""},"\\nsubseteqq":{font:"ams",group:"rel",replace:""},"\\unlhd":{font:"ams",group:"bin",replace:""},"\\unrhd":{font:"ams",group:"bin",replace:""},"\\nleftarrow":{font:"ams",group:"rel",replace:""},"\\nrightarrow":{font:"ams",group:"rel",replace:""},"\\nLeftarrow":{font:"ams",group:"rel",replace:""},"\\nRightarrow":{font:"ams",group:"rel",replace:""},"\\nleftrightarrow":{font:"ams",group:"rel",replace:""},"\\nLeftrightarrow":{font:"ams",group:"rel",replace:""},"\\vartriangle":{font:"ams",group:"rel",replace:""},"\\hslash":{font:"ams",group:"textord",replace:""},"\\triangledown":{font:"ams",group:"textord",replace:""},"\\lozenge":{font:"ams",group:"textord",replace:""},"\\circledS":{font:"ams",group:"textord",replace:""},"\\circledR":{font:"ams",group:"textord",replace:""},"\\measuredangle":{font:"ams",group:"textord",replace:""},"\\nexists":{font:"ams",group:"textord",replace:""},"\\mho":{font:"ams",group:"textord",replace:""},"\\Finv":{font:"ams",group:"textord",replace:""},"\\Game":{font:"ams",group:"textord",replace:""},"\\Bbbk":{font:"ams",group:"textord",replace:"k"},"\\backprime":{font:"ams",group:"textord",replace:""},"\\blacktriangle":{font:"ams",group:"textord",replace:""},"\\blacktriangledown":{font:"ams",group:"textord",replace:""},"\\blacksquare":{font:"ams",group:"textord",replace:""},"\\blacklozenge":{font:"ams",group:"textord",replace:""},"\\bigstar":{font:"ams",group:"textord",replace:""},"\\sphericalangle":{font:"ams",group:"textord",replace:""},"\\complement":{font:"ams",group:"textord",replace:""},"\\eth":{font:"ams",group:"textord",replace:""},"\\diagup":{font:"ams",group:"textord",replace:""},"\\diagdown":{font:"ams",group:"textord",replace:""},"\\square":{font:"ams",group:"textord",replace:""},"\\Box":{font:"ams",group:"textord",replace:""},"\\Diamond":{font:"ams",group:"textord",replace:""},"\\yen":{font:"ams",group:"textord",replace:""},"\\checkmark":{font:"ams",group:"textord",replace:""},"\\beth":{font:"ams",group:"textord",replace:""},"\\daleth":{font:"ams",group:"textord",replace:""},"\\gimel":{font:"ams",group:"textord",replace:""},"\\digamma":{font:"ams",group:"textord",replace:""},"\\varkappa":{font:"ams",group:"textord",replace:""},"\\ulcorner":{font:"ams",group:"open",replace:""},"\\urcorner":{font:"ams",group:"close",replace:""},"\\llcorner":{font:"ams",group:"open",replace:""},"\\lrcorner":{font:"ams",group:"close",replace:""},"\\leqq":{font:"ams",group:"rel",replace:""},"\\leqslant":{font:"ams",group:"rel",replace:""},"\\eqslantless":{font:"ams",group:"rel",replace:""},"\\lesssim":{font:"ams",group:"rel",replace:""},"\\lessapprox":{font:"ams",group:"rel",replace:""},"\\approxeq":{font:"ams",group:"rel",replace:""},"\\lessdot":{font:"ams",group:"bin",replace:""},"\\lll":{font:"ams",group:"rel",replace:""},"\\lessgtr":{font:"ams",group:"rel",replace:""},"\\lesseqgtr":{font:"ams",group:"rel",replace:""},"\\lesseqqgtr":{font:"ams",group:"rel",replace:""},"\\doteqdot":{font:"ams",group:"rel",replace:""},"\\risingdotseq":{font:"ams",group:"rel",replace:""},"\\fallingdotseq":{font:"ams",group:"rel",replace:""},"\\backsim":{font:"ams",group:"rel",replace:""},"\\backsimeq":{font:"ams",group:"rel",replace:""},"\\subseteqq":{font:"ams",group:"rel",replace:""},"\\Subset":{font:"ams",group:"rel",replace:""},"\\sqsubset":{font:"ams",group:"rel",replace:""},"\\preccurlyeq":{font:"ams",group:"rel",replace:""},"\\curlyeqprec":{font:"ams",group:"rel",replace:""},"\\precsim":{font:"ams",group:"rel",replace:""},"\\precapprox":{font:"ams",group:"rel",replace:""},"\\vartriangleleft":{font:"ams",group:"rel",replace:""},"\\trianglelefteq":{font:"ams",group:"rel",replace:""},"\\vDash":{font:"ams",group:"rel",replace:""},"\\Vvdash":{font:"ams",group:"rel",replace:""},"\\smallsmile":{font:"ams",group:"rel",replace:""},"\\smallfrown":{font:"ams",group:"rel",replace:""},"\\bumpeq":{font:"ams",group:"rel",replace:""},"\\Bumpeq":{font:"ams",group:"rel",replace:""},"\\geqq":{font:"ams",group:"rel",replace:""},"\\geqslant":{font:"ams",group:"rel",replace:""},"\\eqslantgtr":{font:"ams",group:"rel",replace:""},"\\gtrsim":{font:"ams",group:"rel",replace:""},"\\gtrapprox":{font:"ams",group:"rel",replace:""},"\\gtrdot":{font:"ams",group:"bin",replace:""},"\\ggg":{font:"ams",group:"rel",replace:""},"\\gtrless":{font:"ams",group:"rel",replace:""},"\\gtreqless":{font:"ams",group:"rel",replace:""},"\\gtreqqless":{font:"ams",group:"rel",replace:""},"\\eqcirc":{font:"ams",group:"rel",replace:""},"\\circeq":{font:"ams",group:"rel",replace:""},"\\triangleq":{font:"ams",group:"rel",replace:""},"\\thicksim":{font:"ams",group:"rel",replace:""},"\\thickapprox":{font:"ams",group:"rel",replace:""},"\\supseteqq":{font:"ams",group:"rel",replace:""},"\\Supset":{font:"ams",group:"rel",replace:""},"\\sqsupset":{font:"ams",group:"rel",replace:""},"\\succcurlyeq":{font:"ams",group:"rel",replace:""},"\\curlyeqsucc":{font:"ams",group:"rel",replace:""},"\\succsim":{font:"ams",group:"rel",replace:""},"\\succapprox":{font:"ams",group:"rel",replace:""},"\\vartriangleright":{font:"ams",group:"rel",replace:""},"\\trianglerighteq":{font:"ams",group:"rel",replace:""},"\\Vdash":{font:"ams",group:"rel",replace:""},"\\shortmid":{font:"ams",group:"rel",replace:""},"\\shortparallel":{font:"ams",group:"rel",replace:""},"\\between":{font:"ams",group:"rel",replace:""},"\\pitchfork":{font:"ams",group:"rel",replace:""},"\\varpropto":{font:"ams",group:"rel",replace:""},"\\blacktriangleleft":{font:"ams",group:"rel",replace:""},"\\therefore":{font:"ams",group:"rel",replace:""},"\\backepsilon":{font:"ams",group:"rel",replace:""},"\\blacktriangleright":{font:"ams",group:"rel",replace:""},"\\because":{font:"ams",group:"rel",replace:""},"\\llless":{font:"ams",group:"rel",replace:""},"\\gggtr":{font:"ams",group:"rel",replace:""},"\\lhd":{font:"ams",group:"bin",replace:""},"\\rhd":{font:"ams",group:"bin",replace:""},"\\eqsim":{font:"ams",group:"rel",replace:""},"\\Join":{font:"main",group:"rel",replace:""},"\\Doteq":{font:"ams",group:"rel",replace:""},"\\dotplus":{font:"ams",group:"bin",replace:""},"\\smallsetminus":{font:"ams",group:"bin",replace:""},"\\Cap":{font:"ams",group:"bin",replace:""},"\\Cup":{font:"ams",group:"bin",replace:""},"\\doublebarwedge":{font:"ams",group:"bin",replace:""},"\\boxminus":{font:"ams",group:"bin",replace:""},"\\boxplus":{font:"ams",group:"bin",replace:""},"\\divideontimes":{font:"ams",group:"bin",replace:""},"\\ltimes":{font:"ams",group:"bin",replace:""},"\\rtimes":{font:"ams",group:"bin",replace:""},"\\leftthreetimes":{font:"ams",group:"bin",replace:""},"\\rightthreetimes":{font:"ams",group:"bin",replace:""},"\\curlywedge":{font:"ams",group:"bin",replace:""},"\\curlyvee":{font:"ams",group:"bin",replace:""},"\\circleddash":{font:"ams",group:"bin",replace:""},"\\circledast":{font:"ams",group:"bin",replace:""},"\\centerdot":{font:"ams",group:"bin",replace:""},"\\intercal":{font:"ams",group:"bin",replace:""},"\\doublecap":{font:"ams",group:"bin",replace:""},"\\doublecup":{font:"ams",group:"bin",replace:""},"\\boxtimes":{font:"ams",group:"bin",replace:""},"\\dashrightarrow":{font:"ams",group:"rel",replace:""},"\\dashleftarrow":{font:"ams",group:"rel",replace:""},"\\leftleftarrows":{font:"ams",group:"rel",replace:""},"\\leftrightarrows":{font:"ams",group:"rel",replace:""},"\\Lleftarrow":{font:"ams",group:"rel",replace:""},"\\twoheadleftarrow":{font:"ams",group:"rel",replace:""},"\\leftarrowtail":{font:"ams",group:"rel",replace:""},"\\looparrowleft":{font:"ams",group:"rel",replace:""},"\\leftrightharpoons":{font:"ams",group:"rel",replace:""},"\\curvearrowleft":{font:"ams",group:"rel",replace:""},"\\circlearrowleft":{font:"ams",group:"rel",replace:""},"\\Lsh":{font:"ams",group:"rel",replace:""},"\\upuparrows":{font:"ams",group:"rel",replace:""},"\\upharpoonleft":{font:"ams",group:"rel",replace:""},"\\downharpoonleft":{font:"ams",group:"rel",replace:""},"\\multimap":{font:"ams",group:"rel",replace:""},"\\leftrightsquigarrow":{font:"ams",group:"rel",replace:""},"\\rightrightarrows":{font:"ams",group:"rel",replace:""},"\\rightleftarrows":{font:"ams",group:"rel",replace:""},"\\twoheadrightarrow":{font:"ams",group:"rel",replace:""},"\\rightarrowtail":{font:"ams",group:"rel",replace:""},"\\looparrowright":{font:"ams",group:"rel",replace:""},"\\curvearrowright":{font:"ams",group:"rel",replace:""},"\\circlearrowright":{font:"ams",group:"rel",replace:""},"\\Rsh":{font:"ams",group:"rel",replace:""},"\\downdownarrows":{font:"ams",group:"rel",replace:""},"\\upharpoonright":{font:"ams",group:"rel",replace:""},"\\downharpoonright":{font:"ams",group:"rel",replace:""},"\\rightsquigarrow":{font:"ams",group:"rel",replace:""},"\\leadsto":{font:"ams",group:"rel",replace:""},"\\Rrightarrow":{font:"ams",group:"rel",replace:""},"\\restriction":{font:"ams",group:"rel",replace:""},"`":{font:"main",group:"textord",replace:""},"\\$":{font:"main",group:"textord",replace:"$"},"\\%":{font:"main",group:"textord",replace:"%"},"\\_":{font:"main",group:"textord",replace:"_"},"\\angle":{font:"main",group:"textord",replace:""},"\\infty":{font:"main",group:"textord",replace:""},"\\prime":{font:"main",group:"textord",replace:""},"\\triangle":{font:"main",group:"textord",replace:""},"\\Gamma":{font:"main",group:"textord",replace:""},"\\Delta":{font:"main",group:"textord",replace:""},"\\Theta":{font:"main",group:"textord",replace:""},"\\Lambda":{font:"main",group:"textord",replace:""},"\\Xi":{font:"main",group:"textord",replace:""},"\\Pi":{font:"main",group:"textord",replace:""},"\\Sigma":{font:"main",group:"textord",replace:""},"\\Upsilon":{font:"main",group:"textord",replace:""},"\\Phi":{font:"main",group:"textord",replace:""},"\\Psi":{font:"main",group:"textord",replace:""},"\\Omega":{font:"main",group:"textord",replace:""},"\\neg":{font:"main",group:"textord",replace:""},"\\lnot":{font:"main",group:"textord",replace:""},"\\top":{font:"main",group:"textord",replace:""},"\\bot":{font:"main",group:"textord",replace:""},"\\emptyset":{font:"main",group:"textord",replace:""},"\\varnothing":{font:"ams",group:"textord",replace:""},"\\alpha":{font:"main",group:"mathord",replace:""},"\\beta":{font:"main",group:"mathord",replace:""},"\\gamma":{font:"main",group:"mathord",replace:""},"\\delta":{font:"main",group:"mathord",replace:""},"\\epsilon":{font:"main",group:"mathord",replace:""},"\\zeta":{font:"main",group:"mathord",replace:""},"\\eta":{font:"main",group:"mathord",replace:""},"\\theta":{font:"main",group:"mathord",replace:""},"\\iota":{font:"main",group:"mathord",replace:""},"\\kappa":{font:"main",group:"mathord",replace:""},"\\lambda":{font:"main",group:"mathord",replace:""},"\\mu":{font:"main",group:"mathord",replace:""},"\\nu":{font:"main",group:"mathord",replace:""},"\\xi":{font:"main",group:"mathord",replace:""},"\\omicron":{font:"main",group:"mathord",replace:"o"},"\\pi":{font:"main",group:"mathord",replace:""},"\\rho":{font:"main",group:"mathord",replace:""},"\\sigma":{font:"main",group:"mathord",replace:""},"\\tau":{font:"main",group:"mathord",replace:""},"\\upsilon":{font:"main",group:"mathord",replace:""},"\\phi":{font:"main",group:"mathord",replace:""},"\\chi":{font:"main",group:"mathord",replace:""},"\\psi":{font:"main",group:"mathord",replace:""},"\\omega":{font:"main",group:"mathord",replace:""},"\\varepsilon":{font:"main",group:"mathord",replace:""},"\\vartheta":{font:"main",group:"mathord",replace:""},"\\varpi":{font:"main",group:"mathord",replace:""},"\\varrho":{font:"main",group:"mathord",replace:""},"\\varsigma":{font:"main",group:"mathord",replace:""},"\\varphi":{font:"main",group:"mathord",replace:""},"*":{font:"main",group:"bin",replace:""},"+":{font:"main",group:"bin"},"-":{font:"main",group:"bin",replace:""},"\\cdot":{font:"main",group:"bin",replace:""},"\\circ":{font:"main",group:"bin",replace:""},"\\div":{font:"main",group:"bin",replace:""},"\\pm":{font:"main",group:"bin",replace:""},"\\times":{font:"main",group:"bin",replace:""},"\\cap":{font:"main",group:"bin",replace:""},"\\cup":{font:"main",group:"bin",replace:""},"\\setminus":{font:"main",group:"bin",replace:""},"\\land":{font:"main",group:"bin",replace:""},"\\lor":{font:"main",group:"bin",replace:""},"\\wedge":{font:"main",group:"bin",replace:""},"\\vee":{font:"main",group:"bin",replace:""},"\\surd":{font:"main",group:"textord",replace:""},"(":{font:"main",group:"open"},"[":{font:"main",group:"open"},"\\langle":{font:"main",group:"open",replace:""},"\\lvert":{font:"main",group:"open",replace:""},"\\lVert":{font:"main",group:"open",replace:""},")":{font:"main",group:"close"},"]":{font:"main",group:"close"},"?":{font:"main",group:"close"},"!":{font:"main",group:"close"},"\\rangle":{font:"main",group:"close",replace:""},"\\rvert":{font:"main",group:"close",replace:""},"\\rVert":{font:"main",group:"close",replace:""},"=":{font:"main",group:"rel"},"<":{font:"main",group:"rel"},">":{font:"main",group:"rel"},":":{font:"main",group:"rel"},"\\approx":{font:"main",group:"rel",replace:""},"\\cong":{font:"main",group:"rel",replace:""},"\\ge":{font:"main",group:"rel",replace:""},"\\geq":{font:"main",group:"rel",replace:""},"\\gets":{font:"main",group:"rel",replace:""},"\\in":{font:"main",group:"rel",replace:""},"\\notin":{font:"main",group:"rel",replace:""},"\\subset":{font:"main",group:"rel",replace:""},"\\supset":{font:"main",group:"rel",replace:""},"\\subseteq":{font:"main",group:"rel",replace:""},"\\supseteq":{font:"main",group:"rel",replace:""},"\\nsubseteq":{font:"ams",group:"rel",replace:""},"\\nsupseteq":{font:"ams",group:"rel",replace:""},"\\models":{font:"main",group:"rel",replace:""},"\\leftarrow":{font:"main",group:"rel",replace:""},"\\le":{font:"main",group:"rel",replace:""},"\\leq":{font:"main",group:"rel",replace:""},"\\ne":{font:"main",group:"rel",replace:""},"\\neq":{font:"main",group:"rel",replace:""},"\\rightarrow":{font:"main",group:"rel",replace:""},"\\to":{font:"main",group:"rel",replace:""},"\\ngeq":{font:"ams",group:"rel",replace:""},"\\nleq":{font:"ams",group:"rel",replace:""},"\\!":{font:"main",group:"spacing"},"\\ ":{font:"main",group:"spacing",replace:""},"~":{font:"main",group:"spacing",replace:""},"\\,":{font:"main",group:"spacing"},"\\:":{font:"main",group:"spacing"},"\\;":{font:"main",group:"spacing"},"\\enspace":{font:"main",group:"spacing"},"\\qquad":{font:"main",group:"spacing"},"\\quad":{font:"main",group:"spacing"},"\\space":{font:"main",group:"spacing",replace:""},",":{font:"main",group:"punct"},";":{font:"main",group:"punct"},"\\colon":{font:"main",group:"punct",replace:":"},"\\barwedge":{font:"ams",group:"bin",replace:""},"\\veebar":{font:"ams",group:"bin",replace:""},"\\odot":{font:"main",group:"bin",replace:""},"\\oplus":{font:"main",group:"bin",replace:""},"\\otimes":{font:"main",group:"bin",replace:""},"\\partial":{font:"main",group:"textord",replace:""},"\\oslash":{font:"main",group:"bin",replace:""},"\\circledcirc":{font:"ams",group:"bin",replace:""},"\\boxdot":{font:"ams",group:"bin",replace:""},"\\bigtriangleup":{font:"main",group:"bin",replace:""},"\\bigtriangledown":{font:"main",group:"bin",replace:""},"\\dagger":{font:"main",group:"bin",replace:""},"\\diamond":{font:"main",group:"bin",replace:""},"\\star":{font:"main",group:"bin",replace:""},"\\triangleleft":{font:"main",group:"bin",replace:""},"\\triangleright":{font:"main",group:"bin",replace:""},"\\{":{font:"main",group:"open",replace:"{"},"\\}":{font:"main",group:"close",replace:"}"},"\\lbrace":{font:"main",group:"open",replace:"{"},"\\rbrace":{font:"main",group:"close",replace:"}"},"\\lbrack":{font:"main",group:"open",replace:"["},"\\rbrack":{font:"main",group:"close",replace:"]"},"\\lfloor":{font:"main",group:"open",replace:""},"\\rfloor":{font:"main",group:"close",replace:""},"\\lceil":{font:"main",group:"open",replace:""},"\\rceil":{font:"main",group:"close",replace:""},"\\backslash":{font:"main",group:"textord",replace:"\\"},"|":{font:"main",group:"textord",replace:""},"\\vert":{font:"main",group:"textord",replace:""},"\\|":{font:"main",group:"textord",replace:""},"\\Vert":{font:"main",group:"textord",replace:""},"\\uparrow":{font:"main",group:"rel",replace:""},"\\Uparrow":{font:"main",group:"rel",replace:""},"\\downarrow":{font:"main",group:"rel",replace:""},"\\Downarrow":{font:"main",group:"rel",replace:""},"\\updownarrow":{font:"main",group:"rel",replace:""},"\\Updownarrow":{font:"main",group:"rel",replace:""},"\\coprod":{font:"math",group:"op",replace:""},"\\bigvee":{font:"math",group:"op",replace:""},"\\bigwedge":{font:"math",group:"op",replace:""},"\\biguplus":{font:"math",group:"op",replace:""},"\\bigcap":{font:"math",group:"op",replace:""},"\\bigcup":{font:"math",group:"op",replace:""},"\\int":{font:"math",group:"op",replace:""},"\\intop":{font:"math",group:"op",replace:""},"\\iint":{font:"math",group:"op",replace:""},"\\iiint":{font:"math",group:"op",replace:""},"\\prod":{font:"math",group:"op",replace:""},"\\sum":{font:"math",group:"op",replace:""},"\\bigotimes":{font:"math",group:"op",replace:""},"\\bigoplus":{font:"math",group:"op",replace:""},"\\bigodot":{font:"math",group:"op",replace:""},"\\oint":{font:"math",group:"op",replace:""},"\\bigsqcup":{font:"math",group:"op",replace:""},"\\smallint":{font:"math",group:"op",replace:""},"\\ldots":{font:"main",group:"inner",replace:""},"\\cdots":{font:"main",group:"inner",replace:""},"\\ddots":{font:"main",group:"inner",replace:""},"\\vdots":{font:"main",group:"textord",replace:""},"\\acute":{font:"main",group:"accent",replace:""},"\\grave":{font:"main",group:"accent",replace:"`"},"\\ddot":{font:"main",group:"accent",replace:""},"\\tilde":{font:"main",group:"accent",replace:"~"},"\\bar":{font:"main",group:"accent",replace:""},"\\breve":{font:"main",group:"accent",replace:""},"\\check":{font:"main",group:"accent",replace:""},"\\hat":{font:"main",group:"accent",replace:"^"},"\\vec":{font:"main",group:"accent",replace:""},"\\dot":{font:"main",group:"accent",replace:""},"\\imath":{font:"main",group:"mathord",replace:""},"\\jmath":{font:"main",group:"mathord",replace:""}},text:{"\\ ":{font:"main",group:"spacing",replace:""}," ":{font:"main",group:"spacing",replace:""},"~":{font:"main",group:"spacing",replace:""}}};var n='0123456789/@."';for(var a=0;a<n.length;a++){var o=n.charAt(a);r.math[o]={font:"main",group:"textord"}}var s="0123456789`!@*()-=+[]'\";:?/.,";for(var a=0;a<s.length;a++){var o=s.charAt(a);r.text[o]={font:"main",group:"textord"}}var h="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var a=0;a<h.length;a++){var o=h.charAt(a);r.math[o]={font:"main",group:"mathord"};r.text[o]={font:"main",group:"textord"}}t.exports=r},{}],23:[function(e,t,i){var r=Array.prototype.indexOf;var n=function(e,t){if(e==null){return-1}if(r&&e.indexOf===r){return e.indexOf(t)}var i=0,n=e.length;for(;i<n;i++){if(e[i]===t){return i}}return-1};var a=function(e,t){return n(e,t)!==-1};var o=function(e,t){return e===undefined?t:e};var s=/([A-Z])/g;var h=function(e){return e.replace(s,"-$1").toLowerCase()};var l={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"};var u=/[&><"']/g;function c(e){return l[e]}function p(e){return(""+e).replace(u,c)}var f;if(typeof document!=="undefined"){var d=document.createElement("span");if("textContent"in d){f=function(e,t){e.textContent=t}}else{f=function(e,t){e.innerText=t}}}function m(e){f(e,"")}t.exports={contains:a,deflt:o,escape:p,hyphenate:h,indexOf:n,setTextContent:f,clearNode:m}},{}]},{},[1])(1)});(function(){var e=window.DomReady={};var t=navigator.userAgent.toLowerCase();var i={version:(t.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(t),opera:/opera/.test(t),msie:/msie/.test(t)&&!/opera/.test(t),mozilla:/mozilla/.test(t)&&!/(compatible|webkit)/.test(t)};var r=false;var n=false;var a=[];function o(){if(!n){n=true;if(a){for(var e=0;e<a.length;e++){a[e].call(window,[])}a=[]}}}function s(e){var t=window.onload;if(typeof window.onload!="function"){window.onload=e}else{window.onload=function(){if(t){t()}e()}}}function h(){if(r){return}r=true;if(document.addEventListener&&!i.opera){document.addEventListener("DOMContentLoaded",o,false)}if(i.msie&&window==top)(function(){if(n)return;try{document.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}o()})();if(i.opera){document.addEventListener("DOMContentLoaded",function(){if(n)return;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].disabled){setTimeout(arguments.callee,0);return}o()},false)}if(i.safari){var e;(function(){if(n)return;if(document.readyState!="loaded"&&document.readyState!="complete"){setTimeout(arguments.callee,0);return}if(e===undefined){var t=document.getElementsByTagName("link");for(var i=0;i<t.length;i++){if(t[i].getAttribute("rel")=="stylesheet"){e++}}var r=document.getElementsByTagName("style");e+=r.length}if(document.styleSheets.length!=e){setTimeout(arguments.callee,0);return}o()})()}s(o)}e.ready=function(e,t){h();if(n){e.call(window,[])}else{a.push(function(){return e.call(window,[])})}};h()})();(function(){"use strict";var e,t,i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M,S,A,C,z,P,L,O,D,F=function(e,t){return function(){return e.apply(t,arguments)}},B=[].slice,U=function(e,t){for(var i in t){if(N.call(t,i))e[i]=t[i]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},N={}.hasOwnProperty;C={red:[.8941,.102,.1098],blue:[.2157,.4941,.7216],green:[.302,.6863,.2902],violet:[.5961,.3059,.6392],orange:[1,.498,0],yellow:[.7,.7,0],brown:[.651,.3373,.1569],pink:[.9686,.5059,.749]};r=function(){function e(){var e;e=1<=arguments.length?B.call(arguments,0):[];this.darken=F(this.darken,this);this.brighten=F(this.brighten,this);this.fromHSL=F(this.fromHSL,this);this.hsl=F(this.hsl,this);this.three=F(this.three,this);this.arr=F(this.arr,this);this.str=F(this.str,this);this.hex=F(this.hex,this);this.set=F(this.set,this);this.r=1;this.g=1;this.b=1;if(e.length>0){this.set.apply(this,e)}}e.prototype.set=function(){var t,i,r,n,a;t=1<=arguments.length?B.call(arguments,0):[];if(t.length===3||t.length===4){this.r=t[0],this.g=t[1],this.b=t[2]}else if(t[0]instanceof Array){this.set.apply(this,t[0])}else if(t[0]instanceof e||t[0]instanceof THREE.Color){n=[t[0].r,t[0].g,t[0].b],this.r=n[0],this.g=n[1],this.b=n[2]}else if(typeof t[0]==="number"){r=Math.floor(t[0]);this.r=(r>>16&255)/255;this.g=(r>>8&255)/255;this.b=(r&255)/255}else if(typeof t[0]==="string"){a=t[0];if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(a)){i=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(a);this.r=Math.min(255,parseInt(i[1],10))/255;this.g=Math.min(255,parseInt(i[2],10))/255;this.b=Math.min(255,parseInt(i[3],10))/255}else if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(a)){i=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(a);this.r=Math.min(100,parseInt(i[1],10))/100;this.g=Math.min(100,parseInt(i[2],10))/100;this.b=Math.min(100,parseInt(i[3],10))/100}else if(/^\#([0-9a-f]{6})$/i.test(a)){i=/^\#([0-9a-f]{6})$/i.exec(a);this.set(parseInt(i[1],16))}else if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a)){i=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a);this.set(parseInt(i[1]+i[1]+i[2]+i[2]+i[3]+i[3],16))}else if(/^(\w+)$/i.test(a)){this.set(C[a])}}this.r=Math.min(1,Math.max(0,this.r));this.g=Math.min(1,Math.max(0,this.g));this.b=Math.min(1,Math.max(0,this.b));return this};e.prototype.hex=function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0};e.prototype.str=function(){return"#"+("000000"+this.hex().toString(16)).slice(-6)};e.prototype.arr=function(){var e;e=1<=arguments.length?B.call(arguments,0):[];if(e.length===0){return[this.r,this.g,this.b]}return[this.r,this.g,this.b,e[0]]};e.prototype.three=function(){return new THREE.Color(this.r,this.g,this.b)};e.prototype.hsl=function(){var e,t,i,r,n,a;r=Math.max(this.r,this.g,this.b);n=Math.min(this.r,this.g,this.b);i=(r+n)/2;t=a=0;if(r!==n){e=r-n;a=i>.5?e/(2-r-n):e/(r+n);switch(r){case this.r:t=(this.g-this.b)/e+(this.g<this.b?6:0);break;case this.g:t=(this.b-this.r)/e+2;break;case this.b:t=(this.r-this.g)/e+4}t/=6}return[t,a,i]};e.prototype.fromHSL=function(e,t,i){var r,n,a;e=Math.min(1,Math.max(0,e));t=Math.min(1,Math.max(0,t));i=Math.min(1,Math.max(0,i));if(t===0){this.r=this.g=this.b=i}else{r=function(e,t,i){if(i<0){i+=1}if(i>1){i-=1}if(i<1/6){return e+(t-e)*6*i}if(i<1/2){return t}if(i<2/3){return e+(t-e)*(2/3-i)*6}return e};a=i<.5?i*(1+t):i+t-i*t;n=2*i-a;this.r=r(n,a,e+1/3);this.g=r(n,a,e);this.b=r(n,a,e-1/3)}return this};e.prototype.brighten=function(t){var i,r,n,a;n=this.hsl(),i=n[0],a=n[1],r=n[2];return(new e).fromHSL(i,a,r+t)};e.prototype.darken=function(e){return this.brighten(-e)};return e}();O=false;try{S=Object.defineProperty({},"passive",{get:function(){return O=true}});window.addEventListener("testPassive",null,S);window.removeEventListener("testPassive",null,S)}catch(e){b=e}T=function(e,t){var i,r,n;r=[];for(i in t){n=t[i];if(t.hasOwnProperty(i)){r.push(e[i]=n)}else{r.push(void 0)}}return r};A=function(){var e;e=null;return function(t,i){if(e==null){e=new THREE.Vector3}e.copy(t.normalize());return i.sub(e.multiplyScalar(i.dot(t))).normalize()}}();k=function(e){var t,i;if(e instanceof THREE.Vector3){return e}i=new THREE.Vector3;return i.set(e[0],e[1],(t=e[2])!=null?t:0)};P=function(e,t){var i;if(t instanceof THREE.Vector3){return e.copy(t)}else{return e.set(t[0],t[1],(i=t[2])!=null?i:0)}};z=function(e,t){var i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,T,R,k,H,M,S,A,C,z,P,L,O,D,F,B,U,N,V,I,j,G,W,q,X,Y,Z,K,Q,J,$,ee,te,ie,re,ne,ae,oe,se,he,le,ue,ce;H=function(){var t,i,n;i=[];for(n=0,t=e.length;n<t;n++){r=e[n];i.push(r.slice())}return i}();if(t==null){t={}}y=(P=t.rows)!=null?P:e[0].length;_=(L=t.cols)!=null?L:e.length;ce=(W=t.epsilon)!=null?W:1e-5;ae=0;n=0;A=[];m=-1;T=[];a=[];R=[];i=function(){var e,t,i;t=[];for(i=0,e=y;0<=e?i<e:i>e;0<=e?i++:i--){t.push(function(){var e,t,i;t=[];for(i=0,e=y;0<=e?i<e:i>e;0<=e?i++:i--){t.push(0)}return t}())}return t}();for(h=he=0,J=y;0<=J?he<J:he>J;h=0<=J?++he:--he){i[h][h]=1}while(true){if(n===_){break}if(ae===y){for(p=le=$=n,ee=_;$<=ee?le<ee:le>ee;p=$<=ee?++le:--le){T.push(p)}break}w=Math.abs(e[n][ae]);b=ae;for(p=ue=te=ae+1,ie=y;te<=ie?ue<ie:ue>ie;p=te<=ie?++ue:--ue){if(Math.abs(e[n][p])>w){w=Math.abs(e[n][p]);b=p}}if(Math.abs(w)<ce){T.push(n);n++;continue}for(p=l=0,re=_;0<=re?l<re:l>re;p=0<=re?++l:--l){ne=[e[p][ae],e[p][b]],e[p][b]=ne[0],e[p][ae]=ne[1]}for(p=c=0,O=y;0<=O?c<O:c>O;p=0<=O?++c:--c){D=[i[p][ae],i[p][b]],i[p][b]=D[0],i[p][ae]=D[1]}A.push([ae,n]);a.push(H[n]);m=ae;S=e[n][ae];for(p=f=F=ae+1,B=y;F<=B?f<B:f>B;p=F<=B?++f:--f){r=e[n][p]/S;if(r===0){continue}e[n][p]=0;for(u=d=U=n+1,N=_;U<=N?d<N:d>N;u=U<=N?++d:--d){e[u][p]-=r*e[u][ae]}for(u=E=0,V=y;0<=V?E<V:E>V;u=0<=V?++E:--E){i[u][p]-=r*i[u][ae]}}ae++;n++}I=A.reverse();for(x=0,g=I.length;x<g;x++){j=I[x],ae=j[0],n=j[1];S=e[n][ae];e[n][ae]=1;for(p=k=G=n+1,q=_;G<=q?k<q:k>q;p=G<=q?++k:--k){e[p][ae]/=S}for(p=M=0,X=y;0<=X?M<X:M>X;p=0<=X?++M:--M){i[p][ae]/=S}for(p=C=0,Y=ae;0<=Y?C<Y:C>Y;p=0<=Y?++C:--C){r=e[n][p];e[n][p]=0;for(u=z=Z=n+1,K=_;Z<=K?z<K:z>K;u=Z<=K?++z:--z){e[u][p]-=r*e[u][ae]}for(u=oe=0,Q=y;0<=Q?oe<Q:oe>Q;u=0<=Q?++oe:--oe){i[u][p]-=r*i[u][ae]}}}s=function(){var t,i,r,a;a=function(){var e,t,i;t=[];for(i=0,e=_;0<=e?i<e:i>e;0<=e?i++:i--){t.push(0)}return t}();a[h]=1;for(r=0,t=A.length;r<t;r++){i=A[r],ae=i[0],n=i[1];a[n]=-e[h][ae]}return R.push(a)};for(se=0,v=T.length;se<v;se++){h=T[se];s()}o=function(e,t){var r,a,o,s,l,c,p,f,d,g,v,E;r=[];for(h=f=0,o=y;0<=o?f<o:f>o;h=0<=o?++f:--f){v=0;for(u=d=0,s=y;0<=s?d<s:d>s;u=0<=s?++d:--d){v+=i[u][h]*e[u]}r.push(v)}for(h=g=l=m+1,c=y;l<=c?g<c:g>c;h=l<=c?++g:--g){if(Math.abs(r[h])>ce){return null}}if(t==null){t=function(){var e,t,i;t=[];for(i=0,e=_;0<=e?i<e:i>e;0<=e?i++:i--){t.push(0)}return t}()}for(E=0,a=A.length;E<a;E++){p=A[E],ae=p[0],n=p[1];t[n]=r[ae]}return t};return[R,a,i,o]};_=function(e){var t,i,r,n,a,o,s,h,l,u,c,p,f,d;switch(e.length){case 2:u=e[0],t=u[0],i=u[1],c=e[1],r=c[0],a=c[1];n=[t*a-i*r,-t-a,1];return findRoots(1,-t-a,t*a-i*r);case 3:p=e[0],t=p[0],i=p[1],r=p[2],f=e[1],a=f[0],b=f[1],o=f[2],d=e[2],s=d[0],h=d[1],l=d[2];return findRoots(1,-t-b-l,t*b+t*l+b*l-i*a-r*s-o*h,-t*b*l-i*o*s-r*a*h+t*o*h+i*a*l+r*b*s)}};v=function(e){e.prototype.on=function(e,t){var i,r,n,a;if(!(e instanceof Array)){e=[e]}if(this._listeners==null){this._listeners={}}for(a=0,r=e.length;a<r;a++){n=e[a];if((i=this._listeners)[n]==null){i[n]=[]}this._listeners[n].push(t)}return this};e.prototype.off=function(e,t){var i,r,n,a,o,s;if(!(e instanceof Array)){e=[e]}for(s=0,r=e.length;s<r;s++){o=e[s];i=(n=this._listeners)!=null?(a=n[o])!=null?a.indexOf(t):void 0:void 0;if(i!=null&&i>=0){this._listeners[o].splice(i,1)}}return this};return e.prototype.trigger=function(e){var t,i,r,n,a,o,s;o=e.type;e.target=this;r=(n=this._listeners)!=null?(a=n[o])!=null?a.slice():void 0:void 0;if(r==null){return}for(s=0,i=r.length;s<i;s++){t=r[s];t.call(this,e,this);if(t.triggerOnce){this.off(o,t)}}return this}};E="// Enable STPQ mapping\n#define POSITION_STPQ\nvoid getPosition(inout vec4 xyzw, inout vec4 stpq) {\n  // Store XYZ per vertex in STPQ\nstpq = xyzw;\n}";y="// Enable STPQ mapping\n#define POSITION_STPQ\nuniform float range;\nuniform int hilite;\n\nvec4 getColor(vec4 rgba, inout vec4 stpq) {\n    stpq = abs(stpq);\n    rgba = getShadedColor(rgba);\n\n    // Discard pixels outside of clip box\n    if(stpq.x > range || stpq.y > range || stpq.z > range)\n        discard;\n\n    if(hilite != 0 &&\n       (range - stpq.x < range * 0.002 ||\n        range - stpq.y < range * 0.002 ||\n        range - stpq.z < range * 0.002)) {\n        rgba.xyz *= 10.0;\n        rgba.w = 1.0;\n    }\n\n    return rgba;\n}";M="vec4 getShadedColor(vec4 rgba) {\n    return rgba;\n}";L="varying vec3 vNormal;\nvarying vec3 vLight;\nvarying vec3 vPosition;\n\nvec3 offSpecular(vec3 color) {\n  vec3 c = 1.0 - color;\n  return 1.0 - c * c;\n}\n\nvec4 getShadedColor(vec4 rgba) {\n\n  vec3 color = rgba.xyz;\n  vec3 color2 = offSpecular(rgba.xyz);\n\n  vec3 normal = normalize(vNormal);\n  vec3 light = normalize(vLight);\n  vec3 position = normalize(vPosition);\n\n  float side    = gl_FrontFacing ? -1.0 : 1.0;\n  float cosine  = side * dot(normal, light);\n  float diffuse = mix(max(0.0, cosine), .5 + .5 * cosine, .1);\n\n  vec3  halfLight = normalize(light + position);\n\tfloat cosineHalf = max(0.0, side * dot(normal, halfLight));\n\tfloat specular = pow(cosineHalf, 16.0);\n\n\treturn vec4(color * (diffuse * .9 + .05) + .25 * color2 * specular, rgba.a);\n}";x=function(e){try{return exprEval.Parser.evaluate(e)}catch(e){return 0}};m=function(){function e(){this.get=F(this.get,this);var e,t,i,r,n;i=/\+/g;n=/([^&=]+)=?([^&]*)/g;e=function(e){return decodeURIComponent(e.replace(i," "))};r=window.location.search.substring(1);while(t=n.exec(r)){this[e(t[1])]=e(t[2])}}e.prototype.get=function(e,t,i){var r;if(t==null){t="str"}if(i==null){i=void 0}r=this[e];if(r!=null){switch(t){case"str":return r;case"str[]":return r.split(",");case"float":return x(r);case"float[]":return r.split(",").map(x);case"int":return parseInt(r);case"int[]":return r.split(",").map(parseInt);case"bool":if(r==="true"||r==="yes"||r==="on"){return true}if(r==="false"||r==="no"||r==="off"){return false}if(i!=null){return i}return false;case"matrix":return r.split(":").map(function(e){return e.split(",").map(x)})}}else{if(i!=null){return i}switch(t){case"str":return"";case"float":return 0;case"int":return 0;case"str[]":case"float[]":case"int[]":case"matrix":return[];case"bool":return false}}};return e}();D=new m;p=function(){function e(e,t){this.camera=e;this.touchEnd=F(this.touchEnd,this);this.touchMove=F(this.touchMove,this);this.touchStart=F(this.touchStart,this);this.onKeyDown=F(this.onKeyDown,this);this.onMouseWheel=F(this.onMouseWheel,this);this.onMouseUp=F(this.onMouseUp,this);this.onMouseMove=F(this.onMouseMove,this);this.onMouseDown=F(this.onMouseDown,this);this.reset=F(this.reset,this);this.update=F(this.update,this);this.pan=F(this.pan,this);this.panUp=F(this.panUp,this);this.panLeft=F(this.panLeft,this);this.dollyOut=F(this.dollyOut,this);this.dollyIn=F(this.dollyIn,this);this.getZoomScale=F(this.getZoomScale,this);this.rotateUp=F(this.rotateUp,this);this.rotateLeft=F(this.rotateLeft,this);this.getAutoRotationAngle=F(this.getAutoRotationAngle,this);this.updateCamera=F(this.updateCamera,this);this.enable=F(this.enable,this);THREE.EventDispatcher.prototype.apply(this);this.domElement=t!=null?t:document;this.enabled=true;this.target=new THREE.Vector3;this.noZoom=false;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=false;this.rotateSpeed=1;this.noPan=false;this.keyPanSpeed=7;this.autoRotate=false;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.noKeys=true;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.clones=[];this.EPS=1e-6;this.rotateStart=new THREE.Vector2;this.rotateEnd=new THREE.Vector2;this.rotateDelta=new THREE.Vector2;this.panStart=new THREE.Vector2;this.panEnd=new THREE.Vector2;this.panDelta=new THREE.Vector2;this.panOffset=new THREE.Vector3;this.panCurrent=new THREE.Vector3;this.offset=new THREE.Vector3;this.dollyStart=new THREE.Vector2;this.dollyEnd=new THREE.Vector2;this.dollyDelta=new THREE.Vector2;this.phiDelta=0;this.thetaDelta=0;this.scale=1;this.lastPosition=new THREE.Vector3;this.STATE={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5};this.state=this.STATE.NONE;this.target0=this.target.clone();this.position0=this.camera.position.clone();this.updateCamera();this.changeEvent={type:"change"};this.startEvent={type:"start"};this.endEvent={type:"end"};this.domElement.addEventListener("contextmenu",function(e){return e.preventDefault()},false);this.domElement.addEventListener("mousedown",this.onMouseDown,false);this.domElement.addEventListener("mousewheel",this.onMouseWheel,false);this.domElement.addEventListener("touchstart",this.touchStart,false);window.addEventListener("keydown",this.onKeyDown,false);this.update()}e.prototype.enable=function(e){var t,i,r;this.enabled=e;if(!this.enabled){t=document.documentElement;if((i=this.state)===this.STATE.ROTATE||i===this.STATE.DOLLY||i===this.STATE.PAN){t.removeEventListener("mousemove",this.onMouseMove,false);t.removeEventListener("mouseup",this.onMouseUp,false);this.dispatchEvent(this.endEvent)}else if((r=this.state)===this.STATE.TOUCH_ROTATE||r===this.STATE.TOUCH_DOLLY||r===this.STATE.TOUCH_PAN){t.removeEventListener("touchend",this.touchEnd,false);t.removeEventListener("touchmove",this.touchMove,false);t.removeEventListener("touchcancel",this.touchEnd,false);this.dispatchEvent(this.endEvent)}return this.state=this.STATE.NONE}};e.prototype.updateCamera=function(){this.quat=(new THREE.Quaternion).setFromUnitVectors(this.camera.up,new THREE.Vector3(0,1,0));this.quatInverse=this.quat.clone().inverse();return this.update()};e.prototype.getAutoRotationAngle=function(){return 2*Math.PI/60/60*this.autoRotateSpeed};e.prototype.rotateLeft=function(e){return this.thetaDelta-=e!=null?e:this.getAutoRotationAngle()};e.prototype.rotateUp=function(e){return this.phiDelta-=e!=null?e:this.getAutoRotationAngle()};e.prototype.getZoomScale=function(){return Math.pow(.95,this.zoomSpeed)};e.prototype.dollyIn=function(e){return this.scale/=e!=null?e:this.getZoomScale()};e.prototype.dollyOut=function(e){return this.scale*=e!=null?e:this.getZoomScale()};e.prototype.panLeft=function(e){var t;t=this.camera.matrix.elements;this.panOffset.set(t[0],t[1],t[2]);this.panOffset.multiplyScalar(-e);return this.panCurrent.add(this.panOffset)};e.prototype.panUp=function(e){var t;t=this.camera.matrix.elements;this.panOffset.set(t[4],t[5],t[6]);this.panOffset.multiplyScalar(e);return this.panCurrent.add(this.panOffset)};e.prototype.pan=function(e,t){var i,r,n,a;i=this.domElement===document?document.body:this.domElement;if(this.camera.fov!=null){n=this.camera.position;r=n.clone().sub(this.target);a=r.length();a*=Math.tan(this.camera.fov/2*Math.PI/180);this.panLeft(2*e*a/i.clientHeight);return this.panUp(2*t*a/i.clientHeight)}else if(this.camera.top!=null){this.panLeft(e*(this.camera.right-this.camera.left)/i.clientWidth);return this.panUp(t*(this.camera.top-this.camera.bottom)/i.clientHeight)}else{return console.warn("WARNING: OrbitControls encountered unknown camera type; pan disabled")}};e.prototype.update=function(e,t){var i,r,n,a,o,s,h,l,u,c,p,f;if(t==null){l=this.clones;for(f=0,r=l.length;f<r;f++){i=l[f];i.update(0,this)}}if(t==null){t=this}p=t.thetaDelta,o=t.phiDelta,n=t.panCurrent,u=t.scale;s=this.camera.position;this.offset.copy(s).sub(this.target);this.offset.applyQuaternion(this.quat);c=Math.atan2(this.offset.x,this.offset.z);a=Math.atan2(Math.sqrt(this.offset.x*this.offset.x+this.offset.z*this.offset.z),this.offset.y);if(this.autoRotate){this.rotateLeft(this.getAutoRotationAngle())}c+=p;a+=o;a=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,a));a=Math.max(this.EPS,Math.min(Math.PI-this.EPS,a));h=this.offset.length()*u;h=Math.max(this.minDistance,Math.min(this.maxDistance,h));this.target.add(n);this.offset.x=h*Math.sin(a)*Math.sin(c);this.offset.y=h*Math.cos(a);this.offset.z=h*Math.sin(a)*Math.cos(c);this.offset.applyQuaternion(this.quatInverse);s.copy(this.target).add(this.offset);this.camera.lookAt(this.target);this.thetaDelta=0;this.phiDelta=0;this.scale=1;this.panCurrent.set(0,0,0);if(this.lastPosition.distanceToSquared(s)>this.EPS){this.dispatchEvent(this.changeEvent);return this.lastPosition.copy(s)}};e.prototype.reset=function(){this.state=this.STATE.NONE;this.target.copy(this.target0);this.camera.position.copy(this.position0);return this.update()};e.prototype.onMouseDown=function(e){if(!this.enabled){return}e.preventDefault();switch(e.button){case 0:if(this.noRotate){return}this.state=this.STATE.ROTATE;this.rotateStart.set(e.clientX,e.clientY);break;case 1:if(this.noZoom){return}this.state=this.STATE.DOLLY;this.dollyStart.set(e.clientX,e.clientY);break;case 2:if(this.noPan){return}this.state=this.STATE.PAN;this.panStart.set(e.clientX,e.clientY)}document.documentElement.addEventListener("mousemove",this.onMouseMove,false);document.documentElement.addEventListener("mouseup",this.onMouseUp,false);return this.dispatchEvent(this.startEvent)};e.prototype.onMouseMove=function(e){var t;if(!this.enabled){return}e.preventDefault();t=this.domElement===document?document.body:this.domElement;switch(this.state){case this.STATE.ROTATE:if(this.noRotate){return}this.rotateEnd.set(e.clientX,e.clientY);this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart);this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientWidth*this.rotateSpeed);this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight*this.rotateSpeed);this.rotateStart.copy(this.rotateEnd);break;case this.STATE.DOLLY:if(this.noZoom){return}this.dollyEnd.set(e.clientX,e.clientY);this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart);if(this.dollyDelta.y>0){this.dollyIn()}else{this.dollyOut()}this.dollyStart.copy(this.dollyEnd);break;case this.STATE.PAN:if(this.noPan){return}this.panEnd.set(e.clientX,e.clientY);this.panDelta.subVectors(this.panEnd,this.panStart);this.pan(this.panDelta.x,this.panDelta.y);this.panStart.copy(this.panEnd);break;default:return}return this.update()};e.prototype.onMouseUp=function(){if(!this.enabled){return}document.documentElement.removeEventListener("mousemove",this.onMouseMove,false);document.documentElement.removeEventListener("mouseup",this.onMouseUp,false);this.dispatchEvent(this.endEvent);return this.state=this.STATE.NONE};e.prototype.onMouseWheel=function(e){var t,i;if(!(this.enabled&&!this.noZoom)){return}e.preventDefault();e.stopPropagation();t=(i=e.wheelDelta)!=null?i:-e.detail;if(t>0){this.dollyOut()}else{this.dollyIn()}this.update();this.dispatchEvent(this.startEvent);return this.dispatchEvent(this.endEvent)};e.prototype.onKeyDown=function(e){if(!this.enabled||this.noKeys||this.noPan){return}switch(e.keyCode){case this.keys.UP:this.pan(0,this.keyPanSpeed);break;case this.keys.BOTTOM:this.pan(0,-this.keyPanSpeed);break;case this.keys.LEFT:this.pan(this.keyPanSpeed,0);break;case this.keys.RIGHT:this.pan(-this.keyPanSpeed,0);break;default:return}return this.update()};e.prototype.touchStart=function(e){var t,i,r;if(!this.enabled){return}e.preventDefault();switch(e.touches.length){case 1:if(this.noRotate){return}this.state=this.STATE.TOUCH_ROTATE;this.rotateStart.set(e.touches[0].clientX,e.touches[0].clientY);break;case 2:if(this.noZoom){return}this.state=this.STATE.TOUCH_DOLLY;i=e.touches[0].clientX-e.touches[1].clientX;r=e.touches[0].clientY-e.touches[1].clientY;t=Math.sqrt(i*i+r*r);this.dollyStart.set(0,t);break;case 3:if(this.noPan){return}this.state=this.STATE.TOUCH_PAN;this.panStart.set(e.touches[0].clientX,e.touches[0].clientY);break;default:this.state=this.STATE.NONE}document.documentElement.addEventListener("touchend",this.touchEnd,false);document.documentElement.addEventListener("touchmove",this.touchMove,false);document.documentElement.addEventListener("touchcancel",this.touchEnd,false);return this.dispatchEvent(this.startEvent)};e.prototype.touchMove=function(e){var t,i,r,n;if(!this.enabled){return}e.preventDefault();e.stopPropagation();n=this.domElement===document?document.body:this.domElement;switch(e.touches.length){case 1:if(this.noRotate||this.state!==this.STATE.TOUCH_ROTATE){return}this.rotateEnd.set(e.touches[0].clientX,e.touches[0].clientY);this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart);this.rotateLeft(2*Math.PI*this.rotateDelta.x/n.clientWidth*this.rotateSpeed);this.rotateUp(2*Math.PI*this.rotateDelta.y/n.clientHeight*this.rotateSpeed);this.rotateStart.copy(this.rotateEnd);break;case 2:if(this.noZoom||this.state!==this.STATE.TOUCH_DOLLY){return}i=e.touches[0].clientX-e.touches[1].clientX;r=e.touches[0].clientY-e.touches[1].clientY;t=Math.sqrt(i*i+r*r);this.dollyEnd.set(0,t);this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart);if(this.dollyDelta.y>0){this.dollyOut()}else{this.dollyIn()}this.dollyStart.copy(this.dollyEnd);break;case 3:if(this.noPan||this.state!==this.STATE.TOUCH_PAN){return}this.panEnd.set(e.touches[0].clientX,e.touches[0].clientY);this.panDelta.subVectors(this.panEnd,this.panStart);this.pan(this.panDelta.x,this.panDelta.y);this.panStart.copy(this.panEnd);break;default:this.touchEnd();return}return this.update()};e.prototype.touchEnd=function(){if(!this.enabled){return}document.documentElement.removeEventListener("touchend",this.touchEnd,false);document.documentElement.removeEventListener("touchmove",this.touchMove,false);document.documentElement.removeEventListener("touchcancel",this.touchEnd,false);this.dispatchEvent(this.endEvent);return this.state=this.STATE.NONE};return e}();R=function(){var e,t,i,r,n,a;e=1<=arguments.length?B.call(arguments,0):[];e=e.filter(function(e){return e.three.controls!=null});n=[];for(t=a=0,r=e.length;0<=r?a<r:a>r;t=0<=r?++a:--a){n.push(function(){var r,n,a;n=[];for(i=a=0,r=e.length;0<=r?a<r:a>r;i=0<=r?++a:--a){if(i===t){continue}n.push(e[t].three.controls.clones.push(e[i].three.controls))}return n}())}return n};e=function(){function e(){this.running=false}e.prototype.start=function(){this.running=true;return this};e.prototype.stop=function(){if(!this.running){return}this.running=false;this.trigger({type:"stopped"});return this};e.prototype.done=function(){this.running=false;this.trigger({type:"done"});return this};return e}();v(e);c=function(e){U(t,e);function t(e,i){var r,n;this.opts=i;this.opts.target=e;if((r=this.opts).to==null){r.to=Math.max.apply(null,function(){var e;e=[];for(n in this.opts.script){e.push(n)}return e}.call(this))}t.__super__.constructor.apply(this,arguments)}t.prototype.start=function(){this._play=this.opts.target.play(this.opts);this._play.on("play.done",function(e){return function(){e._play.remove();delete e._play;return e.done()}}(this));return t.__super__.start.apply(this,arguments)};t.prototype.stop=function(){var e;if((e=this._play)!=null){e.remove()}delete this._play;return t.__super__.stop.apply(this,arguments)};return t}(e);d=function(){function e(e){var t,i,r,n,a;this.opts=e;this.updateDim=F(this.updateDim,this);this.setVisibility=F(this.setVisibility,this);this.draw=F(this.draw,this);this.contains=F(this.contains,this);this.complementFull=F(this.complementFull,this);this.complement=F(this.complement,this);this.project=F(this.project,this);this.update=F(this.update,this);this.setVecs=F(this.setVecs,this);this.onDimChange=(i=this.opts.onDimChange)!=null?i:function(){};this.ortho=[new THREE.Vector3,new THREE.Vector3];this.zeroThreshold=(r=this.opts.zeroThreshold)!=null?r:1e-5;this.numVecs=this.opts.vectors.length;this.vectors=[];for(t=a=0,n=this.numVecs;0<=n?a<n:a>n;t=0<=n?++a:--a){this.vectors[t]=k(this.opts.vectors[t])}this.mesh=this.opts.mesh;this.tmpVec1=new THREE.Vector3;this.tmpVec2=new THREE.Vector3;this.tmpVec3=new THREE.Vector3;this.drawn=false;this.dim=-1;this.update()}e.prototype.setVecs=function(e){var t,i,r;for(t=r=0,i=this.numVecs;0<=i?r<i:r>i;t=0<=i?++r:--r){P(this.vectors[t],e[t])}return this.update()};e.prototype.update=function(){var e,t,i,r,n,a,o,s,h,l,u;n=this.vectors,o=n[0],h=n[1],u=n[2];a=this.ortho,i=a[0],r=a[1];e=this.tmpVec1;t=this.dim;switch(this.numVecs){case 0:this.dim=0;break;case 1:if(o.lengthSq()<=this.zeroThreshold){this.dim=0}else{this.dim=1;i.copy(o).normalize()}break;case 2:e.crossVectors(o,h);if(e.lengthSq()<=this.zeroThreshold){s=o.lengthSq()<=this.zeroThreshold;l=h.lengthSq()<=this.zeroThreshold;if(s&&l){this.dim=0}else if(s){this.dim=1;i.copy(h).normalize()}else{this.dim=1;i.copy(o).normalize()}}else{this.dim=2;A(i.copy(o),r.copy(h))}break;case 3:e.crossVectors(o,h);if(Math.abs(e.dot(u))>this.zeroThreshold){this.dim=3}else{if(e.lengthSq()>this.zeroThreshold){this.dim=2;A(i.copy(o),r.copy(h))}else{e.crossVectors(o,u);if(e.lengthSq()>this.zeroThreshold){this.dim=2;A(i.copy(o),r.copy(u))}else{e.crossVectors(h,u);if(e.lengthSq()>this.zeroThreshold){this.dim=2;A(i.copy(h),r.copy(u))}else if(o.lengthSq()>this.zeroThreshold){this.dim=1;i.copy(o)}else if(h.lengthSq()>this.zeroThreshold){this.dim=1;i.copy(h)}else if(u.lengthSq()>this.zeroThreshold){this.dim=1;i.copy(u)}else{this.dim=0}}}}}if(t!==this.dim){return this.updateDim(t)}};e.prototype.project=function(e,t){var i,r,n;e=P(this.tmpVec1,e);n=this.ortho,i=n[0],r=n[1];switch(this.dim){case 0:return t.set(0,0,0);case 1:return t.copy(i).multiplyScalar(i.dot(e));case 2:t.copy(i).multiplyScalar(i.dot(e));this.tmpVec2.copy(r).multiplyScalar(r.dot(e));return t.add(this.tmpVec2);case 3:return t.copy(e)}};e.prototype.complement=function(){var e,t,i,r,n,a,o,s;o=this.ortho,n=o[0],a=o[1];switch(this.dim){case 0:return[[1,0,0],[0,1,0],[0,0,1]];case 1:s=[n.x,n.y,n.z],e=s[0],t=s[1],i=s[2];if(Math.abs(e)<this.zeroThreshold){if(Math.abs(t)<this.zeroThreshold){return[[1,0,0],[0,1,0]]}if(Math.abs(i)<this.zeroThreshold){return[[1,0,0],[0,0,1]]}return[[1,0,0],[0,i,-t]]}P(this.tmpVec1,[t,-e,0]);P(this.tmpVec2,[i,0,-e]);A(this.tmpVec1,this.tmpVec2);return[[this.tmpVec1.x,this.tmpVec1.y,this.tmpVec1.z],[this.tmpVec2.x,this.tmpVec2.y,this.tmpVec2.z]];case 2:r=this.tmpVec1;r.crossVectors(n,a);return[[r.x,r.y,r.z]];case 3:return[]}};e.prototype.complementFull=function(e){var t;t=this.complement().concat([[0,0,0],[0,0,0],[0,0,0]]);if(e){t[0][2]=0;t[1][2]=0;return[t[0],t[1]]}return t.slice(0,3)};e.prototype.contains=function(e){this.project(e,this.tmpVec3);P(this.tmpVec1,e);this.tmpVec1.sub(this.tmpVec3);return this.tmpVec1.lengthSq()<this.zeroThreshold};e.prototype.draw=function(e){var t,i,n,a,o,s,h,l,u,c,p,f,d;a=(s=this.opts.name)!=null?s:"subspace";this.range=(h=this.opts.range)!=null?h:10;t=(l=this.opts.color)!=null?l:new r("violet");n=(u=this.opts.live)!=null?u:true;if(t instanceof r){t=t.arr()}this.range*=2;o={id:a+"-point",classes:[a],color:t,opacity:1,size:15,visible:false};T(o,(c=this.opts.pointOpts)!=null?c:{});i={id:a+"-line",classes:[a],color:t,opacity:1,stroke:"solid",width:5,visible:false};T(i,(p=this.opts.lineOpts)!=null?p:{});d={id:a+"-plane",classes:[a],color:t,opacity:.25,lineX:false,lineY:false,fill:true,visible:false};T(d,(f=this.opts.surfaceOpts)!=null?f:{});if(n||this.dim===0){e.array({channels:3,width:1,live:n,data:[[0,0,0]]});this.point=e.point(o)}if(n&&this.numVecs>=1||this.dim===1){e.array({channels:3,width:2,live:n,expr:function(e){return function(t,i){if(i===0){return t(-e.ortho[0].x*e.range,-e.ortho[0].y*e.range,-e.ortho[0].z*e.range)}else{return t(e.ortho[0].x*e.range,e.ortho[0].y*e.range,e.ortho[0].z*e.range)}}}(this)});this.line=e.line(i)}if(n&&this.numVecs>=2||this.dim===2){if(!this.opts.noPlane){e.matrix({channels:3,width:2,height:2,live:n,expr:function(e){return function(t,i,r){var n,a;n=i===0?-1:1;a=r===0?-1:1;return t(n*e.ortho[0].x*e.range+a*e.ortho[1].x*e.range,n*e.ortho[0].y*e.range+a*e.ortho[1].y*e.range,n*e.ortho[0].z*e.range+a*e.ortho[1].z*e.range)}}(this)});this.plane=e.surface(d)}}this.objects=[this.point,this.line,this.plane];this.drawn=true;return this.updateDim(-1)};e.prototype.setVisibility=function(e){var t,i;if(!this.drawn){return}if((t=this.objects[this.dim])!=null){t.set("visible",e)}if(this.dim===3){return(i=this.mesh)!=null?i.material.visible=e:void 0}};e.prototype.updateDim=function(e){var t;this.onDimChange(this);if(!this.drawn){return}if(e>=0&&e<3&&this.objects[e]!=null){this.objects[e].set("visible",false)}if(this.dim<3&&this.objects[this.dim]!=null){this.objects[this.dim].set("visible",true)}return(t=this.mesh)!=null?t.material.visible=this.dim===3:void 0};return e}();u=function(){function e(e,t){var i,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,R,k,H,M,S,A,C,z,P,L,O;y=(_=t.name)!=null?_:"lincombo";O=t.vectors;u=t.colors;w=(x=t.pointColor)!=null?x:new r("red");d=t.labels;a=t.coeffs;n=(R=t.coeffVars)!=null?R:["x","y","z"];if(w instanceof r){w=w.arr()}i=function(e){return a[n[e]]};v={classes:[y],points:"#"+y+"-points",colors:"#"+y+"-colors",color:"white",opacity:.75,width:3,zIndex:1};T(v,(k=t.lineOpts)!=null?k:{});b={classes:[y],points:"#"+y+"-combo",color:w,zIndex:2,size:15};T(b,(H=t.pointOpts)!=null?H:{});f={classes:[y],outline:0,background:[0,0,0,0],color:w,offset:[0,25],zIndex:3,size:15};T(f,(M=t.labelOpts)!=null?M:{});E=O.length;for(S=0,m=O.length;S<m;S++){C=O[S];if(C[2]==null){C[2]=0}}z=O[0];P=O[1];L=O[2];for(p=A=0,g=u.length;A<g;p=++A){o=u[p];if(o instanceof r){u[p]=o.arr(1)}}s=u[0];h=u[1];l=u[2];switch(E){case 1:c=function(e){return function(){return e.combo=[z[0]*i(0),z[1]*i(0),z[2]*i(0)]}}(this);e.array({id:y+"-points",channels:3,width:2,items:1,expr:function(e,t){if(t===0){return e(0,0,0)}else{return e(z[0]*i(0),z[1]*i(0),z[2]*i(0))}}}).array({id:y+"-colors",channels:4,width:1,items:1,data:[s]}).array({id:y+"-combo",channels:3,width:1,expr:function(e){return e.apply(null,c())}});break;case 2:c=function(e){return function(){return e.combo=[z[0]*i(0)+P[0]*i(1),z[1]*i(0)+P[1]*i(1),z[2]*i(0)+P[2]*i(1)]}}(this);e.array({id:y+"-points",channels:3,width:2,items:4,expr:function(e,t){var r,n,a;r=[z[0]*i(0),z[1]*i(0),z[2]*i(0)];a=[P[0]*i(1),P[1]*i(1),P[2]*i(1)];n=[r[0]+a[0],r[1]+a[1],r[2]+a[2]];if(t===0){e(0,0,0);e(0,0,0);e.apply(null,r);return e.apply(null,a)}else{e.apply(null,r);e.apply(null,a);e.apply(null,n);return e.apply(null,n)}}}).array({id:y+"-colors",channels:4,width:2,items:4,data:[s,h,h,s,s,h,h,s]}).array({id:y+"-combo",channels:3,width:1,expr:function(e){return e.apply(null,c())}});break;case 3:c=function(e){return function(){return e.combo=[z[0]*i(0)+P[0]*i(1)+L[0]*i(2),z[1]*i(0)+P[1]*i(1)+L[1]*i(2),z[2]*i(0)+P[2]*i(1)+L[2]*i(2)]}}(this);e.array({id:y+"-points",channels:3,width:2,items:12,expr:function(e,t){var r,n,a,o,s,h,l;r=[z[0]*i(0),z[1]*i(0),z[2]*i(0)];s=[P[0]*i(1),P[1]*i(1),P[2]*i(1)];l=[L[0]*i(2),L[1]*i(2),L[2]*i(2)];n=[r[0]+s[0],r[1]+s[1],r[2]+s[2]];o=[r[0]+l[0],r[1]+l[1],r[2]+l[2]];h=[s[0]+l[0],s[1]+l[1],s[2]+l[2]];a=[r[0]+s[0]+l[0],r[1]+s[1]+l[1],r[2]+s[2]+l[2]];if(t===0){e(0,0,0);e(0,0,0);e(0,0,0);e.apply(null,r);e.apply(null,r);e.apply(null,s);e.apply(null,s);e.apply(null,l);e.apply(null,l);e.apply(null,n);e.apply(null,o);return e.apply(null,h)}else{e.apply(null,r);e.apply(null,s);e.apply(null,l);e.apply(null,n);e.apply(null,o);e.apply(null,n);e.apply(null,h);e.apply(null,o);e.apply(null,h);e.apply(null,a);e.apply(null,a);return e.apply(null,a)}}}).array({id:y+"-colors",channels:4,width:2,items:12,data:[s,h,l,h,l,s,l,s,h,l,h,s,s,h,l,h,l,s,l,s,h,l,h,s]}).array({id:y+"-combo",channels:3,width:1,expr:function(e){return e.apply(null,c())}})}e.line(v).point(b);if(d!=null){e.text({live:true,width:1,expr:function(e){var t,r,n,a;a=i(0).toFixed(2)+d[0];if(E>=2){r=Math.abs(i(1));t=i(1)>=0?"+":"-";a+=t+r.toFixed(2)+d[1]}if(E>=3){n=Math.abs(i(2));t=i(2)>=0?"+":"-";a+=t+n.toFixed(2)+d[2]}return e(a)}}).label(f)}this.combine=c}return e}();s=function(){function e(e,t){var i,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x;s=(c=t.name)!=null?c:"vecgrid";x=t.vectors;h=(p=t.numLines)!=null?p:40;o=(f=t.live)!=null?f:true;g={id:s,opacity:1,size:20,normal:false,color:13369344};T(g,(d=t.ticksOpts)!=null?d:{});if(g["color"]instanceof r){g["color"]=g["color"].arr()}a={id:s,opacity:.5,stroke:"solid",width:2,color:8912896,zBias:2};T(a,(m=t.lineOpts)!=null?m:{});if(a["color"]instanceof r){a["color"]=a["color"].arr()}l=x.length;for(y=0,n=x.length;y<n;y++){E=x[y];if(E[2]==null){E[2]=0}}w=x[0],b=x[1],_=x[2];u=h/2;if(l===1){e.array({channels:3,live:o,width:h+1,expr:function(e,t){t-=u;return e(t*w[0],t*w[1],t*w[2])}});this.ticks=e.ticks(g);return}if(l===2){v=(h+1)*2;i=function(e,t){var i,r,n,a,o,s;a=[];for(i=s=r=-u,n=u;r<=n?s<=n:s>=n;i=r<=n?++s:--s){o=t===0?-u:u;e(o*w[0]+i*b[0],o*w[1]+i*b[1],o*w[2]+i*b[2]);a.push(e(o*b[0]+i*w[0],o*b[1]+i*w[1],o*b[2]+i*w[2]))}return a}}if(l===3){v=(h+1)*(h+1)*3;i=function(e,t){var i,r,n,a,o,s,h;o=[];for(i=h=n=-u,a=u;n<=a?h<=a:h>=a;i=n<=a?++h:--h){o.push(function(){var n,a,o,h;o=[];for(r=h=n=-u,a=u;n<=a?h<=a:h>=a;r=n<=a?++h:--h){s=t===0?-u:u;e(s*w[0]+i*b[0]+r*_[0],s*w[1]+i*b[1]+r*_[1],s*w[2]+i*b[2]+r*_[2]);e(s*b[0]+i*w[0]+r*_[0],s*b[1]+i*w[1]+r*_[1],s*b[2]+i*w[2]+r*_[2]);o.push(e(s*_[0]+i*w[0]+r*b[0],s*_[1]+i*w[1]+r*b[1],s*_[2]+i*w[2]+r*b[2]))}return o}())}return o}}e.array({channels:3,live:o,width:2,items:v,expr:i});this.lines=e.line(a)}return e}();t=function(){function e(e,t){this.mathbox=e;this.div=this.mathbox._context.overlays.div;this.label=document.createElement("div");this.label.className="overlay-text";this.label.innerHTML=t;this.div.appendChild(this.label)}return e}();f=function(){function e(e,t){this.mathbox=e;this.div=this.mathbox._context.overlays.div;this.popup=document.createElement("div");this.popup.className="overlay-popup";this.popup.style.display="none";if(t!=null){this.popup.innerHTML=t}this.div.appendChild(this.popup)}e.prototype.show=function(e){if(e!=null){this.popup.innerHTML=e}return this.popup.style.display=""};e.prototype.hide=function(){return this.popup.style.display="none"};return e}();g=function(){function e(e,t){var i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x;this.mathbox=e;this.opts=t;if(this.opts==null){this.opts={}}this.name=(l=this.opts.name)!=null?l:"view";_=(u=this.opts.viewRange)!=null?u:[[-10,10],[-10,10],[-10,10]];this.numDims=_.length;x=(p=this.opts.viewScale)!=null?p:[1,1,1];r=(f=this.opts.axes)!=null?f:true;i={classes:[this.name+"-axes"],end:true,width:3,depth:1,color:"black",opacity:.5,zBias:-1,size:5};T(i,(d=this.opts.axisOpts)!=null?d:{});a=(m=this.opts.grid)!=null?m:true;o={classes:[this.name+"-axes",this.name+"-grid"],axes:[1,2],width:2,depth:1,color:"black",opacity:.25,zBias:0};T(o,(g=this.opts.gridOpts)!=null?g:{});n=((v=this.opts.axisLabels)!=null?v:true)&&r;h={classes:[this.name+"-axes"],size:20,color:"black",opacity:.5,outline:0,background:[0,0,0,0],offset:[0,0]};T(h,(y=this.opts.labelOpts)!=null?y:{});if(this.numDims===3){b={range:_,scale:x,id:this.name+"-view"}}else{b={range:_,scale:x,id:this.name+"-view"}}T(b,(E=this.opts.viewOpts)!=null?E:{});this.view=this.mathbox.cartesian(b);if(r){for(s=w=1,c=this.numDims;1<=c?w<=c:w>=c;s=1<=c?++w:--w){i.axis=s;this.view.axis(i)}}if(a){this.view.grid(o)}if(n){this.view.array({channels:this.numDims,width:this.numDims,live:false,expr:function(e){return function(t,i){var r,n,a,o;r=[];for(n=o=0,a=e.numDims;0<=a?o<a:o>a;n=0<=a?++o:--o){if(i===n){r.push(_[i][1]*1.04)}else{r.push(0)}}return t.apply(null,r)}}(this)}).text({live:false,width:this.numDims,data:["x","y","z"].slice(0,this.numDims)}).label(h)}}return e}();o=function(){function e(e,t){var i,r,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_;this.view=e;this.opts=t;this.getIndexAt=F(this.getIndexAt,this);this.post=F(this.post,this);this.touchEnd=F(this.touchEnd,this);this.touchMove=F(this.touchMove,this);this.touchStart=F(this.touchStart,this);this.movePoint=F(this.movePoint,this);this.onMouseUp=F(this.onMouseUp,this);this.onMouseMove=F(this.onMouseMove,this);this.onMouseDown=F(this.onMouseDown,this);if(this.opts==null){this.opts={}}h=(u=this.opts.name)!=null?u:"draggable";this.points=this.opts.points;b=(c=this.opts.size)!=null?c:30;this.onDrag=(p=this.opts.onDrag)!=null?p:function(){};this.postDrag=(f=this.opts.postDrag)!=null?f:function(){};this.is2D=(d=this.opts.is2D)!=null?d:false;r=(m=this.opts.hiliteColor)!=null?m:[0,.5,.5,.75];this.eyeMatrix=(g=this.opts.eyeMatrix)!=null?g:new THREE.Matrix4;i=(v=this.opts.getMatrix)!=null?v:function(e){return e.view[0].controller.viewMatrix};n={id:h+"-hilite",color:"white",points:"#"+h+"-points",colors:"#"+h+"-colors",size:b,zIndex:2,zTest:false,zWrite:false};T(n,(y=this.opts.hiliteOpts)!=null?y:{});this.three=this.view._context.api.three;this.canvas=this.three.canvas;this.camera=this.view._context.api.select("camera")[0].controller.camera;this.enabled=true;E=this.points;for(_=0,s=E.length;_<s;_++){l=E[_];if(l[2]==null){l[2]=0}}this.hovered=-1;this.dragging=-1;this.mouse=[-1,-1];this.activePoint=void 0;this.projected=new THREE.Vector3;this.vector=new THREE.Vector3;this.matrix=new THREE.Matrix4;this.matrixInv=new THREE.Matrix4;this.scale=1/4;this.viewMatrix=i(this);this.viewMatrixInv=(new THREE.Matrix4).getInverse(this.viewMatrix);this.viewMatrixTrans=this.viewMatrix.clone().transpose();this.eyeMatrixTrans=this.eyeMatrix.clone().transpose();this.eyeMatrixInv=(new THREE.Matrix4).getInverse(this.eyeMatrix);o=function(){var e,t,i;t=[];for(a=i=0,e=this.points.length;0<=e?i<e:i>e;a=0<=e?++i:--i){t.push([(a+1)/255,1,0,0])}return t}.call(this);this.view.array({id:h+"-points",channels:3,width:this.points.length,data:this.points}).array({id:h+"-index",channels:4,width:this.points.length,data:o,live:false});w=this.view.rtt({id:h+"-rtt",size:"relative",width:this.scale,height:this.scale});w.transform({pass:"eye",matrix:Array.prototype.slice.call(this.eyeMatrixTrans.elements)}).transform({matrix:Array.prototype.slice.call(this.viewMatrixTrans.elements)}).point({points:"#"+h+"-points",colors:"#"+h+"-index",color:"white",size:b,blending:"no"}).end();this.view.array({id:h+"-colors",channels:4,width:this.points.length,expr:function(e){return function(t,i,n){if(!e.enabled){t(1,1,1,0);return}if(e.dragging===i||e.hovered===i){return t.apply(null,r)}else{return t(1,1,1,0)}}}(this)}).point(n);this.readback=this.view.readback({source:"#"+h+"-rtt",type:"unsignedByte"});this.canvas.addEventListener("mousedown",this.onMouseDown,false);this.canvas.addEventListener("mousemove",this.onMouseMove,false);this.canvas.addEventListener("mouseup",this.onMouseUp,false);this.canvas.addEventListener("touchstart",this.touchStart,false);this.three.on("post",this.post)}e.prototype.onMouseDown=function(e){if(this.hovered<0||!this.enabled){return}e.preventDefault();this.dragging=this.hovered;return this.activePoint=this.points[this.dragging]};e.prototype.onMouseMove=function(e){var t;t=window.devicePixelRatio;this.mouse=[e.offsetX*t,e.offsetY*t];this.hovered=this.getIndexAt(this.mouse[0],this.mouse[1]);if(this.dragging<0||!this.enabled){return}e.preventDefault();return this.movePoint(e.offsetX,e.offsetY)};e.prototype.onMouseUp=function(e){if(this.dragging<0||!this.enabled){return}e.preventDefault();this.dragging=-1;return this.activePoint=void 0};e.prototype.movePoint=function(e,t){var i,r;i=e/this.canvas.offsetWidth*2-1;r=-(t/this.canvas.offsetHeight*2-1);this.projected.set(this.activePoint[0],this.activePoint[1],this.activePoint[2]).applyMatrix4(this.viewMatrix);this.matrix.multiplyMatrices(this.camera.projectionMatrix,this.eyeMatrix);this.matrix.multiply(this.matrixInv.getInverse(this.camera.matrixWorld));this.projected.applyProjection(this.matrix);this.vector.set(i,r,this.projected.z);this.vector.applyProjection(this.matrixInv.getInverse(this.matrix));this.vector.applyMatrix4(this.viewMatrixInv);if(this.is2D){this.vector.z=0}this.onDrag.call(this,this.vector);this.activePoint[0]=this.vector.x;this.activePoint[1]=this.vector.y;this.activePoint[2]=this.vector.z;return this.postDrag.call(this)};e.prototype.touchStart=function(e){var t,i,r,n,a;if(!(e.touches.length===1&&e.targetTouches.length===1)){return}if(!this.enabled){return}a=e.targetTouches[0];n=e.target.getBoundingClientRect();i=a.pageX-n.left;r=a.pageY-n.top;t=window.devicePixelRatio;this.dragging=this.getIndexAt(i*t,r*t);if(this.dragging<0){return}this.activePoint=this.points[this.dragging];e.preventDefault();this.canvas.addEventListener("touchend",this.touchEnd,false);this.canvas.addEventListener("touchmove",this.touchMove,false);return this.canvas.addEventListener("touchcancel",this.touchEnd,false)};e.prototype.touchMove=function(e){var t,i,r,n;if(!(e.touches.length===1&&e.targetTouches.length===1)){return}if(this.dragging<0||!this.enabled){return}e.preventDefault();n=e.targetTouches[0];r=e.target.getBoundingClientRect();t=n.pageX-r.left;i=n.pageY-r.top;return this.movePoint(t,i)};e.prototype.touchEnd=function(e){if(this.dragging<0||!this.enabled){return}e.preventDefault();this.dragging=-1;return this.activePoint=void 0};e.prototype.post=function(){var e,t;if(!this.enabled){if((e=this.three.controls)!=null){e.enable(true)}return}if(this.dragging>=0){this.canvas.style.cursor="pointer"}else if(this.hovered>=0){this.canvas.style.cursor="pointer"}else if(this.three.controls){this.canvas.style.cursor="move"}else{this.canvas.style.cursor=""}return(t=this.three.controls)!=null?t.enable(this.hovered<0&&this.dragging<0):void 0};e.prototype.getIndexAt=function(e,t){var i,r,n,a,o,s;r=this.readback.get("data");if(!r){return-1}e=Math.floor(e*this.scale);t=Math.floor(t*this.scale);s=this.readback.get("width");n=this.readback.get("height");a=(e+s*(n-t-1))*4;o=r[a];i=r[a+3];if(o!=null){if(i===0){return o-1}else{return-1}}else{return-1}};return e}();i=function(){function e(e,t){var i,n,a,o,s,h,l,u,c,p,f,d,m,g,v;this.view=e;this.opts=t;if(this.opts==null){this.opts={}}l=(u=this.opts.range)!=null?u:1;h=(c=this.opts.pass)!=null?c:"world";o=(p=this.opts.hilite)!=null?p:true;n=(f=this.opts.draw)!=null?f:false;v=(d=this.opts.shaded)!=null?d:false;this.three=this.view._context.api.three;this.camera=this.view._context.api.select("camera")[0].controller.camera;if(n){s=(m=this.opts.material)!=null?m:new THREE.MeshBasicMaterial;if(this.opts.color!=null){this.opts.color=new r(this.opts.color)}i=(g=this.opts.color)!=null?g:new r(.7,.7,.7);this.mesh=function(e){return function(){var t,r,n;r=new THREE.BoxGeometry(2,2,2);n=new THREE.Mesh(r,s);t=new THREE.BoxHelper(n);t.material.color=i.three();e.three.scene.add(t);return n}}(this)()}this.uniforms={range:{type:"f",value:l},hilite:{type:"i",value:o?1:0}};if(this.opts.fragmentShader!=null){a=this.opts.fragmentShader}else if(v){a=L+"\n"+y}else{a=M+"\n"+y}this.clipped=this.view.shader({code:E}).vertex({pass:h}).shader({code:a,uniforms:this.uniforms}).fragment()}e.prototype.installMesh=function(){this.three.scene.add(this.mesh);return this.three.on("pre",function(e){return function(){if(Math.abs(e.camera.position.x<1)&&Math.abs(e.camera.position.y<1)&&Math.abs(e.camera.position.z<1)){return e.mesh.material.side=THREE.BackSide}else{return e.mesh.material.side=THREE.FrontSide}}}(this))};return e}();l=function(){function e(e,t){var i,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,R,k,H,M,S,A,C,z,P,L,O,D,B;this.opts=t;this.show=F(this.show,this);this.hide=F(this.hide,this);if(this.opts==null){this.opts={}}m=(v=this.opts.name)!=null?v:"labeled";P=this.opts.vectors;n=this.opts.colors;l=this.opts.labels;g=(y=this.opts.origins)!=null?y:function(){var e,t,i;t=[];for(i=0,e=P.length;0<=e?i<e:i>e;0<=e?i++:i--){t.push([0,0,0])}return t}();d=(E=this.opts.live)!=null?E:true;u=(w=this.opts.labelsLive)!=null?w:false;z={id:m+"-vectors-drawn",classes:[m],points:"#"+m+"-vectors",colors:"#"+m+"-colors",color:"white",end:true,size:5,width:5};T(z,(b=this.opts.vectorOpts)!=null?b:{});h={id:m+"-vector-labels",classes:[m],colors:"#"+m+"-colors",color:"white",outline:0,background:[0,0,0,0],size:15,offset:[0,25]};T(h,(_=this.opts.labelOpts)!=null?_:{});a=(x=this.opts.zeroPoints)!=null?x:false;D={id:m+"-zero-points",classes:[m],points:"#"+m+"-zeros",colors:"#"+m+"-zero-colors",color:"white",size:20};T(D,(R=this.opts.zeroOpts)!=null?R:{});B=(k=this.opts.zeroThreshold)!=null?k:0;for(o=M=0,c=n.length;M<c;o=++M){i=n[o];if(i instanceof r){n[o]=i.arr(1)}}this.hidden=false;C=[];for(S=0,p=P.length;S<p;S++){A=P[S];if(A[2]==null){A[2]=0}}for(L=0,f=g.length;L<f;L++){A=g[L];if(A[2]==null){A[2]=0}}for(o=s=0,H=P.length;0<=H?s<H:s>H;o=0<=H?++s:--s){C.push(g[o]);C.push(P[o])}e.array({id:m+"-vectors",channels:3,width:P.length,items:2,data:C,live:d}).array({id:m+"-colors",channels:4,width:n.length,data:n,live:d});this.vecs=e.vector(z);if(l!=null){e.array({channels:3,width:P.length,expr:function(e,t){return e((P[t][0]+g[t][0])/2,(P[t][1]+g[t][1])/2,(P[t][2]+g[t][2])/2)},live:d}).text({id:m+"-text",live:u,width:l.length,data:l});this.labels=e.label(h)}if(a){O=function(){var e,t,i;i=[];for(e=0,t=P.length;0<=t?e<t:e>t;0<=t?e++:e--){i.push([0,0,0])}return i}();e.array({id:m+"-zero-colors",channels:4,width:P.length,live:d,expr:function(e,t){if(P[t][0]*P[t][0]+P[t][1]*P[t][1]+P[t][2]*P[t][2]<=B*B){return e.apply(null,n[t])}else{return e(0,0,0,0)}}}).array({id:m+"-zeros",channels:3,width:P.length,data:O,live:false});this.zeroPoints=e.point(D);this.zeroPoints.bind("visible",function(e){return function(){var t,i;if(e.hidden){return false}for(o=t=0,i=P.length;0<=i?t<i:t>i;o=0<=i?++t:--t){if(P[o][0]*P[o][0]+P[o][1]*P[o][1]+P[o][2]*P[o][2]<=B*B){return true}}return false}}(this))}}e.prototype.hide=function(){var e;if(this.hidden){return}this.hidden=true;this.vecs.set("visible",false);return(e=this.labels)!=null?e.set("visible",false):void 0};e.prototype.show=function(){var e;if(!this.hidden){return}this.hidden=false;this.vecs.set("visible",true);return(e=this.labels)!=null?e.set("visible",true):void 0};return e}();h=function(){function e(e,t){var i,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E,w,b,_,x,R,k;this.opts=t;this.show=F(this.show,this);this.hide=F(this.hide,this);if(this.opts==null){this.opts={}}p=(v=this.opts.name)!=null?v:"labeled-points";g=this.opts.points;n=this.opts.colors;s=this.opts.labels;c=(y=this.opts.live)!=null?y:true;h=(E=this.opts.labelsLive)!=null?E:false;m={id:p+"-drawn",classes:[p],points:"#"+p+"-points",colors:"#"+p+"-colors",color:"white",size:15};T(m,(w=this.opts.pointOpts)!=null?w:{});o={id:p+"-labels",classes:[p],points:"#"+p+"-points",colors:"#"+p+"-colors",color:"white",outline:0,background:[0,0,0,0],size:15,offset:[0,25]};T(o,(b=this.opts.labelOpts)!=null?b:{});for(a=x=0,l=n.length;x<l;a=++x){i=n[a];if(i instanceof r){n[a]=i.arr(1)}}this.hidden=false;d=[];for(R=0,u=g.length;R<u;R++){f=g[R];if(f[2]==null){f[2]=0}}for(a=k=0,_=g.length;0<=_?k<_:k>_;a=0<=_?++k:--k){d.push(g[a])}e.array({id:p+"-points",channels:3,width:g.length,data:d,live:c}).array({id:p+"-colors",channels:4,width:n.length,data:n,live:c});this.pts=e.point(m);if(s!=null){e.text({id:p+"-text",live:h,width:s.length,data:s});this.labels=e.label(o)}}e.prototype.hide=function(){var e;if(this.hidden){return}this.hidden=true;this.pts.set("visible",false);return(e=this.labels)!=null?e.set("visible",false):void 0};e.prototype.show=function(){var e;if(!this.hidden){return}this.hidden=false;this.pts.set("visible",true);return(e=this.labels)!=null?e.set("visible",true):void 0};return e}();n=function(){function e(e,t){var i,n,a,o,s,h,l,u,c,f,d,m,g,v,y,E,w,b,_,x,R,k,H;this.opts=e;this.stopAll=F(this.stopAll,this);this.animate=F(this.animate,this);this.clearAnims=F(this.clearAnims,this);this.texCombo=F(this.texCombo,this);this.texSet=F(this.texSet,this);this.urlParams=D;if(this.opts==null){this.opts={}}u={plugins:["core","controls","cursor"],controls:{klass:p,parameters:{noKeys:true}},mathbox:{inspect:false},splash:{fancy:true,color:"blue"}};T(u,(d=this.opts.mathbox)!=null?d:{});n=(m=this.opts.clearColor)!=null?m:16777215;a=(g=this.opts.clearOpacity)!=null?g:1;i={proxy:true,position:[3,1.5,1.5],lookAt:[0,0,0],up:[0,0,1]};T(i,(v=this.opts.camera)!=null?v:{});if((y=this.opts.cameraPosFromQS)!=null?y:true){i.position=this.urlParams.get("camera","float[]",i.position)}s=(E=this.opts.focusDist)!=null?E:1.5;R=(w=this.opts.scaleUI)!=null?w:true;o=(b=this.opts.fullscreen)!=null?b:true;this.dims=(_=this.opts.dims)!=null?_:3;n=new r(n);this.animations=[];c=function(e){return function(){var r;e.mathbox=mathBox(u);e.three=e.mathbox.three;e.three.renderer.setClearColor(n.three(),a);e.controls=e.three.controls;e.camera=e.mathbox.camera(i)[0].controller.camera;if((r=e.controls)!=null){if(typeof r.updateCamera==="function"){r.updateCamera()}}e.canvas=e.mathbox._context.canvas;if(R){e.mathbox.bind("focus",function(){return s/1e3*Math.min(e.canvas.clientWidth,e.canvas.clientHeight)})}else{e.mathbox.set("focus",s)}if(o){document.body.addEventListener("keypress",function(e){if(e.charCode==="f".charCodeAt(0&&screenfull.enabled)){return screenfull.toggle()}})}return t.apply(e)}}(this);f=(x=this.opts.preload)!=null?x:{};k=0;if(f){for(l in f){H=f[l];k++;h=new Image;this[l]=h;h.src=H;h.addEventListener("load",function(){if(--k===0){return c()}})}}if(!(k>0)){c()}}e.prototype.texVector=function(e,t){var i,n,a,o,s,h,l,u,c;if(t==null){t={}}s=(h=t.precision)!=null?h:2;n=(l=t.dim)!=null?l:this.dims;e=e.slice(0,n);if(s>=0){for(a=c=0,o=e.length;c<o;a=++c){i=e[a];e[a]=i.toFixed(s)}}u="";if(t.color!=null){if(t.color instanceof r){t.color=t.color.str()}u+="\\color{"+t.color+"}{"}u+="\\begin{bmatrix}";u+=e.join("\\\\");u+="\\end{bmatrix}";if(t.color!=null){u+="}"}return u};e.prototype.texSet=function(e,t){var i,n,a,o,s,h,l,u,c,p,f;if(t==null){t={}}n=t.colors;if(n!=null){for(a=c=0,o=n.length;c<o;a=++c){i=n[a];if(i instanceof r){n[a]=i.str()}}}h=(l=t.precision)!=null?l:2;u="\\left\\{";for(a=p=0,s=e.length;p<s;a=++p){f=e[a];if(n!=null){t.color=n[a]}u+=this.texVector(f,t);if(a+1<e.length){u+=",\\,"}}return u+"\\right\\}"};e.prototype.texCombo=function(e,t,i){var n,a,o,s,h,l,u,c,p,f,d,m,g,v;if(i==null){i={}}o=i.colors;if(o!=null){for(s=d=0,h=o.length;d<h;s=++d){a=o[s];if(a instanceof r){o[s]=a.str()}}}n=i.coeffColors;if(!(n instanceof Array)){n=function(){var t,i,r;i=[];for(r=0,t=e.length;0<=t?r<t:r>t;0<=t?r++:r--){i.push(n)}return i}()}for(s=m=0,l=n.length;m<l;s=++m){a=n[s];if(a instanceof r){n[s]=a.str()}}c=(p=i.precision)!=null?p:2;f="";for(s=v=0,u=e.length;v<u;s=++v){g=e[s];if(n[s]!=null){f+="\\color{"+n[s]+"}{"}if(t[s]!==1){if(t[s]===-1){f+="-"}else{f+=t[s].toFixed(c)}}if(n[s]!=null){f+="}"}if(o!=null){i.color=o[s]}f+=this.texVector(g,i);if(s+1<e.length&&t[s+1]>=0){f+=" + "}}return f};e.prototype.texMatrix=function(e,t){var i,n,a,o,s,h,l,u,c,p,f,d,m,g,v,y,E;if(t==null){t={}}n=t.colors;if(n!=null){for(a=v=0,s=n.length;v<s;a=++v){i=n[a];if(i instanceof r){n[a]=i.str()}}}u=(c=t.precision)!=null?c:2;h=(p=t.rows)!=null?p:this.dims;l=(f=t.cols)!=null?f:e.length;g="\\begin{bmatrix}";for(a=y=0,d=h;0<=d?y<d:y>d;a=0<=d?++y:--y){for(o=E=0,m=l;0<=m?E<m:E>m;o=0<=m?++E:--E){if(n!=null){g+="\\color{"+n[o]+"}{"}if(u>=0){g+=e[o][a].toFixed(u)}else{g+=e[o][a]}if(n!=null){g+="}"}if(o+1<l){g+="&"}}if(a+1<h){g+="\\\\"}}return g+="\\end{bmatrix}"};e.prototype.rowred=function(e,t){return z(e,t)};e.prototype.view=function(e){var t;if(e==null){e={}}if(this.urlParams.range!=null){t=this.urlParams.get("range","float");if(e.viewRange==null){e.viewRange=[[-t,t],[-t,t],[-t,t]]}}return new g(this.mathbox,e).view};e.prototype.caption=function(e){return new t(this.mathbox,e)};e.prototype.popup=function(e){return new f(this.mathbox,e)};e.prototype.clipCube=function(e,t){return new i(e,t)};e.prototype.draggable=function(e,t){return new o(e,t)};e.prototype.linearCombo=function(e,t){return new u(e,t)};e.prototype.grid=function(e,t){return new s(e,t)};e.prototype.labeledVectors=function(e,t){return new l(e,t)};e.prototype.labeledPoints=function(e,t){return new h(e,t)};e.prototype.subspace=function(e){return new d(e)};e.prototype.clearAnims=function(){return this.animations=this.animations.filter(function(e){return e.running})};e.prototype.animate=function(e){var t,i;t=(i=e.animation)!=null?i:new c(e.element,e);t.on("stopped",this.clearAnims);t.on("done",this.clearAnims);t.start();return this.animations.push(t)};e.prototype.stopAll=function(){var e,t,i,r;i=this.animations;for(r=0,t=i.length;r<t;r++){e=i[r];e.stop();e.off("stopped",this.clearAnims);e.off("done",this.clearAnims)}return this.animations=[]};return e}();a=function(e){U(t,e);function t(e,i){var r,n,a,o,s,h,l,u,c,p,f,d,m;if(e==null){e={}}if(e.dims==null){e.dims=2}if(e.mathbox==null){e.mathbox={}}if((r=e.mathbox).plugins==null){r.plugins=["core"]}p=(f=e.ortho)!=null?f:1e4;if((n=e.mathbox).camera==null){n.camera={}}if((a=e.mathbox.camera).near==null){a.near=p/4}if((o=e.mathbox.camera).far==null){o.far=p*4}if(e.camera==null){e.camera={}}if((s=e.camera).proxy==null){s.proxy=false}if((h=e.camera).position==null){h.position=[0,0,p]}if((l=e.camera).lookAt==null){l.lookAt=[0,0,0]}if((u=e.camera).up==null){u.up=[1,0,0]}m=(d=e.vertical)!=null?d:1.1;if((c=e.camera).fov==null){c.fov=Math.atan(m/p)*360/}if(e.focusDist==null){e.focusDist=p/1.5}t.__super__.constructor.call(this,e,i)}t.prototype.view=function(e){var t;if(e==null){e={}}if(this.urlParams.range!=null){t=this.urlParams.get("range","float");if(e.viewRange==null){e.viewRange=[[-t,t],[-t,t]]}}else{if(e.viewRange==null){e.viewRange=[[-10,10],[-10,10]]}}return new g(this.mathbox,e).view};t.prototype.draggable=function(e,t){if(t==null){t={}}if(t.is2D==null){t.is2D=true}return new o(e,t)};return t}(n);window.Color=r;for(H in C){w=C[H];document.body.style.setProperty("--palette-"+H,new r(w).str())}window.rowReduce=z;window.eigenvalues=_;window.Animation=e;window.Demo=n;window.Demo2D=a;window.urlParams=D;window.OrbitControls=p;window.groupControls=R}).call(this);!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.dat=t()}(this,function(){"use strict";function e(e,t){var i=e.__state.conversionName.toString(),r=Math.round(e.r),n=Math.round(e.g),a=Math.round(e.b),o=e.a,s=Math.round(e.h),h=e.s.toFixed(1),l=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===i||"SIX_CHAR_HEX"===i){for(var u=e.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===i?"rgb("+r+","+n+","+a+")":"CSS_RGBA"===i?"rgba("+r+","+n+","+a+","+o+")":"HEX"===i?"0x"+e.hex.toString(16):"RGB_ARRAY"===i?"["+r+","+n+","+a+"]":"RGBA_ARRAY"===i?"["+r+","+n+","+a+","+o+"]":"RGB_OBJ"===i?"{r:"+r+",g:"+n+",b:"+a+"}":"RGBA_OBJ"===i?"{r:"+r+",g:"+n+",b:"+a+",a:"+o+"}":"HSV_OBJ"===i?"{h:"+s+",s:"+h+",v:"+l+"}":"HSVA_OBJ"===i?"{h:"+s+",s:"+h+",v:"+l+",a:"+o+"}":"unknown format"}function t(e,t,i){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(U.recalculateRGB(this,t,i),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(U.recalculateRGB(this,t,i),this.__state.space="RGB"),this.__state[t]=e}})}function i(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(U.recalculateHSV(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(U.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}function r(e){if("0"===e||k.isUndefined(e))return 0;var t=e.match(j);return k.isNull(t)?0:parseFloat(t[1])}function n(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}function a(e,t){var i=Math.pow(10,t);return Math.round(e*i)/i}function o(e,t,i,r,n){return r+(e-t)/(i-t)*(n-r)}function s(e,t,i,r){e.style.background="",k.each($,function(n){e.style.cssText+="background: "+n+"linear-gradient("+t+", "+i+" 0%, "+r+" 100%); "})}function h(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}function l(e,t,i){var r=document.createElement("li");return t&&r.appendChild(t),i?e.__ul.insertBefore(r,i):e.__ul.appendChild(r),e.onResize(),r}function u(e){G.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&G.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function c(e,t){var i=e.__preset_select[e.__preset_select.selectedIndex];i.innerHTML=t?i.value+"*":i.value}function p(e,t,i){if(i.__li=t,i.__gui=e,k.extend(i,{options:function(t){if(arguments.length>1){var r=i.__li.nextElementSibling;return i.remove(),d(e,i.object,i.property,{before:r,factoryArgs:[k.toArray(arguments)]})}if(k.isArray(t)||k.isObject(t)){var n=i.__li.nextElementSibling;return i.remove(),d(e,i.object,i.property,{before:n,factoryArgs:[t]})}},name:function(e){return i.__li.firstElementChild.firstElementChild.innerHTML=e,i},listen:function(){return i.__gui.listen(i),i},remove:function(){return i.__gui.remove(i),i}}),i instanceof K){var r=new Z(i.object,i.property,{min:i.__min,max:i.__max,step:i.__step});k.each(["updateDisplay","onChange","onFinishChange","step"],function(e){var t=i[e],n=r[e];i[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);return n.apply(r,e),t.apply(i,e)}}),G.addClass(t,"has-slider"),i.domElement.insertBefore(r.domElement,i.domElement.firstElementChild)}else if(i instanceof Z){var n=function(t){if(k.isNumber(i.__min)&&k.isNumber(i.__max)){var r=i.__li.firstElementChild.firstElementChild.innerHTML,n=i.__gui.__listening.indexOf(i)>-1;i.remove();var a=d(e,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[i.__min,i.__max,i.__step]});return a.name(r),n&&a.listen(),a}return t};i.min=k.compose(n,i.min),i.max=k.compose(n,i.max)}else i instanceof W?(G.bind(t,"click",function(){G.fakeEvent(i.__checkbox,"click")}),G.bind(i.__checkbox,"click",function(e){e.stopPropagation()})):i instanceof Q?(G.bind(t,"click",function(){G.fakeEvent(i.__button,"click")}),G.bind(t,"mouseover",function(){G.addClass(i.__button,"hover")}),G.bind(t,"mouseout",function(){G.removeClass(i.__button,"hover")})):i instanceof J&&(G.addClass(t,"color"),i.updateDisplay=k.compose(function(e){return t.style.borderLeftColor=i.__color.toString(),e},i.updateDisplay),i.updateDisplay());i.setValue=k.compose(function(t){return e.getRoot().__preset_select&&i.isModified()&&c(e.getRoot(),!0),t},i.setValue)}function f(e,t){var i=e.getRoot(),r=i.__rememberedObjects.indexOf(t.object);if(-1!==r){var n=i.__rememberedObjectIndecesToControllers[r];if(void 0===n&&(n={},i.__rememberedObjectIndecesToControllers[r]=n),n[t.property]=t,i.load&&i.load.remembered){var a=i.load.remembered,o=void 0;if(a[e.preset])o=a[e.preset];else{if(!a[ae])return;o=a[ae]}if(o[r]&&void 0!==o[r][t.property]){var s=o[r][t.property];t.initialValue=s,t.setValue(s)}}}}function d(e,t,i,r){if(void 0===t[i])throw new Error('Object "'+t+'" has no property "'+i+'"');var n=void 0;if(r.color)n=new J(t,i);else{var a=[t,i].concat(r.factoryArgs);n=te.apply(e,a)}r.before instanceof N&&(r.before=r.before.__li),f(e,n),G.addClass(n.domElement,"c");var o=document.createElement("span");G.addClass(o,"property-name"),o.innerHTML=n.property;var s=document.createElement("div");s.appendChild(o),s.appendChild(n.domElement);var h=l(e,s,r.before);return G.addClass(h,pe.CLASS_CONTROLLER_ROW),n instanceof J?G.addClass(h,"color"):G.addClass(h,P(n.getValue())),p(e,h,n),e.__controllers.push(n),n}function m(e,t){return document.location.href+"."+t}function g(e,t,i){var r=document.createElement("option");r.innerHTML=t,r.value=t,e.__preset_select.appendChild(r),i&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function v(e,t){t.style.display=e.useLocalStorage?"block":"none"}function y(e){var t=e.__save_row=document.createElement("li");G.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),G.addClass(t,"save-row");var i=document.createElement("span");i.innerHTML="&nbsp;",G.addClass(i,"button gears");var r=document.createElement("span");r.innerHTML="Save",G.addClass(r,"button"),G.addClass(r,"save");var n=document.createElement("span");n.innerHTML="New",G.addClass(n,"button"),G.addClass(n,"save-as");var a=document.createElement("span");a.innerHTML="Revert",G.addClass(a,"button"),G.addClass(a,"revert");var o=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?k.each(e.load.remembered,function(t,i){g(e,i,i===e.preset)}):g(e,ae,!1),G.bind(o,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(o),t.appendChild(i),t.appendChild(r),t.appendChild(n),t.appendChild(a),oe){var s=document.getElementById("dg-local-explain"),h=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(m(e,"isLocal"))&&h.setAttribute("checked","checked"),v(e,s),G.bind(h,"change",function(){e.useLocalStorage=!e.useLocalStorage,v(e,s)})}var l=document.getElementById("dg-new-constructor");G.bind(l,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||se.hide()}),G.bind(i,"click",function(){l.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),se.show(),l.focus(),l.select()}),G.bind(r,"click",function(){e.save()}),G.bind(n,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),G.bind(a,"click",function(){e.revert()})}function E(e){function t(t){return t.preventDefault(),e.width+=n-t.clientX,e.onResize(),n=t.clientX,!1}function i(){G.removeClass(e.__closeButton,pe.CLASS_DRAG),G.unbind(window,"mousemove",t),G.unbind(window,"mouseup",i)}function r(r){return r.preventDefault(),n=r.clientX,G.addClass(e.__closeButton,pe.CLASS_DRAG),G.bind(window,"mousemove",t),G.bind(window,"mouseup",i),!1}var n=void 0;e.__resize_handle=document.createElement("div"),k.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),G.bind(e.__resize_handle,"mousedown",r),G.bind(e.__closeButton,"mousedown",r),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function w(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function b(e,t){var i={};return k.each(e.__rememberedObjects,function(r,n){var a={},o=e.__rememberedObjectIndecesToControllers[n];k.each(o,function(e,i){a[i]=t?e.initialValue:e.getValue()}),i[n]=a}),i}function _(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}function x(e){0!==e.length&&ie.call(window,function(){x(e)}),k.each(e,function(e){e.updateDisplay()})}var T=Array.prototype.forEach,R=Array.prototype.slice,k={BREAK:{},extend:function(e){return this.each(R.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(i){this.isUndefined(t[i])||(e[i]=t[i])}.bind(this))},this),e},defaults:function(e){return this.each(R.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(i){this.isUndefined(e[i])&&(e[i]=t[i])}.bind(this))},this),e},compose:function(){var e=R.call(arguments);return function(){for(var t=R.call(arguments),i=e.length-1;i>=0;i--)t=[e[i].apply(this,t)];return t[0]}},each:function(e,t,i){if(e)if(T&&e.forEach&&e.forEach===T)e.forEach(t,i);else if(e.length===e.length+0){var r=void 0,n=void 0;for(r=0,n=e.length;r<n;r++)if(r in e&&t.call(i,e[r],r)===this.BREAK)return}else for(var a in e)if(t.call(i,e[a],a)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,i){var r=void 0;return function(){var n=this,a=arguments,o=i||!r;clearTimeout(r),r=setTimeout(function(){r=null,i||e.apply(n,a)},t),o&&e.apply(n,a)}},toArray:function(e){return e.toArray?e.toArray():R.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return isNaN(e)}),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},H=[{litmus:k.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:e},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:e},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:e},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:e}}},{litmus:k.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:k.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:k.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(k.isNumber(e.r)&&k.isNumber(e.g)&&k.isNumber(e.b)&&k.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(k.isNumber(e.r)&&k.isNumber(e.g)&&k.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(k.isNumber(e.h)&&k.isNumber(e.s)&&k.isNumber(e.v)&&k.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(k.isNumber(e.h)&&k.isNumber(e.s)&&k.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],M=void 0,S=void 0,A=function(){S=!1;var e=arguments.length>1?k.toArray(arguments):arguments[0];return k.each(H,function(t){if(t.litmus(e))return k.each(t.conversions,function(t,i){if(M=t.read(e),!1===S&&!1!==M)return S=M,M.conversionName=i,M.conversion=t,k.BREAK}),k.BREAK}),S},C=void 0,z={hsv_to_rgb:function(e,t,i){var r=Math.floor(e/60)%6,n=e/60-Math.floor(e/60),a=i*(1-t),o=i*(1-n*t),s=i*(1-(1-n)*t),h=[[i,s,a],[o,i,a],[a,i,s],[a,o,i],[s,a,i],[i,a,o]][r];return{r:255*h[0],g:255*h[1],b:255*h[2]}},rgb_to_hsv:function(e,t,i){var r=Math.min(e,t,i),n=Math.max(e,t,i),a=n-r,o=void 0,s=void 0;return 0===n?{h:NaN,s:0,v:0}:(s=a/n,o=e===n?(t-i)/a:t===n?2+(i-e)/a:4+(e-t)/a,(o/=6)<0&&(o+=1),{h:360*o,s:s,v:n/255})},rgb_to_hex:function(e,t,i){var r=this.hex_with_component(0,2,e);return r=this.hex_with_component(r,1,t),r=this.hex_with_component(r,0,i)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,i){return i<<(C=8*t)|e&~(255<<C)}},P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},O=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),D=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)},F=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},B=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},U=function(){function t(){if(L(this,t),this.__state=A.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return O(t,[{key:"toString",value:function(){return e(this)}},{key:"toHexString",value:function(){return e(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();U.recalculateRGB=function(e,t,i){if("HEX"===e.__state.space)e.__state[t]=z.component_from_hex(e.__state.hex,i);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");k.extend(e.__state,z.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},U.recalculateHSV=function(e){var t=z.rgb_to_hsv(e.r,e.g,e.b);k.extend(e.__state,{s:t.s,v:t.v}),k.isNaN(t.h)?k.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},U.COMPONENTS=["r","g","b","h","s","v","hex","a"],t(U.prototype,"r",2),t(U.prototype,"g",1),t(U.prototype,"b",0),i(U.prototype,"h"),i(U.prototype,"s"),i(U.prototype,"v"),Object.defineProperty(U.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(U.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=z.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var N=function(){function e(t,i){L(this,e),this.initialValue=t[i],this.domElement=document.createElement("div"),this.object=t,this.property=i,this.__onChange=void 0,this.__onFinishChange=void 0}return O(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),V={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},I={};k.each(V,function(e,t){k.each(e,function(e){I[e]=t})});var j=/(\d+(\.\d+)?)px/,G={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,i){var r=i,n=t;k.isUndefined(n)&&(n=!0),k.isUndefined(r)&&(r=!0),e.style.position="absolute",n&&(e.style.left=0,e.style.right=0),r&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,i,r){var n=i||{},a=I[t];if(!a)throw new Error("Event type "+t+" not supported.");var o=document.createEvent(a);switch(a){case"MouseEvents":var s=n.x||n.clientX||0,h=n.y||n.clientY||0;o.initMouseEvent(t,n.bubbles||!1,n.cancelable||!0,window,n.clickCount||1,0,0,s,h,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var l=o.initKeyboardEvent||o.initKeyEvent;k.defaults(n,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),l(t,n.bubbles||!1,n.cancelable,window,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.keyCode,n.charCode);break;default:o.initEvent(t,n.bubbles||!1,n.cancelable||!0)}k.defaults(o,r),e.dispatchEvent(o)},bind:function(e,t,i,r){var n=r||!1;return e.addEventListener?e.addEventListener(t,i,n):e.attachEvent&&e.attachEvent("on"+t,i),G},unbind:function(e,t,i,r){var n=r||!1;return e.removeEventListener?e.removeEventListener(t,i,n):e.detachEvent&&e.detachEvent("on"+t,i),G},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var i=e.className.split(/ +/);-1===i.indexOf(t)&&(i.push(t),e.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return G},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var i=e.className.split(/ +/),r=i.indexOf(t);-1!==r&&(i.splice(r,1),e.className=i.join(" "))}else e.className=void 0;return G},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return r(t["border-left-width"])+r(t["border-right-width"])+r(t["padding-left"])+r(t["padding-right"])+r(t.width)},getHeight:function(e){var t=getComputedStyle(e);return r(t["border-top-width"])+r(t["border-bottom-width"])+r(t["padding-top"])+r(t["padding-bottom"])+r(t.height)},getOffset:function(e){var t=e,i={left:0,top:0};if(t.offsetParent)do{i.left+=t.offsetLeft,i.top+=t.offsetTop,t=t.offsetParent}while(t);return i},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},W=function(e){function t(e,i){L(this,t);var r=B(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),n=r;return r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox"),G.bind(r.__checkbox,"change",function(){n.setValue(!n.__prev)},!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return F(t,N),O(t,[{key:"setValue",value:function(e){var i=D(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),i}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),D(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),q=function(e){function t(e,i,r){L(this,t);var n=B(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),a=r,o=n;if(n.__select=document.createElement("select"),k.isArray(a)){var s={};k.each(a,function(e){s[e]=e}),a=s}return k.each(a,function(e,t){var i=document.createElement("option");i.innerHTML=t,i.setAttribute("value",e),o.__select.appendChild(i)}),n.updateDisplay(),G.bind(n.__select,"change",function(){var e=this.options[this.selectedIndex].value;o.setValue(e)}),n.domElement.appendChild(n.__select),n}return F(t,N),O(t,[{key:"setValue",value:function(e){var i=D(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),i}},{key:"updateDisplay",value:function(){return G.isActive(this.__select)?this:(this.__select.value=this.getValue(),D(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(),X=function(e){function t(e,i){function r(){a.setValue(a.__input.value)}L(this,t);var n=B(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),a=n;return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),G.bind(n.__input,"keyup",r),G.bind(n.__input,"change",r),G.bind(n.__input,"blur",function(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}),G.bind(n.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return F(t,N),O(t,[{key:"updateDisplay",value:function(){return G.isActive(this.__input)||(this.__input.value=this.getValue()),D(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),Y=function(e){function t(e,i,r){L(this,t);var a=B(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),o=r||{};return a.__min=o.min,a.__max=o.max,a.__step=o.step,k.isUndefined(a.__step)?0===a.initialValue?a.__impliedStep=1:a.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(a.initialValue))/Math.LN10))/10:a.__impliedStep=a.__step,a.__precision=n(a.__impliedStep),a}return F(t,N),O(t,[{key:"setValue",value:function(e){var i=e;return void 0!==this.__min&&i<this.__min?i=this.__min:void 0!==this.__max&&i>this.__max&&(i=this.__max),void 0!==this.__step&&i%this.__step!=0&&(i=Math.round(i/this.__step)*this.__step),D(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,i)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=n(e),this}}]),t}(),Z=function(e){function t(e,i,r){function n(){h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())}function a(e){var t=l-e.clientY;h.setValue(h.getValue()+t*h.__impliedStep),l=e.clientY}function o(){G.unbind(window,"mousemove",a),G.unbind(window,"mouseup",o),n()}L(this,t);var s=B(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,r));s.__truncationSuspended=!1;var h=s,l=void 0;return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),G.bind(s.__input,"change",function(){var e=parseFloat(h.__input.value);k.isNaN(e)||h.setValue(e)}),G.bind(s.__input,"blur",function(){n()}),G.bind(s.__input,"mousedown",function(e){G.bind(window,"mousemove",a),G.bind(window,"mouseup",o),l=e.clientY}),G.bind(s.__input,"keydown",function(e){13===e.keyCode&&(h.__truncationSuspended=!0,this.blur(),h.__truncationSuspended=!1,n())}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return F(t,Y),O(t,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():a(this.getValue(),this.__precision),D(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),K=function(e){function t(e,i,r,n,a){function s(e){e.preventDefault();var t=p.__background.getBoundingClientRect();return p.setValue(o(e.clientX,t.left,t.right,p.__min,p.__max)),!1}function h(){G.unbind(window,"mousemove",s),G.unbind(window,"mouseup",h),p.__onFinishChange&&p.__onFinishChange.call(p,p.getValue())}function l(e){var t=e.touches[0].clientX,i=p.__background.getBoundingClientRect();p.setValue(o(t,i.left,i.right,p.__min,p.__max))}function u(){G.unbind(window,"touchmove",l),G.unbind(window,"touchend",u),p.__onFinishChange&&p.__onFinishChange.call(p,p.getValue())}L(this,t);var c=B(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,{min:r,max:n,step:a})),p=c;return c.__background=document.createElement("div"),c.__foreground=document.createElement("div"),G.bind(c.__background,"mousedown",function(e){document.activeElement.blur(),G.bind(window,"mousemove",s),G.bind(window,"mouseup",h),s(e)}),G.bind(c.__background,"touchstart",function(e){1===e.touches.length&&(G.bind(window,"touchmove",l),G.bind(window,"touchend",u),l(e))}),G.addClass(c.__background,"slider"),G.addClass(c.__foreground,"slider-fg"),c.updateDisplay(),c.__background.appendChild(c.__foreground),c.domElement.appendChild(c.__background),c}return F(t,Y),O(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",D(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),Q=function(e){function t(e,i,r){L(this,t);var n=B(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),a=n;return n.__button=document.createElement("div"),n.__button.innerHTML=void 0===r?"Fire":r,G.bind(n.__button,"click",function(e){return e.preventDefault(),a.fire(),!1}),G.addClass(n.__button,"button"),n.domElement.appendChild(n.__button),n}return F(t,N),O(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(),J=function(e){function t(e,i){function r(e){c(e),G.bind(window,"mousemove",c),G.bind(window,"touchmove",c),G.bind(window,"mouseup",a),G.bind(window,"touchend",a)}function n(e){p(e),G.bind(window,"mousemove",p),G.bind(window,"touchmove",p),G.bind(window,"mouseup",o),G.bind(window,"touchend",o)}function a(){G.unbind(window,"mousemove",c),G.unbind(window,"touchmove",c),G.unbind(window,"mouseup",a),G.unbind(window,"touchend",a),u()}function o(){G.unbind(window,"mousemove",p),G.unbind(window,"touchmove",p),G.unbind(window,"mouseup",o),G.unbind(window,"touchend",o),u()}function l(){var e=A(this.value);!1!==e?(d.__color.__state=e,d.setValue(d.__color.toOriginal())):this.value=d.__color.toString()}function u(){d.__onFinishChange&&d.__onFinishChange.call(d,d.__color.toOriginal())}function c(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=d.__saturation_field.getBoundingClientRect(),i=e.touches&&e.touches[0]||e,r=i.clientX,n=i.clientY,a=(r-t.left)/(t.right-t.left),o=1-(n-t.top)/(t.bottom-t.top);return o>1?o=1:o<0&&(o=0),a>1?a=1:a<0&&(a=0),d.__color.v=o,d.__color.s=a,d.setValue(d.__color.toOriginal()),!1}function p(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=d.__hue_field.getBoundingClientRect(),i=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return i>1?i=1:i<0&&(i=0),d.__color.h=360*i,d.setValue(d.__color.toOriginal()),!1}L(this,t);var f=B(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));f.__color=new U(f.getValue()),f.__temp=new U(0);var d=f;f.domElement=document.createElement("div"),G.makeSelectable(f.domElement,!1),f.__selector=document.createElement("div"),f.__selector.className="selector",f.__saturation_field=document.createElement("div"),f.__saturation_field.className="saturation-field",f.__field_knob=document.createElement("div"),f.__field_knob.className="field-knob",f.__field_knob_border="2px solid ",f.__hue_knob=document.createElement("div"),f.__hue_knob.className="hue-knob",f.__hue_field=document.createElement("div"),f.__hue_field.className="hue-field",f.__input=document.createElement("input"),f.__input.type="text",f.__input_textShadow="0 1px 1px ",G.bind(f.__input,"keydown",function(e){13===e.keyCode&&l.call(this)}),G.bind(f.__input,"blur",l),G.bind(f.__selector,"mousedown",function(){G.addClass(this,"drag").bind(window,"mouseup",function(){G.removeClass(d.__selector,"drag")})}),G.bind(f.__selector,"touchstart",function(){G.addClass(this,"drag").bind(window,"touchend",function(){G.removeClass(d.__selector,"drag")})});var m=document.createElement("div");return k.extend(f.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),k.extend(f.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:f.__field_knob_border+(f.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),k.extend(f.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),k.extend(f.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),k.extend(m.style,{width:"100%",height:"100%",background:"none"}),s(m,"top","rgba(0,0,0,0)","#000"),k.extend(f.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),h(f.__hue_field),k.extend(f.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:f.__input_textShadow+"rgba(0,0,0,0.7)"}),G.bind(f.__saturation_field,"mousedown",r),G.bind(f.__saturation_field,"touchstart",r),G.bind(f.__field_knob,"mousedown",r),G.bind(f.__field_knob,"touchstart",r),G.bind(f.__hue_field,"mousedown",n),G.bind(f.__hue_field,"touchstart",n),f.__saturation_field.appendChild(m),f.__selector.appendChild(f.__field_knob),f.__selector.appendChild(f.__saturation_field),f.__selector.appendChild(f.__hue_field),f.__hue_field.appendChild(f.__hue_knob),f.domElement.appendChild(f.__input),f.domElement.appendChild(f.__selector),f.updateDisplay(),f}return F(t,N),O(t,[{key:"updateDisplay",value:function(){var e=A(this.getValue());if(!1!==e){var t=!1;k.each(U.COMPONENTS,function(i){if(!k.isUndefined(e[i])&&!k.isUndefined(this.__color.__state[i])&&e[i]!==this.__color.__state[i])return t=!0,{}},this),t&&k.extend(this.__color.__state,e)}k.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var i=this.__color.v<.5||this.__color.s>.5?255:0,r=255-i;k.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+i+","+i+","+i+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,s(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),k.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+i+","+i+","+i+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),t}(),$=["-moz-","-o-","-webkit-","-ms-",""],ee={load:function(e,t){var i=t||document,r=i.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=e,i.getElementsByTagName("head")[0].appendChild(r)},inject:function(e,t){var i=t||document,r=document.createElement("style");r.type="text/css",r.innerHTML=e;var n=i.getElementsByTagName("head")[0];try{n.appendChild(r)}catch(e){}}},te=function(e,t){var i=e[t];return k.isArray(arguments[2])||k.isObject(arguments[2])?new q(e,t,arguments[2]):k.isNumber(i)?k.isNumber(arguments[2])&&k.isNumber(arguments[3])?k.isNumber(arguments[4])?new K(e,t,arguments[2],arguments[3],arguments[4]):new K(e,t,arguments[2],arguments[3]):k.isNumber(arguments[4])?new Z(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new Z(e,t,{min:arguments[2],max:arguments[3]}):k.isString(i)?new X(e,t):k.isFunction(i)?new Q(e,t,""):k.isBoolean(i)?new W(e,t):null},ie=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},re=function(){function e(){L(this,e),this.backgroundElement=document.createElement("div"),k.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),G.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),k.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;G.bind(this.backgroundElement,"click",function(){t.hide()})}return O(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),k.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",G.unbind(e.domElement,"webkitTransitionEnd",t),G.unbind(e.domElement,"transitionend",t),G.unbind(e.domElement,"oTransitionEnd",t)};G.bind(this.domElement,"webkitTransitionEnd",t),G.bind(this.domElement,"transitionend",t),G.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-G.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-G.getHeight(this.domElement)/2+"px"}}]),e}(),ne=function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid transparent}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");ee.inject(ne);var ae="Default",oe=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}(),se=void 0,he=!0,le=void 0,ue=!1,ce=[],pe=function e(t){var i=this,r=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),G.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=k.defaults(r,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),r=k.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),k.isUndefined(r.load)?r.load={preset:ae}:r.preset&&(r.load.preset=r.preset),k.isUndefined(r.parent)&&r.hideable&&ce.push(this),r.resizable=k.isUndefined(r.parent)&&r.resizable,r.autoPlace&&k.isUndefined(r.scrollable)&&(r.scrollable=!0);var n=oe&&"true"===localStorage.getItem(m(this,"isLocal")),a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return i.parent?i.getRoot().preset:r.load.preset},set:function(e){i.parent?i.getRoot().preset=e:r.load.preset=e,_(this),i.revert()}},width:{get:function(){return r.width},set:function(e){r.width=e,w(i,e)}},name:{get:function(){return r.name},set:function(e){r.name=e,titleRowName&&(titleRowName.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(t){r.closed=t,r.closed?G.addClass(i.__ul,e.CLASS_CLOSED):G.removeClass(i.__ul,e.CLASS_CLOSED),this.onResize(),i.__closeButton&&(i.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return n},set:function(e){oe&&(n=e,e?G.bind(window,"unload",a):G.unbind(window,"unload",a),localStorage.setItem(m(i,"isLocal"),e))}}}),k.isUndefined(r.parent)){if(r.closed=!1,G.addClass(this.domElement,e.CLASS_MAIN),G.makeSelectable(this.domElement,!1),oe&&n){i.useLocalStorage=!0;var o=localStorage.getItem(m(this,"gui"));o&&(r.load=JSON.parse(o))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,G.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),r.closeOnTop?(G.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(G.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),G.bind(this.__closeButton,"click",function(){i.closed=!i.closed})}else{void 0===r.closed&&(r.closed=!0);var s=document.createTextNode(r.name);G.addClass(s,"controller-name");var h=l(i,s);G.addClass(this.__ul,e.CLASS_CLOSED),G.addClass(h,"title"),G.bind(h,"click",function(e){return e.preventDefault(),i.closed=!i.closed,!1}),r.closed||(this.closed=!1)}r.autoPlace&&(k.isUndefined(r.parent)&&(he&&(le=document.createElement("div"),G.addClass(le,"dg"),G.addClass(le,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(le),he=!1),le.appendChild(this.domElement),G.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||w(i,r.width)),this.__resizeHandler=function(){i.onResizeDebounced()},G.bind(window,"resize",this.__resizeHandler),G.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),G.bind(this.__ul,"transitionend",this.__resizeHandler),G.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&E(this),a=function(){oe&&"true"===localStorage.getItem(m(i,"isLocal"))&&localStorage.setItem(m(i,"gui"),JSON.stringify(i.getSaveObject()))},this.saveToLocalStorageIfPossible=a,r.parent||function(){var e=i.getRoot();e.width+=1,k.defer(function(){e.width-=1})}()};return pe.toggleHide=function(){ue=!ue,k.each(ce,function(e){e.domElement.style.display=ue?"none":""})},pe.CLASS_AUTO_PLACE="a",pe.CLASS_AUTO_PLACE_CONTAINER="ac",pe.CLASS_MAIN="main",pe.CLASS_CONTROLLER_ROW="cr",pe.CLASS_TOO_TALL="taller-than-window",pe.CLASS_CLOSED="closed",pe.CLASS_CLOSE_BUTTON="close-button",pe.CLASS_CLOSE_TOP="close-top",pe.CLASS_CLOSE_BOTTOM="close-bottom",pe.CLASS_DRAG="drag",pe.DEFAULT_WIDTH=245,pe.TEXT_CLOSED="Close Controls",pe.TEXT_OPEN="Open Controls",pe._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||pe.toggleHide()},G.bind(window,"keydown",pe._keydownHandler,!1),k.extend(pe.prototype,{add:function(e,t){return d(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return d(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;k.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&le.removeChild(this.domElement);var e=this;k.each(this.__folders,function(t){e.removeFolder(t)}),G.unbind(window,"keydown",pe._keydownHandler,!1),u(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var i=new pe(t);this.__folders[e]=i;var r=l(this,i.domElement);return G.addClass(r,"folder"),i},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],u(e);var t=this;k.each(e.__folders,function(t){e.removeFolder(t)}),k.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=G.getOffset(e.__ul).top,i=0;k.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(i+=G.getHeight(t))}),window.innerHeight-t-20<i?(G.addClass(e.domElement,pe.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(G.removeClass(e.domElement,pe.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&k.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:k.debounce(function(){this.onResize()},50),remember:function(){if(k.isUndefined(se)&&((se=new re).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;k.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&y(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&w(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=b(this)),e.folders={},k.each(this.__folders,function(t,i){e.folders[i]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=b(this),c(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[ae]=b(this,!0)),this.load.remembered[e]=b(this),this.preset=e,g(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){k.each(this.__controllers,function(t){this.getRoot().load.remembered?f(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),k.each(this.__folders,function(e){e.revert(e)}),e||c(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&x(this.__listening)},updateDisplay:function(){k.each(this.__controllers,function(e){e.updateDisplay()}),k.each(this.__folders,function(e){e.updateDisplay()})}}),{color:{Color:U,math:z,interpret:A},controllers:{Controller:N,BooleanController:W,OptionController:q,StringController:X,NumberController:Y,NumberControllerBox:Z,NumberControllerSlider:K,FunctionController:Q,ColorController:J},dom:{dom:G},gui:{GUI:pe},GUI:pe}});!function(){"use strict";var e="undefined"!=typeof window&&void 0!==window.document?window.document:{},t="undefined"!=typeof module&&module.exports,i="undefined"!=typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,r=function(){for(var t,i=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,n=i.length,a={};r<n;r++)if((t=i[r])&&t[1]in e){for(r=0;r<t.length;r++)a[i[0][r]]=t[r];return a}return!1}(),n={change:r.fullscreenchange,error:r.fullscreenerror},a={request:function(t){var n=r.requestFullscreen;t=t||e.documentElement,/5\.1[.\d]* Safari/.test(navigator.userAgent)?t[n]():t[n](i&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){e[r.exitFullscreen]()},toggle:function(e){this.isFullscreen?this.exit():this.request(e)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(t,i){var r=n[t];r&&e.addEventListener(r,i,!1)},off:function(t,i){var r=n[t];r&&e.removeEventListener(r,i,!1)},raw:r};if(!r)return void(t?module.exports=!1:window.screenfull=!1);Object.defineProperties(a,{isFullscreen:{get:function(){return Boolean(e[r.fullscreenElement])}},element:{enumerable:!0,get:function(){return e[r.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return Boolean(e[r.fullscreenEnabled])}}}),t?module.exports=a:window.screenfull=a}();"use strict";(function(){var e=function(e){var t=Math.pow(Math.abs(e),1/3);return e<0?-t:t};var t=function(t,i,r,n){if(n===undefined){if(r===undefined){if(i===undefined)return[];return[[-i/t,1]]}var a=i*i-4*t*r;if(Math.abs(a)<1e-8)return[[-i/(2*t),2]];else if(a>0)return[[(-i+Math.sqrt(a))/(2*t),1],[(-i-Math.sqrt(a))/(2*t),1]];return[]}var o=(3*t*r-i*i)/(3*t*t);var s=(2*i*i*i-9*t*i*r+27*t*t*n)/(27*t*t*t);var h;if(Math.abs(o)<1e-8){if(Math.abs(s)<1e-8){h=[[0,3]]}else{h=[[e(-s),1]]}}else if(Math.abs(s)<1e-8){h=[[0,1]].concat(o<0?[[Math.sqrt(-o),1],[-Math.sqrt(-o),1]]:[])}else{var a=s*s/4+o*o*o/27;if(Math.abs(a)<1e-8){h=[[-1.5*s/o,2],[3*s/o,1]]}else if(a>0){var l=e(-s/2-Math.sqrt(a));h=[[l-o/(3*l),1]]}else{var l=2*Math.sqrt(-o/3);var u=Math.acos(3*s/o/l)/3;var c=2*Math.PI/3;h=[[l*Math.cos(u),1],[l*Math.cos(u-c),1],[l*Math.cos(u-2*c),1]]}}for(var p=0;p<h.length;p++)h[p][0]-=i/(3*t);return h};window.findRoots=t})();!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.exprEval=t()}(this,function(){"use strict";function e(e,t){for(var i=0;i<e.length;i++)if(e[i]===t)return i;return-1}function t(e,t){this.type=e,this.value=void 0!==t&&null!==t?t:0}function i(e,t){this.tokens=e,this.parser=t,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.functions=t.functions}function r(e){return"string"==typeof e?JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):e}function n(e,i,r,a,o){for(var s,h,l,u,c=[],p=[],f=0,d=e.length;f<d;f++){var m=e[f],g=m.type;if(g===X)c.push(m);else if(g===Q&&o.hasOwnProperty(m.value))m=new t(X,o[m.value]),c.push(m);else if(g===Z&&c.length>1)h=c.pop(),s=c.pop(),u=r[m.value],m=new t(X,u(s.value,h.value)),c.push(m);else if(g===K&&c.length>2)l=c.pop(),h=c.pop(),s=c.pop(),"?"===m.value?c.push(s.value?h.value:l.value):(u=a[m.value],m=new t(X,u(s.value,h.value,l.value)),c.push(m));else if(g===Y&&c.length>0)s=c.pop(),u=i[m.value],m=new t(X,u(s.value)),c.push(m);else if(g===$){for(;c.length>0;)p.push(c.shift());p.push(new t($,n(m.value,i,r,a,o)))}else if(g===ee&&c.length>0)s=c.pop(),c.push(new t(X,s.value[m.value]));else{for(;c.length>0;)p.push(c.shift());p.push(m)}}for(;c.length>0;)p.push(c.shift());return p}function a(e,i,r){for(var n=[],o=0,s=e.length;o<s;o++){var h=e[o],l=h.type;if(l===Q&&h.value===i)for(var u=0;u<r.tokens.length;u++){var c,p=r.tokens[u];c=p.type===Y?I(p.value):p.type===Z?j(p.value):p.type===K?G(p.value):new t(p.type,p.value),n.push(c)}else l===$?n.push(new t($,a(h.value,i,r))):n.push(h)}return n}function o(e,t,i){for(var r,n,a,s,h=[],l=0,u=e.length;l<u;l++){var c=e[l],p=c.type;if(p===X)h.push(c.value);else if(p===Z)n=h.pop(),r=h.pop(),s=t.binaryOps[c.value],h.push(s(r,n));else if(p===K)a=h.pop(),n=h.pop(),r=h.pop(),"?"===c.value?h.push(o(r?n:a,t,i)):(s=t.ternaryOps[c.value],h.push(s(r,n,a)));else if(p===Q)if(c.value in t.functions)h.push(t.functions[c.value]);else{var f=i[c.value];if(void 0===f)throw new Error("undefined variable: "+c.value);h.push(f)}else if(p===Y)r=h.pop(),s=t.unaryOps[c.value],h.push(s(r));else if(p===J){for(var d=c.value,m=[];d-- >0;)m.unshift(h.pop());if(!(s=h.pop()).apply||!s.call)throw new Error(s+" is not a function");h.push(s.apply(void 0,m))}else if(p===$)h.push(c.value);else{if(p!==ee)throw new Error("invalid Expression");r=h.pop(),h.push(r[c.value])}}if(h.length>1)throw new Error("invalid Expression (parity)");return h[0]}function s(e,t){for(var i,n,a,o,h=[],l=0,u=e.length;l<u;l++){var c=e[l],p=c.type;if(p===X)"number"==typeof c.value&&c.value<0?h.push("("+c.value+")"):h.push(r(c.value));else if(p===Z)n=h.pop(),i=h.pop(),o=c.value,t?"^"===o?h.push("Math.pow("+i+", "+n+")"):"and"===o?h.push("(!!"+i+" && !!"+n+")"):"or"===o?h.push("(!!"+i+" || !!"+n+")"):"||"===o?h.push("(String("+i+") + String("+n+"))"):"=="===o?h.push("("+i+" === "+n+")"):"!="===o?h.push("("+i+" !== "+n+")"):h.push("("+i+" "+o+" "+n+")"):h.push("("+i+" "+o+" "+n+")");else if(p===K){if(a=h.pop(),n=h.pop(),i=h.pop(),"?"!==(o=c.value))throw new Error("invalid Expression");h.push("("+i+" ? "+n+" : "+a+")")}else if(p===Q)h.push(c.value);else if(p===Y)i=h.pop(),"-"===(o=c.value)||"+"===o?h.push("("+o+i+")"):t?"not"===o?h.push("(!"+i+")"):"!"===o?h.push("fac("+i+")"):h.push(o+"("+i+")"):"!"===o?h.push("("+i+"!)"):h.push("("+o+" "+i+")");else if(p===J){for(var f=c.value,d=[];f-- >0;)d.unshift(h.pop());o=h.pop(),h.push(o+"("+d.join(", ")+")")}else if(p===ee)i=h.pop(),h.push(i+"."+c.value);else{if(p!==$)throw new Error("invalid Expression");h.push("("+s(c.value,t)+")")}}if(h.length>1)throw new Error("invalid Expression (parity)");return h[0]}function h(t,i){for(var r=0,n=t.length;r<n;r++){var a=t[r];a.type===Q&&-1===e(i,a.value)?i.push(a.value):a.type===$&&h(a.value,i)}}function l(e,t){return Number(e)+Number(t)}function u(e,t){return e-t}function c(e,t){return e*t}function p(e,t){return e/t}function f(e,t){return e%t}function d(e,t){return""+e+t}function m(e,t){return e===t}function g(e,t){return e!==t}function v(e,t){return e>t}function y(e,t){return e<t}function E(e,t){return e>=t}function w(e,t){return e<=t}function b(e,t){return Boolean(e&&t)}function _(e,t){return Boolean(e||t)}function x(e){return(Math.exp(e)-Math.exp(-e))/2}function T(e){return(Math.exp(e)+Math.exp(-e))/2}function R(e){return e===1/0?1:e===-1/0?-1:(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))}function k(e){return e===-1/0?e:Math.log(e+Math.sqrt(e*e+1))}function H(e){return Math.log(e+Math.sqrt(e*e-1))}function M(e){return Math.log((1+e)/(1-e))/2}function S(e){return Math.log(e)*Math.LOG10E}function A(e){return-e}function C(e){return!e}function z(e){return e<0?Math.ceil(e):Math.floor(e)}function P(e){return Math.random()*(e||1)}function L(e){return U(e+1)}function O(e){return String(e).length}function D(){for(var e=0,t=0,i=0,r=arguments.length;i<r;i++){var n,a=Math.abs(arguments[i]);t<a?(e=e*(n=t/a)*n+1,t=a):e+=a>0?(n=a/t)*n:a}return t===1/0?1/0:t*Math.sqrt(e)}function F(e,t,i){return e?t:i}function B(e){return isFinite(e)&&e===Math.round(e)}function U(e){var t,i;if(B(e)){if(e<=0)return isFinite(e)?1/0:NaN;if(e>171)return 1/0;for(var r=e-2,n=e-1;r>1;)n*=r,r--;return 0===n&&(n=1),n}if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*U(1-e));if(e>=171.35)return 1/0;if(e>85){var a=e*e,o=a*e,s=o*e,h=s*e;return Math.sqrt(2*Math.PI/e)*Math.pow(e/Math.E,e)*(1+1/(12*e)+1/(288*a)-139/(51840*o)-571/(2488320*s)+163879/(209018880*h)+5246819/(75246796800*h*e))}--e,i=ie[0];for(var l=1;l<ie.length;++l)i+=ie[l]/(e+l);return t=e+te+.5,Math.sqrt(2*Math.PI)*Math.pow(t,e+.5)*Math.exp(-t)*i}function N(e,t,i,r){this.type=e,this.value=t,this.line=i,this.column=r}function V(e,t,i,r,n){this.pos=0,this.line=0,this.column=0,this.current=null,this.unaryOps=t,this.binaryOps=i,this.ternaryOps=r,this.consts=n,this.expression=e,this.savedPosition=0,this.savedCurrent=null,this.savedLine=0,this.savedColumn=0}function I(e){return new t(Y,e)}function j(e){return new t(Z,e)}function G(e){return new t(K,e)}function W(e,t){this.parser=e,this.tokens=t,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null}function q(){this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||x,cosh:Math.cosh||T,tanh:Math.tanh||R,asinh:Math.asinh||k,acosh:Math.acosh||H,atanh:Math.atanh||M,sqrt:Math.sqrt,log:Math.log,ln:Math.log,lg:Math.log10||S,log10:Math.log10||S,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||z,"-":A,"+":Number,exp:Math.exp,not:C,length:O,"!":L},this.binaryOps={"+":l,"-":u,"*":c,"/":p,"%":f,"^":Math.pow,"||":d,"==":m,"!=":g,">":v,"<":y,">=":E,"<=":w,and:b,or:_},this.ternaryOps={"?":F},this.functions={random:P,fac:L,min:Math.min,max:Math.max,hypot:Math.hypot||D,pyt:Math.hypot||D,pow:Math.pow,atan2:Math.atan2,if:F,gamma:U},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}var X="INUMBER",Y="IOP1",Z="IOP2",K="IOP3",Q="IVAR",J="IFUNCALL",$="IEXPR",ee="IMEMBER";t.prototype.toString=function(){switch(this.type){case X:case Y:case Z:case K:case Q:return this.value;case J:return"CALL "+this.value;case ee:return"."+this.value;default:return"Invalid Instruction"}},i.prototype.simplify=function(e){return e=e||{},new i(n(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,e),this.parser)},i.prototype.substitute=function(e,t){return t instanceof i||(t=this.parser.parse(String(t))),new i(a(this.tokens,e,t),this.parser)},i.prototype.evaluate=function(e){return e=e||{},o(this.tokens,this,e)},i.prototype.toString=function(){return s(this.tokens,!1)},i.prototype.symbols=function(){var e=[];return h(this.tokens,e),e},i.prototype.variables=function(){var e=[];h(this.tokens,e);var t=this.functions;return e.filter(function(e){return!(e in t)})},i.prototype.toJSFunction=function(e,t){var i=this,r=new Function(e,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+s(this.simplify(t).tokens,!0)+"; }");return function(){return r.apply(i,arguments)}};var te=4.7421875,ie=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22],re="TOP";N.prototype.toString=function(){return this.type+": "+this.value},V.prototype.newToken=function(e,t,i,r){return new N(e,t,null!=i?i:this.line,null!=r?r:this.column)},V.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current,this.savedLine=this.line,this.savedColumn=this.column},V.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent,this.line=this.savedLine,this.column=this.savedColumn},V.prototype.next=function(){return this.pos>=this.expression.length?this.newToken("TEOF","EOF"):this.isWhitespace()||this.isComment()?this.next():this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isComma()||this.isNamedOp()||this.isConst()||this.isName()?this.current:void this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},V.prototype.isString=function(){var e=!1,t=this.line,i=this.column,r=this.pos,n=this.expression.charAt(r);if("'"===n||'"'===n){this.pos++,this.column++;for(var a=this.expression.indexOf(n,r+1);a>=0&&this.pos<this.expression.length;){if(this.pos=a+1,"\\"!==this.expression.charAt(a-1)){var o=this.expression.substring(r+1,a);this.current=this.newToken("TSTRING",this.unescape(o),t,i);for(var s=o.indexOf("\n"),h=-1;s>=0;)this.line++,this.column=0,h=s,s=o.indexOf("\n",s+1);this.column+=o.length-h,e=!0;break}a=this.expression.indexOf(n,a+1)}}return e},V.prototype.isParen=function(){var e=this.expression.charAt(this.pos);return("("===e||")"===e)&&(this.current=this.newToken("TPAREN",e),this.pos++,this.column++,!0)},V.prototype.isComma=function(){return","===this.expression.charAt(this.pos)&&(this.current=this.newToken("TCOMMA",","),this.pos++,this.column++,!0)},V.prototype.isConst=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var i=this.expression.charAt(t);if(i.toUpperCase()===i.toLowerCase()&&(t===this.pos||"_"!==i&&"."!==i&&(i<"0"||i>"9")))break}if(t>e){var r=this.expression.substring(e,t);if(r in this.consts)return this.current=this.newToken("TNUMBER",this.consts[r]),this.pos+=r.length,this.column+=r.length,!0}return!1},V.prototype.isNamedOp=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var i=this.expression.charAt(t);if(i.toUpperCase()===i.toLowerCase()&&(t===this.pos||"_"!==i&&(i<"0"||i>"9")))break}if(t>e){var r=this.expression.substring(e,t);if(r in this.binaryOps||r in this.unaryOps||r in this.ternaryOps)return this.current=this.newToken(re,r),this.pos+=r.length,this.column+=r.length,!0}return!1},V.prototype.isName=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var i=this.expression.charAt(t);if(i.toUpperCase()===i.toLowerCase()&&(t===this.pos||"_"!==i&&(i<"0"||i>"9")))break}if(t>e){var r=this.expression.substring(e,t);return this.current=this.newToken("TNAME",r),this.pos+=r.length,this.column+=r.length,!0}return!1},V.prototype.isWhitespace=function(){for(var e=!1,t=this.expression.charAt(this.pos);!(" "!==t&&"\t"!==t&&"\n"!==t&&"\r"!==t||(e=!0,this.pos++,this.column++,"\n"===t&&(this.line++,this.column=0),this.pos>=this.expression.length));)t=this.expression.charAt(this.pos);return e};var ne=/^[0-9a-f]{4}$/i;return V.prototype.unescape=function(e){var t=e.indexOf("\\");if(t<0)return e;for(var i=e.substring(0,t);t>=0;){var r=e.charAt(++t);switch(r){case"'":i+="'";break;case'"':i+='"';break;case"\\":i+="\\";break;case"/":i+="/";break;case"b":i+="\b";break;case"f":i+="\f";break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"u":var n=e.substring(t+1,t+5);ne.test(n)||this.parseError("Illegal escape sequence: \\u"+n),i+=String.fromCharCode(parseInt(n,16)),t+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+r+'"')}++t;var a=e.indexOf("\\",t);i+=e.substring(t,a<0?e.length:a),t=a}return i},V.prototype.isComment=function(){if("/"===this.expression.charAt(this.pos)&&"*"===this.expression.charAt(this.pos+1)){var e=this.pos;this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length);for(var t=this.expression.substring(e,this.pos),i=t.indexOf("\n");i>=0;)this.line++,this.column=t.length-i,i=t.indexOf("\n",i+1);return!0}return!1},V.prototype.isNumber=function(){for(var e,t=!1,i=this.pos,r=i,n=i,a=this.column,o=a,s=!1,h=!1;i<this.expression.length&&((e=this.expression.charAt(i))>="0"&&e<="9"||!s&&"."===e);)"."===e?s=!0:h=!0,i++,a++,t=h;if(t&&(n=i,o=a),"e"===e||"E"===e){i++,a++;for(var l=!0,u=!1;i<this.expression.length;){if(e=this.expression.charAt(i),!l||"+"!==e&&"-"!==e){if(!(e>="0"&&e<="9"))break;u=!0,l=!1}else l=!1;i++,a++}u||(i=n,a=o)}return t?(this.current=this.newToken("TNUMBER",parseFloat(this.expression.substring(r,i))),this.pos=i,this.column=a):(this.pos=n,this.column=o),t},V.prototype.isOperator=function(){var e=this.expression.charAt(this.pos);if("+"===e||"-"===e||"*"===e||"/"===e||"%"===e||"^"===e||"?"===e||":"===e||"."===e)this.current=this.newToken(re,e);else if(""===e||""===e)this.current=this.newToken(re,"*");else if(">"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(re,">="),this.pos++,this.column++):this.current=this.newToken(re,">");else if("<"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(re,"<="),this.pos++,this.column++):this.current=this.newToken(re,"<");else if("|"===e){if("|"!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(re,"||"),this.pos++,this.column++}else if("="===e){if("="!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(re,"=="),this.pos++,this.column++}else{if("!"!==e)return!1;"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(re,"!="),this.pos++,this.column++):this.current=this.newToken(re,e)}return this.pos++,this.column++,!0},V.prototype.parseError=function(e){throw new Error("parse error ["+(this.line+1)+":"+(this.column+1)+"]: "+e)},W.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},W.prototype.tokenMatches=function(t,i){return void 0===i||(Array.isArray(i)?e(i,t.value)>=0:"function"==typeof i?i(t):t.value===i)},W.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},W.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},W.prototype.accept=function(e,t){return!(this.nextToken.type!==e||!this.tokenMatches(this.nextToken,t))&&(this.next(),!0)},W.prototype.expect=function(e,t){if(!this.accept(e,t))throw new Error("parse error ["+this.tokens.line+":"+this.tokens.column+"]: Expected "+(t||e))},W.prototype.parseAtom=function(e){if(this.accept("TNAME"))e.push(new t(Q,this.current.value));else if(this.accept("TNUMBER"))e.push(new t(X,this.current.value));else if(this.accept("TSTRING"))e.push(new t(X,this.current.value));else{if(!this.accept("TPAREN","("))throw new Error("unexpected "+this.nextToken);this.parseExpression(e),this.expect("TPAREN",")")}},W.prototype.parseExpression=function(e){this.parseConditionalExpression(e)},W.prototype.parseConditionalExpression=function(e){for(this.parseOrExpression(e);this.accept(re,"?");){var i=[],r=[];this.parseConditionalExpression(i),this.expect(re,":"),this.parseConditionalExpression(r),e.push(new t($,i)),e.push(new t($,r)),e.push(G("?"))}},W.prototype.parseOrExpression=function(e){for(this.parseAndExpression(e);this.accept(re,"or");)this.parseAndExpression(e),e.push(j("or"))},W.prototype.parseAndExpression=function(e){for(this.parseComparison(e);this.accept(re,"and");)this.parseComparison(e),e.push(j("and"))},W.prototype.parseComparison=function(e){for(this.parseAddSub(e);this.accept(re,["==","!=","<","<=",">=",">"]);){var t=this.current;this.parseAddSub(e),e.push(j(t.value))}},W.prototype.parseAddSub=function(e){for(this.parseTerm(e);this.accept(re,["+","-","||"]);){var t=this.current;this.parseTerm(e),e.push(j(t.value))}},W.prototype.parseTerm=function(e){for(this.parseFactor(e);this.accept(re,["*","/","%"]);){var t=this.current;this.parseFactor(e),e.push(j(t.value))}},W.prototype.parseFactor=function(e){function t(e){return e.value in i}var i=this.tokens.unaryOps;if(this.save(),this.accept(re,t))if("-"!==this.current.value&&"+"!==this.current.value&&"TPAREN"===this.nextToken.type&&"("===this.nextToken.value)this.restore(),this.parseExponential(e);else{var r=this.current;this.parseFactor(e),e.push(I(r.value))}else this.parseExponential(e)},W.prototype.parseExponential=function(e){for(this.parsePostfixExpression(e);this.accept(re,"^");)this.parseFactor(e),e.push(j("^"))},W.prototype.parsePostfixExpression=function(e){for(this.parseFunctionCall(e);this.accept(re,"!");)e.push(I("!"))},W.prototype.parseFunctionCall=function(e){function i(e){return e.value in r}var r=this.tokens.unaryOps;if(this.accept(re,i)){var n=this.current;this.parseAtom(e),e.push(I(n.value))}else for(this.parseMemberExpression(e);this.accept("TPAREN","(");)if(this.accept("TPAREN",")"))e.push(new t(J,0));else{var a=this.parseArgumentList(e);e.push(new t(J,a))}},W.prototype.parseArgumentList=function(e){for(var t=0;!this.accept("TPAREN",")");)for(this.parseExpression(e),++t;this.accept("TCOMMA");)this.parseExpression(e),++t;return t},W.prototype.parseMemberExpression=function(e){for(this.parseAtom(e);this.accept(re,".");)this.expect("TNAME"),e.push(new t(ee,this.current.value))},q.parse=function(e){return(new q).parse(e)},q.evaluate=function(e,t){return q.parse(e).evaluate(t)},q.prototype={parse:function(e){var t=[],r=new W(this,new V(e,this.unaryOps,this.binaryOps,this.ternaryOps,this.consts));return r.parseExpression(t),r.expect("TEOF","EOF"),new i(t,this)},evaluate:function(e,t){return this.parse(e).evaluate(t)}},{Parser:q,Expression:i}});
