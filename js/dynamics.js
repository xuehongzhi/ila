(function(){var t,e,s,i,n,r,o,h,a,l,u,c,p,f,d,m,v,y,w,x,M,g,S,T,Y,_,R,D,P,k,X,z,Z,L,b=function(t,e){return function(){return t.apply(e,arguments)}},I=function(t,e){for(var s in e){if(O.call(e,s))t[s]=e[s]}function i(){this.constructor=t}i.prototype=e.prototype;t.prototype=new i;t.__super__=e.prototype;return t},O={}.hasOwnProperty;Y="#define M_PI 3.1415926535897932384626433832795\n\nfloat easeInOutSine(float pos) {\n#ifdef FLOW\n    return pos;\n#else\n    return 0.5 * (1.0 - cos(M_PI * pos));\n#endif\n}";z=Y+"uniform float deltaAngle;\nuniform float scale;\nuniform float time;\nuniform float duration;\nuniform float scaleZ;\n\nvec4 getPointSample(vec4 xyzw);\n\nvec4 rotate(vec4 xyzw) {\n    vec4 point = getPointSample(xyzw);\n\n    float start = point.w;\n    float pos = (time - start) / abs(duration);\n    if(duration < 0.0) pos = 1.0 - pos;\n    if(pos < 0.0) return vec4(point.xyz, 0.0);\n    if(pos > 1.0) pos = 1.0;\n    pos = easeInOutSine(pos);\n    float c = cos(deltaAngle * pos);\n    float s = sin(deltaAngle * pos);\n    point.xy = vec2(point.x * c - point.y * s, point.x * s + point.y * c)\n        * pow(scale, pos);\n    if(scaleZ != 0.0) point.z *= pow(scaleZ, pos);\n    return vec4(point.xyz, 0.0);\n}";S=Y+"uniform float scaleX;\nuniform float scaleY;\nuniform float scaleZ;\nuniform float time;\nuniform float duration;\n\nvec4 getPointSample(vec4 xyzw);\n\nvec4 rotate(vec4 xyzw) {\n    vec4 point = getPointSample(xyzw);\n\n    float start = point.w;\n    float pos = (time - start) / abs(duration);\n    if(duration < 0.0) pos = 1.0 - pos;\n    if(pos < 0.0) return vec4(point.xyz, 0.0);\n    if(pos > 1.0) pos = 1.0;\n\n    pos = easeInOutSine(pos);\n    point.x *= pow(scaleX, pos);\n    point.y *= pow(scaleY, pos);\n    if(scaleZ != 0.0) point.z *= pow(scaleZ, pos);\n    return vec4(point.xyz, 0.0);\n}";Z=Y+"uniform float scale;\nuniform float translate;\nuniform float time;\nuniform float duration;\nuniform float scaleZ;\n\nvec4 getPointSample(vec4 xyzw);\n\nvec4 shear(vec4 xyzw) {\n    vec4 point = getPointSample(xyzw);\n\n    float start = point.w;\n    float pos = (time - start) / abs(duration);\n    if(duration < 0.0) pos = 1.0 - pos;\n    if(pos < 0.0) return vec4(point.xyz, 0.0);\n    if(pos > 1.0) pos = 1.0;\n\n    pos = easeInOutSine(pos);\n    float s = pow(scale, pos);\n    point.x  = s * (point.x + translate * pos * point.y);\n    point.y *= s;\n    if(scaleZ != 0.0) point.z *= pow(scaleZ, pos);\n    return vec4(point.xyz, 0.0);\n}";g=Y+"uniform float time;\nuniform float duration;\n\nvec4 getPointSample(vec4 xyzw);\nvec4 getColorSample(vec4 xyzw);\n\nvec3 hsv2rgb(vec3 c) {\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\n#ifdef FLOW\n#define TRANSITION 0.0\n#else\n#define TRANSITION 0.2\n#endif\n\nvec4 getColor(vec4 xyzw) {\n    vec4 color = getColorSample(xyzw);\n    vec4 point = getPointSample(xyzw);\n\n    float start = point.w;\n    float pos, ease;\n    pos = (time - start) / abs(duration);\n    if(duration < 0.0) pos = 1.0 - pos;\n    if(pos < 0.0) pos = 0.0;\n    else if(pos > 1.0) pos = 1.0;\n\n    if(pos < TRANSITION) {\n        ease = easeInOutSine(pos / TRANSITION);\n        color.w *= ease * 0.6 + 0.4;\n        color.y *= ease * 0.6 + 0.4;\n    }\n    else if(pos > 1.0 - TRANSITION) {\n        ease = easeInOutSine((1.0 - pos) / TRANSITION);\n        color.w *= ease * 0.6 + 0.4;\n        color.y *= ease * 0.6 + 0.4;\n    }\n    return vec4(hsv2rgb(color.xyz), color.w);\n}";L=Y+"uniform float time;\nuniform float small;\nuniform float duration;\n\nvec4 getPointSample(vec4 xyzw);\n\n#ifdef FLOW\n#define TRANSITION 0.0\n#else\n#define TRANSITION 0.2\n#endif\n#define BIG (small * 7.0 / 5.0)\n\nvec4 getSize(vec4 xyzw) {\n    vec4 point = getPointSample(xyzw);\n\n    float start = point.w;\n    float pos, ease, size = BIG;\n    pos = (time - start) / abs(duration);\n    if(duration < 0.0) pos = 1.0 - pos;\n    if(pos < 0.0) pos = 0.0;\n    else if(pos > 1.0) pos = 1.0;\n\n    if(pos < TRANSITION) {\n        ease = easeInOutSine(pos / TRANSITION);\n        size = small * (1.0-ease) + BIG * ease;\n    }\n    else if(pos > 1.0 - TRANSITION) {\n        ease = easeInOutSine((1.0 - pos) / TRANSITION);\n        size = small * (1.0-ease) + BIG * ease;\n    }\n    return vec4(size, 0.0, 0.0, 0.0);\n}";u=function(t,e,s){var i,n,r,o,h;n=Math.floor(t*6);i=t*6-n;r=s*(1-e);o=s*(1-i*e);h=s*(1-(1-i)*e);switch(n%6){case 0:return[s,h,r];case 1:return[o,s,r];case 2:return[r,s,h];case 3:return[r,o,s];case 4:return[h,r,s];case 5:return[s,r,o]}};_=function(t,e){return function(s){return Math.pow(e,s)*Math.pow(t,1-s)}};D=function(t,e){return function(s){return e*s+t*(1-s)}};P=function(t,e,s){return function(i){return Math.pow(i,s)*(e-t)+t}};T=function(t,e,s){return function(i){return Math.floor(Math.random()*(s+1))*(e-t)/s+t}};k=function(t){return t[Math.floor(Math.random()*t.length)]};X=function(){return k([-1,1])};R=function(t,e){var s,i,n;i=[];for(s in e){n=e[s];if(e.hasOwnProperty(s)){i.push(t[s]=n)}else{i.push(void 0)}}return i};l=function(){function t(t){this.randomizeCoords=b(this.randomizeCoords,this);this.loadDynamics=b(this.loadDynamics,this);this.updateView=b(this.updateView,this);this.setCoords=b(this.setCoords,this);var e,s,i,n,r,o,h,a,l;if(t==null){t={}}this.is3D=(n=t.is3D)!=null?n:false;this.axisColors=(r=(o=t.axisColors)!=null?o.slice():void 0)!=null?r:[];this.refColor=(h=t.refColor)!=null?h:"rgb(80, 120, 255)";this.timer=(a=t.timer)!=null?a:true;this.axisOpts={end:false,width:3,zBias:-1,depth:1,color:"black",range:[-10,10]};R(this.axisOpts,(l=t.axisOpts)!=null?l:{});if((e=this.axisColors)[0]==null){e[0]=[0,0,0,.3]}if((s=this.axisColors)[1]==null){s[1]=[0,0,0,.3]}if((i=this.axisColors)[2]==null){i[2]=[0,0,0,.3]}this.mathbox=null;this.view0=null;this.view=null;this.initialized=false;this.shaderElt=null;this.linesElt=null;this.linesDataElt=null}t.prototype.setCoords=function(t,e,s){var i,n,r,o;if(t[2]==null){t[2]=0}if(e[2]==null){e[2]=0}if(s==null){s=[0,0,1]}this.v1=t;this.v2=e;this.v3=s;this.coordMat=(new THREE.Matrix4).set(t[0],e[0],s[0],0,t[1],e[1],s[1],0,t[2],e[2],s[2],0,0,0,0,1);i=this.coordMatInv=(new THREE.Matrix4).getInverse(this.coordMat);n=[new THREE.Vector3(1,1,1),new THREE.Vector3(-1,1,1),new THREE.Vector3(1,-1,1),new THREE.Vector3(1,1,-1)].map(function(t){return t.applyMatrix4(i)});r=Math.max.apply(null,n.map(function(t){return t.length()}));this.extents={rad:r,x:Math.max.apply(null,n.map(function(t){return Math.abs(t.x)})),y:Math.max.apply(null,n.map(function(t){return Math.abs(t.y)})),z:Math.max.apply(null,n.map(function(t){return Math.abs(t.z)}))};return(o=this.controller)!=null?o.recomputeExtents():void 0};t.prototype.updateView=function(t,e){var s,i,n,r,o,h,a,l,u,c,p,f,d,m;if(this.mathbox==null){this.mathbox=t}if(this.view0==null){this.view0=e}if(this.view){this.view.set("matrix",this.coordMat)}else{this.view=this.view0.transform({matrix:this.coordMat});d=this.is3D?[1,2,3]:[1,2];for(o=0,h=d.length;o<h;o++){r=d[o];this.axisOpts.axis=r;this.axisOpts.color=this.axisColors[r-1];this.axisOpts.opacity=this.axisColors[r-1][3];this.view.axis(this.axisOpts)}}s=this.mathbox._context.canvas;n=this.controller.flow;u=this.controller.numPointsRow;a=this.controller.numPointsCol;l=this.controller.numPointsDep;if(this.initialized){c=this.current.shaderParams();if(n){c.code="#define FLOW\n"+c.code}this.shaderElt.set(c);return this.linesDataElt.set(this.current.linesParams())}else{p={id:"points-orig",channels:4,width:u,height:a,data:this.controller.points,live:false};if(this.is3D){p.depth=l;f=this.view.voxel}else{f=this.view.matrix}this.pointsElt=f(p);c=this.current.shaderParams();if(n){c.code="#define FLOW\n"+c.code}i=this.controller;if(this.timer){m=function(t){return i.curTime=t}}else{m=function(t){return i.curTime}}this.shaderElt=this.pointsElt.shader(c,{time:m,duration:function(t){return function(){return t.controller.duration*t.controller.direction}}(this)});this.shaderElt.resample({id:"points"});p={channels:4,width:u,height:a,data:this.controller.colors,live:false};if(this.is3D){p.depth=l;f=this.view.voxel}else{f=this.view.matrix}f(p).shader({code:(n?"#define FLOW\n":"")+g,sources:[this.pointsElt]},{time:function(){return i.curTime},duration:function(t){return function(){return t.controller.duration*t.controller.direction}}(this)}).resample({id:"colors"});this.view0.shader({code:(n?"#define FLOW\n":"")+L},{time:function(){return i.curTime},small:function(){return 5/739*s.clientWidth},duration:function(t){return function(){return t.controller.duration*t.controller.direction}}(this)}).resample({source:this.pointsElt,id:"sizes"});this.view.point({points:"#points",color:"white",colors:"#colors",size:1,sizes:"#sizes",zBias:1,zIndex:2});this.linesDataElt=this.view.matrix(this.current.linesParams());this.linesElt=this.view.line({color:this.refColor,width:this.is3D?5:2,opacity:this.is3D?.8:.4,zBias:0,zIndex:1});return this.initialized=true}};t.prototype.loadDynamics=function(t){this.current=t;return this.matrixOrigCoords=(new THREE.Matrix4).multiply(this.coordMat).multiply(this.current.stepMat).multiply(this.coordMatInv)};t.prototype.randomizeCoords=function(){var t,e,s,i,n,r;s=[0,0];i=[0,0];t=D(.5,2);e=t(Math.random());n=Math.random()*2*π;s[0]=Math.cos(n)*e;s[1]=Math.sin(n)*e;r=X()*D(π/4,3*π/4)(Math.random());e=t(Math.random());i[0]=Math.cos(n+r)*e;i[1]=Math.sin(n+r)*e;return this.setCoords(s,i)};return t}();o=function(){function t(t){this.delay=b(this.delay,this);this.start=b(this.start,this);this.unStep=b(this.unStep,this);this.step=b(this.step,this);this.goForwards=b(this.goForwards,this);this.goBackwards=b(this.goBackwards,this);this.loadDynamics=b(this.loadDynamics,this);this.recomputeExtents=b(this.recomputeExtents,this);this.addView=b(this.addView,this);var e,s,i,n,r,o,h;if(t==null){t={}}this.numPointsRow=(e=t.numPointsRow)!=null?e:50;this.numPointsCol=(s=t.numPointsCol)!=null?s:100;this.numPointsDep=(i=t.numPointsDep)!=null?i:10;this.duration=(n=t.duration)!=null?n:3;this.continuous=(r=t.continuous)!=null?r:true;this.is3D=(o=t.is3D)!=null?o:false;this.flow=(h=t.flow)!=null?h:false;this.views=[];this.extents={rad:0,x:0,y:0,z:0};this.current=null;this.direction=1;if(!this.is3D){this.numPointsDep=1}this.numPoints=this.numPointsRow*this.numPointsCol*this.numPointsDep-1;this.curTime=0;this.startTime=-this.duration;this.points=[[0,0,0,1e15]];this.colors=[[0,0,0,1]].concat(function(){var t,e,s;s=[];for(t=0,e=this.numPoints;0<=e?t<e:t>e;0<=e?t++:t--){s.push([Math.random(),1,.7,1])}return s}.call(this))}t.prototype.addView=function(t){t.controller=this;this.views.push(t);return this.recomputeExtents()};t.prototype.recomputeExtents=function(){var t,e,s,i,n,r;this.extents={rad:0,x:0,y:0,z:0};i=this.views;n=[];for(t=0,e=i.length;t<e;t++){r=i[t];n.push(function(){var t,e,i,n;i=["rad","x","y","z"];n=[];for(e=0,t=i.length;e<t;e++){s=i[e];n.push(this.extents[s]=Math.max(this.extents[s],r.extents[s]))}return n}.call(this))}return n};t.prototype.loadDynamics=function(t,e){var s,i,n,r,o,h,a,l;if(e==null){e={}}if(e.onPlane==null){e.onPlane=1/this.numPointsDep}this.current=new t(this.extents,e);for(s=i=1,o=this.numPoints;1<=o?i<=o:i>=o;s=1<=o?++i:--i){this.points[s]=this.current.newPoint();this.points[s][3]=this.curTime+this.delay(true)}h=this.views;a=[];for(r=0,n=h.length;r<n;r++){l=h[r];a.push(l.loadDynamics(this.current))}return a};t.prototype.goBackwards=function(){var t,e,s,i;i=this.points;for(t=0,e=i.length;t<e;t++){s=i[t];this.current.stepMat.applyToVector3Array(s,0,3)}return this.direction=-1};t.prototype.goForwards=function(){var t,e,s,i;i=this.points;for(t=0,e=i.length;t<e;t++){s=i[t];this.current.inverse.stepMat.applyToVector3Array(s,0,3)}return this.direction=1};t.prototype.step=function(){var t,e,s,i,n,r,o,h,a;if(!this.continuous&&!this.flow){if(this.startTime+this.duration>this.curTime){return}this.startTime=this.curTime}if(this.direction===-1){this.goForwards()}o=this.points;for(t=e=0,s=o.length;e<s;t=++e){r=o[t];if(t===0){continue}if(r[3]+this.duration<=this.curTime){this.current.stepMat.applyToVector3Array(r,0,3);this.current.updatePoint(r);r[3]=this.curTime+this.delay()}}h=this.views;for(n=0,i=h.length;n<i;n++){a=h[n];a.pointsElt.set("data",[]);a.pointsElt.set("data",this.points)}return null};t.prototype.unStep=function(){var t,e,s,i,n,r,o,h,a,l;if(!this.continuous&&!this.flow){if(this.startTime+this.duration>this.curTime){return}this.startTime=this.curTime}if(this.direction===1){this.goBackwards()}e=this.current.inverse;h=this.points;for(t=s=0,i=h.length;s<i;t=++s){o=h[t];if(t===0){continue}if(o[3]+this.duration<=this.curTime){e.updatePoint(o);e.stepMat.applyToVector3Array(o,0,3);o[3]=this.curTime+this.delay()}}a=this.views;for(r=0,n=a.length;r<n;r++){l=a[r];l.pointsElt.set("data",[]);l.pointsElt.set("data",this.points)}return null};t.prototype.start=function(t){if(t==null){t=100}return setInterval(this.step,t)};t.prototype.delay=function(t){var e,s;if(!this.continuous){if(t){return-this.duration}else{return 0}}s=this.numPoints/1e3;e=Math.random()*s;if(t){return e-.5*s}else{return e}};return t}();a=function(){function t(t,e){var s,i;this.extents=t;this.linesParams=b(this.linesParams,this);this.updatePoint=b(this.updatePoint,this);this.newPoint=b(this.newPoint,this);this.timeToLeave=b(this.timeToLeave,this);this.scaleZ=(s=e.scaleZ)!=null?s:0;this.onPlane=(i=e.onPlane)!=null?i:1/20;if(Math.abs(this.scaleZ)<1e-5){this.is3D=false;this.zAtTime=function(t,e){return 0};this.timeToLeaveZ=function(t){return Infinity};this.needsResetZ=function(t){return function(t){return false}}(this)}else if(Math.abs(this.scaleZ-1)<1e-5){this.is3D=true;this.scaleZ=1;this.origLerpZ=D(.01,this.extents.z);this.zAtTime=function(t,e){return t};this.timeToLeaveZ=function(t){return Infinity};this.needsResetZ=function(t){return function(t){return false}}(this)}else if(this.scaleZ<1){this.is3D=true;this.origLerpZ=_(.01,this.extents.z/this.scaleZ);this.newLerpZ=_(this.extents.z,this.extents.z/this.scaleZ);this.zAtTime=function(t){return function(e,s){return e*Math.pow(t.scaleZ,s)}}(this);this.timeToLeaveZ=function(t){return function(e){return Math.log(.01/Math.abs(e))/Math.log(t.scaleZ)}}(this);this.needsResetZ=function(t){return function(t){return Math.abs(t)<.01}}(this)}else if(this.scaleZ>1){this.is3D=true;this.origLerpZ=_(.01/this.scaleZ,this.extents.z);this.newLerpZ=_(.01/this.scaleZ,.01);this.zAtTime=function(t){return function(e,s){return e*Math.pow(t.scaleZ,s)}}(this);this.timeToLeaveZ=function(t){return function(e){return Math.log(t.extents.z/Math.abs(e))/Math.log(t.scaleZ)}}(this);this.needsResetZ=function(t){return function(e){return Math.abs(e)>t.extents.z}}(this)}this.invScaleZ=this.is3D?1/this.scaleZ:0}t.prototype.makeStepMat=function(t,e,s,i){var n;n=this.scaleZ;this.stepMat22=[[t,e],[s,i]];return this.stepMat=(new THREE.Matrix4).set(t,e,0,0,s,i,0,0,0,0,n,0,0,0,0,1)};t.prototype.timeToLeave=function(t){var e;e=this.timeToLeaveZ(t[2]);if(isFinite(e)&&e>=0&&e<=25){return e}e=this.timeToLeaveXY(t[0],t[1]);if(e>=0&&e<=25){return e}else{return Infinity}};t.prototype.newPoint=function(){var t,e;if(this.is3D){if(Math.random()<this.onPlane){e=0}else{e=X()*this.origLerpZ(Math.random())}}else{e=0}t=this.origDistr();return[t[0],t[1],e,0]};t.prototype.updatePoint=function(t){var e;if(this.needsResetXY(t[0],t[1])){e=this.newDistr(t),t[0]=e[0],t[1]=e[1]}if(!(this.is3D&&this.scaleZ!==1)){return t}if(t[2]===0){return t}if(this.needsResetZ(t[2])){t[2]=X()*this.newLerpZ(Math.random())}return t};t.prototype.linesParams=function(){var t;t=this.makeReference();return{channels:2,height:t.length,width:t[0].length,items:t[0][0].length,live:false,data:t}};t.prototype.shaderParams=function(t){if(t.uniforms==null){t.uniforms={}}t.uniforms.scaleZ={type:"f",value:this.scaleZ};return t};return t}();r=function(t){I(e,t);function e(t,s){this.shaderParams=b(this.shaderParams,this);this.distr=b(this.distr,this);this.newDistr=b(this.newDistr,this);this.origDistr=b(this.origDistr,this);var i,n;e.__super__.constructor.call(this,t,s);if(s==null){s={}}this.θ=(i=s.θ)!=null?i:X()*D(π/6,5*π/6)(Math.random());this.scale=(n=s.scale)!=null?n:this.randomScale();this.logScale=Math.log(this.scale);this.makeStepMat(Math.cos(this.θ)*this.scale,-Math.sin(this.θ)*this.scale,Math.sin(this.θ)*this.scale,Math.cos(this.θ)*this.scale);this.makeDistributions(s)}e.prototype.origDistr=function(){return this.distr(this.origDist)};e.prototype.newDistr=function(){return this.distr(this.newDist)};e.prototype.distr=function(t){var e,s;e=t(Math.random());s=Math.random()*2*π;return[Math.cos(s)*e,Math.sin(s)*e]};e.prototype.shaderParams=function(){return e.__super__.shaderParams.call(this,{code:z,uniforms:{deltaAngle:{type:"f",value:this.θ},scale:{type:"f",value:this.scale}}})};return e}(a);n=function(t){I(e,t);e.prototype.descr=function(){return"Ovals"};function e(t,s){this.makePath=b(this.makePath,this);this.makeReference=b(this.makeReference,this);this.makeDistributions=b(this.makeDistributions,this);this.randomScale=b(this.randomScale,this);var i;e.__super__.constructor.call(this,t,s);this.inverse=(i=s!=null?s.inverse:void 0)!=null?i:new e(t,{"θ":-this.θ,scale:1/this.scale,inverse:this,scaleZ:this.invScaleZ})}e.prototype.randomScale=function(){return 1};e.prototype.makeDistributions=function(t){return this.newDist=this.origDist=P(.01,this.extents.rad,1/2)};e.prototype.makeReference=function(){var t,e,s,i,n,r,o,h,a,l,u;h=[];for(u=t=0,s=2*π,i=π/72;i>0?t<s:t>s;u=t+=i){a=[];for(l=e=n=this.extents.rad/10,r=this.extents.rad,o=this.extents.rad/10;o>0?e<r:e>r;l=e+=o){a.push([l*Math.cos(u),l*Math.sin(u)])}h.push(a)}h.push(h[0]);return[h]};e.prototype.makePath=function(t,e){var s,i,n,r,o,h,a,l;a=this.timeToLeave(t);if(!isFinite(a)){a=2*π*(e.length+1)/(e.length*Math.abs(this.θ))}h=a*this.θ;for(i=n=0,r=e.length;0<=r?n<r:n>r;i=0<=r?++n:--n){l=h*i/e.length;s=Math.cos(l);o=Math.sin(l);e[i]=[s*t[0]-o*t[1],o*t[0]+s*t[1],this.zAtTime(t[2],a*i/e.length)]}return e};e.prototype.needsResetXY=function(t,e){return false};e.prototype.timeToLeaveXY=function(t,e){return Infinity};return e}(r);w=function(t){I(e,t);function e(){this.makePath=b(this.makePath,this);this.makeReference=b(this.makeReference,this);return e.__super__.constructor.apply(this,arguments)}e.prototype.makeReference=function(){var t,e,s,i,n,r,o,h,a,l,u,c,p,f,d,m,v,y,w;p=[];t=.05;m=this.scale>1?this.scale:1/this.scale;n=(Math.log(this.extents.rad)-Math.log(t))/Math.log(m);f=Math.ceil(this.θ*n/2*π);e=this.direction;for(s=o=0,l=f;0<=l?o<=l:o>=l;s=0<=l?++o:--o){d=[];for(y=h=0;h<=100;y=++h){w=(s+y/100)*2*π;v=t*Math.pow(m,w/this.θ);i=[];for(r=a=0,u=2*π,c=π/4;c>0?a<u:a>u;r=a+=c){i.push([v*Math.cos(e*(w+r)),v*Math.sin(e*(w+r))])}d.push(i)}p.push(d)}return p};e.prototype.makePath=function(t,e){var s,i,n,r,o,h,a,l,u,c;u=this.timeToLeave(t);if(!isFinite(u)){u=2*π*(e.length+1)/(e.length*Math.abs(this.θ))}l=u*this.θ;for(i=n=0,r=e.length;0<=r?n<r:n>r;i=0<=r?++n:--n){c=l*i/e.length;s=Math.cos(c);o=Math.sin(c);a=u*i/e.length;h=Math.pow(this.scale,a);e[i]=[h*s*t[0]-h*o*t[1],h*o*t[0]+h*s*t[1],this.zAtTime(t[2],a)]}return e};return e}(r);x=function(t){I(e,t);e.prototype.descr=function(){return"Spiral in"};function e(t,s){this.timeToLeaveXY=b(this.timeToLeaveXY,this);this.needsResetXY=b(this.needsResetXY,this);this.makeDistributions=b(this.makeDistributions,this);var i;e.__super__.constructor.call(this,t,s);this.direction=-1;this.inverse=(i=s!=null?s.inverse:void 0)!=null?i:new M(t,{"θ":-this.θ,scale:1/this.scale,inverse:this,dist:this.distType,scaleZ:this.invScaleZ})}e.prototype.randomScale=function(){return D(.3,.8)(Math.random())};e.prototype.makeDistributions=function(t){var e,s,i;this.close=.01;this.medium=this.extents.rad;this.far=this.extents.rad/this.scale;this.distType=(i=t.dist)!=null?i:k(["cont","disc"]);switch(this.distType){case"cont":this.origDist=_(this.close,this.far);return this.newDist=_(this.medium,this.far);case"disc":s=[];e=this.far;while(e>this.close){s.push(e);e*=this.scale}this.origDist=function(t){return s[Math.floor(t*s.length)]};return this.newDist=function(t){return function(e){return t.far}}(this)}};e.prototype.needsResetXY=function(t,e){return t*t+e*e<this.close*this.close};e.prototype.timeToLeaveXY=function(t,e){return(Math.log(.01)-.5*Math.log(t*t+e*e))/this.logScale};return e}(w);M=function(t){I(e,t);e.prototype.descr=function(){return"Spiral out"};function e(t,s){this.timeToLeaveXY=b(this.timeToLeaveXY,this);this.needsResetXY=b(this.needsResetXY,this);this.makeDistributions=b(this.makeDistributions,this);this.randomScale=b(this.randomScale,this);var i;e.__super__.constructor.call(this,t,s);this.direction=1;this.inverse=(i=s!=null?s.inverse:void 0)!=null?i:new x(t,{"θ":-this.θ,scale:1/this.scale,inverse:this,dist:this.distType,scaleZ:this.invScaleZ})}e.prototype.randomScale=function(){return D(1/.8,1/.3)(Math.random())};e.prototype.makeDistributions=function(t){var e,s,i;this.veryClose=.01/this.scale;this.close=.01;this.medium=this.extents.rad;this.distType=(i=t.dist)!=null?i:k(["cont","disc"]);switch(this.distType){case"cont":this.origDist=_(this.veryClose,this.medium);return this.newDist=_(this.veryClose,this.close);case"disc":s=[];e=this.veryClose;while(e<this.medium){s.push(e);e*=this.scale}this.origDist=function(t){return s[Math.floor(t*s.length)]};return this.newDist=function(t){return function(e){return t.veryClose}}(this)}};e.prototype.needsResetXY=function(t,e){return t*t+e*e>this.medium*this.medium};e.prototype.timeToLeaveXY=function(t,e){return(Math.log(this.extents.rad)-.5*Math.log(t*t+e*e))/this.logScale};return e}(w);h=function(t){I(e,t);function e(t,s){this.makePath=b(this.makePath,this);this.shaderParams=b(this.shaderParams,this);this.swap=b(this.swap,this);var i,n;e.__super__.constructor.call(this,t,s);if(s==null){s={}}this.swapped=false;this.makeScales(s);i=this.λ1;if(s.negate1){i*=-1}n=this.λ2;if(s.negate2){n*=-1}if(this.swapped){this.makeStepMat(n,0,0,i)}else{this.makeStepMat(i,0,0,n)}}e.prototype.swap=function(){var t;t=[this.λ1,this.λ2],this.λ2=t[0],this.λ1=t[1];this.extents={rad:this.extents.rad,x:this.extents.y,y:this.extents.x,z:this.extents.z};return this.swapped=true};e.prototype.shaderParams=function(){return e.__super__.shaderParams.call(this,{code:S,uniforms:{scaleX:{type:"f",value:this.swapped?this.λ2:this.λ1},scaleY:{type:"f",value:this.swapped?this.λ1:this.λ2}}})};e.prototype.makePath=function(t,e){var s,i,n,r,o,h,a;a=this.timeToLeave(t);if(!isFinite(a)){a=25}if(this.swapped){r=this.λ2;o=this.λ1}else{r=this.λ1;o=this.λ2}for(s=i=0,n=e.length;0<=n?i<n:i>n;s=0<=n?++i:--i){h=a*s/e.length;e[s]=[t[0]*Math.pow(r,h),t[1]*Math.pow(o,h),this.zAtTime(t[2],h)]}return e};return e}(a);c=function(t){I(e,t);e.prototype.descr=function(){return"Hyperbolas"};function e(t,s){this.timeToLeaveXY=b(this.timeToLeaveXY,this);this.needsResetXY=b(this.needsResetXY,this);this.makeReference=b(this.makeReference,this);this.distr=b(this.distr,this);this.newDistr=b(this.newDistr,this);this.origDistr=b(this.origDistr,this);this.makeScales=b(this.makeScales,this);var i,n,r,o;e.__super__.constructor.call(this,t,s);i=this.swapped?[this.λ2,this.λ1]:[this.λ1,this.λ2],r=i[0],o=i[1];this.inverse=(n=s!=null?s.inverse:void 0)!=null?n:new e(t,{"λ1":1/r,"λ2":1/o,inverse:this,scaleZ:this.invScaleZ})}e.prototype.makeScales=function(t){var e,s;this.λ1=(e=t.λ1)!=null?e:D(.3,.8)(Math.random());this.λ2=(s=t.λ2)!=null?s:D(1/.8,1/.3)(Math.random());if(this.λ1>this.λ2){this.swap()}this.logScaleX=Math.log(this.λ1);this.logScaleY=Math.log(this.λ2);this.close=.05;this.closeR=Math.pow(this.close,this.logScaleY-this.logScaleX);this.farR=Math.pow(this.extents.x,this.logScaleY)*Math.pow(this.extents.y,-this.logScaleX);return this.lerpR=D(this.closeR,this.farR)};e.prototype.origDistr=function(){return this.distr(true)};e.prototype.newDistr=function(){return this.distr(false)};e.prototype.distr=function(t){var e,s,i,n;s=this.lerpR(Math.random());if(t){e=Math.pow(s*Math.pow(this.extents.y,this.logScaleX),1/this.logScaleY);i=_(e,this.extents.x/this.λ1)(Math.random())}else{i=_(this.extents.x,this.extents.x/this.λ1)(Math.random())}n=Math.pow(1/s*Math.pow(i,this.logScaleY),1/this.logScaleX);if(this.swapped){return[X()*n,X()*i]}else{return[X()*i,X()*n]}};e.prototype.makeReference=function(){var t,e,s,i,n,r,o,h,a,l,u;o=[];for(a=s=0;s<20;a=++s){r=this.lerpR(a/20);t=Math.pow(r*Math.pow(this.extents.y,this.logScaleX),1/this.logScaleY);i=_(t,this.extents.x);h=[];for(e=n=0;n<=100;e=++n){l=i(e/100);u=Math.pow(1/r*Math.pow(l,this.logScaleY),1/this.logScaleX);if(this.swapped){h.push([[u,l],[u,-l],[-u,l],[-u,-l]])}else{h.push([[l,u],[-l,u],[l,-u],[-l,-u]])}}o.push(h)}return o};e.prototype.needsResetXY=function(t,e){return Math.abs(this.swapped?t:e)>this.extents.y};e.prototype.timeToLeaveXY=function(t,e){if(this.swapped){e=t}return(Math.log(this.extents.y)-Math.log(Math.abs(e)))/this.logScaleY};return e}(h);s=function(t){I(e,t);function e(){this.makeReference=b(this.makeReference,this);this.makeScales=b(this.makeScales,this);return e.__super__.constructor.apply(this,arguments)}e.prototype.makeScales=function(t){var e,s;this.logScaleX=Math.log(this.λ1);this.logScaleY=Math.log(this.λ2);s=.05;this.lerpR=function(t){t=D(s,1-s)(t);return Math.pow(t,this.logScaleY)*Math.pow(1-t,-this.logScaleX)};e=this.logScaleY/this.logScaleX;this.sMin=.01;this.sMax=Math.pow(this.extents.x,e)+this.extents.y;this.yValAt=function(t,e){return e/(1+Math.pow(t,1/this.logScaleX))};return this.xOfY=function(t,e){return Math.pow(e*Math.pow(t,this.logScaleX),1/this.logScaleY)}};e.prototype.makeReference=function(){var t,e,s,i,n,r,o,h,a;r=[];for(t=e=0;e<15;t=++e){n=this.lerpR(t/15);s=_(.01,this.extents.y);o=[];for(t=i=0;i<=100;t=++i){a=s(t/100);h=this.xOfY(a,n);o.push([[h,a],[-h,a],[h,-a],[-h,-a]])}r.push(o)}return r};return e}(h);t=function(t){I(e,t);e.prototype.descr=function(){return"Attracting point"};function e(t,s){this.timeToLeaveXY=b(this.timeToLeaveXY,this);this.needsResetXY=b(this.needsResetXY,this);this.distr=b(this.distr,this);this.newDistr=b(this.newDistr,this);this.origDistr=b(this.origDistr,this);this.makeScales=b(this.makeScales,this);var i;e.__super__.constructor.call(this,t,s);this.inverse=(i=s!=null?s.inverse:void 0)!=null?i:new p(t,{"λ1":1/this.λ1,"λ2":1/this.λ2,inverse:this,scaleZ:this.invScaleZ})}e.prototype.makeScales=function(t){var s,i;this.λ1=(s=t.λ1)!=null?s:D(.3,.9)(Math.random());this.λ2=(i=t.λ2)!=null?i:D(.3,this.λ1)(Math.random());if(this.λ1<this.λ2){throw"Must pass smaller eigenvalue second"}return e.__super__.makeScales.call(this,t)};e.prototype.origDistr=function(){return this.distr(true)};e.prototype.newDistr=function(){return this.distr(false)};e.prototype.distr=function(t){var e,s,i,n,r;i=this.lerpR(Math.random());s=this.yValAt(i,this.sMax/this.λ2);if(t){e=this.yValAt(i,this.sMin)}else{e=this.yValAt(i,this.sMax)}r=_(e,s)(Math.random());n=this.xOfY(r,i);return[X()*n,X()*r]};e.prototype.needsResetXY=function(t,e){return Math.abs(e)<.01};e.prototype.timeToLeaveXY=function(t,e){return(Math.log(.01)-Math.log(Math.abs(e)))/this.logScaleY};return e}(s);p=function(e){I(s,e);s.prototype.descr=function(){return"Repelling point"};function s(e,i){this.timeToLeaveXY=b(this.timeToLeaveXY,this);this.needsResetXY=b(this.needsResetXY,this);this.distr=b(this.distr,this);this.newDistr=b(this.newDistr,this);this.origDistr=b(this.origDistr,this);this.makeScales=b(this.makeScales,this);var n;s.__super__.constructor.call(this,e,i);this.inverse=(n=i!=null?i.inverse:void 0)!=null?n:new t(e,{"λ1":1/this.λ1,"λ2":1/this.λ2,inverse:this,scaleZ:this.invScaleZ})}s.prototype.makeScales=function(t){var e,i;this.λ2=(e=t.λ2)!=null?e:D(1/.9,1/.3)(Math.random());this.λ1=(i=t.λ1)!=null?i:D(1/.9,this.λ2)(Math.random());if(this.λ1>this.λ2){throw"Must pass smaller eigenvalue first"}return s.__super__.makeScales.call(this,t)};s.prototype.origDistr=function(){return this.distr(true)};s.prototype.newDistr=function(){return this.distr(false)};s.prototype.distr=function(t){var e,s,i,n,r;i=this.lerpR(Math.random());e=this.yValAt(i,this.sMin/this.λ2);if(t){s=this.yValAt(i,this.sMax)}else{s=this.yValAt(i,this.sMin)}r=_(e,s)(Math.random());n=this.xOfY(r,i);return[X()*n,X()*r]};s.prototype.needsResetXY=function(t,e){return Math.abs(t)>this.extents.x||Math.abs(e)>this.extents.y};s.prototype.timeToLeaveXY=function(t,e){return Math.min((Math.log(this.extents.x)-Math.log(Math.abs(t)))/this.logScaleX,(Math.log(this.extents.y)-Math.log(Math.abs(e)))/this.logScaleY)};return s}(s);i=function(t){I(e,t);function e(){this.makeReference=b(this.makeReference,this);this.distr=b(this.distr,this);this.newDistr=b(this.newDistr,this);this.origDistr=b(this.origDistr,this);this.makeScales=b(this.makeScales,this);return e.__super__.constructor.apply(this,arguments)}e.prototype.makeScales=function(t){this.λ1=1;return this.lerpX=D(-this.extents.x,this.extents.x)};e.prototype.origDistr=function(){return this.distr(this.origLerpY)};e.prototype.newDistr=function(){return this.distr(this.newLerpY)};e.prototype.distr=function(t){var e,s;e=this.lerpX(Math.random());s=t(Math.random());return[e,X()*s]};e.prototype.makeReference=function(){var t,e,s,i,n;e=[];s=[];for(t=i=0;i<20;t=++i){n=this.lerpX((t+.5)/20);e.push([n,-this.extents.y]);s.push([n,this.extents.y])}return[[e,s]]};return e}(h);e=function(t){I(e,t);e.prototype.descr=function(){return"Attracting line"};function e(t,s){this.timeToLeaveXY=b(this.timeToLeaveXY,this);this.needsResetXY=b(this.needsResetXY,this);this.makeScales=b(this.makeScales,this);var i;e.__super__.constructor.call(this,t,s);this.inverse=(i=s!=null?s.inverse:void 0)!=null?i:new f(t,{"λ1":1/this.λ1,"λ2":1/this.λ2,inverse:this,scaleZ:this.invScaleZ})}e.prototype.makeScales=function(t){var s;e.__super__.makeScales.call(this,t);this.λ2=(s=t.λ2)!=null?s:D(.3,.8)(Math.random());this.origLerpY=_(.01,this.extents.y/this.λ2);return this.newLerpY=_(this.extents.y,this.extents.y/this.λ2)};e.prototype.needsResetXY=function(t,e){return Math.abs(e)<.01};e.prototype.timeToLeaveXY=function(t,e){return(Math.log(.01)-Math.log(Math.abs(e)))/this.logScaleY};return e}(i);f=function(t){I(s,t);s.prototype.descr=function(){return"Repelling line"};function s(t,i){this.timeToLeaveXY=b(this.timeToLeaveXY,this);this.needsResetXY=b(this.needsResetXY,this);this.makeScales=b(this.makeScales,this);var n;s.__super__.constructor.call(this,t,i);this.inverse=(n=i!=null?i.inverse:void 0)!=null?n:new e(t,{"λ1":1/this.λ1,"λ2":1/this.λ2,inverse:this,scaleZ:this.invScaleZ})}s.prototype.makeScales=function(t){var e;s.__super__.makeScales.call(this,t);this.λ2=(e=t.λ2)!=null?e:D(1/.8,1/.3)(Math.random());this.origLerpY=_(.01/this.λ2,this.extents.y);return this.newLerpY=_(.01/this.λ2,.01)};s.prototype.needsResetXY=function(t,e){return Math.abs(e)>this.extents.y};s.prototype.timeToLeaveXY=function(t,e){return(Math.log(this.extents.y)-Math.log(Math.abs(e)))/this.logScaleY};return s}(i);y=function(t){I(e,t);e.prototype.descr=function(){return"Shear"};function e(t,s){this.makePath=b(this.makePath,this);this.timeToLeaveXY=b(this.timeToLeaveXY,this);this.needsResetXY=b(this.needsResetXY,this);this.makeReference=b(this.makeReference,this);this.shaderParams=b(this.shaderParams,this);this.newDistr=b(this.newDistr,this);this.origDistr=b(this.origDistr,this);var i,n;e.__super__.constructor.call(this,t,s);if(s==null){s={}}this.translate=(i=s.translate)!=null?i:X()*D(.2,2)(Math.random());this.makeStepMat(1,this.translate,0,1);this.lerpY=D(.01,this.extents.y);this.lerpY2=D(-this.extents.y,this.extents.y);this.inverse=(n=s!=null?s.inverse:void 0)!=null?n:new e(t,{translate:-this.translate,inverse:this,scaleZ:this.invScaleZ})}e.prototype.origDistr=function(){var t,e,s,i;t=this.translate;i=this.lerpY(Math.random());if(Math.random()<.005){i=0;s=D(-this.extents.x,this.extents.x)(Math.random())}else{if(t<0){s=D(-this.extents.x,this.extents.x-t*i)(Math.random())}else{s=D(-this.extents.x-t*i,this.extents.x)(Math.random())}}e=X();return[e*s,e*i]};e.prototype.newDistr=function(t){var e,s,i,n;e=this.translate;n=Math.abs(t[1]);if(e<0){i=D(this.extents.x,this.extents.x-e*n)(Math.random())}else{i=D(-this.extents.x-e*n,-this.extents.x)(Math.random())}s=X();return[s*i,s*n]};e.prototype.shaderParams=function(){return e.__super__.shaderParams.call(this,{code:Z,uniforms:{scale:{type:"f",value:1},translate:{type:"f",value:this.translate}}})};e.prototype.makeReference=function(){var t,e,s,i,n;e=[];s=[];for(t=i=0;i<20;t=++i){n=this.lerpY2((t+.5)/20);e.push([-this.extents.x,n]);s.push([this.extents.x,n])}return[[e,s]]};e.prototype.needsResetXY=function(t,e){return Math.abs(t)>this.extents.x};e.prototype.timeToLeaveXY=function(t,e){var s;s=e>0?this.extents.x:-this.extents.x;return(s-t)/(this.translate*e)};e.prototype.makePath=function(t,e){var s,i,n,r,o;o=this.timeToLeave(t);if(!isFinite(o)){o=100}for(s=i=0,n=e.length;0<=n?i<n:i>n;s=0<=n?++i:--i){r=o*s/e.length;e[s]=[t[0]+r*this.translate*t[1],t[1],this.zAtTime(t[2],r)]}return e};return e}(a);d=function(t){I(e,t);function e(t,s){this.makePath=b(this.makePath,this);this.makeReference=b(this.makeReference,this);this.shaderParams=b(this.shaderParams,this);this.distr=b(this.distr,this);this.newDistr=b(this.newDistr,this);this.origDistr=b(this.origDistr,this);var i,n,r;e.__super__.constructor.call(this,t,s);if(s==null){s={}}this.translate=(n=s.translate)!=null?n:X()*D(.2,2)(Math.random());r=this.scale;i=this.translate;this.makeStepMat(r,r*i,0,r);this.logScale=Math.log(r);this.xOfY=function(t,e){return e*(t+i*Math.log(e)/this.logScale)};this.lerpR=function(t){return Math.tan((t-.5)*π)};this.lerpR2=function(t){return Math.tan((t/.99+.005-.5)*π)}}e.prototype.origDistr=function(){return this.distr(this.lerpY)};e.prototype.newDistr=function(){return this.distr(this.lerpYNew)};e.prototype.distr=function(t){var e,s,i,n;e=this.lerpR2(Math.random());n=t(Math.random());i=this.xOfY(e,n);s=X();return[s*i,s*n]};e.prototype.shaderParams=function(){return e.__super__.shaderParams.call(this,{code:Z,uniforms:{scale:{type:"f",value:this.scale},translate:{type:"f",value:this.translate}}})};e.prototype.makeReference=function(){var t,e,s,i,n,r,o,h,a,l,u;h=[];n=40;for(t=s=1,o=n;1<=o?s<o:s>o;t=1<=o?++s:--s){r=this.lerpR(t/n);a=[];for(e=i=0;i<100;e=++i){u=this.lerpY(e/100);l=this.xOfY(r,u);a.push([[l,u],[-l,-u]])}h.push(a)}return h};e.prototype.makePath=function(t,e){var s,i,n,r,o,h,a,l;a=this.timeToLeave(t);if(!isFinite(a)){a=25}l=this.scale;s=this.translate;for(i=n=0,r=e.length;0<=r?n<r:n>r;i=0<=r?++n:--n){h=a*i/e.length;o=Math.pow(l,h);e[i]=[o*t[0]+o*s*h*t[1],o*t[1],this.zAtTime(t[2],h)]}return e};return e}(a);v=function(t){I(e,t);e.prototype.descr=function(){return"Scale-out shear"};function e(t,s){var i,n;this.extents=t;this.timeToLeaveXY=b(this.timeToLeaveXY,this);this.needsResetXY=b(this.needsResetXY,this);if(s==null){s={}}this.scale=(i=s.scale)!=null?i:D(1/.7,1/.3)(Math.random());this.lerpY=_(.01/this.scale,this.extents.y);this.lerpYNew=_(.01/this.scale,.01);e.__super__.constructor.call(this,this.extents,s);this.inverse=(n=s!=null?s.inverse:void 0)!=null?n:new m(this.extents,{translate:-this.translate,scale:1/this.scale,inverse:this,scaleZ:this.invScaleZ})}e.prototype.needsResetXY=function(t,e){return Math.abs(e)>this.extents.y};e.prototype.timeToLeaveXY=function(t,e){return(Math.log(this.extents.y)-Math.log(Math.abs(e)))/this.logScale};return e}(d);m=function(t){I(e,t);e.prototype.descr=function(){return"Scale-in shear"};function e(t,s){var i,n;this.extents=t;this.timeToLeaveXY=b(this.timeToLeaveXY,this);this.needsResetXY=b(this.needsResetXY,this);if(s==null){s={}}this.scale=(i=s.scale)!=null?i:D(.3,.7)(Math.random());this.lerpY=_(.01,this.extents.y/this.scale);this.lerpYNew=_(this.extents.y,this.extents.y/this.scale);e.__super__.constructor.call(this,this.extents,s);this.inverse=(n=s!=null?s.inverse:void 0)!=null?n:new v(this.extents,{translate:-this.translate,scale:1/this.scale,inverse:this,scaleZ:this.invScaleZ})}e.prototype.needsResetXY=function(t,e){return Math.abs(e)<.01};e.prototype.timeToLeaveXY=function(t,e){return(Math.log(.01)-Math.log(Math.abs(e)))/this.logScale};return e}(d);window.dynamics={};window.dynamics.DynamicsView=l;window.dynamics.Controller=o;window.dynamics.Circle=n;window.dynamics.SpiralIn=x;window.dynamics.SpiralOut=M;window.dynamics.Hyperbolas=c;window.dynamics.Attract=t;window.dynamics.Repel=p;window.dynamics.AttractLine=e;window.dynamics.RepelLine=f;window.dynamics.Shear=y;window.dynamics.ScaleOutShear=v;window.dynamics.ScaleInShear=m}).call(this);
